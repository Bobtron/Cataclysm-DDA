<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm DDA: src/ranged.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm DDA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ranged.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="ranged_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ranged_8h.html">ranged.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;functional&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;tuple&gt;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160; </div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="activity__actor__definitions_8h.html">activity_actor_definitions.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avatar_8h.html">avatar.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="bionics_8h.html">bionics.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ballistics_8h.html">ballistics.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cached__options_8h.html">cached_options.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="calendar_8h.html">calendar.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cata__scope__helpers_8h.html">cata_scope_helpers.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cata__utility_8h.html">cata_utility.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="catacharset_8h.html">catacharset.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="character_8h.html">character.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="color_8h.html">color.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="creature__tracker_8h.html">creature_tracker.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cursesdef_8h.html">cursesdef.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="damage_8h.html">damage.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">debug.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dispersion_8h.html">dispersion.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="enums_8h.html">enums.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="event_8h.html">event.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="event__bus_8h.html">event_bus.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="flag_8h.html">flag.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="game_8h.html">game.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="game__constants_8h.html">game_constants.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gun__mode_8h.html">gun_mode.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="input_8h.html">input.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="input__context_8h.html">input_context.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="item_8h.html">item.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="item__location_8h.html">item_location.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="itype_8h.html">itype.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="line_8h.html">line.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="magic_8h.html">magic.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="map_8h.html">map.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="math__defines_8h.html">math_defines.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="memory__fast_8h.html">memory_fast.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="messages_8h.html">messages.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="monster_8h.html">monster.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="morale__types_8h.html">morale_types.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mtype_8h.html">mtype.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="npc_8h.html">npc.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="options_8h.html">options.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="output_8h.html">output.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="panels_8h.html">panels.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pocket__type_8h.html">pocket_type.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="point_8h.html">point.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="projectile_8h.html">projectile.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ret__val_8h.html">ret_val.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rng_8h.html">rng.h</a>&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="skill_8h.html">skill.h</a>&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sounds_8h.html">sounds.h</a>&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="string__formatter_8h.html">string_formatter.h</a>&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="translations_8h.html">translations.h</a>&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trap_8h.html">trap.h</a>&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="try__parse__integer_8h.html">try_parse_integer.h</a>&quot;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="type__id_8h.html">type_id.h</a>&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ui_8h.html">ui.h</a>&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ui__manager_8h.html">ui_manager.h</a>&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="units_8h.html">units.h</a>&quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="units__utility_8h.html">units_utility.h</a>&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="value__ptr_8h.html">value_ptr.h</a>&quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vehicle_8h.html">vehicle.h</a>&quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vpart__position_8h.html">vpart_position.h</a>&quot;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="weakpoint_8h.html">weakpoint.h</a>&quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a5b115344b066e0eebf72b6fcafaebfb2">   79</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a5b115344b066e0eebf72b6fcafaebfb2">ammo_120mm</a>( <span class="stringliteral">&quot;120mm&quot;</span> );</div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7c9a7d0a1b73c0f70f96584ecc262420">   80</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a7c9a7d0a1b73c0f70f96584ecc262420">ammo_12mm</a>( <span class="stringliteral">&quot;12mm&quot;</span> );</div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a5894429e236b2dc2ee157ce48d7ad02e">   81</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a5894429e236b2dc2ee157ce48d7ad02e">ammo_40x46mm</a>( <span class="stringliteral">&quot;40x46mm&quot;</span> );</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a57ab4ea57b22b751cee023b1798c68f2">   82</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a57ab4ea57b22b751cee023b1798c68f2">ammo_40x53mm</a>( <span class="stringliteral">&quot;40x53mm&quot;</span> );</div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab386b4796e39e527e91a503f6975c82d">   83</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#ab386b4796e39e527e91a503f6975c82d">ammo_66mm</a>( <span class="stringliteral">&quot;66mm&quot;</span> );</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a638a17e59573d9d6bac0a05980096c37">   84</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a638a17e59573d9d6bac0a05980096c37">ammo_84x246mm</a>( <span class="stringliteral">&quot;84x246mm&quot;</span> );</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a68193ecd0be34e65f12a3febf6f7b6e1">   85</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a68193ecd0be34e65f12a3febf6f7b6e1">ammo_RPG_7</a>( <span class="stringliteral">&quot;RPG-7&quot;</span> );</div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a282ca1601a24be0ae7aae003597e7ada">   86</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a282ca1601a24be0ae7aae003597e7ada">ammo_arrow</a>( <span class="stringliteral">&quot;arrow&quot;</span> );</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a990502dafd582f371f40de17ae3f5ef4">   87</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a990502dafd582f371f40de17ae3f5ef4">ammo_atgm</a>( <span class="stringliteral">&quot;atgm&quot;</span> );</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6ce4de21dacf3a60c3da7dcead0fd08f">   88</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a6ce4de21dacf3a60c3da7dcead0fd08f">ammo_atlatl</a>( <span class="stringliteral">&quot;atlatl&quot;</span> );</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a609c386685fa395233e3f1765e57a38b">   89</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a609c386685fa395233e3f1765e57a38b">ammo_bolt</a>( <span class="stringliteral">&quot;bolt&quot;</span> );</div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#abab3d18c8a6ece5b486b6e3965e27dde">   90</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#abab3d18c8a6ece5b486b6e3965e27dde">ammo_bolt_ballista</a>( <span class="stringliteral">&quot;bolt_ballista&quot;</span> );</div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a66543644370f9b1d803abac7d90cd033">   91</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a66543644370f9b1d803abac7d90cd033">ammo_flammable</a>( <span class="stringliteral">&quot;flammable&quot;</span> );</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aecf1c5ee613ec0609d2ae3a7a46b4b8d">   92</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#aecf1c5ee613ec0609d2ae3a7a46b4b8d">ammo_homebrew_rocket</a>( <span class="stringliteral">&quot;homebrew_rocket&quot;</span> );</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a81c0e98b7eaad878f45b27c21f4d6393">   93</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a81c0e98b7eaad878f45b27c21f4d6393">ammo_m235</a>( <span class="stringliteral">&quot;m235&quot;</span> );</div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ac283fa14509e26bd1becc0a28dfcb8d1">   94</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#ac283fa14509e26bd1becc0a28dfcb8d1">ammo_metal_rail</a>( <span class="stringliteral">&quot;metal_rail&quot;</span> );</div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4daea1de5d5e6f0b8d268b627b874139">   95</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">ammotype</a> <a class="code" href="ranged_8cpp.html#a4daea1de5d5e6f0b8d268b627b874139">ammo_strange_arrow</a>( <span class="stringliteral">&quot;strange_arrow&quot;</span> );</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">   97</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a>( <span class="stringliteral">&quot;bio_railgun&quot;</span> );</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">character_modifier_id</a></div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a591e788884fe3dc8032be8a9fc2ceb3c">  100</a></span>&#160;<a class="code" href="ranged_8cpp.html#a591e788884fe3dc8032be8a9fc2ceb3c">character_modifier_melee_thrown_move_balance_mod</a>( <span class="stringliteral">&quot;melee_thrown_move_balance_mod&quot;</span> );</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">character_modifier_id</a></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a8d4ed92ee82965b00b2c043ef36261d2">  102</a></span>&#160;<a class="code" href="ranged_8cpp.html#a8d4ed92ee82965b00b2c043ef36261d2">character_modifier_melee_thrown_move_lift_mod</a>( <span class="stringliteral">&quot;melee_thrown_move_lift_mod&quot;</span> );</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">character_modifier_id</a></div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aef6b532c29ec965cbee404c29746a7da">  104</a></span>&#160;<a class="code" href="ranged_8cpp.html#aef6b532c29ec965cbee404c29746a7da">character_modifier_ranged_dispersion_manip_mod</a>( <span class="stringliteral">&quot;ranged_dispersion_manip_mod&quot;</span> );</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aaab2235167b3bf7fa8f2e8c9163d64d2">  105</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">character_modifier_id</a> <a class="code" href="ranged_8cpp.html#aaab2235167b3bf7fa8f2e8c9163d64d2">character_modifier_thrown_dex_mod</a>( <span class="stringliteral">&quot;thrown_dex_mod&quot;</span> );</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">  107</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">damage_type_id</a> <a class="code" href="ranged_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">damage_bash</a>( <span class="stringliteral">&quot;bash&quot;</span> );</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">  108</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">damage_type_id</a> <a class="code" href="ranged_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">damage_cut</a>( <span class="stringliteral">&quot;cut&quot;</span> );</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160; </div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">  110</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a>( <span class="stringliteral">&quot;downed&quot;</span> );</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">  111</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a>( <span class="stringliteral">&quot;hit_by_player&quot;</span> );</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">  112</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a>( <span class="stringliteral">&quot;on_roof&quot;</span> );</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a308f7276ae25fff301d31c7fd64270e4">  113</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="ranged_8cpp.html#a308f7276ae25fff301d31c7fd64270e4">effect_quadruped_full</a>( <span class="stringliteral">&quot;quadruped_full&quot;</span> );</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">  115</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">fault_id</a> <a class="code" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a>( <span class="stringliteral">&quot;fault_gun_blackpowder&quot;</span> );</div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">  116</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">fault_id</a> <a class="code" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a>( <span class="stringliteral">&quot;fault_gun_chamber_spent&quot;</span> );</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">  117</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">fault_id</a> <a class="code" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a>( <span class="stringliteral">&quot;fault_gun_dirt&quot;</span> );</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a5a490676abb8e2a402ec62817da5311b">  118</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">fault_id</a> <a class="code" href="ranged_8cpp.html#a5a490676abb8e2a402ec62817da5311b">fault_overheat_explosion</a>( <span class="stringliteral">&quot;fault_overheat_explosion&quot;</span> );</div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aaa28e14858a862e5085b9c4d06f5bfdc">  119</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">fault_id</a> <a class="code" href="ranged_8cpp.html#aaa28e14858a862e5085b9c4d06f5bfdc">fault_overheat_melting</a>( <span class="stringliteral">&quot;fault_overheat_melting&quot;</span> );</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a52f20bf5a32adb49385320ff391b2f8e">  120</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">fault_id</a> <a class="code" href="ranged_8cpp.html#a52f20bf5a32adb49385320ff391b2f8e">fault_overheat_safety</a>( <span class="stringliteral">&quot;fault_overheat_safety&quot;</span> );</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0f268fc372aed3ee28ba36bd2d2d5287">  121</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">fault_id</a> <a class="code" href="ranged_8cpp.html#a0f268fc372aed3ee28ba36bd2d2d5287">fault_overheat_venting</a>( <span class="stringliteral">&quot;fault_overheat_venting&quot;</span> );</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4df4dd60924cd337468bb34326d879a7">  123</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">flag_id</a> <a class="code" href="ranged_8cpp.html#a4df4dd60924cd337468bb34326d879a7">json_flag_FILTHY</a>( <span class="stringliteral">&quot;FILTHY&quot;</span> );</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a26815bd1f0ea7814c8d82103ce7458d8">  125</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a26815bd1f0ea7814c8d82103ce7458d8">material_budget_steel</a>( <span class="stringliteral">&quot;budget_steel&quot;</span> );</div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a263771acb00bdae9183f85580fcb1b43">  126</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a263771acb00bdae9183f85580fcb1b43">material_case_hardened_steel</a>( <span class="stringliteral">&quot;case_hardened_steel&quot;</span> );</div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0445510734214e05ba923feabd4b85d9">  127</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a0445510734214e05ba923feabd4b85d9">material_glass</a>( <span class="stringliteral">&quot;glass&quot;</span> );</div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a1e9f8f3600585654b27d71a2dc99a449">  128</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a1e9f8f3600585654b27d71a2dc99a449">material_high_steel</a>( <span class="stringliteral">&quot;high_steel&quot;</span> );</div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a770eb7c8ac46ca214eafc8a3778dc4be">  129</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a770eb7c8ac46ca214eafc8a3778dc4be">material_iron</a>( <span class="stringliteral">&quot;iron&quot;</span> );</div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ad75fbfd35a5881cf4652a8cf745f52b7">  130</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#ad75fbfd35a5881cf4652a8cf745f52b7">material_low_steel</a>( <span class="stringliteral">&quot;low_steel&quot;</span> );</div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a5fa8fef66699e3dfe7059a6e9cc672a6">  131</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a5fa8fef66699e3dfe7059a6e9cc672a6">material_med_steel</a>( <span class="stringliteral">&quot;med_steel&quot;</span> );</div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6cda9e7cd9c37d3822410cf6280babdf">  132</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a6cda9e7cd9c37d3822410cf6280babdf">material_steel</a>( <span class="stringliteral">&quot;steel&quot;</span> );</div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a37b3abec3c86a9a6473849010adee218">  133</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">material_id</a> <a class="code" href="ranged_8cpp.html#a37b3abec3c86a9a6473849010adee218">material_tempered_steel</a>( <span class="stringliteral">&quot;tempered_steel&quot;</span> );</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160; </div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#af94296ce179c8a7441548e43d0b8235f">  135</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">proficiency_id</a> <a class="code" href="ranged_8cpp.html#af94296ce179c8a7441548e43d0b8235f">proficiency_prof_bow_basic</a>( <span class="stringliteral">&quot;prof_bow_basic&quot;</span> );</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a5a31fd4e066d23b9f26579e931b87113">  136</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">proficiency_id</a> <a class="code" href="ranged_8cpp.html#a5a31fd4e066d23b9f26579e931b87113">proficiency_prof_bow_expert</a>( <span class="stringliteral">&quot;prof_bow_expert&quot;</span> );</div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab1f819e79b8cfdcbf08cca629e3073ba">  137</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">proficiency_id</a> <a class="code" href="ranged_8cpp.html#ab1f819e79b8cfdcbf08cca629e3073ba">proficiency_prof_bow_master</a>( <span class="stringliteral">&quot;prof_bow_master&quot;</span> );</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">  139</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a>( <span class="stringliteral">&quot;archery&quot;</span> );</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">  140</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">skill_dodge</a>( <span class="stringliteral">&quot;dodge&quot;</span> );</div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">  141</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a>( <span class="stringliteral">&quot;driving&quot;</span> );</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">  142</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a>( <span class="stringliteral">&quot;gun&quot;</span> );</div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">  143</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a>( <span class="stringliteral">&quot;launcher&quot;</span> );</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a1d815a8053cfecc8a05374bf92924ba2">  144</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="ranged_8cpp.html#a1d815a8053cfecc8a05374bf92924ba2">skill_swimming</a>( <span class="stringliteral">&quot;swimming&quot;</span> );</div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">  145</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>( <span class="stringliteral">&quot;throw&quot;</span> );</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0fb9c66af29eade7d376e89264128bcd">  147</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">trait_id</a> <a class="code" href="ranged_8cpp.html#a0fb9c66af29eade7d376e89264128bcd">trait_BRAWLER</a>( <span class="stringliteral">&quot;BRAWLER&quot;</span> );</div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">  148</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">trait_id</a> <a class="code" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a>( <span class="stringliteral">&quot;PYROMANIA&quot;</span> );</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a26f773999c96865544c00b5496637d56">  150</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">trap_str_id</a> <a class="code" href="ranged_8cpp.html#a26f773999c96865544c00b5496637d56">tr_practice_target</a>( <span class="stringliteral">&quot;tr_practice_target&quot;</span> );</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6cd87802123477df1237fa5271842f8b">  152</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> std::set&lt;material_id&gt; <a class="code" href="ranged_8cpp.html#a6cd87802123477df1237fa5271842f8b">ferric</a> = { <a class="code" href="ranged_8cpp.html#a770eb7c8ac46ca214eafc8a3778dc4be">material_iron</a>, <a class="code" href="ranged_8cpp.html#a6cda9e7cd9c37d3822410cf6280babdf">material_steel</a>, <a class="code" href="ranged_8cpp.html#a26815bd1f0ea7814c8d82103ce7458d8">material_budget_steel</a>, <a class="code" href="ranged_8cpp.html#a263771acb00bdae9183f85580fcb1b43">material_case_hardened_steel</a>, <a class="code" href="ranged_8cpp.html#a1e9f8f3600585654b27d71a2dc99a449">material_high_steel</a>, <a class="code" href="ranged_8cpp.html#ad75fbfd35a5881cf4652a8cf745f52b7">material_low_steel</a>, <a class="code" href="ranged_8cpp.html#a5fa8fef66699e3dfe7059a6e9cc672a6">material_med_steel</a>, <a class="code" href="ranged_8cpp.html#a37b3abec3c86a9a6473849010adee218">material_tempered_steel</a> };</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">// Maximum duration of aim-and-fire loop, in turns</span></div>
<div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">  155</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">AIF_DURATION_LIMIT</a> = 10;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">static</span> <a class="code" href="structprojectile.html">projectile</a> <a class="code" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;gun );</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;p, <span class="keyword">const</span> <a class="code" href="structitype.html">itype</a> &amp;firing );<span class="comment"></span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">/**</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment">* Handle spent ammo casings and linkages.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">* @param weap   Weapon.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">* @param ammo   Ammo used.</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">* @param pos    Character position.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#a035c67a119c3f5a39b1069944798c9fc">cycle_action</a>( <a class="code" href="classitem.html">item</a> &amp;weap, <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> &amp;ammo, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;<a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> );</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#a13b78ee77e8e3b8527bff0ce8e7a5651">make_gun_sound_effect</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;p, <span class="keywordtype">bool</span> burst, <a class="code" href="classitem.html">item</a> *weapon );</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="classtarget__ui.html">  168</a></span>&#160;<span class="keyword">class </span><a class="code" href="classtarget__ui.html">target_ui</a></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;{</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keyword">public</span>:</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="comment">/* None of the public members (except ammo and range) should be modified during execution */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">  173</a></span>&#160;        <span class="keyword">enum class</span> <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">TargetMode</a> : int {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">Fire</a>,</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">Throw</a>,</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">ThrowBlind</a>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">Turrets</a>,</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TurretManual</a>,</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">Reach</a>,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">Spell</a>,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997afd3508f354d330de0aaa9207ba65bf4e">SelectOnly</a></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        };</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160; </div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="comment">// Avatar</span></div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">  185</a></span>&#160;        <a class="code" href="classavatar.html">avatar</a> *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        <span class="comment">// Interface mode</span></div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">  187</a></span>&#160;        <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">TargetMode</a> <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> = <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a>;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="comment">// Weapon being fired/thrown</span></div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">  189</a></span>&#160;        <a class="code" href="classitem.html">item</a> *<a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        <span class="comment">// Cached selection range from player&#39;s position</span></div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">  191</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = 0;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="comment">// Cached current ammo to display</span></div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">  193</a></span>&#160;        <span class="keyword">const</span> <a class="code" href="structitype.html">itype</a> *<a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment">// Turret being manually fired</span></div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">  195</a></span>&#160;        <a class="code" href="classturret__data.html">turret_data</a> *<a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="comment">// Turrets being fired (via vehicle controls)</span></div>
<div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">  197</a></span>&#160;        <span class="keyword">const</span> std::vector&lt;vehicle_part *&gt; *<a class="code" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="comment">// Vehicle that turrets belong to</span></div>
<div class="line"><a name="l00199"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">  199</a></span>&#160;        <a class="code" href="classvehicle.html">vehicle</a> *<a class="code" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">veh</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        <span class="comment">// Spell being cast</span></div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">  201</a></span>&#160;        <a class="code" href="classspell.html">spell</a> *<a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// Spell cannot fail</span></div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">  203</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">no_fail</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// Spell does not require mana</span></div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">  205</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">no_mana</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <span class="comment">// Relevant activity</span></div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">  207</a></span>&#160;        <a class="code" href="classaim__activity__actor.html">aim_activity_actor</a> *<a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160; </div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">  209</a></span>&#160;        <span class="keyword">enum class</span> <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">ExitCode</a> : int {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">Abort</a>,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">Fire</a>,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">Timeout</a>,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">Reload</a></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        };</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">// Initialize UI and run the event loop</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310">run</a>();</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        <span class="comment">// returns the currently selected aim type (immediate/careful/precise etc)</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <a class="code" href="structaim__type.html">aim_type</a> <a class="code" href="classtarget__ui.html#a5898f18e796130f0a4aa0b5099c7a4a0">get_selected_aim_type</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="classtarget__ui.html#a8606ff468dc8ac0fab74c239c455e2f7">get_sight_dispersion</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">private</span>:</div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">  225</a></span>&#160;        <span class="keyword">enum class</span> <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">Status</a> : int {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Good</a>, <span class="comment">// All UI elements are enabled</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408">BadTarget</a>, <span class="comment">// Bad &#39;dst&#39; selected; forbid aiming/firing</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">OutOfAmmo</a>, <span class="comment">// Selected gun mode is out of ammo; forbid moving cursor,aiming and firing</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">OutOfRange</a> <span class="comment">// Selected target is out of range of current gun mode; forbid aiming/firing</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        };</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        <span class="comment">// Ui status (affects which UI controls are temporarily disabled)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno"><a class="line" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">  233</a></span>&#160;        <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">Status</a> <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="comment">// Current trajectory</span></div>
<div class="line"><a name="l00236"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">  236</a></span>&#160;        std::vector&lt;tripoint&gt; <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="comment">// Aiming source (player&#39;s position)</span></div>
<div class="line"><a name="l00238"></a><span class="lineno"><a class="line" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">  238</a></span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        <span class="comment">// Aiming destination (cursor position)</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="comment">// Use set_cursor_pos() to modify</span></div>
<div class="line"><a name="l00241"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">  241</a></span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>;</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <span class="comment">// Creature currently under cursor. nullptr if aiming at empty tile,</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="comment">// yourself or a creature you cannot see</span></div>
<div class="line"><a name="l00244"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">  244</a></span>&#160;        <a class="code" href="classCreature.html">Creature</a> *<a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        <span class="comment">// List of visible hostile targets</span></div>
<div class="line"><a name="l00246"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">  246</a></span>&#160;        std::vector&lt;Creature *&gt; <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <span class="comment">// Window</span></div>
<div class="line"><a name="l00249"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">  249</a></span>&#160;        <a class="code" href="classcatacurses_1_1window.html">catacurses::window</a> <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <span class="comment">// Input context</span></div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">  251</a></span>&#160;        <a class="code" href="classinput__context.html">input_context</a> <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160; </div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="comment">/* These members are relevant for TargetMode::Fire */</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        <span class="comment">// Weapon sight dispersion</span></div>
<div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">  255</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> = 0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        <span class="comment">// List of available weapon aim types</span></div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">  257</a></span>&#160;        std::vector&lt;aim_type&gt; <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;        <span class="comment">// Currently selected aim mode</span></div>
<div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">  259</a></span>&#160;        std::vector&lt;aim_type&gt;::iterator <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        <span class="comment">// &#39;Recoil&#39; value the player will reach if they</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="comment">// start aiming at cursor position. Equals player&#39;s</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <span class="comment">// &#39;recoil&#39; while they are actively spending moves to aim,</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="comment">// but increases the further away the new aim point will be</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <span class="comment">// relative to the current one.</span></div>
<div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">  265</a></span>&#160;        <span class="keywordtype">double</span> <a class="code" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = 0;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        <span class="comment">// For AOE spells, list of tiles affected by the spell</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        <span class="comment">// relevant for TargetMode::Spell</span></div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">  269</a></span>&#160;        std::set&lt;tripoint&gt; <a class="code" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a>;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160; </div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <span class="comment">// Represents a turret and a straight line from that turret to target</span></div>
<div class="line"><a name="l00272"></a><span class="lineno"><a class="line" href="structtarget__ui_1_1turret__with__lof.html">  272</a></span>&#160;        <span class="keyword">struct </span><a class="code" href="structtarget__ui_1_1turret__with__lof.html">turret_with_lof</a> {</div>
<div class="line"><a name="l00273"></a><span class="lineno"><a class="line" href="structtarget__ui_1_1turret__with__lof.html#aaa416c09474e4040a712a05bbb5e99cf">  273</a></span>&#160;            <a class="code" href="structvehicle__part.html">vehicle_part</a> *<a class="code" href="structtarget__ui_1_1turret__with__lof.html#aaa416c09474e4040a712a05bbb5e99cf">turret</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="structtarget__ui_1_1turret__with__lof.html#a4422bb428b5d266bad798974571c9baf">  274</a></span>&#160;            std::vector&lt;tripoint&gt; <a class="code" href="structtarget__ui_1_1turret__with__lof.html#a4422bb428b5d266bad798974571c9baf">line</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        };</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160; </div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="comment">// List of vehicle turrets in range (out of those listed in &#39;vturrets&#39;)</span></div>
<div class="line"><a name="l00278"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">  278</a></span>&#160;        std::vector&lt;turret_with_lof&gt; <a class="code" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160; </div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="comment">// If true, draws turret lines</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="comment">// relevant for TargetMode::Turrets</span></div>
<div class="line"><a name="l00282"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">  282</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        <span class="comment">// Snap camera to cursor. Can be permanently toggled in settings</span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="comment">// or temporarily in this window</span></div>
<div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">  285</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">// If true, LEVEL_UP, LEVEL_DOWN and directional keys</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <span class="comment">// responsible for moving cursor will shift view instead.</span></div>
<div class="line"><a name="l00288"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">  288</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="comment">// Compact layout</span></div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">  291</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <span class="comment">// Tiny layout - when extremely short on space</span></div>
<div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">  293</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">tiny</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="comment">// Narrow layout - to keep in theme with</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="comment">// &quot;compact&quot; and &quot;labels-narrow&quot; sidebar styles.</span></div>
<div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">  296</a></span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment">// Create window and set up input context</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">init_window_and_input</a>();</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;        <span class="comment">// Handle input related to cursor movement.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="comment">// Returns &#39;true&#39; if action was recognized and processed.</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="comment">// &#39;skip_redraw&#39; is set to &#39;true&#39; if there is no need to redraw the UI.</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">handle_cursor_movement</a>( <span class="keyword">const</span> std::string &amp;<a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>, <span class="keywordtype">bool</span> &amp;skip_redraw );</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        <span class="comment">// Set cursor position. If new position is out of range,</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="comment">// selects closest position in range.</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <span class="comment">// Returns &#39;false&#39; if cursor position did not change</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;new_pos );</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        <span class="comment">// Called when range/ammo changes (or may have changed)</span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">on_range_ammo_changed</a>();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="comment">// Updates &#39;targets&#39; for current range</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">update_target_list</a>();</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        <span class="comment">// Choose where to position the cursor when opening the ui</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">choose_initial_target</a>();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="comment">        /**</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;<span class="comment">         * Try to re-acquire target for aim-and-fire.</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">         * @param critter whether were aiming at a critter, or a tile</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">         * @param new_dst where to move aim cursor (if e.g. critter moved)</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">         * @returns true on success</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">try_reacquire_target</a>( <span class="keywordtype">bool</span> critter, <a class="code" href="structtripoint.html">tripoint</a> &amp;new_dst );</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="comment">// Update &#39;status&#39; variable</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">update_status</a>();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160; </div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="comment">// Calculates distance from &#39;src&#39;. For consistency, prefer using this over rl_dist.</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p );</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;        <span class="comment">// Set creature (or tile) under cursor as player&#39;s last target</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;        <span class="comment">// Prompts player to confirm attack on neutral NPC</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        <span class="comment">// Returns &#39;true&#39; if attack should proceed</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">confirm_non_enemy_target</a>();</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;        <span class="comment">// Prompts player to re-confirm an ongoing attack if</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="comment">// a non-hostile NPC / friendly creatures enters line of fire.</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        <span class="comment">// Returns &#39;true&#39; if attack should proceed</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">prompt_friendlies_in_lof</a>();</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160; </div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="comment">// List friendly creatures currently occupying line of fire.</span></div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; <a class="code" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">list_friendlies_in_lof</a>();</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160; </div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="comment">// Toggle snap-to-target</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">toggle_snap_to_target</a>();</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        <span class="comment">// Cycle targets. &#39;direction&#39; is either 1 or -1</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">cycle_targets</a>( <span class="keywordtype">int</span> <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> );</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160; </div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;        <span class="comment">// Set new view offset. Updates map cache if necessary</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">set_view_offset</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;new_offset ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        <span class="comment">// Updates &#39;turrets_in_range&#39;</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">update_turrets_in_range</a>();</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        <span class="comment">// Recalculate &#39;recoil&#39; penalty. This should be called if</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="comment">// avatar&#39;s &#39;recoil&#39; value has been modified</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="comment">// Relevant for TargetMode::Fire</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">recalc_aim_turning_penalty</a>();</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160; </div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="comment">// Apply penalty to avatar&#39;s &#39;recoil&#39; value based on</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">// how much they moved their aim point.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="comment">// Relevant for TargetMode::Fire</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aa81de937ba74331a08f3ef8e049a3c28">apply_aim_turning_penalty</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="comment">// Switch firing mode.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#af1178602a3d2f7e37c9dbebf22dd29a3">action_switch_mode</a>();</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160; </div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;        <span class="comment">// Switch ammo. Returns &#39;false&#39; if requires a reloading UI.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">action_switch_ammo</a>();</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160; </div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;        <span class="comment">// Aim for 10 turns. Returns &#39;false&#39; if ran out of moves</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">action_aim</a>();</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;        <span class="comment">// drop aim so you can look around</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a4924621b242d0938e9a03fcefdfa6a9d">action_drop_aim</a>();</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160; </div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;        <span class="comment">// Aim and shoot. Returns &#39;false&#39; if ran out of moves</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;        <span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">action_aim_and_shoot</a>( <span class="keyword">const</span> std::string &amp;<a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160; </div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        <span class="comment">// Draw UI-specific terrain overlays</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">draw_terrain_overlay</a>();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;        <span class="comment">// Draw aiming window</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a93a478e95d201324548329f39a087208">draw_ui_window</a>();</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160; </div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        <span class="comment">// Generate ui window title</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        std::string <a class="code" href="classtarget__ui.html#aac34aeff88a5103d4af19a2ad067a677">uitext_title</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;        <span class="comment">// Generate flavor text for &#39;Fire!&#39; key</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;        std::string <a class="code" href="classtarget__ui.html#a7f3d575ebc23cdd3a199a8c17579a225">uitext_fire</a>() <span class="keyword">const</span>;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">draw_window_title</a>();</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">draw_help_notice</a>();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160; </div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="comment">// Draw list of available controls at the bottom of the window.</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="comment">// text_y - first free line counting from the top</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">draw_controls_list</a>( <span class="keywordtype">int</span> text_y );</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160; </div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">panel_cursor_info</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">panel_gun_info</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">panel_recoil</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">panel_spell_info</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">panel_target_info</a>( <span class="keywordtype">int</span> &amp;text_y, <span class="keywordtype">bool</span> fill_with_blank_if_no_target );</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">panel_turret_list</a>( <span class="keywordtype">int</span> &amp;text_y );</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="comment">// On-selected-as-target checks that act as if they are on-hit checks.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="comment">// `harmful` is `false` if using a non-damaging spell</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        <span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a50ee1e0b8e7d1141e4d6c2019fe6df39">on_target_accepted</a>( <span class="keywordtype">bool</span> harmful ) <span class="keyword">const</span>;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;};</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#ad17e5a6408a9a9dbe8ac07aa89b0dac4">  417</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="namespacetarget__handler.html#ad17e5a6408a9a9dbe8ac07aa89b0dac4">target_handler::mode_select_only</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <span class="keywordtype">int</span> range )</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;{</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="classtarget__ui.html">target_ui</a> <a class="code" href="namespaceui.html">ui</a> = <a class="code" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mode = <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997afd3508f354d330de0aaa9207ba65bf4e">target_ui::TargetMode::SelectOnly</a>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.range = range;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="classrestore__on__out__of__scope.html">restore_on_out_of_scope&lt;tripoint&gt;</a> view_offset_prev( you.<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> );</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;}</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a15e531943e7385d987d87f82f5957821">  428</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="namespacetarget__handler.html#a15e531943e7385d987d87f82f5957821">target_handler::mode_fire</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <a class="code" href="classaim__activity__actor.html">aim_activity_actor</a> &amp;activity )</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;{</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    <a class="code" href="classtarget__ui.html">target_ui</a> <a class="code" href="namespaceui.html">ui</a> = <a class="code" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mode = <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">target_ui::TargetMode::Fire</a>;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.activity = &amp;activity;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.relevant = &amp;*activity.get_weapon();</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <a class="code" href="classgun__mode.html">gun_mode</a> <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> = <a class="code" href="namespaceui.html">ui</a>.relevant-&gt;gun_current_mode();</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.range = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.target-&gt;gun_range( &amp;you );</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.ammo = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>-&gt;ammo_data();</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160; </div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;}</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#abf6b4d399e1ef6b51df0dc4621a5720d">  442</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="namespacetarget__handler.html#abf6b4d399e1ef6b51df0dc4621a5720d">target_handler::mode_throw</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <a class="code" href="classitem.html">item</a> &amp;relevant,</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keywordtype">bool</span> blind_throwing )</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;{</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <a class="code" href="classtarget__ui.html">target_ui</a> <a class="code" href="namespaceui.html">ui</a> = <a class="code" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mode = blind_throwing ? <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">target_ui::TargetMode::ThrowBlind</a> : <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">target_ui::TargetMode::Throw</a>;</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.relevant = &amp;relevant;</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.range = you.<a class="code" href="classCharacter.html#a455c06bf0dab6e3558f759fe43e27e98">throw_range</a>( relevant );</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <a class="code" href="classrestore__on__out__of__scope.html">restore_on_out_of_scope&lt;tripoint&gt;</a> view_offset_prev( you.<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> );</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;}</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a2ee0da8af1b540479f0a5def5357a8b5">  455</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="namespacetarget__handler.html#a2ee0da8af1b540479f0a5def5357a8b5">target_handler::mode_reach</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <a class="code" href="classitem__location.html">item_location</a> weapon )</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;{</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <a class="code" href="classtarget__ui.html">target_ui</a> <a class="code" href="namespaceui.html">ui</a> = <a class="code" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mode = <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">target_ui::TargetMode::Reach</a>;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.relevant = weapon.<a class="code" href="classitem__location.html#a350bb267073f30205f780b394324a32c">get_item</a>();</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.range = weapon ? weapon-&gt;<a class="code" href="classitem.html#adb2ea39327f1a8da37740b4bfb171a5d">current_reach_range</a>( you ) : 1;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160; </div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="classrestore__on__out__of__scope.html">restore_on_out_of_scope&lt;tripoint&gt;</a> view_offset_prev( you.<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> );</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a9f06978559f45ddb20b5a1caec3f9c1f">  467</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="namespacetarget__handler.html#a9f06978559f45ddb20b5a1caec3f9c1f">target_handler::mode_turret_manual</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <a class="code" href="classturret__data.html">turret_data</a> &amp;turret )</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;{</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <a class="code" href="classtarget__ui.html">target_ui</a> <a class="code" href="namespaceui.html">ui</a> = <a class="code" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mode = <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">target_ui::TargetMode::TurretManual</a>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.turret = &amp;turret;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.relevant = &amp;*turret.<a class="code" href="classturret__data.html#a737465cce9c8f1e87eec808ee1363421">base</a>();</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.range = turret.<a class="code" href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">range</a>();</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.ammo = turret.<a class="code" href="classturret__data.html#a541ea995045e847f2cd59cf8b9014ed3">ammo_data</a>();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160; </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <a class="code" href="classrestore__on__out__of__scope.html">restore_on_out_of_scope&lt;tripoint&gt;</a> view_offset_prev( you.<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> );</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;}</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160; </div>
<div class="line"><a name="l00481"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a3371a56d7b45012072236fb97eda5cc0">  481</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="namespacetarget__handler.html#a3371a56d7b45012072236fb97eda5cc0">target_handler::mode_turrets</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <a class="code" href="classvehicle.html">vehicle</a> &amp;veh,</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="keyword">const</span> std::vector&lt;vehicle_part *&gt; &amp;turrets )</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;{</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <span class="comment">// Find radius of a circle centered at u encompassing all points turrets can aim at</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <span class="comment">// FIXME: this calculation is fine for square distances, but results in an underestimation</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="comment">//        when used with real circles</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordtype">int</span> range_total = 0;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structvehicle__part.html">vehicle_part</a> *t : turrets ) {</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordtype">int</span> range = veh.<a class="code" href="classvehicle.html#accfab81af66cd979bdfff4c39e5a3a8e">turret_query</a>( *t ).<a class="code" href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">range</a>();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> = veh.<a class="code" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( *t );</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160; </div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        res = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( res, <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> + <a class="code" href="structpoint.html">point</a>( range, 0 ) ) );</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        res = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( res, <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> + <a class="code" href="structpoint.html">point</a>( -range, 0 ) ) );</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        res = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( res, <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> + <a class="code" href="structpoint.html">point</a>( 0, range ) ) );</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        res = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( res, <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> + <a class="code" href="structpoint.html">point</a>( 0, -range ) ) );</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        range_total = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( range_total, res );</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="classtarget__ui.html">target_ui</a> <a class="code" href="namespaceui.html">ui</a> = <a class="code" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mode = <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">target_ui::TargetMode::Turrets</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.veh = &amp;veh;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.vturrets = &amp;turrets;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.range = range_total;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160; </div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    <a class="code" href="classrestore__on__out__of__scope.html">restore_on_out_of_scope&lt;tripoint&gt;</a> view_offset_prev( you.<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> );</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;}</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno"><a class="line" href="namespacetarget__handler.html#a10911d1ab9fa4b1484138f1bc379baa5">  511</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="namespacetarget__handler.html#a10911d1ab9fa4b1484138f1bc379baa5">target_handler::mode_spell</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <a class="code" href="classspell.html">spell</a> &amp;casting, <span class="keywordtype">bool</span> no_fail,</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordtype">bool</span> no_mana )</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;{</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    <a class="code" href="classtarget__ui.html">target_ui</a> <a class="code" href="namespaceui.html">ui</a> = <a class="code" href="classtarget__ui.html">target_ui</a>();</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.you = &amp;you;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mode = <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">target_ui::TargetMode::Spell</a>;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.casting = &amp;casting;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.range = casting.<a class="code" href="classspell.html#ab00175ffc465d406a7ec24331c6c55f2">range</a>( you );</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.no_fail = no_fail;</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.no_mana = no_mana;</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;    <a class="code" href="classrestore__on__out__of__scope.html">restore_on_out_of_scope&lt;tripoint&gt;</a> view_offset_prev( you.<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> );</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespaceui.html">ui</a>.run();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;}</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">  526</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">occupied_tile_fraction</a>( <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2">creature_size</a> target_size )</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;{</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">switch</span>( target_size ) {</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2ad60cadf1a41c651e1f0ade50136bad43">creature_size::tiny</a>:</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">return</span> 0.1;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aeb5c1399a871211c7e7ed732d15e3a8b">creature_size::small</a>:</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;            <span class="keywordflow">return</span> 0.25;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2a075a3e36a0a52dcbc568c05788e8a713">creature_size::medium</a>:</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            <span class="keywordflow">return</span> 0.5;</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aafacdb0a401ccdf6b48551bbc00e8a74">creature_size::large</a>:</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <span class="keywordflow">return</span> 0.75;</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2ab7cf27ffe6ea83cdcf8af2ef29de9285">creature_size::huge</a>:</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">return</span> 1.0;</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aac651433a999fb14f71f6754f0199781">creature_size::num_sizes</a>:</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;ERROR: Invalid Creature size class.&quot;</span> );</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;    }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;    <span class="keywordflow">return</span> 0.5;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;}</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno"><a class="line" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">  547</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">Creature::ranged_target_size</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordtype">double</span> stance_factor = 1.0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">if</span>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> *character = this-&gt;<a class="code" href="classCreature.html#a55d12f92d62a7c89c44b466d7e7cb00d">as_character</a>() ) {</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;        <span class="keywordflow">if</span>( character-&gt;is_crouching() || ( character-&gt;has_effect( <a class="code" href="ranged_8cpp.html#a308f7276ae25fff301d31c7fd64270e4">effect_quadruped_full</a> ) &amp;&amp;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                                           character-&gt;is_running() ) ) {</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            stance_factor = 0.6;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( character-&gt;is_prone() ) {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;            stance_factor = 0.25;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    }</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#aec78049b0ee4401d3a4c073663735aad">has_flag</a>( <a class="code" href="mtype_8cpp.html#aef6cb4006fa1626010cdd2dba9c988db">mon_flag_HARDTOSHOOT</a> ) ) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="keywordflow">switch</span>( <a class="code" href="classCreature.html#ac9fd76782cca4157eda2afcb7d66f02e">get_size</a>() ) {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2ad60cadf1a41c651e1f0ade50136bad43">creature_size::tiny</a>:</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aeb5c1399a871211c7e7ed732d15e3a8b">creature_size::small</a>:</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                <span class="keywordflow">return</span> stance_factor * <a class="code" href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">occupied_tile_fraction</a>( <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2ad60cadf1a41c651e1f0ade50136bad43">creature_size::tiny</a> );</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2a075a3e36a0a52dcbc568c05788e8a713">creature_size::medium</a>:</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                <span class="keywordflow">return</span> stance_factor * <a class="code" href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">occupied_tile_fraction</a>( <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aeb5c1399a871211c7e7ed732d15e3a8b">creature_size::small</a> );</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aafacdb0a401ccdf6b48551bbc00e8a74">creature_size::large</a>:</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                <span class="keywordflow">return</span> stance_factor * <a class="code" href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">occupied_tile_fraction</a>( <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2a075a3e36a0a52dcbc568c05788e8a713">creature_size::medium</a> );</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2ab7cf27ffe6ea83cdcf8af2ef29de9285">creature_size::huge</a>:</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                <span class="keywordflow">return</span> stance_factor * <a class="code" href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">occupied_tile_fraction</a>( <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aafacdb0a401ccdf6b48551bbc00e8a74">creature_size::large</a> );</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aac651433a999fb14f71f6754f0199781">creature_size::num_sizes</a>:</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;ERROR: Invalid Creature size class.&quot;</span> );</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;    <span class="keywordflow">return</span> stance_factor * <a class="code" href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">occupied_tile_fraction</a>( <a class="code" href="classCreature.html#ac9fd76782cca4157eda2afcb7d66f02e">get_size</a>() );</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;}</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160; </div>
<div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">  577</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">range_with_even_chance_of_good_hit</a>( <span class="keywordtype">int</span> dispersion )</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;{</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordtype">int</span> even_chance_range = 0;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    <span class="keywordflow">while</span>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span><span class="keyword">&gt;</span>( even_chance_range ) &lt;</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;           <a class="code" href="classCreature.html#a73b9cb6320e4447addaec375887e7861">Creature::dispersion_for_even_chance_of_good_hit</a>.<a class="code" href="namespaceom__direction.html#af97f9dbddaa758278662da3478826c61">size</a>() &amp;&amp;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;           dispersion &lt; <a class="code" href="classCreature.html#a73b9cb6320e4447addaec375887e7861">Creature::dispersion_for_even_chance_of_good_hit</a>[ even_chance_range ] ) {</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        even_chance_range++;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;    }</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">return</span> even_chance_range;</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;}</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno"><a class="line" href="classCharacter.html#a94f04577f690dc8400ff13aa991cd6ed">  588</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCharacter.html#a94f04577f690dc8400ff13aa991cd6ed">Character::gun_engagement_moves</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;gun, <span class="keywordtype">int</span> target, <span class="keywordtype">int</span> start,</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                                     <span class="keyword">const</span> <a class="code" href="structTarget__attributes.html">Target_attributes</a> &amp;attributes )<span class="keyword"> const</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keywordtype">int</span> mv = 0;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="keywordtype">double</span> penalty = start;</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="keyword">const</span> <a class="code" href="structaim__mods__cache.html">aim_mods_cache</a> aim_cache = <a class="code" href="classCharacter.html#aa58280d717f23351fb1cdc6f7a83047f">gen_aim_mods_cache</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> );</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="keywordflow">while</span>( penalty &gt; target ) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> adj = <a class="code" href="classCharacter.html#a6243be833eae8764b8dc841fb05cf867">aim_per_move</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>, penalty, attributes, { std::ref( aim_cache ) } );</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        <span class="keywordflow">if</span>( adj &lt;= <a class="code" href="ranged_8h.html#a3ad21aa630e4e68c1d2834fe0467c018">MIN_RECOIL_IMPROVEMENT</a> ) {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        }</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        penalty -= adj;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;        mv++;</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;    }</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160; </div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">return</span> mv;</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;}</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160; </div>
<div class="line"><a name="l00606"></a><span class="lineno"><a class="line" href="classCharacter.html#ad34f7b20c4a0e5a8f659efe14482fd2b">  606</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCharacter.html#ad34f7b20c4a0e5a8f659efe14482fd2b">Character::handle_gun_damage</a>( <a class="code" href="classitem.html">item</a> &amp;it )</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;{</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    <span class="comment">// Below item (maximum dirt possible) should be greater than or equal to dirt range in item_group.cpp. Also keep in mind that monster drops can have specific ranges and these should be below the max!</span></div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> dirt_max_dbl = 10000;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">if</span>( !it.<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Tried to handle_gun_damage of a non-gun %s&quot;</span>, it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    }</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <span class="keywordtype">int</span> dirt = it.<a class="code" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;    <span class="keywordtype">int</span> dirtadder = 0;</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    <span class="keywordtype">double</span> dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a2eefa8e0a7fd8e2c60f3e4247a629685">has_fault_flag</a>( <span class="stringliteral">&quot;JAMMED_GUN&quot;</span> ) ) {</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s can&#39;t fire.&quot;</span> ), it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a2eefa8e0a7fd8e2c60f3e4247a629685">has_fault_flag</a>( <span class="stringliteral">&quot;RUINED_GUN&quot;</span> ) ) {</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s is little more than an awkward club now.&quot;</span> ), it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;    }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;curammo_effects = it.<a class="code" href="classitem.html#a768c08639c1047f61b9aab2b894e9bcd">ammo_effects</a>();</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    <span class="keyword">const</span> <a class="code" href="structislot__gun.html">islot_gun</a> &amp;firing = *it.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>;</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;    <span class="comment">// misfire chance based on dirt accumulation. Formula is designed to make chance of jam highly unlikely at low dirt levels, but levels increase geometrically as the dirt level reaches max (10,000). The number used is just a figure I found reasonable after plugging the number into excel and changing it until the probability made sense at high, medium, and low levels of dirt.</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;    <span class="keywordflow">if</span>( !it.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a5685feafd05d6c3a374460c0b50ad725">flag_NEVER_JAMS</a> ) &amp;&amp;</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        <a class="code" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl,</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                1000000000000.0 ) ) {</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;            <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;        <span class="comment">// at high dirt levels the chance to misfire gets to significant levels. 10,000 is max and 7800 is quite high so above that the player gets some relief in the form of exchanging time for some dirt reduction. Basically jiggling the parts loose to remove some dirt and get a few more shots out.</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;        <span class="keywordflow">if</span>( dirt_dbl &gt;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            7800 ) {</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;            <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>(</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of your %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Perhaps taking the ammo out of &lt;npcname&gt;&#39;s %s and reloading will help.&quot;</span> ),</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;        }</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    }</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="comment">// Here we check if we&#39;re underwater and whether we should misfire.</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// As a result this causes no damage to the firearm, note that some guns are waterproof</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// and so are immune to this effect, note also that WATERPROOF_GUN status does not</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">// mean the gun will actually be accurate underwater.</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordtype">int</span> effective_durability = firing.<a class="code" href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">durability</a>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">is_underwater</a>() &amp;&amp; !it.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a91b719509dce6a71673f9183835e8939">flag_WATERPROOF_GUN</a> ) &amp;&amp; <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( effective_durability ) ) {</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a wet click!&quot;</span> ),</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="comment">// Here we check for a chance for the weapon to suffer a mechanical malfunction.</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="comment">// Note that some weapons never jam up &#39;NEVER_JAMS&#39; and thus are immune to this</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="comment">// effect as current guns have a durability between 5 and 9 this results in</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="comment">// a chance of mechanical failure between 1/(64*3) and 1/(1024*3) on any given shot.</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="comment">// the malfunction can&#39;t cause damage</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( ( 2 &lt;&lt; effective_durability ) * 3 ) &amp;&amp; !it.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a5685feafd05d6c3a374460c0b50ad725">flag_NEVER_JAMS</a> ) ) {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s malfunctions!&quot;</span> ),</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s malfunctions!&quot;</span> ),</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="comment">// Here we check for a chance for the weapon to suffer a misfire due to</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// using player-made &#39;RECYCLED&#39; bullets. Note that not all forms of</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        <span class="comment">// player-made ammunition have this effect.</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( curammo_effects.count( <span class="stringliteral">&quot;RECYCLED&quot;</span> ) &amp;&amp; <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 256 ) ) {</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s misfires with a muffled click!&quot;</span> ),</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;        <span class="comment">// Here we check for a chance for attached mods to get damaged if they are flagged as &#39;CONSUMABLE&#39;.</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="comment">// This is mostly for crappy handmade expedient stuff  or things that rarely receive damage during normal usage.</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;        <span class="comment">// Default chance is 1/10000 unless set via json, damage is proportional to caliber(see below).</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;        <span class="comment">// Can be toned down with &#39;consume_divisor.&#39;</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160; </div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a3bcbf7092a1bea453e53428f8bc5881f">flag_CONSUMABLE</a> ) &amp;&amp; !curammo_effects.count( <span class="stringliteral">&quot;LASER&quot;</span> ) &amp;&amp;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;               !curammo_effects.count( <span class="stringliteral">&quot;PLASMA&quot;</span> ) &amp;&amp; !curammo_effects.count( <span class="stringliteral">&quot;EMP&quot;</span> ) ) {</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        <span class="keywordtype">int</span> uncork = ( ( 10 * it.<a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;loudness )</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                       + ( it.<a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil / 2 ) ) / 100;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        uncork = std::pow( uncork, 3 ) * 6.5;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> *<a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : it.<a class="code" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;has_flag( <a class="code" href="flag_8cpp.html#a3bcbf7092a1bea453e53428f8bc5881f">flag_CONSUMABLE</a> ) ) {</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                <span class="keywordtype">int</span> dmgamt = uncork / <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_divisor;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                <span class="keywordtype">int</span> modconsume = <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;consume_chance;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                <span class="keywordtype">int</span> initstate = it.<a class="code" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>();</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <span class="comment">// fuzz damage if it&#39;s small</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                <span class="keywordflow">if</span>( dmgamt &lt; 1000 ) {</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                    dmgamt = <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( dmgamt, dmgamt + 200 );</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                    <span class="comment">// ignore damage if inconsequential.</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">if</span>( dmgamt &lt; 800 ) {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                    dmgamt = 0;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( modconsume ) ) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;mod_damage( dmgamt ) ) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your attached %s is destroyed by your shot!&quot;</span> ),</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;                                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s attached %s is destroyed by their shot!&quot;</span> ),</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                                               <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                        <a class="code" href="classCharacter.html#a379081ad133b17e4ab3d230270b2414d">i_rem</a>( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> );</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">damage</a>() &gt; initstate ) {</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your attached %s is damaged by your shot!&quot;</span> ),</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by their shot!&quot;</span> ),</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                                               <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;tname() );</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                    }</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                }</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            }</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        }</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a2eefa8e0a7fd8e2c60f3e4247a629685">has_fault_flag</a>( <span class="stringliteral">&quot;UNLUBRICATED&quot;</span> ) &amp;&amp;</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <a class="code" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl, dirt_max_dbl ) ) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s emits a grimace-inducing screech!&quot;</span> ),</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        it.<a class="code" href="classitem.html#a6dc463a17ae0cac2850b6d1bc8b34fa7">inc_damage</a>();</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span>( !it.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#aa1084eab5da5ecd3f6efe55e0216eb96">flag_PRIMITIVE_RANGED_WEAPON</a> ) ) {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>() != <span class="keyword">nullptr</span> &amp;&amp; ( ( it.<a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;recoil &lt; it.<a class="code" href="classitem.html#a4800c32ea052d36233db889257cc7867">min_cycle_recoil</a>() ) ||</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;                                           ( it.<a class="code" href="classitem.html#a2eefa8e0a7fd8e2c60f3e4247a629685">has_fault_flag</a>( <span class="stringliteral">&quot;BAD_CYCLING&quot;</span> ) &amp;&amp; <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 16 ) ) ) &amp;&amp;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            it.<a class="code" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) ) {</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;            <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;                                   <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s fails to cycle!&quot;</span> ),</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;                                   it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            it.<a class="code" href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">faults</a>.insert( <a class="code" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> );</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="comment">// Don&#39;t return false in this case; this shot happens, follow-up ones won&#39;t.</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="comment">// These are the dirtying/fouling mechanics</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <span class="keywordflow">if</span>( !curammo_effects.count( <span class="stringliteral">&quot;NON_FOULING&quot;</span> ) &amp;&amp; !it.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a8b16e2df6770ff1c280c38e754697b0d">flag_NON_FOULING</a> ) ) {</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <span class="keywordflow">if</span>( dirt &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ) ) {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                dirtadder = curammo_effects.count( <span class="stringliteral">&quot;BLACKPOWDER&quot;</span> ) * ( 200 - firing.<a class="code" href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">blackpowder_tolerance</a> *</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;                            2 );</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <span class="comment">// dirtadder is the dirt-increasing number for shots fired with gunpowder-based ammo. Usually dirt level increases by 1, unless it&#39;s blackpowder, in which case it increases by a higher number, but there is a reduction for blackpowder resistance of a weapon.</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                <span class="keywordflow">if</span>( dirtadder &lt; 0 ) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    dirtadder = 0;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                }</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                <span class="comment">// in addition to increasing dirt level faster, regular gunpowder fouling is also capped at 7,150, not 10,000. So firing with regular gunpowder can never make the gun quite as bad as firing it with black gunpowder. At 7,150 the chance to jam is significantly lower (though still significant) than it is at 10,000, the absolute cap.</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <span class="keywordflow">if</span>( curammo_effects.count( <span class="stringliteral">&quot;BLACKPOWDER&quot;</span> ) ||</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    dirt &lt; 7150 ) {</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;                    it.<a class="code" href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">set_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( dirt_max_dbl ), dirt + dirtadder + 1 ) );</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;                }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            dirt = it.<a class="code" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;dirt&quot;</span>, 0 );</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            dirt_dbl = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( dirt );</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; !it.<a class="code" href="classitem.html#a2eefa8e0a7fd8e2c60f3e4247a629685">has_fault_flag</a>( <span class="stringliteral">&quot;NO_DIRTYING&quot;</span> ) ) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                it.<a class="code" href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">faults</a>.insert( <a class="code" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;            }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">if</span>( dirt &gt; 0 &amp;&amp; curammo_effects.count( <span class="stringliteral">&quot;BLACKPOWDER&quot;</span> ) ) {</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                it.<a class="code" href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">faults</a>.erase( <a class="code" href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a> );</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                it.<a class="code" href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">faults</a>.insert( <a class="code" href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a> );</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            }</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="comment">// end fouling mechanics</span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;        }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;    <span class="comment">// chance to damage gun due to high levels of dirt. Very unlikely, especially at lower levels and impossible below 5,000. Lower than the chance of a jam at the same levels. 555555... is an arbitrary number that I came up with after playing with the formula in excel. It makes sense at low, medium, and high levels of dirt.</span></div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">// if you have a bullet loaded with match head powder this can happen randomly at any time. The chances are about the same as a recycled ammo jamming the gun</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">if</span>( ( dirt_dbl &gt; 5000 &amp;&amp; <a class="code" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( dirt_dbl * dirt_dbl * dirt_dbl, 5555555555555 ) ) ||</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        ( curammo_effects.count( <span class="stringliteral">&quot;MATCHHEAD&quot;</span> ) &amp;&amp; <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 256 ) ) ) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is damaged by the high pressure!&quot;</span> ),</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;        <span class="comment">// Don&#39;t increment until after the message</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;        it.<a class="code" href="classitem.html#a6dc463a17ae0cac2850b6d1bc8b34fa7">inc_damage</a>();</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;    }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;}</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno"><a class="line" href="classCharacter.html#a9e1fc0ad25d91346b7bfe54d24a4aacd">  771</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classCharacter.html#a9e1fc0ad25d91346b7bfe54d24a4aacd">Character::handle_gun_overheat</a>( <a class="code" href="classitem.html">item</a> &amp;it )</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;{</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    <span class="keywordtype">double</span> overheat_modifier = 0;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="keywordtype">float</span> overheat_multiplier = 1.0f;</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordtype">double</span> heat_modifier = 0;</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;    <span class="keywordtype">float</span> heat_multiplier = 1.0f;</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> *<a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : it.<a class="code" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;        overheat_modifier += <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;overheat_threshold_modifier;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;        overheat_multiplier *= <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;overheat_threshold_multiplier;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        heat_modifier += <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;heat_per_shot_modifier;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        heat_multiplier *= <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;heat_per_shot_multiplier;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordtype">double</span> heat = it.<a class="code" href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">get_var</a>( <span class="stringliteral">&quot;gun_heat&quot;</span>, 0.0 );</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    <span class="keywordtype">double</span> threshold = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( ( it.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;overheat_threshold * overheat_multiplier ) +</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                 overheat_modifier, 5.0 );</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <span class="keyword">const</span> <a class="code" href="structislot__gun.html">islot_gun</a> &amp;gun_type = *it.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    <span class="keywordflow">if</span>( threshold &lt; 0.0 ) {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;    }</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160; </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">if</span>( heat &gt; threshold ) {</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code" href="ranged_8cpp.html#a52f20bf5a32adb49385320ff391b2f8e">fault_overheat_safety</a> ) &amp;&amp; !<a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( gun_type.<a class="code" href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">durability</a> ) ) {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>,</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s displays a warning sequence as its active cooling cycle engages.&quot;</span> ),</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            it.<a class="code" href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">faults</a>.insert( <a class="code" href="ranged_8cpp.html#a52f20bf5a32adb49385320ff391b2f8e">fault_overheat_safety</a> );</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        }</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160; </div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="comment">//Overall the durability of the gun greatly conditions what sort of failures are possible.</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        <span class="comment">//A durability above 8 prevents the most serious failures</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordtype">int</span> fault_roll = <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 5, 15 ) - gun_type.<a class="code" href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">durability</a>;</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;        <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code" href="ranged_8cpp.html#a5a490676abb8e2a402ec62817da5311b">fault_overheat_explosion</a> ) &amp;&amp; fault_roll &gt; 9 ) {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>,</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s revs and chokes violently as its internal containment fields detune!&quot;</span> ),</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s detonates!&quot;</span> ),</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            it.<a class="code" href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">faults</a>.insert( <a class="code" href="ranged_8cpp.html#aaa28e14858a862e5085b9c4d06f5bfdc">fault_overheat_melting</a> );</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;            <a class="code" href="namespaceexplosion__handler.html#af4ae8e07a9627dbfe22b2d07ea577587">explosion_handler::explosion</a>( <span class="keyword">this</span>, this-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), 1200, 0.4 );</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code" href="ranged_8cpp.html#aaa28e14858a862e5085b9c4d06f5bfdc">fault_overheat_melting</a> ) &amp;&amp; fault_roll &gt; 6 ) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Acrid smoke pours from your %s as its internals fuse together.&quot;</span> ),</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;            it.<a class="code" href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">faults</a>.insert( <a class="code" href="ranged_8cpp.html#aaa28e14858a862e5085b9c4d06f5bfdc">fault_overheat_melting</a> );</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#adaaa3ece39eb40637371659dad8550e3">faults_potential</a>().count( <a class="code" href="ranged_8cpp.html#a0f268fc372aed3ee28ba36bd2d2d5287">fault_overheat_venting</a> ) &amp;&amp; fault_roll &gt; 2 ) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>,</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;The cooling system of your %s chokes and vents a dense cloud of superheated coolant.&quot;</span> ),</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;                               it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 3; i++ ) {</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                here.<a class="code" href="classmap.html#a32a9de57ddea3145ca42e6acfde7f3d6">add_field</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() + <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -1, 1 ), <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -1, 1 ) ), <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a1e3f04102267eaf5e8d0ca424fd5c561">field_type_id</a>( <span class="stringliteral">&quot;fd_nuke_gas&quot;</span> ), 3 );</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;            }</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            it.<a class="code" href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">set_var</a>( <span class="stringliteral">&quot;gun_heat&quot;</span>, heat - gun_type.<a class="code" href="structislot__gun.html#a2dab58d1ca33c9221bb4f30fc0b17edb">cooling_value</a> * 4.0 );</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    it.<a class="code" href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">set_var</a>( <span class="stringliteral">&quot;gun_heat&quot;</span>, heat + <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( ( gun_type.<a class="code" href="structislot__gun.html#a25ca55cb76e90794dc8ac200c8baf211">heat_per_shot</a> * heat_multiplier ) +</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;                heat_modifier, 0.0 ) );</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;}</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno"><a class="line" href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">  835</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">npc::pretend_fire</a>( <a class="code" href="classnpc.html">npc</a> *source, <span class="keywordtype">int</span> shots, <a class="code" href="classitem.html">item</a> &amp;gun )</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;{</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    <span class="keywordtype">int</span> curshot = 0;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 50 ) ) {</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( *source, <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s shoots something.&quot;</span> ), source-&gt;<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">while</span>( curshot != shots ) {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> required = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_required();</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_consume( required, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="keyword">this</span> ) != required ) {</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Unexpected shortage of ammo whilst firing %s&quot;</span>, <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname().c_str() );</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;        }</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;        <a class="code" href="classitem.html">item</a> *<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = &amp;<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;        <span class="keyword">const</span> <a class="code" href="structitem_1_1sound__data.html">item::sound_data</a> data = <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>-&gt;<a class="code" href="classitem.html#a3694c5d9138956736af2444bd7b3972e">gun_noise</a>( shots &gt; 1 );</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160; </div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( *source, <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You hear %s.&quot;</span> ), data.<a class="code" href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">sound</a> );</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        curshot++;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;}</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160; </div>
<div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="classCharacter.html#a9f90838e7733c76ae2b1eaa7b9e418cb">  857</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCharacter.html#a9f90838e7733c76ae2b1eaa7b9e418cb">Character::fire_gun</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;target, <span class="keywordtype">int</span> shots )</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;{</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>();</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> ) {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s doesn&#39;t have a gun to fire&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classCharacter.html#a9f90838e7733c76ae2b1eaa7b9e418cb">fire_gun</a>( target, shots, *<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> );</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;}</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno"><a class="line" href="classCharacter.html#a93bc0ca4e02140cfc457f0b30f1716ea">  867</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCharacter.html#a9f90838e7733c76ae2b1eaa7b9e418cb">Character::fire_gun</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;target, <span class="keywordtype">int</span> shots, <a class="code" href="classitem.html">item</a> &amp;gun )</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;{</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.is_gun() ) {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s tried to fire non-gun (%s).&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname() );</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    }</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.has_flag( <a class="code" href="flag_8cpp.html#aedfde22bea9f851fe42ce054812293f2">flag_CHOKE</a> ) &amp;&amp; !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_effects().count( <span class="stringliteral">&quot;SHOT&quot;</span> ) ) {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;A shotgun equipped with choke cannot fire slugs.&quot;</span> ) );</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;    }</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordtype">bool</span> is_mech_weapon = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() &amp;&amp;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;has_flag( <a class="code" href="mtype_8cpp.html#a1ce59be15eeebc2aa195dc5a5cf38358">mon_flag_RIDEABLE_MECH</a> ) ) {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;        is_mech_weapon = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;    <span class="comment">// cap our maximum burst size by ammo and energy</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.has_flag( <a class="code" href="flag_8cpp.html#a5d1fa7fb2e0d7c717f7bc1cc461407db">flag_VEHICLE</a> ) ) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;        shots = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( shots, <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.shots_remaining( <span class="keyword">this</span> ) );</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_required() ) {</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="comment">// This checks ammo only. Vehicle turret energy drain is handled elsewhere.</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        shots = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( shots, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_remaining() / <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_required() ) );</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160; </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">if</span>( shots &lt;= 0 ) {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Attempted to fire zero or negative shots using %s&quot;</span>, <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname() );</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;    }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="comment">// usage of any attached bipod is dependent upon terrain or on being prone</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="keywordtype">bool</span> bipod = here.<a class="code" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a6360286fa7a45a7d705397a23a639f54">ter_furn_flag::TFLAG_MOUNTABLE</a>, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) || <a class="code" href="classCharacter.html#ac6f590f28f979103633d198e32524c06">is_prone</a>();</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <span class="keywordflow">if</span>( !bipod ) {</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;        <span class="keywordflow">if</span>( <span class="keyword">const</span> <a class="code" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            bipod = vp-&gt;vehicle().has_part( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="stringliteral">&quot;MOUNTABLE&quot;</span> );</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        }</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160; </div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="comment">// Up to 50% of recoil can be delayed until end of burst dependent upon relevant skill</span><span class="comment"></span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;<span class="comment">    /** @EFFECT_PISTOL delays effects of recoil during automatic fire */</span><span class="comment"></span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="comment">    /** @EFFECT_SMG delays effects of recoil during automatic fire */</span><span class="comment"></span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;<span class="comment">    /** @EFFECT_RIFLE delays effects of recoil during automatic fire */</span><span class="comment"></span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;<span class="comment">    /** @EFFECT_SHOTGUN delays effects of recoil during automatic fire */</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordtype">double</span> absorb = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gun_skill() ),</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                              <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) ) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> * 2 );</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <a class="code" href="classstring__id.html">itype_id</a> gun_id = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.typeId();</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    <a class="code" href="classstring__id.html">skill_id</a> gun_skill = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gun_skill();</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2a784256c4603f053783c251704220cd0c">debugmode::DF_RANGED</a>, <span class="stringliteral">&quot;Gun skill (%s) %g&quot;</span>, gun_skill.<a class="code" href="classstring__id.html#a2c0e3a434bcb9e3c353b337053ff22d8">c_str</a>(),</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                   <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( gun_skill ) ) ;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> aim = target;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;    <span class="keywordtype">int</span> curshot = 0;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    <span class="keywordtype">int</span> hits = 0; <span class="comment">// total shots on target</span></div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;    <span class="keywordtype">int</span> delay = 0; <span class="comment">// delayed recoil that has yet to be applied</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordflow">while</span>( curshot != shots ) {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.faults.count( <a class="code" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> ) &amp;&amp; curshot == 0 ) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() * 0.5 );</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.faults.erase( <a class="code" href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a> );</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You cycle your %s manually.&quot;</span> ), <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname() );</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        }</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160; </div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#ad34f7b20c4a0e5a8f659efe14482fd2b">handle_gun_damage</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> ) ) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;        }</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a9e1fc0ad25d91346b7bfe54d24a4aacd">handle_gun_overheat</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> ) ) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;        <span class="comment">// If this is a vehicle mounted turret, which vehicle is it mounted on?</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keyword">const</span> <a class="code" href="classvehicle.html">vehicle</a> *in_veh = <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a> ) ? <a class="code" href="vpart__position_8h.html#a8da46e924794d004c9899494ecd600c5">veh_pointer_or_null</a>( here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>(</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                                    <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160; </div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        <span class="comment">// Add gunshot noise</span></div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        <a class="code" href="ranged_8cpp.html#a13b78ee77e8e3b8527bff0ce8e7a5651">make_gun_sound_effect</a>( *<span class="keyword">this</span>, shots &gt; 1, &amp;<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> );</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <a class="code" href="namespacesfx.html#ab522c25b68b3f305b3f006ee41a7bd83">sfx::generate_gun_sound</a>( *<span class="keyword">this</span>, <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> );</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160; </div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;        <a class="code" href="structweakpoint__attack.html">weakpoint_attack</a> wp_attack;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        wp_attack.<a class="code" href="structweakpoint__attack.html#aed78ef37bb4ef0b99cc10318b569c016">weapon</a> = &amp;<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>;</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <a class="code" href="structprojectile.html">projectile</a> proj = <a class="code" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> );</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="structdamage__unit.html">damage_unit</a> &amp;elem : proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code" href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_units</a> ) {</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            elem.<a class="code" href="structdamage__unit.html#a5937d5d78a6db9efaefb0bf9517377d3">amount</a> = <a class="code" href="classCharacter.html#add870e576ff59aa6943af286576219e9">enchantment_cache</a>-&gt;modify_value( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998ae9eb92b40afbf5f24dc08c3543737d84">enchant_vals::mod::RANGED_DAMAGE</a>, elem.<a class="code" href="structdamage__unit.html#a5937d5d78a6db9efaefb0bf9517377d3">amount</a> );</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        }</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <a class="code" href="classdispersion__sources.html">dispersion_sources</a> dispersion = <a class="code" href="classCharacter.html#a05331bfbde3df1348a870d987597d29a">get_weapon_dispersion</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> );</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code" href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">recoil_total</a>() );</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#a61a49ec23021c4865d0dd9110a0b8b4e">add_spread</a>( proj.<a class="code" href="structprojectile.html#af0fefe18f0e831be4b4d7d9693b35cbc">shot_spread</a> );</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160; </div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordtype">bool</span> first = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordtype">bool</span> headshot = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;        <span class="keywordtype">bool</span> multishot = proj.<a class="code" href="structprojectile.html#ac535de1b5134a85ddcc5d1deffbf0d31">count</a> &gt; 1;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;        std::map&lt; Creature *, std::pair &lt; int, int &gt;&gt; targets_hit;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> projectile_number = 0; projectile_number &lt; proj.<a class="code" href="structprojectile.html#ac535de1b5134a85ddcc5d1deffbf0d31">count</a>; ++projectile_number ) {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            <span class="keywordflow">if</span>( !first &amp;&amp; !proj.<a class="code" href="structprojectile.html#a69088085addc2ca2b0e5328faab85c87">multi_projectile_effects</a> ) {</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                proj.<a class="code" href="structprojectile.html#a4536010a51aee3302d749f2eb4dcaf35">proj_effects</a>.erase( proj.<a class="code" href="structprojectile.html#a4536010a51aee3302d749f2eb4dcaf35">proj_effects</a>.begin(), proj.<a class="code" href="structprojectile.html#a4536010a51aee3302d749f2eb4dcaf35">proj_effects</a>.end() );</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <a class="code" href="structdealt__projectile__attack.html">dealt_projectile_attack</a> shot = <a class="code" href="ballistics_8cpp.html#a3090f41e3e1093c0ac85ed679237a6df">projectile_attack</a>( proj, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), aim,</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                                           dispersion, <span class="keyword">this</span>, in_veh, wp_attack, first );</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            first = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            <span class="keywordflow">if</span>( shot.<a class="code" href="structdealt__projectile__attack.html#a466f327979e41691bc19c91e622078b6">hit_critter</a> ) {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                <span class="keywordtype">int</span> damage = shot.<a class="code" href="structdealt__projectile__attack.html#aca4d2ea74ab244bb1defe86449a45c39">dealt_dam</a>.<a class="code" href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">total_damage</a>();</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                <span class="keywordflow">if</span>( damage &gt; 0 ) {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                    targets_hit[ shot.<a class="code" href="structdealt__projectile__attack.html#a466f327979e41691bc19c91e622078b6">hit_critter</a> ].second += damage;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                }</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                targets_hit[ shot.<a class="code" href="structdealt__projectile__attack.html#a466f327979e41691bc19c91e622078b6">hit_critter</a> ].first++;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;            }</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;            <span class="keywordflow">if</span>( shot.<a class="code" href="structdealt__projectile__attack.html#ab874a1233da5daa95ff296cdb1ee1849">missed_by</a> &lt;= .1 ) {</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                headshot = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            }</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            <span class="keywordflow">if</span>( proj.<a class="code" href="structprojectile.html#ac535de1b5134a85ddcc5d1deffbf0d31">count</a> &gt; 1 &amp;&amp; <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), shot.<a class="code" href="structdealt__projectile__attack.html#a7dd960a5108456f89dc1f8ef369a1096">end_point</a> ) == 1 ) {</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                <span class="comment">// Point-blank shots don&#39;t act like shot, everything hits the same target.</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                multishot = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;            }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        }</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;        <span class="keywordflow">if</span>( !targets_hit.empty() ) {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;            hits++;</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="keywordflow">for</span>( std::pair&lt;<a class="code" href="classCreature.html">Creature</a> *<span class="keyword">const</span>, std::pair&lt;int, int&gt;&gt; &amp;hit_entry : targets_hit ) {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classmonster.html">monster</a> *<span class="keyword">const</span> m = hit_entry.first-&gt;<a class="code" href="classmonster.html#a02fa605494e946663ddd216166828f2a">as_monster</a>() ) {</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                <a class="code" href="classcata_1_1event.html">cata::event</a> e = cata::event::make&lt;event_type::character_ranged_attacks_monster&gt;( <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>(), gun_id,</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                m-&gt;type-&gt;<a class="code" href="structitype.html#ab018b62882b32eef884f4efd769c0993">id</a> );</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                <a class="code" href="event__bus_8h.html#a4f760194b9225ccf92a1419748def636">get_event_bus</a>().<a class="code" href="classevent__bus.html#a29fab483aed46dcf2697e6e504e685dc">send_with_talker</a>( <span class="keyword">this</span>, m, e );</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html">Character</a> *<span class="keyword">const</span> <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a> = hit_entry.first-&gt;as_character() ) {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                <a class="code" href="classcata_1_1event.html">cata::event</a> e = cata::event::make&lt;event_type::character_ranged_attacks_character&gt;( <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>(), gun_id,</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                                <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>-&gt;getID(), <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>-&gt;get_name() );</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                <a class="code" href="event__bus_8h.html#a4f760194b9225ccf92a1419748def636">get_event_bus</a>().<a class="code" href="classevent__bus.html#a29fab483aed46dcf2697e6e504e685dc">send_with_talker</a>( <span class="keyword">this</span>, <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, e );</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;            <span class="keywordflow">if</span>( multishot ) {</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                <span class="comment">// TODO: Pull projectile name from the ammo entry.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                <a class="code" href="projectile_8cpp.html#a25f4dcd2b5815a4943a73a6b674ba9e0">multi_projectile_hit_message</a>( hit_entry.first, hit_entry.second.first, hit_entry.second.second,</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                                              <a class="code" href="translations_8h.html#a45dd4e3da9b83845bcd1c2d8e80cf802">n_gettext</a>( <span class="stringliteral">&quot;projectile&quot;</span>, <span class="stringliteral">&quot;projectiles&quot;</span>, hit_entry.second.first ) );</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        }</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="keywordflow">if</span>( headshot ) {</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            <span class="comment">// TODO: check head existence for headshot</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;            <a class="code" href="event__bus_8h.html#a4f760194b9225ccf92a1419748def636">get_event_bus</a>().<a class="code" href="classevent__bus.html#ab753616a3a663185377ac52560068194">send</a>&lt;<a class="code" href="event_8h.html#a333a7721472705fe444b24f107f9a731a365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a>&gt;( <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() );</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        curshot++;</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160; </div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.is_gun() ) {</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            <span class="comment">// If we lose our gun as a side effect of firing it, skip the rest of the loop body.</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="keywordtype">int</span> qty = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gun_recoil( *<span class="keyword">this</span>, bipod );</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        delay  += qty * absorb;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="comment">// Temporarily scale by 5x as we adjust MAX_RECOIL, factoring in the recoil enchantment also.</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> += <a class="code" href="classCharacter.html#add870e576ff59aa6943af286576219e9">enchantment_cache</a>-&gt;modify_value( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998ac01550f8cffa20cf080d109e61087f58">enchant_vals::mod::RECOIL_MODIFIER</a>, 5.0 ) *</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;                  ( qty * ( 1.0 - absorb ) );</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> current_ammo = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_current();</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code" href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a> ) &amp;&amp; !<a class="code" href="classCharacter.html#a74cf2e51a768e3d2e2114aeaddb5fda4">has_morale</a>( <a class="code" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a> ) ) {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            <span class="keyword">const</span> std::set&lt;ammotype&gt; &amp;at = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_types();</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a66543644370f9b1d803abac7d90cd033">ammo_flammable</a> ) ) {</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You feel a surge of euphoria as flames roar out of the %s!&quot;</span> ),</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                                   <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname() );</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <a class="code" href="classCharacter.html#ab6b6b317ae10bfb8f358fe289d645c96">add_morale</a>( <a class="code" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a>, 15, 15, 8_hours, 6_hours );</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                <a class="code" href="classCharacter.html#a2725bcbfa9e92e0590930e6a8e35764c">rem_morale</a>( <a class="code" href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a> );</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#ab386b4796e39e527e91a503f6975c82d">ammo_66mm</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a5b115344b066e0eebf72b6fcafaebfb2">ammo_120mm</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a638a17e59573d9d6bac0a05980096c37">ammo_84x246mm</a> ) ||</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                       at.count( <a class="code" href="ranged_8cpp.html#a81c0e98b7eaad878f45b27c21f4d6393">ammo_m235</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a990502dafd582f371f40de17ae3f5ef4">ammo_atgm</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a68193ecd0be34e65f12a3febf6f7b6e1">ammo_RPG_7</a> ) ||</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                       at.count( <a class="code" href="ranged_8cpp.html#aecf1c5ee613ec0609d2ae3a7a46b4b8d">ammo_homebrew_rocket</a> ) ) {</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                <a class="code" href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You feel a surge of euphoria as flames burst out!&quot;</span> ) );</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                <a class="code" href="classCharacter.html#ab6b6b317ae10bfb8f358fe289d645c96">add_morale</a>( <a class="code" href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a>, 15, 15, 8_hours, 6_hours );</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                <a class="code" href="classCharacter.html#a2725bcbfa9e92e0590930e6a8e35764c">rem_morale</a>( <a class="code" href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a> );</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            }</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;        }</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160; </div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> required = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_required();</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_consume( required, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="keyword">this</span> ) != required ) {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;            <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Unexpected shortage of ammo whilst firing %s&quot;</span>, <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname() );</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;        }</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160; </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;        <span class="comment">// Vehicle turrets drain vehicle battery and do not care about this</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.has_flag( <a class="code" href="flag_8cpp.html#a5d1fa7fb2e0d7c717f7bc1cc461407db">flag_VEHICLE</a> ) ) {</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::energy</a> energ_req = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.get_gun_energy_drain();</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::energy</a> drained = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.energy_consume( energ_req, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="keyword">this</span> );</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;            <span class="keywordflow">if</span>( drained &lt; energ_req ) {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Unexpected shortage of energy whilst firing %s. Required: %i J, drained: %i J&quot;</span>,</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                          <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname(), <a class="code" href="namespaceunits.html#a9e6793937cd630b03c24d520c5415904">units::to_joule</a>( energ_req ), <a class="code" href="namespaceunits.html#a9e6793937cd630b03c24d520c5415904">units::to_joule</a>( drained ) );</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            }</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;        <span class="keywordflow">if</span>( !current_ammo.<a class="code" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;            <a class="code" href="ranged_8cpp.html#a035c67a119c3f5a39b1069944798c9fc">cycle_action</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>, current_ammo, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;        }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;        <span class="keywordflow">if</span>( gun_skill == <a class="code" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a> ) {</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;            <span class="keywordflow">continue</span>; <span class="comment">// skip retargeting for launchers</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        }</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    }</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <span class="comment">// Use different amounts of time depending on the type of gun and our skill</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( *<span class="keyword">this</span>, *gun_id ) );</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160; </div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;    <span class="keyword">const</span> <a class="code" href="structislot__gun.html">islot_gun</a> &amp;firing = *<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.type-&gt;gun;</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const bodypart_str_id, int&gt; &amp;hurt_part : firing.<a class="code" href="structislot__gun.html#a7c8efa3250a559891c258d4a10cb2a43">hurt_part_when_fired</a> ) {</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        <a class="code" href="classCharacter.html#a7c11a4f12bee9f80279bff21faa54153">apply_damage</a>( <span class="keyword">nullptr</span>, <a class="code" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( hurt_part.first ), hurt_part.second );</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;        <a class="code" href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">add_msg_player_or_npc</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s is hurt by the recoil!&quot;</span> ),</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                               <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt;&#39;s %s is hurt by the recoil!&quot;</span> ),</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                               <a class="code" href="bodypart_8cpp.html#aa097cb26e12eaa87b56e93c3568a5a74">body_part_name_accusative</a>( <a class="code" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( hurt_part.first ) ) );</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    }</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">// Practice the base gun skill proportionally to number of hits, but always by one.</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.has_flag( <a class="code" href="flag_8cpp.html#a355f9f8a9e0571a45af1c696fb28977c">flag_WONT_TRAIN_MARKSMANSHIP</a> ) ) {</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;        <a class="code" href="classCharacter.html#a6535a02158a1d6b23b0a6bb623dfae19">practice</a>( <a class="code" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a>, ( hits + 1 ) * 5 );</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;    }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="comment">// launchers train weapon skill for both hits and misses.</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    <span class="keywordtype">int</span> practice_units = gun_skill == <a class="code" href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a> ? curshot : hits;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <a class="code" href="classCharacter.html#a6535a02158a1d6b23b0a6bb623dfae19">practice</a>( gun_skill, ( practice_units + 1 ) * 5 );</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160; </div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.is_gun() ) {</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <span class="comment">// If we lose our gun as a side effect of firing it, skip the rest of the function.</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;        <span class="keywordflow">return</span> curshot;</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    }</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <span class="comment">// apply shot counter to gun and its mods.</span></div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.set_var( <span class="stringliteral">&quot;shot_counter&quot;</span>, <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.get_var( <span class="stringliteral">&quot;shot_counter&quot;</span>, 0 ) + curshot );</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> *<a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gunmods() ) {</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;        <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;set_var( <span class="stringliteral">&quot;shot_counter&quot;</span>, <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;get_var( <span class="stringliteral">&quot;shot_counter&quot;</span>, 0 ) + curshot );</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    }</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.has_flag( <a class="code" href="flag_8cpp.html#aa4483d80251dc96dd0c8313d8a6366f9">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <span class="comment">// Reset aim for bows and other reload-and-shoot weapons.</span></div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;        <span class="comment">// apply delayed recoil, factor in recoil enchantments</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;        <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> += <a class="code" href="classCharacter.html#add870e576ff59aa6943af286576219e9">enchantment_cache</a>-&gt;modify_value( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998ac01550f8cffa20cf080d109e61087f58">enchant_vals::mod::RECOIL_MODIFIER</a>, delay );</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <span class="keywordflow">if</span>( is_mech_weapon ) {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            <span class="comment">// mechs can handle recoil far better. they are built around their main gun.</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;            <span class="comment">// TODO: shouldn&#39;t this affect only recoil accumulated during this function?</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> / 2;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;        <span class="comment">// Cap</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>, <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160; </div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#ac209d32cbfd3774af3d5c0500e2fae52">is_avatar</a>() ) {</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;        <a class="code" href="classCreature.html#a3efb920d8e3d22ee766b62012ad0f9cd">as_avatar</a>()-&gt;<a class="code" href="classavatar.html#a8344dc1c4b8cd02a9633f3275cc69a2d">aim_cache_dirty</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160; </div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="keywordflow">return</span> curshot;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;}</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160; </div>
<div class="line"><a name="l01110"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aa55aace1fedc5b64c6d3d0418e251c38"> 1110</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#aa55aace1fedc5b64c6d3d0418e251c38">throw_cost</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;<a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;to_throw )</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;{</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="comment">// Very similar to player::attack_speed</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="comment">// TODO: Extract into a function?</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;    <span class="comment">// Differences:</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    <span class="comment">// Dex is more (2x) important for throwing speed</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="comment">// At 10 skill, the cost is down to 0.75%, not 0.66%</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> base_move_cost = to_throw.<a class="code" href="classitem.html#a5ac32d5d8193f5fad10893881f53cb1c">attack_time</a>( <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a> ) / 2;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> throw_skill = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ),</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                                        <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_skill_level( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );<span class="comment"></span></div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;<span class="comment">    ///\EFFECT_THROW increases throwing speed</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;<span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> skill_cost = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( base_move_cost * ( 20 - throw_skill ) / 20 ) );<span class="comment"></span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">    ///\EFFECT_DEX increases throwing speed</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> dexbonus = <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_dex();</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_ratio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina() ) / <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_stamina_max();</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> stamina_penalty = 1.0 + <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( ( 0.25f - stamina_ratio ) * 4.0f, 0.0f );</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160; </div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordtype">int</span> move_cost = base_move_cost;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;    move_cost *= <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_modifier( <a class="code" href="ranged_8cpp.html#a8d4ed92ee82965b00b2c043ef36261d2">character_modifier_melee_thrown_move_lift_mod</a> );</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;    move_cost *= <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_modifier( <a class="code" href="ranged_8cpp.html#a591e788884fe3dc8032be8a9fc2ceb3c">character_modifier_melee_thrown_move_balance_mod</a> );</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;    <span class="comment">// Stamina penalty only affects base/2 and encumbrance parts of the cost</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;    move_cost *= stamina_penalty;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    move_cost += skill_cost;</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;    move_cost -= dexbonus;</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    move_cost = <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.enchantment_cache-&gt;modify_value( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998a3d3e5fcb0b68fc939d4e32a894e620a8">enchant_vals::mod::ATTACK_SPEED</a>, move_cost );</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160; </div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 25, move_cost );</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;}</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160; </div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">// Handle capping aim level when the player cannot see the target tile or there is nothing to aim at.</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7ff8232af89fc85c44dee1cd0525f655"> 1140</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="ranged_8cpp.html#a7ff8232af89fc85c44dee1cd0525f655">calculate_aim_cap</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;you, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;target )</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;{</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;    <span class="keywordtype">double</span> min_recoil = 0.0;</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> *victim = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( target, <span class="keyword">true</span> );</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;    <span class="comment">// No p.sees_with_specials() here because special senses are not precise enough</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;    <span class="comment">// to give creature&#39;s exact size &amp; position, only which tile it occupies</span></div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;    <span class="keywordflow">if</span>( victim == <span class="keyword">nullptr</span> || ( !you.<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *victim ) &amp;&amp; !you.<a class="code" href="classCharacter.html#a9976ba9d9bccdaff264bd834628b97ec">sees_with_infrared</a>( *victim ) ) ) {</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> range = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), target );</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;        <span class="comment">// Get angle of triangle that spans the target square.</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> = 2 * <a class="code" href="line_8cpp.html#aaa43dcdfe5b511b116fafb32c5cff349">atan2</a>( 0.5, range );</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;        <span class="comment">// Convert from radians to arcmin.</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;        min_recoil = 60 * 180 * <a class="code" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> / <a class="code" href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    }</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="keywordflow">return</span> min_recoil;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;}</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160; </div>
<div class="line"><a name="l01156"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a969d7fb0eb05d60c2c98eb568bce69f2"> 1156</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="ranged_8cpp.html#a969d7fb0eb05d60c2c98eb568bce69f2">calc_steadiness</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;weapon, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;<a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a>,</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                        <span class="keywordtype">double</span> predicted_recoil )</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;{</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil = <a class="code" href="ranged_8cpp.html#a7ff8232af89fc85c44dee1cd0525f655">calculate_aim_cap</a>( you, <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> );</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> effective_recoil = you.<a class="code" href="classCharacter.html#a2c1e0d2a430258c132cbdff827fc8e89">most_accurate_aiming_method_limit</a>( weapon );</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> min_dispersion = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( min_recoil, effective_recoil );</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> steadiness_range = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - min_dispersion;</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;    <span class="comment">// This is a relative measure of how steady the player&#39;s aim is,</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    <span class="comment">// 0 is the best the player can do.</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> steady_score = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0.0, predicted_recoil - min_dispersion );</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">// Fairly arbitrary cap on steadiness...</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    <span class="keywordflow">return</span> 1.0 - ( steady_score / steadiness_range );</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;}</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"><a class="line" href="classCharacter.html#ace68b093955008a3faf37ba2d09bb0b5"> 1170</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCharacter.html#ace68b093955008a3faf37ba2d09bb0b5">Character::throw_dispersion_per_dodge</a>( <span class="keywordtype">bool</span> <span class="comment">/* add_encumbrance */</span> )<span class="keyword"> const</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    <span class="comment">// +200 per dodge point at 0 dexterity</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    <span class="comment">// +100 at 8, +80 at 12, +66.6 at 16, +57 at 20, +50 at 24</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    <span class="comment">// Each 10 encumbrance on either hand is like -1 dex (can bring penalty to +400 per dodge)</span><span class="comment"></span></div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="comment">    ///\EFFECT_DEX increases throwing accuracy against targets with good dodge stat</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="comment"></span>    <span class="keywordtype">float</span> effective_dex = 2 + <a class="code" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>() / 4.0f;</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    effective_dex *= <a class="code" href="classCharacter.html#a191d57983e5a0064be49504c11e8b56a">get_modifier</a>( <a class="code" href="ranged_8cpp.html#aaab2235167b3bf7fa8f2e8c9163d64d2">character_modifier_thrown_dex_mod</a> );</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( 100.0f / <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1.0f, effective_dex ) );</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;}</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160; </div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="comment">// Perfect situation gives us 1000 dispersion at lvl 0</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="comment">// This goes down linearly to 250  dispersion at lvl 10</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"><a class="line" href="classCharacter.html#a6853521cfe7399330d90c08271e003b4"> 1183</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCharacter.html#a6853521cfe7399330d90c08271e003b4">Character::throwing_dispersion</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;to_throw, <a class="code" href="classCreature.html">Creature</a> *critter,</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                                    <span class="keywordtype">bool</span> is_blind_throw )<span class="keyword"> const</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;    <a class="code" href="classunits_1_1quantity.html">units::mass</a> weight = to_throw.<a class="code" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>();</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <a class="code" href="classunits_1_1quantity.html">units::volume</a> <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> = to_throw.<a class="code" href="classitem.html#a686df014e8aa8bc4637883802d05f935">volume</a>();</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;    <span class="keywordflow">if</span>( to_throw.<a class="code" href="classitem.html#a40963a016376016eb408bdb9dbb94388">count_by_charges</a>() &amp;&amp; to_throw.<a class="code" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> &gt; 1 ) {</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        weight /= to_throw.<a class="code" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> /= to_throw.<a class="code" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160; </div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <span class="keywordtype">int</span> throw_difficulty = 1000;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <span class="comment">// 1000 penalty for every liter after the first</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="comment">// TODO: Except javelin type items</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    throw_difficulty += std::max&lt;int&gt;( 0, <a class="code" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> - 1_liter ) );</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    <span class="comment">// 1 penalty for gram above str*100 grams (at 0 skill)</span><span class="comment"></span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment">    ///\ARM_STR decreases throwing dispersion when throwing heavy objects</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">int</span> weight_in_gram = <a class="code" href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a>( weight );</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    throw_difficulty += <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0, weight_in_gram - <a class="code" href="classCharacter.html#af707ac7d1e7995274f21a9f0ac740c9a">get_arm_str</a>() * 100 );</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160; </div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="comment">// Dispersion from difficult throws goes from 100% at lvl 0 to 25% at lvl 10</span><span class="comment"></span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="comment">    ///\EFFECT_THROW increases throwing accuracy</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">float</span> throw_skill = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ),</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                                        <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="keywordtype">int</span> dispersion = 10 * throw_difficulty / ( 8 * throw_skill + 4 );</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="comment">// If the target is a creature, it moves around and ruins aim</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="comment">// TODO: Inform projectile functions if the attacker actually aims for the critter or just the tile</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;    <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;        <span class="comment">// It&#39;s easier to dodge at close range (thrower needs to adjust more)</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;        <span class="comment">// Dodge x10 at point blank, x5 at 1 dist, then flat</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;        <span class="keywordtype">float</span> effective_dodge = critter-&gt;<a class="code" href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">get_dodge</a>() * <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1, 10 - 5 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(),</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;                                critter-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) );</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;        dispersion += <a class="code" href="classCharacter.html#ace68b093955008a3faf37ba2d09bb0b5">throw_dispersion_per_dodge</a>( <span class="keyword">true</span> ) * effective_dodge;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    }</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    <span class="comment">// 1 perception per 1 eye encumbrance</span><span class="comment"></span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;<span class="comment">    ///\EFFECT_PER decreases throwing accuracy penalty from eye encumbrance</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;<span class="comment"></span>    dispersion += <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0, ( <a class="code" href="classCharacter.html#aef9cb6bfa6f5446ffbdf160e18ffdb86">encumb</a>( <a class="code" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;eyes&quot;</span> ) ) - <a class="code" href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">get_per</a>() ) * 10 );</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160; </div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="comment">// If throwing blind, we&#39;re assuming they mechanically can&#39;t achieve the</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">// accuracy of a normal throw.</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="keywordflow">if</span>( is_blind_throw ) {</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        dispersion *= 4;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    }</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0, dispersion );</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;}</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a9a8aae9d14e825d1fa9707093ef0a616"> 1229</a></span>&#160;<span class="keyword">static</span> std::optional&lt;int&gt; <a class="code" href="ranged_8cpp.html#a9a8aae9d14e825d1fa9707093ef0a616">character_throw_assist</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;guy )</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;{</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    std::optional&lt;int&gt; throw_assist = std::nullopt;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;    <span class="keywordflow">if</span>( guy.<a class="code" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <span class="keyword">auto</span> *mons = guy.<a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>.get();</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <span class="keywordflow">if</span>( mons-&gt;mech_str_addition() != 0 ) {</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            throw_assist = mons-&gt;mech_str_addition();</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            mons-&gt;use_mech_power( 3_kJ );</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;        }</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;    }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">return</span> throw_assist;</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;}</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160; </div>
<div class="line"><a name="l01242"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a6a73511d720b80c22f04cdb5a5662393"> 1242</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="ranged_8cpp.html#a6a73511d720b80c22f04cdb5a5662393">throwing_skill_adjusted</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;guy )</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;{</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <span class="keywordtype">float</span> skill_level = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ), guy.<a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <span class="comment">// if you are lying on the floor, you can&#39;t really throw that well</span></div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keywordflow">if</span>( guy.<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a> ) ) {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        skill_level = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0.0f, skill_level - 5 );</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    }</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <span class="keywordflow">return</span> skill_level;</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;}</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"><a class="line" href="classCharacter.html#ae6c99add30790add67dd94133805269f"> 1252</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCharacter.html#ae6c99add30790add67dd94133805269f">Character::thrown_item_adjusted_damage</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;thrown )<span class="keyword"> const</span></div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <span class="keyword">const</span> std::optional&lt;int&gt; throw_assist = <a class="code" href="ranged_8cpp.html#a9a8aae9d14e825d1fa9707093ef0a616">character_throw_assist</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_railgun = <a class="code" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( <a class="code" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a> ) &amp;&amp; thrown.<a class="code" href="classitem.html#a9e2c24734b538e61e186fb6777b62c25">made_of_any</a>( <a class="code" href="ranged_8cpp.html#a6cd87802123477df1237fa5271842f8b">ferric</a> ) &amp;&amp;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                            !throw_assist;</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160; </div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <span class="comment">// The damage dealt due to item&#39;s weight, player&#39;s strength, and skill level</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <span class="comment">// Up to str/2 or weight/100g (lower), so 10 str is 5 damage before multipliers</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="comment">// Railgun doubles the effective strength</span><span class="comment"></span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;<span class="comment">    ///\ARM_STR increases throwing damage</span></div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> stats_mod = do_railgun ? <a class="code" href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">get_str</a>() : ( <a class="code" href="classCharacter.html#af707ac7d1e7995274f21a9f0ac740c9a">get_arm_str</a>() / 2.0 );</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    stats_mod = throw_assist ? *throw_assist / 2.0 : stats_mod;</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="comment">// modify strength impact based on skill level, clamped to [0.15 - 1]</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;    <span class="comment">// mod = mod * [ ( ( skill / max_skill ) * 0.85 ) + 0.15 ]</span></div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    stats_mod *= ( <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ),</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;                             <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) ) /</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) ) * 0.85 + 0.15;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <span class="keywordflow">return</span> stats_mod;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;}</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160; </div>
<div class="line"><a name="l01272"></a><span class="lineno"><a class="line" href="classCharacter.html#ab00eb5ef085c40f7666fbb6f7a3e98e6"> 1272</a></span>&#160;<a class="code" href="structprojectile.html">projectile</a> <a class="code" href="classCharacter.html#ab00eb5ef085c40f7666fbb6f7a3e98e6">Character::thrown_item_projectile</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;thrown )<span class="keyword"> const</span></div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="comment">// We&#39;ll be constructing a projectile</span></div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;    <a class="code" href="structprojectile.html">projectile</a> proj;</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a> = thrown.<a class="code" href="classitem.html#a13b2b008995a2f2f2daa63be578b27c8">base_damage_thrown</a>();</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    proj.<a class="code" href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">speed</a> = 10 + <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">round</a>( <a class="code" href="ranged_8cpp.html#a6a73511d720b80c22f04cdb5a5662393">throwing_skill_adjusted</a>( *<span class="keyword">this</span> ) );</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    <span class="keywordflow">return</span> proj;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;}</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160; </div>
<div class="line"><a name="l01281"></a><span class="lineno"><a class="line" href="classCharacter.html#a5147c11c1cf4730c70f6412784153731"> 1281</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classCharacter.html#a5147c11c1cf4730c70f6412784153731">Character::thrown_item_total_damage_raw</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;thrown )<span class="keyword"> const</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    <a class="code" href="structprojectile.html">projectile</a> proj = <a class="code" href="classCharacter.html#ab00eb5ef085c40f7666fbb6f7a3e98e6">thrown_item_projectile</a>( thrown );</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code" href="structdamage__instance.html#a9eff5065ef6631935e95d061ca756ae4">add_damage</a>( <a class="code" href="ranged_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">damage_bash</a>, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( thrown.<a class="code" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>() / 100.0_gram,</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                            <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#ae6c99add30790add67dd94133805269f">thrown_item_adjusted_damage</a>( thrown ) ) ) );</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> glass_portion = thrown.<a class="code" href="classitem.html#a0795ac0d3e2ba958ab3a6ff4e282482b">made_of</a>( <a class="code" href="ranged_8cpp.html#a0445510734214e05ba923feabd4b85d9">material_glass</a> );</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> glass_fraction = glass_portion / <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( thrown.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#aef9a3f51d54f46dd1d5a7accaf483922">mat_portion_total</a> );</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::volume</a> <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> = thrown.<a class="code" href="classitem.html#a686df014e8aa8bc4637883802d05f935">volume</a>() * glass_fraction;</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="comment">// Item will shatter upon landing, destroying the item, dealing damage, and making noise</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordflow">if</span>( !thrown.<a class="code" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> &amp;&amp; glass_portion &amp;&amp;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, <a class="code" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( 2_liter - <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> ) ) &lt; <a class="code" href="classCharacter.html#af707ac7d1e7995274f21a9f0ac740c9a">get_arm_str</a>() * 100 ) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;        proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code" href="structdamage__instance.html#a9eff5065ef6631935e95d061ca756ae4">add_damage</a>( <a class="code" href="ranged_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">damage_cut</a>, <a class="code" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> ) / 500.0f );</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    }</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    <span class="comment">// Some minor (skill/2) armor piercing for skillful throws</span></div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    <span class="comment">// Not as much as in melee, though</span></div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> skill_level = <a class="code" href="ranged_8cpp.html#a6a73511d720b80c22f04cdb5a5662393">throwing_skill_adjusted</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structdamage__unit.html">damage_unit</a> &amp;du : proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code" href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_units</a> ) {</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        du.<a class="code" href="structdamage__unit.html#ab4d1b13f7ebe2f16a43038e1441ec2b5">res_pen</a> += skill_level / 2.0f;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;    }</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <span class="keywordtype">int</span> total_damage = 0;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structdamage__unit.html">damage_unit</a> &amp;du : proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code" href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_units</a> ) {</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        total_damage += du.<a class="code" href="structdamage__unit.html#a5937d5d78a6db9efaefb0bf9517377d3">amount</a> * du.<a class="code" href="structdamage__unit.html#a8c5cf76dd074bd5dac9b76aaece0ecf4">damage_multiplier</a>;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keywordflow">return</span> total_damage;</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;}</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160; </div>
<div class="line"><a name="l01308"></a><span class="lineno"><a class="line" href="classCharacter.html#acfb04a0e86c82c14248f911ebcb23f90"> 1308</a></span>&#160;<a class="code" href="structdealt__projectile__attack.html">dealt_projectile_attack</a> <a class="code" href="classCharacter.html#acfb04a0e86c82c14248f911ebcb23f90">Character::throw_item</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;target, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;to_throw,</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keyword">const</span> std::optional&lt;tripoint&gt; &amp;blind_throw_from_pos )</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;{</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="comment">// Copy the item, we may alter it before throwing</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <a class="code" href="classitem.html">item</a> thrown = to_throw;</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160; </div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">move_cost</a> = <a class="code" href="ranged_8cpp.html#aa55aace1fedc5b64c6d3d0418e251c38">throw_cost</a>( *<span class="keyword">this</span>, to_throw );</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">move_cost</a> );</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160; </div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> throwing_skill = <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">round</a>( <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> ) );</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::volume</a> <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> = to_throw.<a class="code" href="classitem.html#a686df014e8aa8bc4637883802d05f935">volume</a>();</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::mass</a> weight = to_throw.<a class="code" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>();</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keyword">const</span> std::optional&lt;int&gt; throw_assist = <a class="code" href="ranged_8cpp.html#a9a8aae9d14e825d1fa9707093ef0a616">character_throw_assist</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160; </div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordflow">if</span>( !throw_assist ) {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> stamina_cost = <a class="code" href="classCharacter.html#a0bd7efcad4b20c844c502639525095b0">get_standard_stamina_cost</a>( &amp;thrown );</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <a class="code" href="classCharacter.html#ac29de3d2bc90dd1c8d921b539fb05cfb">mod_stamina</a>( stamina_cost + throwing_skill );</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    }</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> skill_level = <a class="code" href="ranged_8cpp.html#a6a73511d720b80c22f04cdb5a5662393">throwing_skill_adjusted</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2a784256c4603f053783c251704220cd0c">debugmode::DF_RANGED</a>, <span class="stringliteral">&quot;Adjusted throw skill %g&quot;</span>, skill_level );</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <a class="code" href="structprojectile.html">projectile</a> proj = <a class="code" href="classCharacter.html#ab00eb5ef085c40f7666fbb6f7a3e98e6">thrown_item_projectile</a>( thrown );</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="structdamage__instance.html">damage_instance</a> &amp;<a class="code" href="classCharacter.html#aec5b22f2b058eb8923e91190f4a9ac8b">impact</a> = proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    std::set&lt;std::string&gt; &amp;proj_effects = proj.<a class="code" href="structprojectile.html#a4536010a51aee3302d749f2eb4dcaf35">proj_effects</a>;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160; </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_railgun = <a class="code" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( <a class="code" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a> ) &amp;&amp; thrown.<a class="code" href="classitem.html#a9e2c24734b538e61e186fb6777b62c25">made_of_any</a>( <a class="code" href="ranged_8cpp.html#a6cd87802123477df1237fa5271842f8b">ferric</a> ) &amp;&amp;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;                            !throw_assist;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160; </div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;    <a class="code" href="classCharacter.html#aec5b22f2b058eb8923e91190f4a9ac8b">impact</a>.add_damage( <a class="code" href="ranged_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">damage_bash</a>, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( weight / 100.0_gram,</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                       <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#ae6c99add30790add67dd94133805269f">thrown_item_adjusted_damage</a>( thrown ) ) ) );</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160; </div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;    <span class="keywordflow">if</span>( thrown.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a2f1dc9188e7d82056be9cd27d40a1ded">flag_ACT_ON_RANGED_HIT</a> ) ) {</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;ACT_ON_RANGED_HIT&quot;</span> );</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        thrown.<a class="code" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;    }</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;    <span class="comment">// Item will shatter upon landing, destroying the item, dealing damage, and making noise</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> glass_portion = thrown.<a class="code" href="classitem.html#a0795ac0d3e2ba958ab3a6ff4e282482b">made_of</a>( <a class="code" href="ranged_8cpp.html#a0445510734214e05ba923feabd4b85d9">material_glass</a> );</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> glass_fraction = glass_portion / <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( thrown.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#aef9a3f51d54f46dd1d5a7accaf483922">mat_portion_total</a> );</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;    <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::volume</a> glass_vol = <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> * glass_fraction;<span class="comment"></span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">    /** @ARM_STR increases chance of shattering thrown glass items (NEGATIVE) */</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> shatter = !thrown.<a class="code" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> &amp;&amp; glass_portion &amp;&amp;</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;                         <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, <a class="code" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( 2_liter - glass_vol ) ) &lt; <a class="code" href="classCharacter.html#af707ac7d1e7995274f21a9f0ac740c9a">get_arm_str</a>() * 100;</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="comment">// Item will burst upon landing, destroying the item, and spilling its contents</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> burst = thrown.<a class="code" href="classitem.html#aeb49bb1b64eba3731e606ffe83e95b4f">has_property</a>( <span class="stringliteral">&quot;burst_when_filled&quot;</span> ) &amp;&amp; thrown.<a class="code" href="classitem.html#a723753bab4cc789e3ec186846c9916a3">is_container</a>() &amp;&amp;</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                       thrown.<a class="code" href="classitem.html#a19e6dd5afd4bada41c8d97792fd0815d">get_property_int64_t</a>( <span class="stringliteral">&quot;burst_when_filled&quot;</span> ) &lt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                       ( thrown.<a class="code" href="classitem.html#a616aedf5cb1225f658078d1ffa48e8f6">total_contained_volume</a>().<a class="code" href="classunits_1_1quantity.html#a96f3f957dba2ea5583a55060ffa04363">value</a>() ) / thrown.<a class="code" href="classitem.html#ae9daf89e99f089da259528d1ed85e75d">get_total_capacity</a>().<a class="code" href="classunits_1_1quantity.html#a96f3f957dba2ea5583a55060ffa04363">value</a>() *</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;                       100;</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    <span class="comment">// Add some flags to the projectile</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    <span class="keywordflow">if</span>( weight &gt; 500_gram ) {</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;HEAVY_HIT&quot;</span> );</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    }</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    proj_effects.insert( <span class="stringliteral">&quot;NO_ITEM_DAMAGE&quot;</span> );</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160; </div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;    <span class="keywordflow">if</span>( thrown.<a class="code" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> ) {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;        <span class="comment">// Can&#39;t have Molotovs embed into monsters</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        <span class="comment">// Monsters don&#39;t have inventory processing</span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;NO_EMBED&quot;</span> );</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;    }</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160; </div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="keywordflow">if</span>( do_railgun ) {</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;LIGHTNING&quot;</span> );</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160; </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::energy</a> trigger_cost = <a class="code" href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a>-&gt;<a class="code" href="structbionic__data.html#a01bb3ba6e83ceeb4fed579177f084ae3">power_trigger</a>;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <a class="code" href="classCharacter.html#a17446e14fd6046648a505c4aaec3d976">mod_power_level</a>( -trigger_cost );</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    }</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160; </div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> &gt; 500_ml ) {</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;WIDE&quot;</span> );</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;    }</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160; </div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    <span class="comment">// Deal extra cut damage if the item breaks</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">if</span>( shatter ) {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <a class="code" href="classCharacter.html#aec5b22f2b058eb8923e91190f4a9ac8b">impact</a>.add_damage( <a class="code" href="ranged_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">damage_cut</a>, <a class="code" href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a>( <a class="code" href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">volume</a> ) / 500.0f );</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;SHATTER_SELF&quot;</span> );</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    }</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160; </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;    <span class="comment">// TODO: Add wet effect if other things care about that</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;    <span class="keywordflow">if</span>( burst ) {</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;BURST&quot;</span> );</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    }</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160; </div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    <span class="comment">// Some minor (skill/2) armor piercing for skillful throws</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;    <span class="comment">// Not as much as in melee, though</span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structdamage__unit.html">damage_unit</a> &amp;du : <a class="code" href="classCharacter.html#aec5b22f2b058eb8923e91190f4a9ac8b">impact</a>.damage_units ) {</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        du.<a class="code" href="structdamage__unit.html#ab4d1b13f7ebe2f16a43038e1441ec2b5">res_pen</a> += skill_level / 2.0f;</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;    <span class="comment">// handling for tangling thrown items</span></div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="keywordflow">if</span>( thrown.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a14c2f85962f78884b152b105f984a9f4">flag_TANGLE</a> ) ) {</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        proj_effects.insert( <span class="stringliteral">&quot;TANGLE&quot;</span> );</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;    }</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160; </div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *critter = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( target, <span class="keyword">true</span> );</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="keyword">const</span> <a class="code" href="classdispersion__sources.html">dispersion_sources</a> dispersion( <a class="code" href="classCharacter.html#a6853521cfe7399330d90c08271e003b4">throwing_dispersion</a>( thrown, critter,</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;                                         blind_throw_from_pos.has_value() ) );</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <span class="keyword">const</span> <a class="code" href="structitype.html">itype</a> *thrown_type = thrown.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>;</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160; </div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <span class="comment">// Put the item into the projectile</span></div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    proj.<a class="code" href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">set_drop</a>( std::move( thrown ) );</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordflow">if</span>( thrown_type-&gt;<a class="code" href="structitype.html#a72121b6b478fae1969a4b559f3ded22f">has_flag</a>( <a class="code" href="flag_8cpp.html#ae84bc064f3667f365835de3b66ba89de">flag_CUSTOM_EXPLOSION</a> ) ) {</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        proj.<a class="code" href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">set_custom_explosion</a>( thrown_type-&gt;<a class="code" href="structitype.html#a15ce9f3914d2afb7992e4683a0996791">explosion</a> );</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    }</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160; </div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;    <span class="comment">// Throw from the player&#39;s position, unless we&#39;re blind throwing, in which case</span></div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;    <span class="comment">// throw from the the blind throw position instead.</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> throw_from = blind_throw_from_pos ? *blind_throw_from_pos : <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160; </div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;    <span class="keywordtype">float</span> range = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( throw_from, target );</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    proj.<a class="code" href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">range</a> = range;</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;    <span class="keywordtype">float</span> skill_lvl = <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a> );</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;    <span class="comment">// Avoid awarding tons of xp for lucky throws against hard to hit targets</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> range_factor = std::min&lt;float&gt;( range, skill_lvl + 3 );</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <span class="comment">// We&#39;re aiming to get a damaging hit, not just an accurate one - reward proper weapons</span></div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> damage_factor = 5.0f * <a class="code" href="math__parser__func_8h.html#aeb3bbc4ec861ea58cbfca028920e4cc6">std::sqrt</a>( proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a>.<a class="code" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>() / 5.0f );</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="comment">// This should generally have values below ~20*sqrt(skill_lvl)</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> final_xp_mult = range_factor * damage_factor;</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160; </div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    <a class="code" href="structweakpoint__attack.html">weakpoint_attack</a> wp_attack;</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    wp_attack.<a class="code" href="structweakpoint__attack.html#aed78ef37bb4ef0b99cc10318b569c016">weapon</a> = &amp;to_throw;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    wp_attack.<a class="code" href="structweakpoint__attack.html#a0dd6f503710c5851bab2e59107d40ab3">is_thrown</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;    <a class="code" href="structdealt__projectile__attack.html">dealt_projectile_attack</a> dealt_attack = <a class="code" href="ballistics_8cpp.html#a3090f41e3e1093c0ac85ed679237a6df">projectile_attack</a>( proj, throw_from, target, dispersion,</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;                                           <span class="keyword">this</span>, <span class="keyword">nullptr</span>, wp_attack );</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160; </div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> missed_by = dealt_attack.<a class="code" href="structdealt__projectile__attack.html#ab874a1233da5daa95ff296cdb1ee1849">missed_by</a>;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160; </div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    <span class="keywordflow">if</span>( critter &amp;&amp; dealt_attack.<a class="code" href="structdealt__projectile__attack.html#a466f327979e41691bc19c91e622078b6">hit_critter</a> != <span class="keyword">nullptr</span> &amp;&amp; missed_by &lt;= 0.1 &amp;&amp;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;        !critter-&gt;<a class="code" href="classCreature.html#aec78049b0ee4401d3a4c073663735aad">has_flag</a>( <a class="code" href="mtype_8cpp.html#af8eb4198f7564379a407e89c13cdd1b7">mon_flag_IMMOBILE</a> ) ) {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <a class="code" href="classCharacter.html#a6535a02158a1d6b23b0a6bb623dfae19">practice</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>, final_xp_mult, <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <span class="comment">// TODO: Check target for existence of head</span></div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <a class="code" href="event__bus_8h.html#a4f760194b9225ccf92a1419748def636">get_event_bus</a>().<a class="code" href="classevent__bus.html#ab753616a3a663185377ac52560068194">send</a>&lt;<a class="code" href="event_8h.html#a333a7721472705fe444b24f107f9a731a365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a>&gt;( <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() );</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( critter &amp;&amp; dealt_attack.<a class="code" href="structdealt__projectile__attack.html#a466f327979e41691bc19c91e622078b6">hit_critter</a> != <span class="keyword">nullptr</span> &amp;&amp; missed_by &gt; 0.0f &amp;&amp;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;               !critter-&gt;<a class="code" href="classCreature.html#aec78049b0ee4401d3a4c073663735aad">has_flag</a>( <a class="code" href="mtype_8cpp.html#af8eb4198f7564379a407e89c13cdd1b7">mon_flag_IMMOBILE</a> ) ) {</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        <a class="code" href="classCharacter.html#a6535a02158a1d6b23b0a6bb623dfae19">practice</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>, final_xp_mult / ( 1.0f + missed_by ), <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> );</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        <span class="comment">// Pure grindy practice - cap gain at lvl 2</span></div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <a class="code" href="classCharacter.html#a6535a02158a1d6b23b0a6bb623dfae19">practice</a>( <a class="code" href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a>, 5, 2 );</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    }</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    <span class="comment">// Reset last target pos</span></div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a> = std::nullopt;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160; </div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordflow">return</span> dealt_attack;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;}</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae8b9efd8abced2440e1b53139f2696d7"> 1455</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#ae8b9efd8abced2440e1b53139f2696d7">practice_archery_proficiency</a>( <a class="code" href="classCharacter.html">Character</a> &amp;p, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;relevant )</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;{</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="comment">// Do nothing, we are not doing archery</span></div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    <span class="keywordflow">if</span>( relevant.<a class="code" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() != <a class="code" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a> ) {</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160; </div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <span class="comment">// We are already a master, practice has no effect</span></div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <span class="keywordflow">if</span>( p.<a class="code" href="classCharacter.html#a72472dd1bc3a1fba8b053682ae5a2244">has_proficiency</a>( <a class="code" href="ranged_8cpp.html#ab1f819e79b8cfdcbf08cca629e3073ba">proficiency_prof_bow_master</a> ) ) {</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    }</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160; </div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <span class="comment">// Only train archery in multiples of 100 moves (or 1 turn) for performance, focus, and simplifying calculations</span></div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    p.<a class="code" href="classCreature.html#afc6e990c7faf2e750a941b8a92f892e2">archery_aim_counter</a>++;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">if</span>( p.<a class="code" href="classCreature.html#afc6e990c7faf2e750a941b8a92f892e2">archery_aim_counter</a> &gt; 100 ) {</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="comment">// Reset our counter</span></div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        p.<a class="code" href="classCreature.html#afc6e990c7faf2e750a941b8a92f892e2">archery_aim_counter</a> = 0;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160; </div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;        <span class="comment">// Intended to train prof_bow_basic from 0 to 100% in ~200 arrows in 5 hours from max aim, or 90s/arrow.</span></div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="comment">// Additionally, a shortbow is used as the basis for number of moves per max aim shot at ~250 moves.</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        <span class="comment">// 90s/arrow / 2.5turns/arrow = 36s/turn. It is important to note, this is 200 arrows pre-focus.</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        <a class="code" href="classtime__duration.html">time_duration</a> prof_exp = 36_seconds;</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;        <span class="comment">// We don&#39;t know how to handle a bow yet</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="keywordflow">if</span>( !p.<a class="code" href="classCharacter.html#a72472dd1bc3a1fba8b053682ae5a2244">has_proficiency</a>( <a class="code" href="ranged_8cpp.html#af94296ce179c8a7441548e43d0b8235f">proficiency_prof_bow_basic</a> ) ) {</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;            p.<a class="code" href="classCharacter.html#aa376cb5765a50c43ee63c4a3b151832e">practice_proficiency</a>( <a class="code" href="ranged_8cpp.html#af94296ce179c8a7441548e43d0b8235f">proficiency_prof_bow_basic</a>, prof_exp );</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        }</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        <span class="comment">// We know how to handle a bow, but we are not an expert yet</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !p.<a class="code" href="classCharacter.html#a72472dd1bc3a1fba8b053682ae5a2244">has_proficiency</a>( <a class="code" href="ranged_8cpp.html#a5a31fd4e066d23b9f26579e931b87113">proficiency_prof_bow_expert</a> ) ) {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            p.<a class="code" href="classCharacter.html#aa376cb5765a50c43ee63c4a3b151832e">practice_proficiency</a>( <a class="code" href="ranged_8cpp.html#a5a31fd4e066d23b9f26579e931b87113">proficiency_prof_bow_expert</a>, prof_exp );</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        <span class="comment">// We are an expert, lets practice to become a master</span></div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            p.<a class="code" href="classCharacter.html#aa376cb5765a50c43ee63c4a3b151832e">practice_proficiency</a>( <a class="code" href="ranged_8cpp.html#ab1f819e79b8cfdcbf08cca629e3073ba">proficiency_prof_bow_master</a>, prof_exp );</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        }</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    }</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;}</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160; </div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;<span class="comment">// Apply stamina cost to archery which decreases due to proficiency</span></div>
<div class="line"><a name="l01497"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a2d15a168c57c6a43e0e7130e7aac2120"> 1497</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#a2d15a168c57c6a43e0e7130e7aac2120">mod_stamina_archery</a>( <a class="code" href="classCharacter.html">Character</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;relevant )</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;{</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    <span class="comment">// Set activity level to 10 * str_ratio, with 10 being max (EXTRA_EXERCISE)</span></div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    <span class="comment">// This ratio should never be below 0 and above 1</span></div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> str_ratio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( relevant.<a class="code" href="classitem.html#a2899a37f781e1efea9465a98277141c7">get_min_str</a>() ) / you.<a class="code" href="classCharacter.html#a26369a0a81eef76cfe75214d22ed32b4">str_cur</a>;</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;    you.<a class="code" href="classCharacter.html#af987a23fb823861daf5d77051e3dc60f">set_activity_level</a>( 10 * str_ratio );</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160; </div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;    <span class="comment">// Calculate stamina drain based on archery, athletics skill, and effective bow strength ratio</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> archery_skill = you.<a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a> );</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> athletics_skill = you.<a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#a1d815a8053cfecc8a05374bf92924ba2">skill_swimming</a> );</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> skill_modifier = ( 2.0f * archery_skill + athletics_skill ) / 3.0f;</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> stamina_cost = pow( 10.0f * str_ratio + 10 - skill_modifier, 2 );</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160; </div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    you.<a class="code" href="classCharacter.html#ac29de3d2bc90dd1c8d921b539fb05cfb">mod_stamina</a>( -stamina_cost );</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2a784256c4603f053783c251704220cd0c">debugmode::DF_RANGED</a>,</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                   <span class="stringliteral">&quot;-%i stamina: %.1f str ratio, %.1f skill mod&quot;</span>,</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                   stamina_cost, str_ratio, skill_modifier );</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;}</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160; </div>
<div class="line"><a name="l01516"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae6e2f802cc8fb025d3dd4ada3da65c55"> 1516</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#ae6e2f802cc8fb025d3dd4ada3da65c55">do_aim</a>( <a class="code" href="classCharacter.html">Character</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;relevant, <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil )</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;{</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> aim_amount = you.<a class="code" href="classCharacter.html#a6243be833eae8764b8dc841fb05cf867">aim_per_move</a>( relevant, you.<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    <span class="keywordflow">if</span>( aim_amount &gt; 0 &amp;&amp; you.<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &gt; min_recoil ) {</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        <span class="comment">// Increase aim at the cost of moves</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;        you.<a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -1 );</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        you.<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( min_recoil, you.<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> - aim_amount );</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="comment">// Train archery proficiencies if we are doing archery</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        <span class="keywordflow">if</span>( relevant.<a class="code" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() == <a class="code" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a> ) {</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;            <a class="code" href="ranged_8cpp.html#ae8b9efd8abced2440e1b53139f2696d7">practice_archery_proficiency</a>( you, relevant );</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160; </div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;            <span class="comment">// Only drain stamina on initial draw</span></div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            <span class="keywordflow">if</span>( you.<a class="code" href="classCreature.html#af3d3fb7cfb98cf3c36f0f0681414274a">get_moves</a>() == 1 ) {</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                <a class="code" href="ranged_8cpp.html#a2d15a168c57c6a43e0e7130e7aac2120">mod_stamina_archery</a>( you, relevant );</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            }</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        }</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        <span class="comment">// If aim is already maxed, we&#39;re just waiting, so pass the turn.</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        you.<a class="code" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    }</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;}</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160; </div>
<div class="line"><a name="l01539"></a><span class="lineno"><a class="line" href="structconfidence__rating.html"> 1539</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structconfidence__rating.html">confidence_rating</a> {</div>
<div class="line"><a name="l01540"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#a95391c9a8078562cb5f37dacf9ff0267"> 1540</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structconfidence__rating.html#a95391c9a8078562cb5f37dacf9ff0267">aim_level</a>;</div>
<div class="line"><a name="l01541"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#a3e948736e9d479abfa280833019cad36"> 1541</a></span>&#160;    <span class="keywordtype">char</span> <a class="code" href="structconfidence__rating.html#a3e948736e9d479abfa280833019cad36">symbol</a>;</div>
<div class="line"><a name="l01542"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#afe2900a64ed6d6d39f4f2322216abf36"> 1542</a></span>&#160;    std::string <a class="code" href="structconfidence__rating.html#afe2900a64ed6d6d39f4f2322216abf36">color</a>;</div>
<div class="line"><a name="l01543"></a><span class="lineno"><a class="line" href="structconfidence__rating.html#a47c7756df867e77f46be130c7bb02e5c"> 1543</a></span>&#160;    std::string <a class="code" href="structconfidence__rating.html#a47c7756df867e77f46be130c7bb02e5c">label</a>;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;};</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160; </div>
<div class="line"><a name="l01546"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576"> 1546</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576">print_steadiness</a>( <span class="keyword">const</span> <a class="code" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w, <span class="keywordtype">int</span> line_number, <span class="keywordtype">double</span> steadiness )</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;{</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> window_width = <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( w ) - 2; <span class="comment">// Window width minus borders.</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160; </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">if</span>( get_option&lt;std::string&gt;( <span class="stringliteral">&quot;ACCURACY_DISPLAY&quot;</span> ) == <span class="stringliteral">&quot;numbers&quot;</span> ) {</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        std::string steadiness_s = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;%s: %d%%&quot;</span>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Steadiness&quot;</span> ),</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( 100.0 * steadiness ) );</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;        <a class="code" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code" href="structpoint.html">point</a>( 1, line_number++ ), steadiness_s );</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;        <span class="keyword">const</span> std::string &amp;steadiness_bar = <a class="code" href="output_8cpp.html#add34b080694a5b887cf3b201051bf1c0">get_labeled_bar</a>( steadiness, window_width,</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                                            <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Steadiness&quot;</span> ), <span class="charliteral">&#39;*&#39;</span> );</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        <a class="code" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code" href="structpoint.html">point</a>( 1, line_number++ ), steadiness_bar );</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;    }</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160; </div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;    <span class="keywordflow">return</span> line_number;</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;}</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160; </div>
<div class="line"><a name="l01563"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a1942f5c7424513a78ab3491db37341f1"> 1563</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="ranged_8cpp.html#a1942f5c7424513a78ab3491db37341f1">confidence_estimate</a>( <span class="keyword">const</span> <a class="code" href="structTarget__attributes.html">Target_attributes</a> &amp;attributes,</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;                                   <span class="keyword">const</span> <a class="code" href="classdispersion__sources.html">dispersion_sources</a> &amp;dispersion )</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;{</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="comment">// This is a rough estimate of accuracy based on a linear distribution across min and max</span></div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="comment">// dispersion.  It is highly inaccurate probability-wise, but this is intentional, the player</span></div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <span class="comment">// is not doing Gaussian integration in their head while aiming.  The result gives the player</span></div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <span class="comment">// correct relative measures of chance to hit, and corresponds with the actual distribution at</span></div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="comment">// min, max, and mean.</span></div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;    <span class="keywordflow">if</span>( attributes.<a class="code" href="structTarget__attributes.html#ad834b1dc87768bdad806da80b5dc9ecd">range</a> == 0 ) {</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;        <span class="keywordflow">return</span> 2 * attributes.<a class="code" href="structTarget__attributes.html#a76ea0e1418f9b8a6ed3955a700cc239a">size</a>;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;    }</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="keywordtype">double</span> max_lateral_offset = <a class="code" href="line_8cpp.html#a755929144f419e0be862e2a7a87b6ab7">iso_tangent</a>( attributes.<a class="code" href="structTarget__attributes.html#ad834b1dc87768bdad806da80b5dc9ecd">range</a>, <a class="code" href="namespaceunits.html#ae3cb4452221bae58dc798b8fc5865007">units::from_arcmin</a>( dispersion.<a class="code" href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">max</a>() ) );</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="keywordflow">return</span> 1 / ( max_lateral_offset / attributes.<a class="code" href="structTarget__attributes.html#a76ea0e1418f9b8a6ed3955a700cc239a">size</a> );</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;}</div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160; </div>
<div class="line"><a name="l01578"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aa68fa53ae2a9bc0bb461af10bec001fe"> 1578</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structaim__type.html">aim_type</a> <a class="code" href="ranged_8cpp.html#aa68fa53ae2a9bc0bb461af10bec001fe">get_default_aim_type</a>()</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;{</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="comment">// dummy aim type for unaimed shots</span></div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <span class="keywordflow">return</span> { <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Immediate&quot;</span> ), <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> ) };</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;}</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160; </div>
<div class="line"><a name="l01584"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a86a68d80cad5052d3e456a9fb8b1769d"> 1584</a></span>&#160;<span class="keyword">using</span> <a class="code" href="output_8cpp.html#a86a68d80cad5052d3e456a9fb8b1769d">RatingVector</a> = std::vector&lt;std::tuple&lt;double, char, std::string&gt;&gt;;</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160; </div>
<div class="line"><a name="l01586"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101"> 1586</a></span>&#160;<span class="keyword">static</span> std::string <a class="code" href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101">get_colored_bar</a>( <span class="keyword">const</span> <span class="keywordtype">double</span> val, <span class="keyword">const</span> <span class="keywordtype">int</span> width, <span class="keyword">const</span> std::string &amp;<a class="code" href="structlabel.html">label</a>,</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;                                    RatingVector::iterator begin, RatingVector::iterator <a class="code" href="namespacekeycode.html#a16ca776f0df120afb4f1b16a92e2d7f7aa6efe66b8fc51ca203d5f0015d983eac">end</a> )</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;{</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="keywordflow">return</span> get_labeled_bar&lt;RatingVector::iterator&gt;( val, width, <a class="code" href="structlabel.html">label</a>, begin, <a class="code" href="namespacekeycode.html#a16ca776f0df120afb4f1b16a92e2d7f7aa6efe66b8fc51ca203d5f0015d983eac">end</a>,</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    []( RatingVector::iterator it, <span class="keywordtype">int</span> seg_width ) -&gt; std::string {</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        std::string result = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;&lt;color_%s&gt;&quot;</span>, std::get&lt;2&gt;( *it ) );</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        result.insert( result.end(), seg_width, std::get&lt;1&gt;( *it ) );</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        result += <span class="stringliteral">&quot;&lt;/color&gt;&quot;</span>;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">return</span> result;} );</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;}</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160; </div>
<div class="line"><a name="l01597"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a967f906a89a2a31d1bdb0fbc93e6ddf9"> 1597</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="ranged_8cpp.html#a967f906a89a2a31d1bdb0fbc93e6ddf9">target_size_in_moa</a>( <span class="keywordtype">int</span> range, <span class="keywordtype">double</span> <a class="code" href="namespaceom__direction.html#af97f9dbddaa758278662da3478826c61">size</a> )</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;{</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="line_8cpp.html#aaa43dcdfe5b511b116fafb32c5cff349">atan2</a>( <a class="code" href="namespaceom__direction.html#af97f9dbddaa758278662da3478826c61">size</a>, range ) * 60 * 180 / <a class="code" href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a>;</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;}</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"><a class="line" href="structTarget__attributes.html#a92de929e3fda09df1b832b7ca6b22de3"> 1602</a></span>&#160;<a class="code" href="structTarget__attributes.html#aa5a529f43ff9026d1f50be95076b3e14">Target_attributes::Target_attributes</a>( <a class="code" href="structtripoint.html">tripoint</a> src, <a class="code" href="structtripoint.html">tripoint</a> target )</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;{</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *target_critter = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( target );</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *shooter = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( src );</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    <a class="code" href="structTarget__attributes.html#ad834b1dc87768bdad806da80b5dc9ecd">range</a> = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( src, target );</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    <a class="code" href="structTarget__attributes.html#a76ea0e1418f9b8a6ed3955a700cc239a">size</a> = target_critter != <span class="keyword">nullptr</span> ?</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;           target_critter-&gt;<a class="code" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">ranged_target_size</a>() :</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;           <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a34187b9eff71461437403611d0d122a7">ranged_target_size</a>( target );</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <a class="code" href="structTarget__attributes.html#ab1c3e55f892cde598070c6189dfa88e6">size_in_moa</a> = <a class="code" href="ranged_8cpp.html#a967f906a89a2a31d1bdb0fbc93e6ddf9">target_size_in_moa</a>( <a class="code" href="structTarget__attributes.html#ad834b1dc87768bdad806da80b5dc9ecd">range</a>, <a class="code" href="structTarget__attributes.html#a76ea0e1418f9b8a6ed3955a700cc239a">size</a> ) ;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    <a class="code" href="structTarget__attributes.html#acfd538a5784056d1cadff165495fa18a">light</a> = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a47284179cd831f04aaa7ff3242a5fb7b">ambient_light_at</a>( target );</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;    <a class="code" href="structTarget__attributes.html#a3ef95402fbe3b47c2a9c7371c5f96a46">visible</a> = shooter-&gt;<a class="code" href="classCreature.html#a5f818f1aa899ba2e2765f327a020a878">sees</a>( target );</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160; </div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;}</div>
<div class="line"><a name="l01615"></a><span class="lineno"><a class="line" href="structTarget__attributes.html#a1a575d26b697bfae6fb19709acb7456f"> 1615</a></span>&#160;<a class="code" href="structTarget__attributes.html#aa5a529f43ff9026d1f50be95076b3e14">Target_attributes::Target_attributes</a>( <span class="keywordtype">int</span> <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>, <span class="keywordtype">double</span> target_size, <span class="keywordtype">float</span> light_target,</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                                      <span class="keywordtype">bool</span> can_see )</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;{</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;    <a class="code" href="structTarget__attributes.html#ad834b1dc87768bdad806da80b5dc9ecd">range</a> = <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>;</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <a class="code" href="structTarget__attributes.html#a76ea0e1418f9b8a6ed3955a700cc239a">size</a> = target_size;</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;    <a class="code" href="structTarget__attributes.html#ab1c3e55f892cde598070c6189dfa88e6">size_in_moa</a> = <a class="code" href="ranged_8cpp.html#a967f906a89a2a31d1bdb0fbc93e6ddf9">target_size_in_moa</a>( <a class="code" href="structTarget__attributes.html#ad834b1dc87768bdad806da80b5dc9ecd">range</a>, <a class="code" href="structTarget__attributes.html#a76ea0e1418f9b8a6ed3955a700cc239a">size</a> );</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;    <a class="code" href="structTarget__attributes.html#acfd538a5784056d1cadff165495fa18a">light</a> = light_target;</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;    <a class="code" href="structTarget__attributes.html#a3ef95402fbe3b47c2a9c7371c5f96a46">visible</a> = can_see;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;}</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160; </div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;<span class="comment">* struct used to hold the information on entire aim_type prediction;</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;<span class="comment">* all the properties and odds for every &#39;confidence&#39; outcome</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html"> 1629</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structaim__type__prediction.html">aim_type_prediction</a> {</div>
<div class="line"><a name="l01630"></a><span class="lineno"><a class="line" href="structaim__type__prediction_1_1aim__confidence.html"> 1630</a></span>&#160;    <span class="keyword">struct </span><a class="code" href="structaim__type__prediction_1_1aim__confidence.html">aim_confidence</a> {</div>
<div class="line"><a name="l01631"></a><span class="lineno"><a class="line" href="structaim__type__prediction_1_1aim__confidence.html#a7d95f07bea9f9ea602884238a49543da"> 1631</a></span>&#160;        std::string <a class="code" href="structaim__type__prediction_1_1aim__confidence.html#a7d95f07bea9f9ea602884238a49543da">label</a>;</div>
<div class="line"><a name="l01632"></a><span class="lineno"><a class="line" href="structaim__type__prediction_1_1aim__confidence.html#a203e68d0e3e766e8a9dbd4a59cb81900"> 1632</a></span>&#160;        std::string <a class="code" href="structaim__type__prediction_1_1aim__confidence.html#a203e68d0e3e766e8a9dbd4a59cb81900">color</a>;</div>
<div class="line"><a name="l01633"></a><span class="lineno"><a class="line" href="structaim__type__prediction_1_1aim__confidence.html#aadb7a11b006a31248cab2d525e55daf1"> 1633</a></span>&#160;        <span class="keywordtype">int</span> <a class="code" href="structaim__type__prediction_1_1aim__confidence.html#aadb7a11b006a31248cab2d525e55daf1">chance</a>;</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;    };</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160; </div>
<div class="line"><a name="l01636"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#abd5d5da2ed456b35987cc924ad03f607"> 1636</a></span>&#160;    std::string <a class="code" href="structaim__type__prediction.html#abd5d5da2ed456b35987cc924ad03f607">name</a>;</div>
<div class="line"><a name="l01637"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#ad254eae18ae704d8c9d75bfe0770730f"> 1637</a></span>&#160;    std::string <a class="code" href="structaim__type__prediction.html#ad254eae18ae704d8c9d75bfe0770730f">hotkey</a>;</div>
<div class="line"><a name="l01638"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#aaeeb40de07b50ebc88e227fa4f5f05f1"> 1638</a></span>&#160;    std::vector&lt;confidence_rating&gt; <a class="code" href="structaim__type__prediction.html#aaeeb40de07b50ebc88e227fa4f5f05f1">ratings</a>; <span class="comment">// this is read back in UI</span></div>
<div class="line"><a name="l01639"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#a06f406ce06d1987183e399e054bd40a4"> 1639</a></span>&#160;    std::vector&lt;aim_confidence&gt; <a class="code" href="structaim__type__prediction.html#a06f406ce06d1987183e399e054bd40a4">chances</a>;</div>
<div class="line"><a name="l01640"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#a2e72fff16a3ec72943a7dd9482dff8bf"> 1640</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structaim__type__prediction.html#a2e72fff16a3ec72943a7dd9482dff8bf">is_default</a>;</div>
<div class="line"><a name="l01641"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#ae8c7262761667bf3ba7fc0b3d1b54677"> 1641</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structaim__type__prediction.html#ae8c7262761667bf3ba7fc0b3d1b54677">moves</a>;</div>
<div class="line"><a name="l01642"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#a2c9a4e350971e1aae39533618e323d4f"> 1642</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structaim__type__prediction.html#a2c9a4e350971e1aae39533618e323d4f">chance_to_hit</a>; <span class="comment">// all hit probabilities summed up for sorting</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#aa1ed8d79daea94f79f6c5a17e25332ab"> 1643</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structaim__type__prediction.html#aa1ed8d79daea94f79f6c5a17e25332ab">confidence</a>;</div>
<div class="line"><a name="l01644"></a><span class="lineno"><a class="line" href="structaim__type__prediction.html#a8d589a89e9239f64703618d8bf60f672"> 1644</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structaim__type__prediction.html#a8d589a89e9239f64703618d8bf60f672">steadiness</a>;</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;};</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160; </div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;<span class="comment">// struct used for returning values from predict_recoil()</span></div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;<span class="comment">// recoil is the either the sight dispersion or the aim mode&#39;s threshold</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;<span class="comment">// moves it the amount of moves it&#39;ll take to reach that aim state</span></div>
<div class="line"><a name="l01650"></a><span class="lineno"><a class="line" href="structrecoil__prediction.html"> 1650</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structrecoil__prediction.html">recoil_prediction</a> {</div>
<div class="line"><a name="l01651"></a><span class="lineno"><a class="line" href="structrecoil__prediction.html#af135e1f559f055da9d184aeffcf02193"> 1651</a></span>&#160;    <span class="keywordtype">double</span> <a class="code" href="structrecoil__prediction.html#af135e1f559f055da9d184aeffcf02193">recoil</a>;</div>
<div class="line"><a name="l01652"></a><span class="lineno"><a class="line" href="structrecoil__prediction.html#abfa8d33a8f4a583d4460678e290d7efb"> 1652</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structrecoil__prediction.html#abfa8d33a8f4a583d4460678e290d7efb">moves</a>;</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;};</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160; </div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;<span class="comment">* This method tries to estimate the amount of moves required to reach</span></div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="comment">* the aim mode&#39;s recoil threshold or the sight&#39;s dispersion value</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a9301f55736d917c84a4ebf973386a40e"> 1659</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structrecoil__prediction.html">recoil_prediction</a> <a class="code" href="ranged_8cpp.html#a9301f55736d917c84a4ebf973386a40e">predict_recoil</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;weapon,</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        <span class="keyword">const</span> <a class="code" href="structTarget__attributes.html">Target_attributes</a> &amp;target, <span class="keywordtype">int</span> sight_dispersion,</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        <span class="keyword">const</span> <a class="code" href="structaim__type.html">aim_type</a> &amp;aim_mode, <span class="keywordtype">double</span> start_recoil )</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;{</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    <span class="keywordflow">if</span>( !aim_mode.<a class="code" href="structaim__type.html#a26dc7ca55f61cd28bc534dc21d53164d">has_threshold</a> || aim_mode.<a class="code" href="structaim__type.html#a7763c382e69ad4d525dfe8716672c565">threshold</a> &gt; start_recoil ) {</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keywordflow">return</span> { start_recoil, 0 };</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    }</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="keywordtype">double</span> predicted_recoil = start_recoil;</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;    <span class="keywordtype">int</span> predicted_delay = 0;</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    <span class="keyword">const</span> <a class="code" href="structaim__mods__cache.html">aim_mods_cache</a> &amp;aim_cache = you.<a class="code" href="classCharacter.html#aa58280d717f23351fb1cdc6f7a83047f">gen_aim_mods_cache</a>( weapon );</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <span class="keyword">auto</span> aim_cache_opt = std::make_optional( std::ref( aim_cache ) );</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;    <span class="comment">// next loop simulates aiming until either aim mode threshold or sight_dispersion is reached</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> aim_amount = you.<a class="code" href="classCharacter.html#a6243be833eae8764b8dc841fb05cf867">aim_per_move</a>( weapon, predicted_recoil, target, aim_cache_opt );</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        <span class="keywordflow">if</span>( aim_amount &lt;= <a class="code" href="ranged_8h.html#a3ad21aa630e4e68c1d2834fe0467c018">MIN_RECOIL_IMPROVEMENT</a> ) {</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        }</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        predicted_delay++;</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        predicted_recoil = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( predicted_recoil - aim_amount, 0.0 );</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;    } <span class="keywordflow">while</span>( predicted_recoil &gt; aim_mode.<a class="code" href="structaim__type.html#a7763c382e69ad4d525dfe8716672c565">threshold</a> &amp;&amp; predicted_recoil &gt; sight_dispersion );</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160; </div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;    <span class="keywordflow">return</span> { predicted_recoil, predicted_delay };</div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;}</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160; </div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;<span class="comment">* This method calculates the ranged to-hit chances, split by</span></div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;<span class="comment">* confidence ratings for UI display purposes.</span></div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;<span class="comment">* The returned vector contains all the</span></div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;<span class="comment">* a mapping of all weapon aiming modes to their chance predictions.</span></div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;<span class="comment">* Inside each prediction there is a vector of &quot;confidences&quot;;</span></div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">* they represent the great/hit/graze/miss chances.</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a221acbe15b21618febcda6765ff3223c"> 1692</a></span>&#160;<span class="keyword">static</span> std::vector&lt;aim_type_prediction&gt; <a class="code" href="ranged_8cpp.html#a221acbe15b21618febcda6765ff3223c">calculate_ranged_chances</a>(</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;    <span class="keyword">const</span> <a class="code" href="classtarget__ui.html">target_ui</a> &amp;<a class="code" href="namespaceui.html">ui</a>, <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;you,</div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">target_ui::TargetMode</a> mode, <span class="keyword">const</span> <a class="code" href="classinput__context.html">input_context</a> &amp;ctxt, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;weapon,</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keyword">const</span> <a class="code" href="classdispersion__sources.html">dispersion_sources</a> &amp;dispersion, <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; &amp;confidence_ratings,</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <span class="keyword">const</span> <a class="code" href="structTarget__attributes.html">Target_attributes</a> &amp;target, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;<a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> )</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;{</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    std::vector&lt;aim_type&gt; aim_types { <a class="code" href="ranged_8cpp.html#aa68fa53ae2a9bc0bb461af10bec001fe">get_default_aim_type</a>() };</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    std::vector&lt;aim_type_prediction&gt; aim_outputs;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    <span class="keywordflow">if</span>( mode != <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">target_ui::TargetMode::Throw</a> &amp;&amp; mode != <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">target_ui::TargetMode::ThrowBlind</a> ) {</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        aim_types = you.<a class="code" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">get_aim_types</a>( weapon );</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;    }</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;    <span class="comment">// predict how long it&#39;ll take to reach from current recoil</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="comment">// to the ui&#39;s selected default aim mode threshold.</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    <span class="keyword">const</span> <a class="code" href="structrecoil__prediction.html">recoil_prediction</a> aim_to_selected = <a class="code" href="ranged_8cpp.html#a9301f55736d917c84a4ebf973386a40e">predict_recoil</a>( you, weapon, target,</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;            <a class="code" href="namespaceui.html">ui</a>.get_sight_dispersion(), <a class="code" href="namespaceui.html">ui</a>.get_selected_aim_type(), you.<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160; </div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> selected_steadiness = <a class="code" href="ranged_8cpp.html#a969d7fb0eb05d60c2c98eb568bce69f2">calc_steadiness</a>( you, weapon, <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a>, aim_to_selected.<a class="code" href="structrecoil__prediction.html#af135e1f559f055da9d184aeffcf02193">recoil</a> );</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160; </div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> throw_moves = <a class="code" href="ranged_8cpp.html#aa55aace1fedc5b64c6d3d0418e251c38">throw_cost</a>( you, weapon );</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160; </div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structaim__type.html">aim_type</a> &amp;<a class="code" href="structaim__type.html">aim_type</a> : aim_types ) {</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;        <span class="keyword">const</span> std::vector&lt;input_event&gt; keys = ctxt.<a class="code" href="classinput__context.html#a1cd0c2537bc31a2c039e1178efb2ffdc">keys_bound_to</a>( <a class="code" href="structaim__type.html">aim_type</a>.<a class="code" href="structaim__type.html#abab67c2762f5ce5d549988ac7405dcb0">action</a>.empty() ? <span class="stringliteral">&quot;FIRE&quot;</span> :</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                                              <a class="code" href="structaim__type.html">aim_type</a>.<a class="code" href="structaim__type.html#abab67c2762f5ce5d549988ac7405dcb0">action</a>, <span class="comment">/*maximum_modifier_count=*/</span>1 );</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160; </div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;        <a class="code" href="structaim__type__prediction.html">aim_type_prediction</a> prediction = {};</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;        prediction.<a class="code" href="structaim__type__prediction.html#abd5d5da2ed456b35987cc924ad03f607">name</a> = <a class="code" href="structaim__type.html">aim_type</a>.<a class="code" href="structaim__type.html#a26dc7ca55f61cd28bc534dc21d53164d">has_threshold</a> ? <a class="code" href="structaim__type.html">aim_type</a>.<a class="code" href="structaim__type.html#a51fa794edcf0ce9509763b0b48a8e1b5">name</a> : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Current&quot;</span> );</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        prediction.<a class="code" href="structaim__type__prediction.html#a2e72fff16a3ec72943a7dd9482dff8bf">is_default</a> = <a class="code" href="structaim__type.html">aim_type</a>.<a class="code" href="structaim__type.html#abab67c2762f5ce5d549988ac7405dcb0">action</a>.empty(); <span class="comment">// default mode defaults to FIRE hotkey</span></div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;        prediction.<a class="code" href="structaim__type__prediction.html#ad254eae18ae704d8c9d75bfe0770730f">hotkey</a> = ( keys.empty() ? <a class="code" href="structinput__event.html">input_event</a>() : keys.front() ).short_description();</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160; </div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;        <span class="keywordflow">if</span>( mode == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">target_ui::TargetMode::Throw</a> || mode == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">target_ui::TargetMode::ThrowBlind</a> ) {</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#ae8c7262761667bf3ba7fc0b3d1b54677">moves</a> = throw_moves;</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#ae8c7262761667bf3ba7fc0b3d1b54677">moves</a> = <a class="code" href="ranged_8cpp.html#a9301f55736d917c84a4ebf973386a40e">predict_recoil</a>( you, weapon, target, <a class="code" href="namespaceui.html">ui</a>.get_sight_dispersion(), <a class="code" href="structaim__type.html">aim_type</a>,</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                                               you.<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> ).<a class="code" href="structrecoil__prediction.html#abfa8d33a8f4a583d4460678e290d7efb">moves</a> + <a class="code" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( you, *weapon.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a> );</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;        }</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160; </div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;        <span class="comment">// if the default method is &quot;behind&quot; the selected; e.g. you are in immediate</span></div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;        <span class="comment">// firing mode with almost close no chances of hitting, but UI has selected</span></div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="comment">// &quot;precise&quot; this will &quot;catch up&quot; the default method adding the required moves</span></div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;        <span class="comment">// and steadiness that it will gain if player presses fire, so pressing fire</span></div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;        <span class="comment">// hotkey in this case will actually use &#39;precise&#39; aim mode.</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;        <span class="comment">// in case where it already surpassed the UI selected mode this should be a</span></div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;        <span class="comment">// no-op.</span></div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        <span class="keywordflow">if</span>( prediction.<a class="code" href="structaim__type__prediction.html#a2e72fff16a3ec72943a7dd9482dff8bf">is_default</a> ) {</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#ae8c7262761667bf3ba7fc0b3d1b54677">moves</a> += aim_to_selected.<a class="code" href="structrecoil__prediction.html#abfa8d33a8f4a583d4460678e290d7efb">moves</a>;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#a8d589a89e9239f64703618d8bf60f672">steadiness</a> = selected_steadiness;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;            <span class="comment">// predict how long it&#39;ll take to reach from current recoil</span></div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;            <span class="comment">// to the current aim mode&#39;s threshold.</span></div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            <span class="keyword">const</span> <a class="code" href="structrecoil__prediction.html">recoil_prediction</a> aim_to_type = ( <a class="code" href="structaim__type.html">aim_type</a> == <a class="code" href="namespaceui.html">ui</a>.get_selected_aim_type() ) ? aim_to_selected :</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                                                  <a class="code" href="ranged_8cpp.html#a9301f55736d917c84a4ebf973386a40e">predict_recoil</a>( you, weapon, target, <a class="code" href="namespaceui.html">ui</a>.get_sight_dispersion(), <a class="code" href="structaim__type.html">aim_type</a>, you.<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#a8d589a89e9239f64703618d8bf60f672">steadiness</a> = <a class="code" href="ranged_8cpp.html#a969d7fb0eb05d60c2c98eb568bce69f2">calc_steadiness</a>( you, weapon, <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a>, aim_to_type.<a class="code" href="structrecoil__prediction.html#af135e1f559f055da9d184aeffcf02193">recoil</a> );</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;        }</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160; </div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        <span class="comment">// make a copy of the given dispersion, apply the aiming and calculate hit confidence</span></div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;        <a class="code" href="classdispersion__sources.html">dispersion_sources</a> current_dispersion = dispersion;</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;        current_dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code" href="structaim__type.html">aim_type</a>.<a class="code" href="structaim__type.html#a26dc7ca55f61cd28bc534dc21d53164d">has_threshold</a> ? <a class="code" href="structaim__type.html">aim_type</a>.<a class="code" href="structaim__type.html#a7763c382e69ad4d525dfe8716672c565">threshold</a> :</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;                                      aim_to_selected.<a class="code" href="structrecoil__prediction.html#af135e1f559f055da9d184aeffcf02193">recoil</a> );</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160; </div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;        <span class="comment">// this loop fills in the &quot;confidence&quot; values; the chances of great/good/graze outcomes</span></div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;        prediction.<a class="code" href="structaim__type__prediction.html#aa1ed8d79daea94f79f6c5a17e25332ab">confidence</a> = <a class="code" href="ranged_8cpp.html#a1942f5c7424513a78ab3491db37341f1">confidence_estimate</a>( target, current_dispersion );</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structconfidence__rating.html">confidence_rating</a> &amp;rating : confidence_ratings ) {</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> chance = std::min&lt;int&gt;( 100, 100 * rating.aim_level * prediction.<a class="code" href="structaim__type__prediction.html#aa1ed8d79daea94f79f6c5a17e25332ab">confidence</a> )</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                               - prediction.<a class="code" href="structaim__type__prediction.html#a2c9a4e350971e1aae39533618e323d4f">chance_to_hit</a>;</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#aaeeb40de07b50ebc88e227fa4f5f05f1">ratings</a>.push_back( rating );</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#a06f406ce06d1987183e399e054bd40a4">chances</a>.push_back( {rating.label, rating.color, chance} );</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;            prediction.<a class="code" href="structaim__type__prediction.html#a2c9a4e350971e1aae39533618e323d4f">chance_to_hit</a> += chance;</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;        }</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160; </div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;        <span class="comment">// Adds the &quot;miss&quot; outcome</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        prediction.<a class="code" href="structaim__type__prediction.html#a06f406ce06d1987183e399e054bd40a4">chances</a>.push_back( { <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Miss&quot;</span> ), <span class="stringliteral">&quot;light_gray&quot;</span>, 100 - prediction.<a class="code" href="structaim__type__prediction.html#a2c9a4e350971e1aae39533618e323d4f">chance_to_hit</a> } );</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160; </div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;        aim_outputs.push_back( prediction );</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;    }</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;    <span class="keywordflow">return</span> aim_outputs;</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;}</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160; </div>
<div class="line"><a name="l01771"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ae2f62035db4e943bb2c797e8c3febedd"> 1771</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#ae2f62035db4e943bb2c797e8c3febedd">print_confidence_ratings</a>( <span class="keyword">const</span> <a class="code" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w,</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                                      <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; &amp;ratings, <span class="keywordtype">int</span> &amp;line_number, <span class="keywordtype">int</span> width, <span class="keywordtype">int</span> &amp;column_number,</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                                      <a class="code" href="classnc__color.html">nc_color</a> col )</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;{</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structconfidence__rating.html">confidence_rating</a> &amp;cr : ratings ) {</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;        std::string <a class="code" href="structlabel.html">label</a> = <a class="code" href="translations_8h.html#a46bdf4dff9d320938561cade1c9a5f7e">pgettext</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, cr.label.c_str() );</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;        std::string <a class="code" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;&lt;color_%s&gt;%s&lt;/color&gt; = %s&quot;</span>, cr.color, cr.symbol, <a class="code" href="structlabel.html">label</a> );</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;        <span class="keywordtype">int</span> line_len = <a class="code" href="catacharset_8cpp.html#af20ee33da59ccceb9f4c14005c0bbe80">utf8_width</a>( <a class="code" href="structlabel.html">label</a> ) + 5; <span class="comment">// 5 for &#39;# = &#39; and whitespace at end</span></div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <span class="keywordflow">if</span>( ( width - column_number ) &lt; line_len ) {</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            column_number = 1;</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            line_number++;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;        }</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( w, <a class="code" href="structpoint.html">point</a>( column_number, line_number ), col, col, <a class="code" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> );</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        column_number += line_len;</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;    }</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;    line_number++;</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;}</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160; </div>
<div class="line"><a name="l01789"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ad665e86d9214ba9ef7722492a65cac0d"> 1789</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#ad665e86d9214ba9ef7722492a65cac0d">print_confidence_rating_bar</a>( <span class="keyword">const</span> <a class="code" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w,</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <a class="code" href="structaim__type__prediction.html">aim_type_prediction</a> prediction, <span class="keywordtype">int</span> &amp;line_number, <span class="keywordtype">int</span> width, <a class="code" href="classnc__color.html">nc_color</a> col )</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;{</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;    <a class="code" href="output_8cpp.html#a86a68d80cad5052d3e456a9fb8b1769d">RatingVector</a> confidence_ratings;</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;    std::transform( prediction.<a class="code" href="structaim__type__prediction.html#aaeeb40de07b50ebc88e227fa4f5f05f1">ratings</a>.begin(), prediction.<a class="code" href="structaim__type__prediction.html#aaeeb40de07b50ebc88e227fa4f5f05f1">ratings</a>.end(),</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;                    std::back_inserter( confidence_ratings ),</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;    [&amp;]( <span class="keyword">const</span> <a class="code" href="structconfidence__rating.html">confidence_rating</a> &amp; config ) {</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;        return std::make_tuple( config.aim_level, config.symbol, config.color );</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;    } );</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160; </div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;    <span class="keyword">const</span> std::string &amp;confidence_bar = <a class="code" href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101">get_colored_bar</a>( prediction.<a class="code" href="structaim__type__prediction.html#aa1ed8d79daea94f79f6c5a17e25332ab">confidence</a>, width, <span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;                                        confidence_ratings.begin(), confidence_ratings.end() );</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160; </div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;    <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( w, <a class="code" href="structpoint.html">point</a>( 1, line_number++ ), col, col, confidence_bar );</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;}</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160; </div>
<div class="line"><a name="l01805"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a4fd0e174103e30dd7949347118557bc8"> 1805</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#a4fd0e174103e30dd7949347118557bc8">print_ranged_chance</a>( <span class="keyword">const</span> <a class="code" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w, <span class="keywordtype">int</span> line_number,</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                                <span class="keyword">const</span> std::vector&lt;aim_type_prediction&gt; &amp;aim_chances )</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;{</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;    std::vector&lt;aim_type_prediction&gt; <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a> = aim_chances;</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160; </div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;    <span class="comment">// Sort aim types so that &#39;current&#39; mode is placed at the current probability it provides</span></div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;    <span class="comment">// TODO: consider removing it, but for now it demonstrates the odds changing pretty well</span></div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;    std::sort( <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a>.begin(), <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a>.end(),</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;    []( <span class="keyword">const</span> <span class="keyword">auto</span> &amp; lhs, <span class="keyword">const</span> <span class="keyword">auto</span> &amp; rhs ) {</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        return lhs.confidence &lt;= rhs.confidence;</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;    } );</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160; </div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;    <span class="keywordtype">int</span> width = <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( w ) - 2; <span class="comment">// window width minus borders</span></div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> bars_pad = 3;</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;    <span class="keywordtype">bool</span> display_numbers = get_option&lt;std::string&gt;( <span class="stringliteral">&quot;ACCURACY_DISPLAY&quot;</span> ) == <span class="stringliteral">&quot;numbers&quot;</span>;</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;    std::string panel_type = <a class="code" href="classpanel__manager.html#a5acbe61fa6ec7eaf06ea15c80f14ebc6">panel_manager::get_manager</a>().<a class="code" href="classpanel__manager.html#a3f6290efcd5bca21c3cf44762bca2a91">get_current_layout_id</a>();</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> col = <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160; </div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;    <span class="comment">// Start printing by panel type, inside each branch whether to output numbers or &quot;bars&quot;</span></div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;    <span class="keywordflow">if</span>( panel_type == <span class="stringliteral">&quot;legacy_labels_narrow_sidebar&quot;</span> || panel_type == <span class="stringliteral">&quot;legacy_compact_sidebar&quot;</span> ) {</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;        <span class="keywordtype">bool</span> narrow = panel_type == <span class="stringliteral">&quot;legacy_labels_narrow_sidebar&quot;</span>;</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;        <span class="comment">// TODO: who uses this? this is broken likely since work started</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;        <span class="comment">// on sidebar widgets and yet nobody complains...</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;        std::vector&lt;std::string&gt; t_aims( 4 );</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;        std::vector&lt;std::string&gt; t_confidence( 20 );</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;        <span class="keywordtype">int</span> aim_iter = 0;</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;        <span class="keywordtype">int</span> conf_iter = 0;</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;        <span class="keywordflow">if</span>( !display_numbers ) {</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;            <span class="keywordtype">int</span> column_number = 1;</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;            <a class="code" href="ranged_8cpp.html#ae2f62035db4e943bb2c797e8c3febedd">print_confidence_ratings</a>( w, aim_chances.front().ratings, line_number, width, column_number, col );</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;            width -= bars_pad;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;            std::string <a class="code" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> = <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot; &lt;color_green&gt;Great&lt;/color&gt; &lt;color_light_gray&gt;Normal&lt;/color&gt;&quot;</span></div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                                     <span class="stringliteral">&quot; &lt;color_magenta&gt;Graze&lt;/color&gt; &lt;color_dark_gray&gt;Miss&lt;/color&gt; &lt;color_light_blue&gt;Moves&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;            <a class="code" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( w, <a class="code" href="structpoint.html">point</a>( 1, line_number++ ), width + bars_pad, <a class="code" href="color_8h.html#a5738d18ff9e165cca088a623cb1883ae">c_dark_gray</a>, <a class="code" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> );</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;            <span class="keywordtype">int</span> len = <a class="code" href="catacharset_8cpp.html#af20ee33da59ccceb9f4c14005c0bbe80">utf8_width</a>( <a class="code" href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">symbols</a> ) - 121; <span class="comment">// to subtract color codes</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;            <span class="keywordflow">if</span>( len &gt; width + bars_pad ) {</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                line_number++;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;            }</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; width; i++ ) {</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                <a class="code" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code" href="structpoint.html">point</a>( i + 1, line_number ), <span class="stringliteral">&quot;-&quot;</span> );</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            }</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;        }</div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structaim__type__prediction.html">aim_type_prediction</a> &amp;out : <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a> ) {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;            <span class="keywordflow">if</span>( display_numbers ) {</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                t_aims[aim_iter] = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;&lt;color_dark_gray&gt;%s:&lt;/color&gt;&quot;</span>, out.name );</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                t_confidence[( aim_iter * 5 ) + 4] = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;&lt;color_light_blue&gt;%d&lt;/color&gt;&quot;</span>, out.moves );</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( w, <a class="code" href="structpoint.html">point</a>( 1, line_number ), col, col, <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s %s:&quot;</span> ), out.name,</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                                    <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Aim&quot;</span> ) ) );</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                <a class="code" href="output_8cpp.html#aa6093ccb0ebc7f7ee1f11edd5cc2711c">right_print</a>( w, line_number++, 1, <a class="code" href="color_8h.html#a7b00fb82de0be83f6fc5f7965ea86623">c_light_blue</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Moves&quot;</span> ) );</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                <a class="code" href="output_8cpp.html#aa6093ccb0ebc7f7ee1f11edd5cc2711c">right_print</a>( w, line_number, 1, <a class="code" href="color_8h.html#a7b00fb82de0be83f6fc5f7965ea86623">c_light_blue</a>, <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;%d&quot;</span>, out.moves ) );</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;            }</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160; </div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;            <span class="keywordflow">if</span>( display_numbers ) {</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                <span class="keywordtype">int</span> last_chance = 0;</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                conf_iter = 0;</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structconfidence__rating.html">confidence_rating</a> &amp;cr : narrow ? aim_chances.front().ratings : out.ratings ) {</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                    <span class="keywordtype">int</span> chance = std::min&lt;int&gt;( 100, 100.0 * ( cr.aim_level ) * out.confidence ) - last_chance;</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                    last_chance += chance;</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                    t_confidence[conf_iter + ( aim_iter * 5 )] = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;&lt;color_%s&gt;%3d%%&lt;/color&gt;&quot;</span>, cr.color,</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                            chance );</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                    conf_iter++;</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                    <span class="keywordflow">if</span>( conf_iter == 3 ) {</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                        t_confidence[conf_iter + ( aim_iter * 5 )] = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;&lt;color_%s&gt;%3d%%&lt;/color&gt;&quot;</span>, <span class="stringliteral">&quot;dark_gray&quot;</span>,</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                                100 - last_chance );</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                    }</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                }</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                aim_iter++;</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                <a class="code" href="ranged_8cpp.html#ad665e86d9214ba9ef7722492a65cac0d">print_confidence_rating_bar</a>( w, out, line_number, width, col );</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;            }</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;        }</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160; </div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;        <span class="comment">// Draw tables for compact Numbers display</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;        <span class="keywordflow">if</span>( display_numbers ) {</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;            <span class="keyword">const</span> std::string divider = <span class="stringliteral">&quot;|&quot;</span>;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;            <span class="keywordtype">int</span> left_pad = 8;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            <span class="keywordtype">int</span> columns = 5;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;            <a class="code" href="output_8cpp.html#add4e31deb8a6e0444b89c79343c34a9c">insert_table</a>( w, left_pad, ++line_number, columns, <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>, divider, <span class="keyword">true</span>, t_confidence );</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            <a class="code" href="output_8cpp.html#add4e31deb8a6e0444b89c79343c34a9c">insert_table</a>( w, 0, line_number, 1, <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>, <span class="stringliteral">&quot;&quot;</span>, <span class="keyword">false</span>, t_aims );</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;            line_number = line_number + 4; <span class="comment">// 4 to account for the tables</span></div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        }</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;        <span class="keywordflow">return</span> line_number;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// print the &quot;legacy classic&quot; one</span></div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="comment">// there&#39;s more legacy sidebars but appear to not be used</span></div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160; </div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;current_steadiness_it = std::find_if( <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a>.begin(),</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;        <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a>.end(), []( <span class="keyword">const</span> <a class="code" href="structaim__type__prediction.html">aim_type_prediction</a> &amp; atp ) {</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;            return atp.is_default;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        } );</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;        <span class="keywordflow">if</span>( current_steadiness_it != <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a>.end() ) {</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            line_number = <a class="code" href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576">print_steadiness</a>( w, line_number, current_steadiness_it-&gt;steadiness );</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;        }</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160; </div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;        <span class="keywordtype">int</span> column_number = 1;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;        <span class="keywordflow">if</span>( !( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> ) ) {</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;            std::string <a class="code" href="structlabel.html">label</a> = <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Symbols:&quot;</span> );</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            <a class="code" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( w, <a class="code" href="structpoint.html">point</a>( column_number, line_number ), <a class="code" href="structlabel.html">label</a> );</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;            column_number += <a class="code" href="catacharset_8cpp.html#af20ee33da59ccceb9f4c14005c0bbe80">utf8_width</a>( <a class="code" href="structlabel.html">label</a> ) + 1; <span class="comment">// 1 for whitespace after &#39;Symbols:&#39;</span></div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;        }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160; </div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        <a class="code" href="ranged_8cpp.html#ae2f62035db4e943bb2c797e8c3febedd">print_confidence_ratings</a>( w, <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a>.front().ratings, line_number, width, column_number, col );</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160; </div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structaim__type__prediction.html">aim_type_prediction</a> &amp;out : <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">sorted</a> ) {</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;            std::string col_hl = out.is_default ? <span class="stringliteral">&quot;light_green&quot;</span> : <span class="stringliteral">&quot;light_gray&quot;</span>;</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;            std::string desc =</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160;                <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;&lt;color_white&gt;[%s]&lt;/color&gt; &lt;color_%s&gt;%s %s&lt;/color&gt; | %s: &lt;color_light_blue&gt;%3d&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;                               out.hotkey, col_hl, out.name, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Aim&quot;</span> ), <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Moves to fire&quot;</span> ), out.moves );</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160; </div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( w, <a class="code" href="structpoint.html">point</a>( 1, line_number++ ), col, col, desc );</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160; </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;            <span class="keywordflow">if</span>( display_numbers ) {</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;                <span class="keyword">const</span> std::string <a class="code" href="mapgen_8cpp.html#a4f3a5fd278254d867d914ad5953679e2">line</a> = <a class="code" href="output_8h.html#a4be67498ee67b5186fcae5cf706f7512">enumerate_as_string</a>( out.chances.cbegin(), out.chances.cend(),</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;                []( <span class="keyword">const</span> <a class="code" href="structaim__type__prediction_1_1aim__confidence.html">aim_type_prediction::aim_confidence</a> &amp; conf ) {</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;                    const std::string label_loc = pgettext( <span class="stringliteral">&quot;aim_confidence&quot;</span>, conf.label.c_str() );</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;                    return string_format( <span class="stringliteral">&quot;%s: &lt;color_%s&gt;%3d%%&lt;/color&gt;&quot;</span>, label_loc, conf.color, conf.chance );</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;                }, <a class="code" href="output_8h.html#acff0d12357d8a4690e781eed41b36b98a334c4a4c42fdb79d7ebc3e73b517e6f8">enumeration_conjunction::none</a> );</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160; </div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;                line_number += <a class="code" href="output_8cpp.html#a2f8515020638461e15374b3bf6555c75">fold_and_print_from</a>( w, <a class="code" href="structpoint.html">point</a>( 1, line_number ), width, 0, <a class="code" href="color_8h.html#a5738d18ff9e165cca088a623cb1883ae">c_dark_gray</a>, <a class="code" href="mapgen_8cpp.html#a4f3a5fd278254d867d914ad5953679e2">line</a> );</div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;                <a class="code" href="ranged_8cpp.html#ad665e86d9214ba9ef7722492a65cac0d">print_confidence_rating_bar</a>( w, out, line_number, width, col );</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            }</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        }</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="keywordflow">return</span> line_number;</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    }</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;}</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160; </div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;<span class="comment">// Whether player character knows creature&#39;s position and can roughly track it with the aim cursor</span></div>
<div class="line"><a name="l01935"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951"> 1935</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> &amp;cr )</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;{</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;<a class="code" href="global__vars_8h.html#a54b344f3b76633f42ae19af82cc1cc89a7b774effe4a349c6dd82ad4f4f21d34c">u</a> = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="global__vars_8h.html#a54b344f3b76633f42ae19af82cc1cc89a7b774effe4a349c6dd82ad4f4f21d34c">u</a>.sees( cr ) || <a class="code" href="global__vars_8h.html#a54b344f3b76633f42ae19af82cc1cc89a7b774effe4a349c6dd82ad4f4f21d34c">u</a>.sees_with_infrared( cr ) || <a class="code" href="global__vars_8h.html#a54b344f3b76633f42ae19af82cc1cc89a7b774effe4a349c6dd82ad4f4f21d34c">u</a>.sees_with_specials( cr );</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;}</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160; </div>
<div class="line"><a name="l01941"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a0702c7984ec8768691cb9a805616d1de"> 1941</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#a0702c7984ec8768691cb9a805616d1de">print_aim</a>( <span class="keyword">const</span> <a class="code" href="classtarget__ui.html">target_ui</a> &amp;<a class="code" href="namespaceui.html">ui</a>, <a class="code" href="classCharacter.html">Character</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w,</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;                      <span class="keywordtype">int</span> line_number, <a class="code" href="classinput__context.html">input_context</a> &amp;ctxt, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;weapon, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;<a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> )</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;{</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="comment">// This is absolute accuracy for the player.</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    <span class="comment">// TODO: push the calculations duplicated from Creature::deal_projectile_attack() and</span></div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <span class="comment">// Creature::projectile_attack() into shared methods.</span></div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="comment">// Dodge doesn&#39;t affect gun attacks</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160; </div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    <a class="code" href="classdispersion__sources.html">dispersion_sources</a> dispersion = you.<a class="code" href="classCharacter.html#a05331bfbde3df1348a870d987597d29a">get_weapon_dispersion</a>( weapon );</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( you.<a class="code" href="classCharacter.html#accd6b165a9454cad9972bc153061215a">recoil_vehicle</a>() );</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160; </div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    <span class="comment">// This could be extracted, to allow more/less verbose displays</span></div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; confidence_config = {{</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;            { <a class="code" href="game__constants_8h.html#a32b6b0daa47aeb1caa71bc0585e24684">accuracy_critical</a>, <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;green&quot;</span>, <a class="code" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Great&quot;</span> ) },</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;            { <a class="code" href="game__constants_8h.html#ae5e219227693b7de2d1bb823567b01c7">accuracy_standard</a>, <span class="charliteral">&#39;+&#39;</span>, <span class="stringliteral">&quot;light_gray&quot;</span>, <a class="code" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Normal&quot;</span> ) },</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;            { <a class="code" href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a>, <span class="charliteral">&#39;|&#39;</span>, <span class="stringliteral">&quot;magenta&quot;</span>, <a class="code" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Graze&quot;</span> ) }</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        }</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    };</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160; </div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;    <span class="keyword">const</span> std::vector&lt;aim_type_prediction&gt; aim_chances = <a class="code" href="ranged_8cpp.html#a221acbe15b21618febcda6765ff3223c">calculate_ranged_chances</a>( <a class="code" href="namespaceui.html">ui</a>, you,</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">target_ui::TargetMode::Fire</a>, ctxt, weapon, dispersion, confidence_config,</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;            <a class="code" href="structTarget__attributes.html">Target_attributes</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> ), <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> );</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160; </div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="ranged_8cpp.html#a4fd0e174103e30dd7949347118557bc8">print_ranged_chance</a>( w, line_number, aim_chances );</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;}</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160; </div>
<div class="line"><a name="l01967"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#aad8bc17f1bcf65d90738d8d06460c91a"> 1967</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#aad8bc17f1bcf65d90738d8d06460c91a">draw_throw_aim</a>( <span class="keyword">const</span> <a class="code" href="classtarget__ui.html">target_ui</a> &amp;<a class="code" href="namespaceui.html">ui</a>, <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classcatacurses_1_1window.html">catacurses::window</a> &amp;w,</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;                            <span class="keywordtype">int</span> &amp;text_y, <a class="code" href="classinput__context.html">input_context</a> &amp;ctxt, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;weapon, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;target_pos,</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;                            <span class="keywordtype">bool</span> is_blind_throw )</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;{</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *target = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( target_pos, <span class="keyword">true</span> );</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <span class="keywordflow">if</span>( target != <span class="keyword">nullptr</span> &amp;&amp; !you.<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *target ) ) {</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;        target = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    }</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160; </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    <span class="keyword">const</span> <a class="code" href="classdispersion__sources.html">dispersion_sources</a> dispersion( you.<a class="code" href="classCharacter.html#a6853521cfe7399330d90c08271e003b4">throwing_dispersion</a>( weapon, target, is_blind_throw ) );</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> range = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), target_pos );</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160; </div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> target_size = target != <span class="keyword">nullptr</span> ? target-&gt;<a class="code" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">ranged_target_size</a>() : 1.0f;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160; </div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; confidence_config_critter = {{</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;            { <a class="code" href="game__constants_8h.html#a32b6b0daa47aeb1caa71bc0585e24684">accuracy_critical</a>, <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;green&quot;</span>, <a class="code" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Great&quot;</span> ) },</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;            { <a class="code" href="game__constants_8h.html#ae5e219227693b7de2d1bb823567b01c7">accuracy_standard</a>, <span class="charliteral">&#39;+&#39;</span>, <span class="stringliteral">&quot;light_gray&quot;</span>, <a class="code" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Normal&quot;</span> ) },</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;            { <a class="code" href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a>, <span class="charliteral">&#39;|&#39;</span>, <span class="stringliteral">&quot;magenta&quot;</span>, <a class="code" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Graze&quot;</span> ) }</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;        }</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    };</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;confidence_rating&gt; confidence_config_object = {{</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;            { <a class="code" href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a>, <span class="charliteral">&#39;*&#39;</span>, <span class="stringliteral">&quot;white&quot;</span>, <a class="code" href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a>( <span class="stringliteral">&quot;aim_confidence&quot;</span>, <span class="stringliteral">&quot;Hit&quot;</span> ) }</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;        }</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    };</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;confidence_config = target != <span class="keyword">nullptr</span> ?</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;                                    confidence_config_critter : confidence_config_object;</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160; </div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="keyword">const</span> <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">target_ui::TargetMode</a> throwing_target_mode = is_blind_throw ?</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">target_ui::TargetMode::ThrowBlind</a> :</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;            <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">target_ui::TargetMode::Throw</a>;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160;    <a class="code" href="structTarget__attributes.html">Target_attributes</a> attributes( range, target_size, <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().ambient_light_at( target_pos ),</div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;                                  you.<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( target_pos ) );</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160; </div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <span class="keyword">const</span> std::vector&lt;aim_type_prediction&gt; aim_chances = <a class="code" href="ranged_8cpp.html#a221acbe15b21618febcda6765ff3223c">calculate_ranged_chances</a>( <a class="code" href="namespaceui.html">ui</a>, you,</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;            throwing_target_mode, ctxt, weapon, dispersion, confidence_config, attributes, target_pos );</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160; </div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;    text_y = <a class="code" href="ranged_8cpp.html#a4fd0e174103e30dd7949347118557bc8">print_ranged_chance</a>( w, text_y, aim_chances );</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;}</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160; </div>
<div class="line"><a name="l02006"></a><span class="lineno"><a class="line" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d"> 2006</a></span>&#160;std::vector&lt;aim_type&gt; <a class="code" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">Character::get_aim_types</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;gun )<span class="keyword"> const</span></div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;    std::vector&lt;aim_type&gt; aim_types { <a class="code" href="ranged_8cpp.html#aa68fa53ae2a9bc0bb461af10bec001fe">get_default_aim_type</a>() };</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.is_gun() ) {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;        <span class="keywordflow">return</span> aim_types;</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;    }</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;    <span class="keywordtype">int</span> sight_dispersion = <a class="code" href="classCharacter.html#a2c1e0d2a430258c132cbdff827fc8e89">most_accurate_aiming_method_limit</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> );</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;    <span class="comment">// Aiming thresholds are dependent on weapon sight dispersion, attempting to place thresholds</span></div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;    <span class="comment">// at 10%, 5% and 0% of the difference between MAX_RECOIL and sight dispersion.</span></div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;    std::vector&lt;int&gt; thresholds = {</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( ( <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - sight_dispersion ) / 10.0 ) + sight_dispersion ),</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( ( ( <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - sight_dispersion ) / 40.0 ) + sight_dispersion ),</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( sight_dispersion )</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;    };</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;    <span class="comment">// Remove duplicate thresholds.</span></div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;    std::vector&lt;int&gt;::iterator thresholds_it = std::adjacent_find( thresholds.begin(),</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;            thresholds.end() );</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;    <span class="keywordflow">while</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        thresholds.erase( thresholds_it );</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        thresholds_it = std::adjacent_find( thresholds.begin(), thresholds.end() );</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;    }</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;    thresholds_it = thresholds.begin();</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;    aim_types.push_back( <a class="code" href="structaim__type.html">aim_type</a> { <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Regular&quot;</span> ), <span class="stringliteral">&quot;AIMED_SHOT&quot;</span>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%c] to aim and fire.&quot;</span> ),</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;                                    <span class="keyword">true</span>, *thresholds_it } );</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    thresholds_it++;</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;    <span class="keywordflow">if</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        aim_types.push_back( <a class="code" href="structaim__type.html">aim_type</a> { <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Careful&quot;</span> ), <span class="stringliteral">&quot;CAREFUL_SHOT&quot;</span>,</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;                                        <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%c] to take careful aim and fire.&quot;</span> ), <span class="keyword">true</span>,</div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;                                        *thresholds_it } );</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        thresholds_it++;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    }</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;    <span class="keywordflow">if</span>( thresholds_it != thresholds.end() ) {</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160;        aim_types.push_back( <a class="code" href="structaim__type.html">aim_type</a> { <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Precise&quot;</span> ), <span class="stringliteral">&quot;PRECISE_SHOT&quot;</span>,</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;                                        <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%c] to take precise aim and fire.&quot;</span> ), <span class="keyword">true</span>,</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;                                        *thresholds_it } );</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    }</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <span class="keywordflow">return</span> aim_types;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;}</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160; </div>
<div class="line"><a name="l02045"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff"> 2045</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structprojectile.html">projectile</a> <a class="code" href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;gun )</div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;{</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <a class="code" href="structprojectile.html">projectile</a> proj;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    proj.<a class="code" href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">speed</a>  = 1000;</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    proj.<a class="code" href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">impact</a> = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gun_damage();</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    proj.<a class="code" href="structprojectile.html#a221a35c5c50354f9e29ec63ebfd6669f">shot_impact</a> = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gun_damage( <span class="keyword">true</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160; </div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;    proj.<a class="code" href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">range</a> = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gun_range();</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;    proj.<a class="code" href="structprojectile.html#a4536010a51aee3302d749f2eb4dcaf35">proj_effects</a> = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_effects();</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160; </div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;    <span class="keyword">auto</span> &amp;fx = proj.<a class="code" href="structprojectile.html#a4536010a51aee3302d749f2eb4dcaf35">proj_effects</a>;</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160; </div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    <span class="keywordflow">if</span>( ( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_data() &amp;&amp; <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_data()-&gt;phase == <a class="code" href="enums_8h.html#ade8f325e8cc8463cef8f944f3209d0e5a5918e24870f0ea98b9978dae8a69c533">phase_id::LIQUID</a> ) ||</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;        fx.count( <span class="stringliteral">&quot;SHOT&quot;</span> ) || fx.count( <span class="stringliteral">&quot;BOUNCE&quot;</span> ) ) {</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;        fx.insert( <span class="stringliteral">&quot;WIDE&quot;</span> );</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;    }</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160; </div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_data() ) {</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;        <span class="comment">// Some projectiles have a chance of being recoverable</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="keywordtype">bool</span> recover = std::any_of( fx.begin(), fx.end(), []( <span class="keyword">const</span> std::string_view e ) {</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            if( !string_starts_with( e, <span class="stringliteral">&quot;RECOVER_&quot;</span> ) ) {</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                return false;</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;            }</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;            <a class="code" href="classret__val.html">ret_val&lt;int&gt;</a> n = <a class="code" href="try__parse__integer_8cpp.html#ae51236610f306440113477987363490b">try_parse_integer&lt;int&gt;</a>( e.substr( 8 ), <span class="keyword">false</span> );</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;            <span class="keywordflow">if</span>( !n.success() ) {</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;                debugmsg( <span class="stringliteral">&quot;Error parsing ammo RECOVER_ denominator: %s&quot;</span>, n.str() );</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;                return false;</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;            }</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;            <span class="keywordflow">return</span> !<a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( n.value() );</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;        } );</div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160; </div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <span class="keywordflow">if</span>( recover &amp;&amp; !fx.count( <span class="stringliteral">&quot;IGNITE&quot;</span> ) &amp;&amp; !fx.count( <span class="stringliteral">&quot;EXPLOSIVE&quot;</span> ) ) {</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            <a class="code" href="classitem.html">item</a> drop( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_current(), <a class="code" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a>, 1 );</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;            drop.<a class="code" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> = fx.count( <span class="stringliteral">&quot;ACT_ON_RANGED_HIT&quot;</span> );</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;            drop.<a class="code" href="classitem.html#a9a1f33d04abe5ec73a31213be8d0c44e">set_favorite</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.get_contents().first_ammo().is_favorite );</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;            proj.<a class="code" href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">set_drop</a>( drop );</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;        }</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160; </div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;ammo = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_data()-&gt;ammo;</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        proj.<a class="code" href="structprojectile.html#a8f7965237723889c4066c90c05220523">critical_multiplier</a> = ammo-&gt;critical_multiplier;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;        proj.<a class="code" href="structprojectile.html#ac535de1b5134a85ddcc5d1deffbf0d31">count</a> = ammo-&gt;count;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        proj.<a class="code" href="structprojectile.html#a69088085addc2ca2b0e5328faab85c87">multi_projectile_effects</a> = ammo-&gt;multi_projectile_effects;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        <span class="keywordflow">if</span>( fx.count( <span class="stringliteral">&quot;MULTI_EFFECTS&quot;</span> ) ) {</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;            proj.<a class="code" href="structprojectile.html#a69088085addc2ca2b0e5328faab85c87">multi_projectile_effects</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        }</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;        proj.<a class="code" href="structprojectile.html#af0fefe18f0e831be4b4d7d9693b35cbc">shot_spread</a> = ammo-&gt;shot_spread * <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.gun_shot_spread_multiplier();</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;        <span class="keywordflow">if</span>( !ammo-&gt;drop.is_null() &amp;&amp; <a class="code" href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a>( ammo-&gt;drop_chance, 1.0 ) ) {</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;            <a class="code" href="classitem.html">item</a> drop( ammo-&gt;drop );</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;            <span class="keywordflow">if</span>( ammo-&gt;drop_active ) {</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;                drop.<a class="code" href="classitem.html#a7f1ae4e309841707eea0852dd4cd95a3">activate</a>();</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;            }</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            proj.<a class="code" href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">set_drop</a>( drop );</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        }</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160; </div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;        <span class="keywordflow">if</span>( fx.count( <span class="stringliteral">&quot;CUSTOM_EXPLOSION&quot;</span> ) &gt; 0 ) {</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;            proj.<a class="code" href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">set_custom_explosion</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_data()-&gt;explosion );</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;        }</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;    }</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160; </div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <span class="keywordflow">return</span> proj;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;}</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160; </div>
<div class="line"><a name="l02107"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3"> 2107</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;p, <span class="keyword">const</span> <a class="code" href="structitype.html">itype</a> &amp;firing )</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;{</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;    <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> &amp;skill_used = firing.<a class="code" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;skill_used;</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtime__info__t.html">time_info_t</a> &amp;info = skill_used-&gt;<a class="code" href="classSkill.html#a879f0e8d0da73f0cdebd825134cd32d6">time_to_attack</a>();</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( info.<a class="code" href="structtime__info__t.html#a562e779c37f25968ccd5f5298a8c308c">min_time</a>,</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;                     <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">round</a>( info.<a class="code" href="structtime__info__t.html#ab3676d37128ef1625abe58686c8c2bfb">base_time</a> - info.<a class="code" href="structtime__info__t.html#a1cb4c0bb33cbe25f4e889533d8ae1721">time_reduction_per_level</a> * p.<a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>(</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;                                           skill_used ) ) ) );</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;}</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160; </div>
<div class="line"><a name="l02116"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a035c67a119c3f5a39b1069944798c9fc"> 2116</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#a035c67a119c3f5a39b1069944798c9fc">cycle_action</a>( <a class="code" href="classitem.html">item</a> &amp;weap, <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> &amp;ammo, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;<a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> )</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;{</div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <span class="comment">// eject casings and linkages in random direction avoiding walls using player position as fallback</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    std::vector&lt;tripoint&gt; tiles = <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a>, 1 );</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    tiles.erase( tiles.begin() );</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    tiles.erase( std::remove_if( tiles.begin(), tiles.end(), [&amp;]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; e ) {</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;        return !here.passable( e );</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    } ), tiles.end() );</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> eject = tiles.empty() ? <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> : <a class="code" href="rng_8h.html#a12244355ee77108f1b08618e9962e4d1">random_entry</a>( tiles );</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160; </div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;    <span class="comment">// for turrets try and drop casings or linkages directly to any CARGO part on the same tile</span></div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;    <span class="keyword">const</span> std::optional&lt;vpart_reference&gt; ovp_cargo = weap.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a5d1fa7fb2e0d7c717f7bc1cc461407db">flag_VEHICLE</a> )</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;            ? here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> ).<a class="code" href="classoptional__vpart__position.html#acf1ddbf380ff79f8fd707a0453b1608b">cargo</a>()</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            : std::nullopt;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160; </div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <a class="code" href="classitem.html">item</a> *brass_catcher = weap.<a class="code" href="classitem.html#ac11fd08d9b41ad301b7135906df8c33e">gunmod_find_by_flag</a>( <a class="code" href="flag_8cpp.html#a959a7603cf7b380c637eede6d2a6dd17">flag_BRASS_CATCHER</a> );</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;    <span class="keywordflow">if</span>( !!ammo-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;casing ) {</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;        <a class="code" href="classitem.html">item</a> casing = <a class="code" href="classitem.html">item</a>( *ammo-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;casing );</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <span class="comment">// blackpowder can gum up casings too</span></div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="keywordflow">if</span>( ( *ammo-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a> ).ammo_effects.count( <span class="stringliteral">&quot;BLACKPOWDER&quot;</span> ) ) {</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;            casing.<a class="code" href="classitem.html#a5b29c86dff457effe5dc4b9e7a24da12">set_flag</a>( <a class="code" href="ranged_8cpp.html#a4df4dd60924cd337468bb34326d879a7">json_flag_FILTHY</a> );</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        }</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        <span class="keywordflow">if</span>( weap.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a7dffac54d4c781ade6642ecb6365d4db">flag_RELOAD_EJECT</a> ) ) {</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;            weap.<a class="code" href="classitem.html#a8b6013a4dab952626df6834f46ec048f">force_insert_item</a>( casing.<a class="code" href="classitem.html#a5b29c86dff457effe5dc4b9e7a24da12">set_flag</a>( <a class="code" href="flag_8cpp.html#ac577a11efabcd415739ddfea395ace5e">flag_CASING</a> ),</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;                                    <a class="code" href="pocket__type_8h.html#af41ed729a50321996f6fa60225086cf1a9ad53f422a98449de1c9f7bd20b2de8a">pocket_type::MAGAZINE</a> );</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;            weap.<a class="code" href="classitem.html#a6d1575c31b1dc0df51cbe3a1dfbfef16">on_contents_changed</a>();</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;            <span class="keywordflow">if</span>( brass_catcher &amp;&amp; brass_catcher-&gt;<a class="code" href="classitem.html#a28fa4969a257ea0b79acc9c60595ee7b">can_contain</a>( casing ).<a class="code" href="classret__val__common.html#a933807b816264e791e488ed5e7abb1c3">success</a>() ) {</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;                brass_catcher-&gt;<a class="code" href="classitem.html#a018fe1a11eaa7e18cae915d683088c02">put_in</a>( casing, <a class="code" href="pocket__type_8h.html#af41ed729a50321996f6fa60225086cf1a9bbab5f947b9e3fbb8a399ecc257459b">pocket_type::CONTAINER</a> );</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ovp_cargo ) {</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;                ovp_cargo-&gt;vehicle().add_item( ovp_cargo-&gt;part(), casing );</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                here.<a class="code" href="classmap.html#a5579e13088b4ccd9c5a75458919d528a">add_item_or_charges</a>( eject, casing );</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;            }</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160; </div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;            <a class="code" href="namespacesfx.html#a8fa2bb887ac81392fb686cc4079b5d5a">sfx::play_variant_sound</a>( <span class="stringliteral">&quot;fire_gun&quot;</span>, <span class="stringliteral">&quot;brass_eject&quot;</span>, <a class="code" href="namespacesfx.html#a1f138eaa92db132e81ce591751c512cc">sfx::get_heard_volume</a>( eject ),</div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;                                     <a class="code" href="namespacesfx.html#aa186eb63210729f73d7c76dcda527ff5">sfx::get_heard_angle</a>( eject ) );</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;        }</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;    }</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160; </div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;    <span class="comment">// some magazines also eject disintegrating linkages</span></div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> *mag = weap.<a class="code" href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">magazine_current</a>();</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;    <span class="keywordflow">if</span>( mag &amp;&amp; mag-&gt;<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#aba9992b8bc80b65d4153370b3e0755ec">magazine</a>-&gt;linkage ) {</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        <a class="code" href="classitem.html">item</a> linkage( *mag-&gt;<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#aba9992b8bc80b65d4153370b3e0755ec">magazine</a>-&gt;linkage, <a class="code" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a>, 1 );</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;        <span class="keywordflow">if</span>( !( brass_catcher &amp;&amp;</div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;               brass_catcher-&gt;<a class="code" href="classitem.html#a018fe1a11eaa7e18cae915d683088c02">put_in</a>( linkage, <a class="code" href="pocket__type_8h.html#af41ed729a50321996f6fa60225086cf1a9bbab5f947b9e3fbb8a399ecc257459b">pocket_type::CONTAINER</a> ).<a class="code" href="classret__val__common.html#a933807b816264e791e488ed5e7abb1c3">success</a>() ) ) {</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;            <span class="keywordflow">if</span>( ovp_cargo ) {</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;                ovp_cargo-&gt;items().insert( linkage );</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;                here.<a class="code" href="classmap.html#a5579e13088b4ccd9c5a75458919d528a">add_item_or_charges</a>( eject, linkage );</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;            }</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;        }</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;    }</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;}</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160; </div>
<div class="line"><a name="l02172"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a13b78ee77e8e3b8527bff0ce8e7a5651"> 2172</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="ranged_8cpp.html#a13b78ee77e8e3b8527bff0ce8e7a5651">make_gun_sound_effect</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;p, <span class="keywordtype">bool</span> burst, <a class="code" href="classitem.html">item</a> *weapon )</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;{</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;    <span class="keyword">const</span> <a class="code" href="structitem_1_1sound__data.html">item::sound_data</a> data = weapon-&gt;<a class="code" href="classitem.html#a3694c5d9138956736af2444bd7b3972e">gun_noise</a>( burst );</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;    <span class="keywordflow">if</span>( data.<a class="code" href="structitem_1_1sound__data.html#aa2fb844ce506ca62f0c5d1d549f54826">volume</a> &gt; 0 ) {</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        <a class="code" href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a>( p.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), data.<a class="code" href="structitem_1_1sound__data.html#aa2fb844ce506ca62f0c5d1d549f54826">volume</a>, <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a>,</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;                       data.<a class="code" href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">sound</a>.empty() ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Bang!&quot;</span> ) : data.<a class="code" href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">sound</a> );</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    }</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    <a class="code" href="classenum__bitset.html">tname::segment_bitset</a> segs( <a class="code" href="namespacetname.html#a24cc3734547252a92df94fedcff08ae3">tname::unprefixed_tname</a> );</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160;    segs.<a class="code" href="classenum__bitset.html#a4817796a50f9f258865e0413ff1f91f9">set</a>( <a class="code" href="namespacetname.html#aa6dc2a5ef81ad3157f8280d5645e3ea6a8b926ca329dfb31daa1211d0e158e05e">tname::segments::CONTENTS</a>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    p.<a class="code" href="classCharacter.html#af0503012f1ff927cbb5ad126e39cb103">add_msg_if_player</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You shoot your %1$s.  %2$s&quot;</span> ), weapon-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>( 1, segs ),</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;                         <a class="code" href="output_8cpp.html#a71e024973a8beccd4a228d00ebd9503a">uppercase_first_letter</a>( data.<a class="code" href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">sound</a> ) );</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;}</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160; </div>
<div class="line"><a name="l02185"></a><span class="lineno"><a class="line" href="classitem.html#a3694c5d9138956736af2444bd7b3972e"> 2185</a></span>&#160;<a class="code" href="structitem_1_1sound__data.html">item::sound_data</a> <a class="code" href="classitem.html#a3694c5d9138956736af2444bd7b3972e">item::gun_noise</a>( <span class="keyword">const</span> <span class="keywordtype">bool</span> burst )<span class="keyword"> const</span></div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <span class="keywordflow">return</span> { 0, <span class="stringliteral">&quot;&quot;</span> };</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    }</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160; </div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> = <a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>-&gt;loudness;</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> *<a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a> : <a class="code" href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">gunmods</a>() ) {</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> += <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">mod</a>-&gt;type-&gt;gunmod-&gt;loudness;</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;    }</div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>() ) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;        <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> += <a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;loudness;</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;    }</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160; </div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;    <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, 0 );</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160; </div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;    <span class="keyword">const</span> std::set&lt;ammotype&gt; &amp;at = <a class="code" href="classitem.html#aed15b9f2983bf68f5701e2b7e3b6ac73">ammo_types</a>();</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a5894429e236b2dc2ee157ce48d7ad02e">ammo_40x46mm</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a57ab4ea57b22b751cee023b1798c68f2">ammo_40x53mm</a> ) ) {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        <span class="comment">// Grenade launchers</span></div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        <span class="keywordflow">return</span> { 8, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Thunk!&quot;</span> ) };</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160; </div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a7c9a7d0a1b73c0f70f96584ecc262420">ammo_12mm</a> ) || at.count( <a class="code" href="ranged_8cpp.html#ac283fa14509e26bd1becc0a28dfcb8d1">ammo_metal_rail</a> ) ) {</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;        <span class="comment">// Railguns</span></div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <span class="keywordflow">return</span> { 24, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;tz-CRACKck!&quot;</span> ) };</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160; </div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a66543644370f9b1d803abac7d90cd033">ammo_flammable</a> ) || at.count( <a class="code" href="ranged_8cpp.html#ab386b4796e39e527e91a503f6975c82d">ammo_66mm</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a5b115344b066e0eebf72b6fcafaebfb2">ammo_120mm</a> ) ||</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;               at.count( <a class="code" href="ranged_8cpp.html#a638a17e59573d9d6bac0a05980096c37">ammo_84x246mm</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a81c0e98b7eaad878f45b27c21f4d6393">ammo_m235</a> ) || at.count( <a class="code" href="ranged_8cpp.html#a990502dafd582f371f40de17ae3f5ef4">ammo_atgm</a> ) ||</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;               at.count( <a class="code" href="ranged_8cpp.html#a68193ecd0be34e65f12a3febf6f7b6e1">ammo_RPG_7</a> ) || at.count( <a class="code" href="ranged_8cpp.html#aecf1c5ee613ec0609d2ae3a7a46b4b8d">ammo_homebrew_rocket</a> ) ) {</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;        <span class="comment">// Rocket launchers and flamethrowers</span></div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;        <span class="keywordflow">return</span> { 4, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Fwoosh!&quot;</span> ) };</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a282ca1601a24be0ae7aae003597e7ada">ammo_arrow</a> ) ) {</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;        <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;whizz!&quot;</span> ) };</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a4daea1de5d5e6f0b8d268b627b874139">ammo_strange_arrow</a> ) ) {</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Crack!&quot;</span> ) };</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a609c386685fa395233e3f1765e57a38b">ammo_bolt</a> ) || at.count( <a class="code" href="ranged_8cpp.html#abab3d18c8a6ece5b486b6e3965e27dde">ammo_bolt_ballista</a> ) ) {</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;thonk!&quot;</span> ) };</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( at.count( <a class="code" href="ranged_8cpp.html#a6ce4de21dacf3a60c3da7dcead0fd08f">ammo_atlatl</a> ) ) {</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;        <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;swoosh!&quot;</span> ) };</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    }</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160; </div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    <span class="keyword">auto</span> fx = <a class="code" href="classitem.html#a768c08639c1047f61b9aab2b894e9bcd">ammo_effects</a>();</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160; </div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    <span class="keywordflow">if</span>( fx.count( <span class="stringliteral">&quot;LASER&quot;</span> ) || fx.count( <span class="stringliteral">&quot;PLASMA&quot;</span> ) ) {</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 20 ) {</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Fzzt!&quot;</span> ) };</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 40 ) {</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Pew!&quot;</span> ) };</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 60 ) {</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Tsewww!&quot;</span> ) };</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Kra-kow!&quot;</span> ) };</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;        }</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160; </div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx.count( <span class="stringliteral">&quot;LIGHTNING&quot;</span> ) ) {</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 20 ) {</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Bzzt!&quot;</span> ) };</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 40 ) {</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Bzap!&quot;</span> ) };</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 60 ) {</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Bzaapp!&quot;</span> ) };</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Kra-koom!&quot;</span> ) };</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;        }</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160; </div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fx.count( <span class="stringliteral">&quot;WHIP&quot;</span> ) ) {</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;        <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Crack!&quot;</span> ) };</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160; </div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &gt; 0 ) {</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 10 ) {</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Brrrip!&quot;</span> ) : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;plink!&quot;</span> ) };</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 150 ) {</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Brrrap!&quot;</span> ) : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;bang!&quot;</span> ) };</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a> &lt; 175 ) {</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;P-p-p-pow!&quot;</span> ) : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;blam!&quot;</span> ) };</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;            <span class="keywordflow">return</span> { <a class="code" href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">noise</a>, burst ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Kaboom!&quot;</span> ) : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;kerblam!&quot;</span> ) };</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        }</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;    }</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160; </div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    <span class="keywordflow">return</span> { 0, <span class="stringliteral">&quot;&quot;</span> }; <span class="comment">// silent weapons</span></div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;}</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160; </div>
<div class="line"><a name="l02267"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd"> 2267</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">double</span> <a class="code" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a>( <span class="keywordtype">double</span> skill, <span class="keywordtype">double</span> weapon_dispersion )</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;{</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;    <span class="keywordflow">if</span>( skill &gt;= <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) {</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;    }</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    <span class="keywordtype">double</span> skill_shortfall = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) - skill;</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <span class="keywordtype">double</span> dispersion_penalty = 10 * skill_shortfall;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    <span class="keywordtype">double</span> skill_threshold = 5;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;    <span class="keywordflow">if</span>( skill &gt;= skill_threshold ) {</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;        <span class="keywordtype">double</span> post_threshold_skill_shortfall = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) - skill;</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;        <span class="comment">// Lack of mastery multiplies the dispersion of the weapon.</span></div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        <span class="keywordflow">return</span> dispersion_penalty + ( weapon_dispersion * post_threshold_skill_shortfall * 1.25 ) /</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;               ( <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) - skill_threshold );</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    }</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;    <span class="comment">// Unskilled shooters suffer greater penalties, still scaling with weapon penalties.</span></div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <span class="keywordtype">double</span> pre_threshold_skill_shortfall = skill_threshold - skill;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    dispersion_penalty += weapon_dispersion *</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                          ( 1.25 + pre_threshold_skill_shortfall * 10.0 / skill_threshold );</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160; </div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;    <span class="keywordflow">return</span> dispersion_penalty;</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;}</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160; </div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;<span class="comment">// utility functions for projectile_attack</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"><a class="line" href="classCharacter.html#a05331bfbde3df1348a870d987597d29a"> 2290</a></span>&#160;<a class="code" href="classdispersion__sources.html">dispersion_sources</a> <a class="code" href="classCharacter.html#a05331bfbde3df1348a870d987597d29a">Character::get_weapon_dispersion</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;<a class="code" href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">obj</a> )<span class="keyword"> const</span></div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;    <span class="keywordtype">int</span> weapon_dispersion = obj.<a class="code" href="classitem.html#adfd6f9946d4895a6ef2190e07c2486a3">gun_dispersion</a>();</div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    <a class="code" href="classdispersion__sources.html">dispersion_sources</a> dispersion( weapon_dispersion );</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;    dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code" href="classCharacter.html#aaef1f2b773b9e659b6b69f813ea4dafb">ranged_dex_mod</a>() );</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160; </div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code" href="classCharacter.html#a191d57983e5a0064be49504c11e8b56a">get_modifier</a>( <a class="code" href="ranged_8cpp.html#aef6b532c29ec965cbee404c29746a7da">character_modifier_ranged_dispersion_manip_mod</a> ) );</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160; </div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a1f4afdf9827faa33b0d2436fa27d9fd2">is_driving</a>() ) {</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        <span class="comment">// get volume of gun (or for auxiliary gunmods the parent gun)</span></div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> *parent = <a class="code" href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">has_item</a>( obj ) ? <a class="code" href="classvisitable.html#a31e8c573cb6e4870cc005915efc103b3">find_parent</a>( obj ) : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> vol = ( parent ? parent-&gt;<a class="code" href="classitem.html#a686df014e8aa8bc4637883802d05f935">volume</a>() : obj.<a class="code" href="classitem.html#a686df014e8aa8bc4637883802d05f935">volume</a>() ) / 250_ml;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;<span class="comment">        /** @EFFECT_DRIVING reduces the inaccuracy penalty when using guns whilst driving */</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( vol - <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a> ), 1.0f ) * 20 );</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    }</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;<span class="comment">    /** @EFFECT_GUN improves usage of accurate weapons and sights */</span></div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;    <span class="keywordtype">double</span> avgSkill = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a> ) +</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;                                           <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( obj.<a class="code" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() ) ) / 2.0;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;    avgSkill = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( avgSkill, <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>( <a class="code" href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a> ) );</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    <span class="comment">// If the value is affected by the accuracy of the firearm itself,</span></div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <span class="comment">// then beginners will rely heavily on high-precision weapons, while experts are not.</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <span class="comment">// Obviously this is not true.</span></div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    <span class="comment">// So use a constant instead.</span></div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;    <span class="keywordflow">if</span>( obj.<a class="code" href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">gun_skill</a>() == <a class="code" href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a> ) {</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a>( avgSkill,</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;                              450 / get_option&lt; float &gt;( <span class="stringliteral">&quot;GUN_DISPERSION_DIVIDER&quot;</span> ) ) );</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( <a class="code" href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a>( avgSkill,</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;                              300 / get_option&lt; float &gt;( <span class="stringliteral">&quot;GUN_DISPERSION_DIVIDER&quot;</span> ) ) );</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;    }</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160; </div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <span class="keywordtype">float</span> disperation_mod = <a class="code" href="classCharacter.html#add870e576ff59aa6943af286576219e9">enchantment_cache</a>-&gt;modify_value( <a class="code" href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998ac3248d624360335e5425f9570bb48629">enchant_vals::mod::WEAPON_DISPERSION</a>,</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;                            1.0f );</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;    <span class="keywordflow">if</span>( disperation_mod != 1.0f ) {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">add_multiplier</a>( disperation_mod );</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;    }</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160; </div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;    <span class="comment">// Range is effectively four times longer when shooting unflagged/flagged guns underwater/out of water.</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">is_underwater</a>() != obj.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#acb6e90c0baf497df88a7a259edd77dc3">flag_UNDERWATER_GUN</a> ) ) {</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;        <span class="comment">// Adding dispersion for additional debuff</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">add_range</a>( 150 );</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;        dispersion.<a class="code" href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">add_multiplier</a>( 4 );</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    }</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160; </div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    <span class="keywordflow">return</span> dispersion;</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;}</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160; </div>
<div class="line"><a name="l02339"></a><span class="lineno"><a class="line" href="classCharacter.html#a64b5eefd36bce677403f1912c414f977"> 2339</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classCharacter.html#a64b5eefd36bce677403f1912c414f977">Character::gun_value</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;weap, <span class="keywordtype">int</span> ammo )<span class="keyword"> const</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    <span class="comment">// TODO: Mods</span></div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    <span class="comment">// TODO: Allow using a specified type of ammo rather than default or current</span></div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    <span class="keywordflow">if</span>( !weap.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a> ) {</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    }</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160; </div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;    <span class="keywordflow">if</span>( ammo &lt;= 0 || !<a class="code" href="classCharacter.html#afca93d0bd4fe00f5c087d4040cbf98ae">meets_requirements</a>( weap ) ) {</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;    }</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160; </div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    <span class="keyword">const</span> <a class="code" href="structislot__gun.html">islot_gun</a> &amp;<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> = *weap.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a623ec8243b1e599086fa3a23c3179370">gun</a>;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;    <a class="code" href="classstring__id.html">itype_id</a> ammo_type = <a class="code" href="classstring__id.html#a1b2100ed077789ba45aaf5081791b36c">itype_id::NULL_ID</a>();</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;    <span class="keywordflow">if</span>( !weap.<a class="code" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>().<a class="code" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;        ammo_type = weap.<a class="code" href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">ammo_current</a>();</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( weap.<a class="code" href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">magazine_current</a>() ) {</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;        ammo_type = weap.<a class="code" href="classitem.html#a5cc833f71e0454446fd0f877d24f6585">common_ammo_default</a>();</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( weap.<a class="code" href="classitem.html#adce43f2490a85e2dc212a26ce5ded4fc">is_magazine</a>() ) {</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;        ammo_type = weap.<a class="code" href="classitem.html#ab07d96e30c441a84435972df842f4c77">ammo_default</a>();</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !weap.<a class="code" href="classitem.html#a159a8d7dbb5135f556838aec5e223287">magazine_default</a>().<a class="code" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        ammo_type = <a class="code" href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a447b7147e84be512208dcc0995d67ebc">item</a>( weap.<a class="code" href="classitem.html#a159a8d7dbb5135f556838aec5e223287">magazine_default</a>() ).ammo_default();</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    }</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;    <span class="keyword">const</span> <a class="code" href="structitype.html">itype</a> *def_ammo_i = !ammo_type.<a class="code" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ?</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;                              <a class="code" href="classitem.html#a11cf8d500b6d8106302470dce5ca9177">item::find_type</a>( ammo_type ) :</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;                              <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160; </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    <a class="code" href="structdamage__instance.html">damage_instance</a> gun_damage = weap.<a class="code" href="classitem.html#af0ba40b31415b6f32050d014a501b4b1">gun_damage</a>();</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    <a class="code" href="classitem.html">item</a> tmp = weap;</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="keywordflow">if</span>( tmp.<a class="code" href="classitem.html#adce43f2490a85e2dc212a26ce5ded4fc">is_magazine</a>() || tmp.<a class="code" href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">magazine_current</a>() || tmp.<a class="code" href="classitem.html#a159a8d7dbb5135f556838aec5e223287">magazine_default</a>() ) {</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;        tmp.<a class="code" href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">ammo_set</a>( ammo_type );</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    }</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <span class="keywordtype">int</span> total_dispersion = <a class="code" href="classCharacter.html#a05331bfbde3df1348a870d987597d29a">get_weapon_dispersion</a>( tmp ).<a class="code" href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">max</a>() + tmp.<a class="code" href="classitem.html#afb76ea7bd94d06815e5ab68b520b2a19">sight_dispersion</a>( *this ).second;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160; </div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;    <span class="keywordflow">if</span>( def_ammo_i != <span class="keyword">nullptr</span> &amp;&amp; def_ammo_i-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a> ) {</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;        <span class="keyword">const</span> <a class="code" href="structislot__ammo.html">islot_ammo</a> &amp;def_ammo = *def_ammo_i-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>;</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;        gun_damage.<a class="code" href="structdamage__instance.html#ae17bfa13ed37fd55281fa769a152e941">add</a>( def_ammo.<a class="code" href="structcommon__ranged__data.html#a94254f1acb94261bb47c4b7aaa3b0c89">damage</a> );</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;        total_dispersion += def_ammo.<a class="code" href="structcommon__ranged__data.html#a497cd4533098e79f14f8a97fcec6ca1a">dispersion</a>;</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    }</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160; </div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;    <span class="keywordtype">float</span> damage_factor = gun_damage.<a class="code" href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">total_damage</a>();</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;    <span class="keywordflow">if</span>( damage_factor &gt; 0 &amp;&amp; !gun_damage.<a class="code" href="structdamage__instance.html#af81002fc0a5fafe2690d31403941d2d6">empty</a>() ) {</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        <span class="comment">// TODO: Multiple damage types</span></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;        damage_factor += 0.5f * gun_damage.<a class="code" href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_units</a>.front().res_pen;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    }</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160; </div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;    <span class="keywordtype">int</span> <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">move_cost</a> = <a class="code" href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a>( *<span class="keyword">this</span>, *weap.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a> );</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.clip != 0 &amp;&amp; <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.clip &lt; 10 ) {</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        <span class="comment">// TODO: RELOAD_ONE should get a penalty here</span></div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;        <span class="keywordtype">int</span> reload_cost = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.reload_time + <a class="code" href="classCharacter.html#aef9cb6bfa6f5446ffbdf160e18ffdb86">encumb</a>( <a class="code" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;hand_l&quot;</span> ) ) + <a class="code" href="classCharacter.html#aef9cb6bfa6f5446ffbdf160e18ffdb86">encumb</a>(</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;                              <a class="code" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;hand_r&quot;</span> ) );</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;        reload_cost /= <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.clip;</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;        <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">move_cost</a> += reload_cost;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    }</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160; </div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="comment">// &quot;Medium range&quot; below means 9 tiles, &quot;short range&quot; means 4</span></div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;    <span class="comment">// Those are guarantees (assuming maximum time spent aiming)</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; dispersion_thresholds = {{</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            <span class="comment">// Headshots all the time</span></div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;            { 0.0f, 5.0f },</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            <span class="comment">// Critical at medium range</span></div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;            { 100.0f, 4.5f },</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;            <span class="comment">// Critical at short range or good hit at medium</span></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;            { 200.0f, 3.5f },</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;            <span class="comment">// OK hits at medium</span></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;            { 300.0f, 3.0f },</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;            <span class="comment">// Point blank headshots</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;            { 450.0f, 2.5f },</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;            <span class="comment">// OK hits at short</span></div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;            { 700.0f, 1.5f },</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;            <span class="comment">// Glances at medium, criticals at point blank</span></div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;            { 1000.0f, 1.0f },</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;            <span class="comment">// Nothing guaranteed, pure gamble</span></div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;            { 2000.0f, 0.1f },</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        }</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;    };</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160; </div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; move_cost_thresholds = {{</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;            { 10.0f, 4.0f },</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;            { 25.0f, 3.0f },</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;            { 100.0f, 1.0f },</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;            { 500.0f, 0.5f },</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;        }</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    };</div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160; </div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="keywordtype">float</span> move_cost_factor = <a class="code" href="cata__utility_8cpp.html#a179b3f9b48b6d93e55bd110a79054d26">multi_lerp</a>( move_cost_thresholds, <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">move_cost</a> );</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160; </div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;    <span class="comment">// Penalty for dodging in melee makes the gun unusable in melee</span></div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;    <span class="comment">// Until NPCs get proper kiting, at least</span></div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;    <span class="keywordtype">int</span> melee_penalty = weap.<a class="code" href="classitem.html#a686df014e8aa8bc4637883802d05f935">volume</a>() / 250_ml - <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">skill_dodge</a> );</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;    <span class="keywordflow">if</span>( melee_penalty &lt;= 0 ) {</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;        <span class="comment">// Dispersion matters less if you can just use the gun in melee</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;        total_dispersion = std::min&lt;int&gt;( total_dispersion / move_cost_factor, total_dispersion );</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;    }</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160; </div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;    <span class="keywordtype">float</span> dispersion_factor = <a class="code" href="cata__utility_8cpp.html#a179b3f9b48b6d93e55bd110a79054d26">multi_lerp</a>( dispersion_thresholds, total_dispersion );</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160; </div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;    <span class="keywordtype">float</span> damage_and_accuracy = damage_factor * dispersion_factor;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160; </div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;    <span class="comment">// TODO: Some better approximation of the ability to keep on shooting</span></div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::vector&lt;std::pair&lt;float, float&gt;&gt; capacity_thresholds = {{</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;            { 1.0f, 0.5f },</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;            { 5.0f, 1.0f },</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;            { 10.0f, 1.5f },</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;            { 20.0f, 2.0f },</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;            { 50.0f, 3.0f },</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;        }</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;    };</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160; </div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;    <span class="comment">// How much until reload</span></div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;    <span class="keywordtype">float</span> capacity = <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.clip &gt; 0 ? std::min&lt;float&gt;( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.clip, ammo ) : ammo;</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;    <span class="comment">// How much until dry and a new weapon is needed</span></div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;    capacity += std::min&lt;float&gt;( 1.0, ammo / 20.0 );</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;    <span class="keywordtype">double</span> capacity_factor = <a class="code" href="cata__utility_8cpp.html#a179b3f9b48b6d93e55bd110a79054d26">multi_lerp</a>( capacity_thresholds, capacity );</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160; </div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;    <span class="keywordtype">double</span> <a class="code" href="classCharacter.html#a64b5eefd36bce677403f1912c414f977">gun_value</a> = damage_and_accuracy * capacity_factor;</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160; </div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2a784256c4603f053783c251704220cd0c">debugmode::DF_RANGED</a>,</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                   <span class="stringliteral">&quot;%s as gun: %.1f total, %.1f dispersion, %.1f damage, %.1f capacity&quot;</span>,</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                   weap.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a291870408701f0174d8c46b7f770fbaf">get_id</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>(), <a class="code" href="classCharacter.html#a64b5eefd36bce677403f1912c414f977">gun_value</a>, dispersion_factor, damage_factor,</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                   capacity_factor );</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0.0, <a class="code" href="classCharacter.html#a64b5eefd36bce677403f1912c414f977">gun_value</a> );</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;}</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160; </div>
<div class="line"><a name="l02463"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310"> 2463</a></span>&#160;<a class="code" href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a> <a class="code" href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310">target_ui::run</a>()</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;{</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp; !<a class="code" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">no_mana</a> &amp;&amp; !<a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#ab2631d5fc9da8a5ec04f7c3757e6c9f5">can_cast</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ) ) {</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;        <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#af0503012f1ff927cbb5ad126e39cb103">add_msg_if_player</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You don&#39;t have enough %s to cast this spell&quot;</span> ),</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                                <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#aeb55e6084337fb199e3cab09260ad916">energy_string</a>() );</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        <a class="code" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a2c1e0d2a430258c132cbdff827fc8e89">most_accurate_aiming_method_limit</a>( *<a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> );</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;    }</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160; </div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;    <span class="comment">// Load settings</span></div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = get_option&lt;bool&gt;( <span class="stringliteral">&quot;SNAP_TO_TARGET&quot;</span> );</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;        <span class="comment">// Due to how cluttered the display would become, disable it by default</span></div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;        <span class="comment">// unless aiming a single turret.</span></div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;        <a class="code" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> = <a class="code" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a>-&gt;size() == 1;</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;    }</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160; </div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;    <a class="code" href="classavatar.html">avatar</a> &amp;player_character = <a class="code" href="avatar_8h.html#a7fe2c1a3376948380f856732d4f34c5c">get_avatar</a>();</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;    <a class="code" href="classon__out__of__scope.html">on_out_of_scope</a> cleanup( [&amp;here, &amp;player_character]() {</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;        here.<a class="code" href="classmap.html#a7481e86917674a912940956719d2eaa3">invalidate_map_cache</a>( player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>().<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + player_character.<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;    } );</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160; </div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;    <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;game::draw_callback_t&gt;</a> target_ui_cb = make_shared_fast&lt;game::draw_callback_t&gt;(</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    [&amp;]() {</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;        <a class="code" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">draw_terrain_overlay</a>();</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;    } );</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;    <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;add_draw_callback( target_ui_cb );</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160; </div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;    <a class="code" href="classui__adaptor.html">ui_adaptor</a> <a class="code" href="namespaceui.html">ui</a>;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.on_screen_resize( [&amp;]( <a class="code" href="classui__adaptor.html">ui_adaptor</a> &amp; <a class="code" href="namespaceui.html">ui</a> ) {</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;        <a class="code" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">init_window_and_input</a>();</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        <a class="code" href="namespaceui.html">ui</a>.position_from_window( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    } );</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.mark_resize();</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160; </div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;    <a class="code" href="namespaceui.html">ui</a>.on_redraw( [&amp;]( <span class="keyword">const</span> <a class="code" href="classui__adaptor.html">ui_adaptor</a> &amp; ) {</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;        <a class="code" href="classtarget__ui.html#a93a478e95d201324548329f39a087208">draw_ui_window</a>();</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;    } );</div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160; </div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;    <span class="comment">// Handle multi-turn aiming</span></div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    std::string <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>;</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;    <span class="keywordtype">bool</span> attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    <span class="keywordtype">bool</span> reentered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;    <span class="keywordtype">bool</span> resume_critter = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> &amp;&amp; !<a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a59cdab2e147fa7c2d2d46b9440083e05">first_turn</a> ) {</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;        <span class="comment">// We were in this UI during previous turn...</span></div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        reentered = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        std::string act_data = <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#ae287f1e168ac9ea8cfc16f0f55d323ef">action</a>;</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;        <span class="keywordflow">if</span>( act_data == <span class="stringliteral">&quot;AIM&quot;</span> ) {</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;            <span class="comment">// ...and ran out of moves while aiming.</span></div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;            <span class="comment">// ...and selected &#39;aim and shoot&#39;, but ran out of moves.</span></div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;            <span class="comment">// So, skip retrieving input and go straight to the action.</span></div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = act_data;</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;            attack_was_confirmed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;        }</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;        <span class="comment">// Load state to keep the ui consistent across turns</span></div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;        <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a289353e8cf59d999c2e3db1db5d89f12">snap_to_target</a>;</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;        <a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#ab7b696d1eb458e907dbccf99a5dd54aa">shifting_view</a>;</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        resume_critter = <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a8f9b4001d182a0fc1ab4fdd8bd5b1507">aiming_at_critter</a>;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;    }</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160; </div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    <span class="comment">// Initialize cursor position</span></div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    <a class="code" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">update_target_list</a>();</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160; </div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a> &amp;&amp; <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a14fa61e3a66db776b55f75a6dba7f67d">abort_if_no_targets</a> &amp;&amp; <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.empty() ) {</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        <span class="comment">// this branch is taken when already shot once and re-entered</span></div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        <span class="comment">// aiming, if no targets are available we want to abort so</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;        <span class="comment">// players don&#39;t arrive at aiming ui with nothing to shoot at.</span></div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a064e415f122aefc25c29b9d3eee4fa4e">aborted</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>.clear();</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>;</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;    }</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> initial_dst = <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;    <span class="keywordflow">if</span>( reentered ) {</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">try_reacquire_target</a>( resume_critter, initial_dst ) ) {</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;            <span class="comment">// Target lost</span></div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;            attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        }</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;        initial_dst = <a class="code" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">choose_initial_target</a>();</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    }</div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( initial_dst );</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> != initial_dst ) {</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;        <span class="comment">// Our target moved out of range</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;    }</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aif_duration</a> &gt; <a class="code" href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">AIF_DURATION_LIMIT</a> ) {</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;            <span class="comment">// Break long (potentially infinite) aim-and-fire loop.</span></div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;            <span class="comment">// May happen if e.g. avatar tries to get &#39;precise&#39; shot while being</span></div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;            <span class="comment">// attacked by multiple zombies, which triggers dodges and corresponding aim loss.</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;            attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;        }</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a59cdab2e147fa7c2d2d46b9440083e05">first_turn</a> &amp;&amp; !<a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.empty() &amp;&amp; !<a class="code" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">prompt_friendlies_in_lof</a>() ) {</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;            <span class="comment">// A friendly creature moved into line of fire during aim-and-shoot,</span></div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;            <span class="comment">// and player decided to stop aiming</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear();</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;            attack_was_confirmed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;        }</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;        <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">acceptable_losses</a>.clear();</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.empty() ) {</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aif_duration</a> = 0;</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aif_duration</a> += 1;</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;        }</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;    }</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160; </div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;    <span class="comment">// Event loop!</span></div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;    <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">ExitCode</a> loop_exit_code;</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;    std::string timed_out_action;</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;    <span class="keywordtype">bool</span> skip_redraw = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;    <span class="keywordflow">for</span>( ;; <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.clear() ) {</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;        <span class="keywordflow">if</span>( !skip_redraw ) {</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;invalidate_main_ui_adaptor();</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            <a class="code" href="namespaceui__manager.html#ae38f3a918052ef286ee60daac47f52d4">ui_manager::redraw</a>();</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;        }</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;        skip_redraw = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160; </div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;        <span class="comment">// Wait for user input (or use value retrieved from activity)</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.empty() ) {</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;            <span class="keywordtype">int</span> <a class="code" href="input__enums_8h.html#af2ddbd916f900586e2430bb9e0bb9ea1a90272dda245ae1fb3cf197e91a8689dc">timeout</a> = get_option&lt;int&gt;( <span class="stringliteral">&quot;EDGE_SCROLL&quot;</span> );</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#a43aa2fcd42cabfd04056def8986bc927">handle_input</a>( <a class="code" href="input__enums_8h.html#af2ddbd916f900586e2430bb9e0bb9ea1a90272dda245ae1fb3cf197e91a8689dc">timeout</a> );</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        }</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160; </div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;        <span class="comment">// If an aiming mode is selected, use &quot;*_SHOT&quot; instead of &quot;FIRE&quot;</span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> &amp;&amp; <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;FIRE&quot;</span> &amp;&amp; <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;has_threshold ) {</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;action;</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        }</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160; </div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        <span class="comment">// Handle received input</span></div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">handle_cursor_movement</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>, skip_redraw ) ) {</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TOGGLE_SNAP_TO_TARGET&quot;</span> ) {</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            <a class="code" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">toggle_snap_to_target</a>();</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TOGGLE_TURRET_LINES&quot;</span> ) {</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;            <a class="code" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> = !<a class="code" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a>;</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TOGGLE_MOVE_CURSOR_VIEW&quot;</span> ) {</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;                <a class="code" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">toggle_snap_to_target</a>();</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;            }</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;            <a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = !<a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a>;</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;zoom_in&quot;</span> ) {</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;            <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;zoom_in();</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;            <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;mark_main_ui_adaptor_resize();</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;zoom_out&quot;</span> ) {</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;            <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;zoom_out();</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;            <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;mark_main_ui_adaptor_resize();</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;QUIT&quot;</span> ) {</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;            loop_exit_code = <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">ExitCode::Abort</a>;</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;SWITCH_MODE&quot;</span> ) {</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#af1178602a3d2f7e37c9dbebf22dd29a3">action_switch_mode</a>() ) {</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;                loop_exit_code = <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">ExitCode::Abort</a>;</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;            }</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;SWITCH_AMMO&quot;</span> ) {</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">action_switch_ammo</a>() ) {</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                loop_exit_code = <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">ExitCode::Reload</a>;</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;            }</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;FIRE&quot;</span> ) {</div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;            }</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;            <span class="keywordtype">bool</span> can_skip_confirm = <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp; <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#ad572a7c2376afa1bd84ca8ab9603ed2a">damage</a>( player_character ) &lt;= 0;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;            <span class="keywordflow">if</span>( !can_skip_confirm &amp;&amp; !<a class="code" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">confirm_non_enemy_target</a>() ) {</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;            }</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;            <a class="code" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;            loop_exit_code = <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">ExitCode::Fire</a>;</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;AIM&quot;</span> ) {</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;            }</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160; </div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;            <span class="comment">// No confirm_non_enemy_target here because we have not initiated the firing.</span></div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;            <span class="comment">// Aiming can be stopped / aborted at any time.</span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160; </div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">action_aim</a>() ) {</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                timed_out_action = <span class="stringliteral">&quot;AIM&quot;</span>;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                loop_exit_code = <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">ExitCode::Timeout</a>;</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;            }</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;STOPAIM&quot;</span> ) {</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;            }</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160; </div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;            <a class="code" href="classtarget__ui.html#a4924621b242d0938e9a03fcefdfa6a9d">action_drop_aim</a>();</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;AIMED_SHOT&quot;</span> || <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;CAREFUL_SHOT&quot;</span> || <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;PRECISE_SHOT&quot;</span> ) {</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            }</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160; </div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;            <span class="comment">// This action basically means &quot;Fire&quot; as well; the actual firing may be delayed</span></div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;            <span class="comment">// through aiming, but there is usually no means to abort it. Therefore we query now</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;            <span class="keywordflow">if</span>( !attack_was_confirmed &amp;&amp; !<a class="code" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">confirm_non_enemy_target</a>() ) {</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;            }</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160; </div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">action_aim_and_shoot</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) ) {</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;                loop_exit_code = <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">ExitCode::Fire</a>;</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                timed_out_action = <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                loop_exit_code = <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">ExitCode::Timeout</a>;</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;            }</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;        }</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;    } <span class="comment">// for(;;)</span></div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160; </div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;    <span class="keywordflow">switch</span>( loop_exit_code ) {</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">ExitCode::Abort</a>: {</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;            <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>.clear();</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || ( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">TargetMode::Reach</a> &amp;&amp; <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a> ) ) {</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;                <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a064e415f122aefc25c29b9d3eee4fa4e">aborted</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;            }</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;        }</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">ExitCode::Fire</a>: {</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> != <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997afd3508f354d330de0aaa9207ba65bf4e">TargetMode::SelectOnly</a> ) {</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                <span class="keywordtype">bool</span> harmful = !( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp; <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#ad572a7c2376afa1bd84ca8ab9603ed2a">damage</a>( player_character ) &lt;= 0 );</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                <a class="code" href="classtarget__ui.html#a50ee1e0b8e7d1141e4d6c2019fe6df39">on_target_accepted</a>( harmful );</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;            }</div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;        }</div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">ExitCode::Timeout</a>: {</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;            <span class="comment">// We&#39;ve ran out of moves, save UI state</span></div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">acceptable_losses</a> = <a class="code" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">list_friendlies_in_lof</a>();</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;            <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>.clear();</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#ae287f1e168ac9ea8cfc16f0f55d323ef">action</a> = timed_out_action;</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a289353e8cf59d999c2e3db1db5d89f12">snap_to_target</a> = <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a>;</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#ab7b696d1eb458e907dbccf99a5dd54aa">shifting_view</a> = <a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a>;</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a8f9b4001d182a0fc1ab4fdd8bd5b1507">aiming_at_critter</a> = !!<a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>;</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;        }</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">ExitCode::Reload</a>: {</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;            <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>.clear();</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a064e415f122aefc25c29b9d3eee4fa4e">aborted</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;            <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a5a65a1ad1452654bdf0ce924ba8dcf53">reload_requested</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;        }</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    }</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160; </div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>;</div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;}</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160; </div>
<div class="line"><a name="l02716"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7"> 2716</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">target_ui::init_window_and_input</a>()</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;{</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    std::string panel_type = <a class="code" href="classpanel__manager.html#a5acbe61fa6ec7eaf06ea15c80f14ebc6">panel_manager::get_manager</a>().<a class="code" href="classpanel__manager.html#a3f6290efcd5bca21c3cf44762bca2a91">get_current_layout_id</a>();</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <a class="code" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> = ( panel_type == <span class="stringliteral">&quot;compact&quot;</span> || panel_type == <span class="stringliteral">&quot;labels-narrow&quot;</span> );</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160; </div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    <span class="keywordtype">int</span> top = 0;</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="keywordtype">int</span> width;</div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="keywordtype">int</span> height;</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> ) {</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        <span class="comment">// Narrow layout removes the list of controls. This allows us</span></div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;        <span class="comment">// to have small window size and not suffer from it.</span></div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;        width = 34;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;        height = 24;</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        <a class="code" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;        width = 55;</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;        <a class="code" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> = <a class="code" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a> &lt; 41;</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;        <a class="code" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">tiny</a> = <a class="code" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a> &lt; 28;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;        <span class="keywordtype">bool</span> use_whole_sidebar = <a class="code" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a> &lt; 32;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        <span class="keywordflow">if</span>( use_whole_sidebar ) {</div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;            <span class="comment">// If we&#39;re extremely short on space, use the whole sidebar.</span></div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;            height = <a class="code" href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a>;</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ) {</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;            <span class="comment">// Cover up more low-value ui elements if we&#39;re tight on space.</span></div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;            height = 28;</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;            <span class="comment">// Go all out</span></div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;            height = 33;</div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        }</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;    }</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160; </div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;    <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> = <a class="code" href="namespacecatacurses.html#a576fd20080b8f49e27acf97af45b374b">catacurses::newwin</a>( height, width, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( <a class="code" href="output_8cpp.html#a000abea6447dfafd5f9b787aa6753609">TERMX</a> - width, top ) );</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160; </div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a> = <a class="code" href="classinput__context.html">input_context</a>( <span class="stringliteral">&quot;TARGET&quot;</span> );</div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#aec8e809c4ee9afcde858709e07b5f64b">set_iso</a>( <span class="keyword">true</span> );</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#a26d796fbe876b21a2d8b85eb5d59195f">register_directions</a>();</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;COORDINATE&quot;</span> );</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;SELECT&quot;</span> );</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;FIRE&quot;</span> );</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;NEXT_TARGET&quot;</span> );</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;PREV_TARGET&quot;</span> );</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;CENTER&quot;</span> );</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;TOGGLE_SNAP_TO_TARGET&quot;</span> );</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;HELP_KEYBINDINGS&quot;</span> );</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;QUIT&quot;</span> );</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;MOUSE_MOVE&quot;</span> );</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;zoom_out&quot;</span> );</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;zoom_in&quot;</span> );</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;TOGGLE_MOVE_CURSOR_VIEW&quot;</span> );</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a> &gt; 0 ) {</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;        <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;LEVEL_UP&quot;</span> );</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;        <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;LEVEL_DOWN&quot;</span> );</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160;    }</div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> || ( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">TargetMode::Reach</a> &amp;&amp;</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;            <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() &amp;&amp; <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">get_aim_types</a>( *relevant ).size() &gt; 1 ) ) {</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;SWITCH_MODE&quot;</span> );</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;            <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;SWITCH_AMMO&quot;</span> );</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        }</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160;    }</div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;        <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;AIM&quot;</span> );</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;        <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;STOPAIM&quot;</span> );</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160; </div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a> = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">get_aim_types</a>( *<a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> );</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="structaim__type.html">aim_type</a> &amp;<a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> : <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a> ) {</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a>.has_threshold ) {</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;                <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a>.action );</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;            }</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;        }</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin();</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin(); it != <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end(); ++it ) {</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classavatar.html#a98553758b9d158c58dd11c77d97ff55e">preferred_aiming_mode</a> == it-&gt;action ) {</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;                <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = it; <span class="comment">// default to persisted mode if possible</span></div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;            }</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        }</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    }</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;        <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">register_action</a>( <span class="stringliteral">&quot;TOGGLE_TURRET_LINES&quot;</span> );</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    }</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;}</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160; </div>
<div class="line"><a name="l02798"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0"> 2798</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">target_ui::handle_cursor_movement</a>( <span class="keyword">const</span> std::string &amp;<a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>, <span class="keywordtype">bool</span> &amp;skip_redraw )</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;{</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    std::optional&lt;tripoint&gt; mouse_pos;</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> shift_view_or_cursor = [<span class="keyword">this</span>]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; delta ) {</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;        <span class="keywordflow">if</span>( this-&gt;<a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> ) {</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;            this-&gt;<a class="code" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">set_view_offset</a>( this-&gt;<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> + delta );</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;            this-&gt;<a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> + delta );</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;        }</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;    };</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160; </div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;MOUSE_MOVE&quot;</span> || <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;TIMEOUT&quot;</span> ) {</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        <span class="comment">// Shift pos and/or view via edge scrolling</span></div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> edge_scroll = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;mouse_edge_scrolling_terrain( <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a> );</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;        <span class="keywordflow">if</span>( edge_scroll == <a class="code" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> ) {</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;            skip_redraw = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;MOUSE_MOVE&quot;</span> ) {</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;                edge_scroll *= 2;</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;            }</div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;                <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> + edge_scroll );</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;                <a class="code" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">set_view_offset</a>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> + edge_scroll );</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;            }</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        }</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <span class="keyword">const</span> std::optional&lt;tripoint&gt; delta = <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#a0acd9546d02155a0b3a270560f20713a">get_direction</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) ) {</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;        <span class="comment">// Shift view/cursor with directional keys</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;        shift_view_or_cursor( *delta );</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;SELECT&quot;</span> &amp;&amp;</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;               ( mouse_pos = <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#a78a04063aa3ae17a4597ee7dcc584bfa">get_coordinates</a>( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;w_terrain, <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;ter_view_p.xy() ) ) ) {</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160;        <span class="comment">// Set pos by clicking with mouse</span></div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;        mouse_pos-&gt;z = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>().<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;        <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( *mouse_pos );</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;LEVEL_UP&quot;</span> || <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;LEVEL_DOWN&quot;</span> ) {</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        <span class="comment">// Shift view/cursor up/down one z level</span></div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> delta = <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">tripoint</a>(</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;                             0,</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                             0,</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;                             <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;LEVEL_UP&quot;</span> ? 1 : -1</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;                         );</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;        shift_view_or_cursor( delta );</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;NEXT_TARGET&quot;</span> ) {</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160;        <a class="code" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">cycle_targets</a>( 1 );</div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;PREV_TARGET&quot;</span> ) {</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;        <a class="code" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">cycle_targets</a>( -1 );</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <span class="stringliteral">&quot;CENTER&quot;</span> ) {</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> ) {</div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;            <a class="code" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">set_view_offset</a>( <a class="code" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> );</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;            <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;        }</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;    }</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160; </div>
<div class="line"><a name="l02854"></a><span class="lineno"> 2854</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;}</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160; </div>
<div class="line"><a name="l02857"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42"> 2857</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">target_ui::set_cursor_pos</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;new_pos )</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160;{</div>
<div class="line"><a name="l02859"></a><span class="lineno"> 2859</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> == new_pos ) {</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;    }</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a> &amp;&amp; new_pos != <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160;        <span class="comment">// range == 0, no sense in moving cursor</span></div>
<div class="line"><a name="l02864"></a><span class="lineno"> 2864</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;    }</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160; </div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;    <span class="comment">// Make sure new position is valid or find a closest valid position</span></div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;    std::vector&lt;tripoint&gt; new_traj;</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> valid_pos = new_pos;</div>
<div class="line"><a name="l02870"></a><span class="lineno"> 2870</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;    <span class="keywordflow">if</span>( new_pos != <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;        <span class="comment">// On Z axis, make sure we do not exceed map boundaries</span></div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160;        valid_pos.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( valid_pos.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>, <a class="code" href="game__constants_8h.html#a3984a9476d1edc78e4e7b886a08d4d4b">OVERMAP_HEIGHT</a> );</div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;        <span class="comment">// Or current view range</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;        valid_pos.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( valid_pos.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a>, <a class="code" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a> ) + <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160; </div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;        new_traj = here.<a class="code" href="classmap.html#a0f73359be972a030063b4e84f770275e">find_clear_path</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, valid_pos );</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> == 1 ) {</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;            <span class="comment">// We should always be able to hit adjacent squares</span></div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a9d7b6c83d7cf9846d5f1b56e02d88268">square_dist</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, valid_pos ) &gt; 1 ) {</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160;                valid_pos = new_traj[0];</div>
<div class="line"><a name="l02882"></a><span class="lineno"> 2882</span>&#160;            }</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="line_8cpp.html#a40b9d88f6d95e646490329d0071ec931">trigdist</a> ) {</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( valid_pos ) &gt; <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;                <span class="comment">// Find the farthest point that is still in range</span></div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;                <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = new_traj.size(); i &gt; 0; i-- ) {</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( new_traj[i - 1] ) &lt;= <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;                        valid_pos = new_traj[i - 1];</div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;                    }</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;                }</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160; </div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                <span class="comment">// FIXME: due to a bug in map::find_clear_path (#39693),</span></div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160;                <span class="comment">//        returned trajectory is invalid in some cases.</span></div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;                <span class="comment">//        This bandaid stops us from exceeding range,</span></div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                <span class="comment">//        but does not fix the issue.</span></div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( valid_pos ) &gt; <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;                    <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Exceeded allowed range!&quot;</span> );</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;                    valid_pos = <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160;                }</div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;            }</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;            <a class="code" href="structtripoint.html">tripoint</a> delta = valid_pos - <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;            valid_pos = <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> + <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">tripoint</a>(</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                            <a class="code" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( delta.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, -<a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ),</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                            <a class="code" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( delta.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, -<a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ),</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;                            <a class="code" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( delta.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> )</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                        );</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;        }</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;        new_traj.push_back( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;    }</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160; </div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160;    <span class="keywordflow">if</span>( valid_pos == <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;        <span class="comment">// We don&#39;t need to move the cursor after all</span></div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( new_pos == valid_pos ) {</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        <span class="comment">// We can reuse new_traj</span></div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> = valid_pos;</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> = new_traj;</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160;        <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> = valid_pos;</div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;        <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> = here.<a class="code" href="classmap.html#a0f73359be972a030063b4e84f770275e">find_clear_path</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    }</div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160; </div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;        <a class="code" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">set_view_offset</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> - <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160;    }</div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160; </div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="comment">// Make player&#39;s sprite flip to face the current target</span></div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <a class="code" href="structpoint.html">point</a> d( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() - <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;is_tileset_isometric() ) {</div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        <span class="keywordflow">if</span>( d.<a class="code" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &gt; 0 ) {</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;            <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code" href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a21507b40c80068eda19865706fdc2403">FacingDirection::RIGHT</a>;</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( d.<a class="code" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &lt; 0 ) {</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;            <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code" href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a684d325a7303f52e64011467ff5c5758">FacingDirection::LEFT</a>;</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;        }</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        <span class="keywordflow">if</span>( d.<a class="code" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &gt;= 0 &amp;&amp; d.<a class="code" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> &gt;= 0 ) {</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;            <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code" href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a21507b40c80068eda19865706fdc2403">FacingDirection::RIGHT</a>;</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;        }</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        <span class="keywordflow">if</span>( d.<a class="code" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a> &lt;= 0 &amp;&amp; d.<a class="code" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> &lt;= 0 ) {</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;            <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code" href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a684d325a7303f52e64011467ff5c5758">FacingDirection::LEFT</a>;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;        }</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160;    }</div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160; </div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="comment">// Cache creature under cursor</span></div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> != <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;        <a class="code" href="classCreature.html">Creature</a> *cr = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;        <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( *cr ) ) {</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;            <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = cr;</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;            <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;        }</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;        <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;    }</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160; </div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;    <span class="comment">// Update mode-specific stuff</span></div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;        <a class="code" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">recalc_aim_turning_penalty</a>();</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160;        <span class="keywordflow">switch</span>( <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#ab26955ff4600c3a2855e6fe02dc0d216">shape</a>() ) {</div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca9e1b93b20faf4a4798c106c0db299473">spell_shape::blast</a>:</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;                <a class="code" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> = <a class="code" href="namespacespell__effect.html#a9e71032270fa0320ba243005a7b50a5f">spell_effect::spell_effect_blast</a>(</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;                                <a class="code" href="structspell__effect_1_1override__parameters.html">spell_effect::override_parameters</a>( *<a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>() ), <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca29d6fc960c94b5a330f850284e75ab1f">spell_shape::cone</a>:</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;                <a class="code" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> = <a class="code" href="namespacespell__effect.html#a7c43bcc07956a3d9de33c074d6507544">spell_effect::spell_effect_cone</a>(</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;                                <a class="code" href="structspell__effect_1_1override__parameters.html">spell_effect::override_parameters</a>( *<a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>() ), <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474">spell_shape::line</a>:</div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;                <a class="code" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> = <a class="code" href="namespacespell__effect.html#a867e7cee9db7df16c4334db9c0637501">spell_effect::spell_effect_line</a>(</div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;                                <a class="code" href="structspell__effect_1_1override__parameters.html">spell_effect::override_parameters</a>( *<a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>() ), <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;                <a class="code" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a>.clear();</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s does not have valid spell shape&quot;</span>, <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a7d44bdaf4c9faff438e6b30973d68615">id</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>() );</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;        }</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;        <a class="code" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">update_turrets_in_range</a>();</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;    }</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160; </div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;    <span class="comment">// Update UI controls &amp; colors</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;    <a class="code" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">update_status</a>();</div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160; </div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;}</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160; </div>
<div class="line"><a name="l02991"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36"> 2991</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">target_ui::on_range_ammo_changed</a>()</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;{</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;    <a class="code" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">update_status</a>();</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;    <a class="code" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">update_target_list</a>();</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;}</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160; </div>
<div class="line"><a name="l02997"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a"> 2997</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">target_ui::update_target_list</a>()</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;{</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> == 0 ) {</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;        <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.clear();</div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;    }</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160; </div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;    <span class="comment">// Get targets in range and sort them by distance (targets[0] is the closest)</span></div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160;    <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a> = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a7a1a328276dae4040ef931b5976d04ba">get_targetable_creatures</a>( <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a>, <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">TargetMode::Reach</a> );</div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;    std::sort( <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.begin(), <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.end(), [&amp;]( <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> * lhs, <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> * rhs ) {</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;        return rl_dist_exact( lhs-&gt;pos(), you-&gt;pos() ) &lt; rl_dist_exact( rhs-&gt;pos(), you-&gt;pos() );</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;    } );</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;}</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160; </div>
<div class="line"><a name="l03011"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e"> 3011</a></span>&#160;<a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">target_ui::choose_initial_target</a>()</div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;{</div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    <span class="comment">// Try previously targeted creature</span></div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> cr = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a15520bb61b6da84f9bd753fa43dcbabc">last_target</a>.lock();</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;    <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( *cr ) &amp;&amp; <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( cr-&gt;pos() ) &lt;= <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <span class="keywordflow">return</span> cr-&gt;pos();</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;    }</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160; </div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;    <span class="comment">// Try closest creature</span></div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.empty() ) {</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>[0]-&gt;pos();</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    }</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160; </div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;    <span class="comment">// Try closest practice target</span></div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;    <span class="keyword">const</span> std::vector&lt;tripoint&gt; nearby = <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> );</div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> target_spot = std::find_if( nearby.begin(), nearby.end(),</div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;    [<span class="keyword">this</span>, &amp;here]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; pt ) {</div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;        return here.tr_at( pt ).id == tr_practice_target &amp;&amp; this-&gt;you-&gt;sees( pt );</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;    } );</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;    <span class="keywordflow">if</span>( target_spot != nearby.end() ) {</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        <span class="keywordflow">return</span> *target_spot;</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;    }</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160; </div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    <span class="comment">// We&#39;ve got nothing.</span></div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;}</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160; </div>
<div class="line"><a name="l03039"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2"> 3039</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">target_ui::try_reacquire_target</a>( <span class="keywordtype">bool</span> critter, <a class="code" href="structtripoint.html">tripoint</a> &amp;new_dst )</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;{</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;    <span class="keywordflow">if</span>( critter ) {</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        <span class="comment">// Try to re-acquire the creature</span></div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;        <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> cr = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a15520bb61b6da84f9bd753fa43dcbabc">last_target</a>.lock();</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;        <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code" href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a>( *cr ) &amp;&amp; <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( cr-&gt;pos() ) &lt;= <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;            new_dst = cr-&gt;pos();</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;        }</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;    }</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160; </div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a>.has_value() ) {</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;        <span class="comment">// This shouldn&#39;t happen</span></div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;    }</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160; </div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;    <span class="comment">// Try to re-acquire target tile or tile where the target creature used to be</span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> local_lt = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a> );</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( local_lt ) &lt;= <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        new_dst = local_lt;</div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;        <span class="comment">// Abort aiming if a creature moved in</span></div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;        <span class="keywordflow">return</span> !critter &amp;&amp; !<a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( local_lt, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;    }</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160; </div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;    <span class="comment">// We moved out of range</span></div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;}</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160; </div>
<div class="line"><a name="l03067"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f"> 3067</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">target_ui::update_status</a>()</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;{</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    std::vector&lt;std::string&gt; msgbuf;</div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> &amp;&amp; <a class="code" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.empty() ) { <span class="comment">// NOLINT(bugprone-branch-clone)</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;        <span class="comment">// None of the turrets are in range</span></div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;        <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">Status::OutOfRange</a>;</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> &amp;&amp;</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;               ( !<a class="code" href="ranged_8cpp.html#a18e93476c9d626924c31cf14193305b3">gunmode_checks_common</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>(), msgbuf, <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>() ) ||</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;                 !<a class="code" href="ranged_8cpp.html#a207024a5d17769a16bfc8a7a434d72cd">gunmode_checks_weapon</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>(), msgbuf, <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>() ) )</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;             ) { <span class="comment">// NOLINT(bugprone-branch-clone)</span></div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;        <span class="comment">// Selected gun mode is empty</span></div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;        <span class="comment">// TODO: it might be some other error, but that&#39;s highly unlikely to happen, so a catch-all &#39;Out of ammo&#39; is fine</span></div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;        <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a>;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> &amp;&amp; ( <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#a585d18f2c33116bc1e9028210fccadbc">query</a>() != <a class="code" href="classturret__data.html#a3a01d6f45d3f23cf6b5a32c5e17440b7ab2fdab230a2c39f3595a947861863cb7">turret_data::status::ready</a> ||</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;               !<a class="code" href="ranged_8cpp.html#a18e93476c9d626924c31cf14193305b3">gunmode_checks_common</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>(), msgbuf, <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>() ) ) ) {</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;        <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a>;</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> == <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) &amp;&amp; !( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp;</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;                                    <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#adc1aee8fd855fce28ebb1dcc39e37a12">is_valid_target</a>( <a class="code" href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a590f53e8699817c6fa498cc11a4cbe63">spell_target::self</a> ) ) ) {</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;        <span class="comment">// TODO: consider allowing targeting yourself with turrets</span></div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408">Status::BadTarget</a>;</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) &gt; <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> ) {</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;        <span class="comment">// We&#39;re out of range. This can happen if we switch from long-ranged</span></div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;        <span class="comment">// gun mode to short-ranged. We can, of course, move the cursor into range automatically,</span></div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        <span class="comment">// but that would be rude. Instead, wait for directional keys/etc. and *then* move the cursor.</span></div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160;        <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">Status::OutOfRange</a>;</div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;        <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> = <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a>;</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160;    }</div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;}</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160; </div>
<div class="line"><a name="l03097"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9"> 3097</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">target_ui::dist_fn</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p )</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;{</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">std::round</a>( <a class="code" href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, p ) ) );</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;}</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160; </div>
<div class="line"><a name="l03102"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b"> 3102</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">target_ui::set_last_target</a>()</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;{</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a>.has_value() || <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a>.value() != <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().getabs( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) ) {</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;        <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classavatar.html#a8344dc1c4b8cd02a9633f3275cc69a2d">aim_cache_dirty</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;    }</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;    <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a> = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a501f3a1d449ac022f1b36b99da653e94">getabs</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) {</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;        <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a15520bb61b6da84f9bd753fa43dcbabc">last_target</a> = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( *<a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> );</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;        <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a15520bb61b6da84f9bd753fa43dcbabc">last_target</a>.reset();</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;    }</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;}</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160; </div>
<div class="line"><a name="l03115"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014"> 3115</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">target_ui::confirm_non_enemy_target</a>()</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;{</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;    <span class="comment">// Check if you are casting a spell at yourself.</span></div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> &amp;&amp; ( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> == <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> || <a class="code" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a>.count( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) == 1 ) ) {</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="output_8cpp.html#ab62599a77867b8f416669b92f60f4900">query_yn</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Really attack yourself?&quot;</span> ) ) ) {</div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;        }</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;    }</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;    <a class="code" href="classnpc.html">npc</a> *<span class="keyword">const</span> who = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> );</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;    <span class="keywordflow">if</span>( who &amp;&amp; !who-&gt;<a class="code" href="classnpc.html#adc0b90f197e58b09eb6eb92132d432f0">guaranteed_hostile</a>() ) {</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="output_8cpp.html#ab62599a77867b8f416669b92f60f4900">query_yn</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Really attack %s?&quot;</span> ), who-&gt;<a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>().c_str() );</div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;    }</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;}</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160; </div>
<div class="line"><a name="l03130"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84"> 3130</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">target_ui::prompt_friendlies_in_lof</a>()</div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;{</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> != <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Not implemented&quot;</span> );</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;    }</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160; </div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;    std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; in_lof = <a class="code" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">list_friendlies_in_lof</a>();</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160;    std::vector&lt;Creature *&gt; new_in_lof;</div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;cr_ptr : in_lof ) {</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;        <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        <a class="code" href="classCreature.html">Creature</a> *cr = cr_ptr.lock().get();</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;cr2_ptr : <a class="code" href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">activity</a>-&gt;<a class="code" href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">acceptable_losses</a> ) {</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;            <a class="code" href="classCreature.html">Creature</a> *cr2 = cr2_ptr.lock().get();</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;            <span class="keywordflow">if</span>( cr == cr2 ) {</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;                found = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160;            }</div>
<div class="line"><a name="l03148"></a><span class="lineno"> 3148</span>&#160;        }</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;        <span class="keywordflow">if</span>( !found ) {</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;            new_in_lof.push_back( cr );</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        }</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    }</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160; </div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    <span class="keywordflow">if</span>( new_in_lof.empty() ) {</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;    }</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160; </div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;    std::string msg = <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;There are friendly creatures in line of fire:\n&quot;</span> );</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classCreature.html">Creature</a> *cr : new_in_lof ) {</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160;        msg += <span class="stringliteral">&quot;  &quot;</span> + cr-&gt;disp_name() + <span class="stringliteral">&quot;\n&quot;</span>;</div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    }</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    msg += <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Proceed with the attack?&quot;</span> );</div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="output_8cpp.html#ab62599a77867b8f416669b92f60f4900">query_yn</a>( msg );</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;}</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160; </div>
<div class="line"><a name="l03166"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6"> 3166</a></span>&#160;std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; <a class="code" href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">target_ui::list_friendlies_in_lof</a>()</div>
<div class="line"><a name="l03167"></a><span class="lineno"> 3167</span>&#160;{</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;    std::vector&lt;weak_ptr_fast&lt;Creature&gt;&gt; <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Not implemented&quot;</span> );</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;    }</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    <a class="code" href="classcreature__tracker.html">creature_tracker</a> &amp;creatures = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>();</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p : <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> ) {</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;        <span class="keywordflow">if</span>( p != <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> &amp;&amp; p != <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;            <a class="code" href="classCreature.html">Creature</a> *cr = creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( p, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;            <span class="keywordflow">if</span>( cr &amp;&amp; <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *cr ) ) {</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160;                <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217">Creature::Attitude</a> <a class="code" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> = cr-&gt;<a class="code" href="classCreature.html#a5698402eb4d7bbb013213f11f5768c92">attitude_to</a>( *this-&gt;<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> );</div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;                <span class="keywordflow">if</span>(</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;                    ( cr-&gt;<a class="code" href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">is_npc</a>() &amp;&amp; <a class="code" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> != <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747">Creature::Attitude::HOSTILE</a> ) ||</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;                    ( !cr-&gt;<a class="code" href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">is_npc</a>() &amp;&amp; <a class="code" href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a> == <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217af6a34a956d1ce0a552bf4731b9f9d9c0">Creature::Attitude::FRIENDLY</a> )</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;                ) {</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160;                    <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( *cr ) );</div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;                }</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;            }</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;        }</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    }</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;}</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160; </div>
<div class="line"><a name="l03191"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5"> 3191</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">target_ui::toggle_snap_to_target</a>()</div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;{</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;    <a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> ) {</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;        <span class="comment">// Keep current view offset</span></div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;        <a class="code" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">set_view_offset</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> - <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> );</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160;    }</div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    <a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a> = !<a class="code" href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">snap_to_target</a>;</div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;}</div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160; </div>
<div class="line"><a name="l03202"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c"> 3202</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">target_ui::cycle_targets</a>( <span class="keywordtype">int</span> <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> )</div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;{</div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.empty() ) {</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;        <span class="comment">// Nothing to cycle</span></div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    }</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160; </div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) {</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160;        <span class="keyword">auto</span> t = std::find( <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.begin(), <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.end(), <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> );</div>
<div class="line"><a name="l03211"></a><span class="lineno"> 3211</span>&#160;        <span class="keywordtype">size_t</span> new_target = 0;</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;        <span class="keywordflow">if</span>( t != <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.end() ) {</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;            <span class="keywordtype">size_t</span> idx = std::distance( <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.begin(), t );</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;            new_target = ( idx + <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.size() + <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> ) % <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.size();</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;            <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>[new_target]-&gt;<a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a>() );</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;        }</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160;    }</div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160; </div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;    <span class="comment">// There is either no creature under the cursor or the player can&#39;t see it.</span></div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160;    <span class="comment">// Use the closest/farthest target in this case</span></div>
<div class="line"><a name="l03222"></a><span class="lineno"> 3222</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> == 1 ) {</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;        <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.front()-&gt;pos() );</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;        <a class="code" href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">set_cursor_pos</a>( <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.back()-&gt;pos() );</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    }</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;}</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160; </div>
<div class="line"><a name="l03229"></a><span class="lineno"><a class="line" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d"> 3229</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">target_ui::set_view_offset</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;new_offset )<span class="keyword"> const</span></div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> new_( new_offset.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), <a class="code" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( new_offset.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a>, <a class="code" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a> ) );</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160;    new_.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code" href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a>( new_.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, -<a class="code" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>, <a class="code" href="game__constants_8h.html#a3984a9476d1edc78e4e7b886a08d4d4b">OVERMAP_HEIGHT</a> ) - <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160; </div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;    <span class="keywordtype">bool</span> changed_z = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> != new_.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>;</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;    <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a> = new_;</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160;    <span class="keywordflow">if</span>( changed_z ) {</div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;        <span class="comment">// We need to do a bunch of cache updates since we&#39;re</span></div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;        <span class="comment">// looking at a different z-level.</span></div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a7481e86917674a912940956719d2eaa3">invalidate_map_cache</a>( new_.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160;    }</div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;}</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160; </div>
<div class="line"><a name="l03243"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef"> 3243</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">target_ui::update_turrets_in_range</a>()</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;{</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160;    <a class="code" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.clear();</div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structvehicle__part.html">vehicle_part</a> *t : *<a class="code" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a> ) {</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <a class="code" href="classturret__data.html">turret_data</a> td = <a class="code" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">veh</a>-&gt;<a class="code" href="classvehicle.html#accfab81af66cd979bdfff4c39e5a3a8e">turret_query</a>( *t );</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;        <span class="keywordflow">if</span>( td.<a class="code" href="classturret__data.html#ad8b9e08531f26de34c61d5821ca69d7c">in_range</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) ) {</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> = <a class="code" href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">veh</a>-&gt;<a class="code" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( *t );</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            <a class="code" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.push_back( {t, <a class="code" href="coordinates_8h.html#a31847b31c6ef002e9d16afd7fd0005e3">line_to</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> )} );</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;        }</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;    }</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;}</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160; </div>
<div class="line"><a name="l03255"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5"> 3255</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">target_ui::recalc_aim_turning_penalty</a>()</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;{</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    <span class="comment">// since we are recalcing recoil dirty the aimm cache</span></div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160;    <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classavatar.html#a8344dc1c4b8cd02a9633f3275cc69a2d">aim_cache_dirty</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160; </div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160;        <span class="comment">// We don&#39;t care about invalid situations</span></div>
<div class="line"><a name="l03262"></a><span class="lineno"> 3262</span>&#160;        <a class="code" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    }</div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160; </div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;    <span class="keywordtype">double</span> curr_recoil = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a>;</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> curr_recoil_pos;</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;    <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> *lt_ptr = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a15520bb61b6da84f9bd753fa43dcbabc">last_target</a>.lock().get();</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;    <span class="keywordflow">if</span>( lt_ptr ) {</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;        curr_recoil_pos = lt_ptr-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a> ) {</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;        curr_recoil_pos = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">last_target_pos</a> );</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;        curr_recoil_pos = <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>;</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;    }</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160; </div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;    <span class="keywordflow">if</span>( curr_recoil_pos == <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        <span class="comment">// We&#39;re aiming at that point right now, no penalty</span></div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;        <a class="code" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = curr_recoil;</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( curr_recoil_pos == <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;        <span class="comment">// The player wasn&#39;t aiming anywhere, max it out</span></div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;        <a class="code" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;        <span class="comment">// Raise it proportionally to how much</span></div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;        <span class="comment">// the player has to turn from previous aiming point</span></div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;        <span class="comment">// the player loses their aim more quickly if less skilled, normalizing at 5 skill.</span><span class="comment"></span></div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;<span class="comment">        /** @EFFECT_GUN increases the penalty for reorienting aim while below 5 */</span></div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> skill_penalty = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0.0, 5.0 - <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a> ) );</div>
<div class="line"><a name="l03289"></a><span class="lineno"> 3289</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> recoil_per_degree = skill_penalty * <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> / 180.0;</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::angle</a> angle_curr = <a class="code" href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, curr_recoil_pos );</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::angle</a> angle_desired = <a class="code" href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::angle</a> phi = <a class="code" href="units__utility_8cpp.html#a1e30191582247e71dd6bca985f5fba36">normalize</a>( angle_curr - angle_desired );</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::angle</a> <a class="code" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( phi, 360.0_degrees - phi );</div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;        <a class="code" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a> =</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;            <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>, curr_recoil + <a class="code" href="namespaceunits.html#a9ce2bc1618fa4acf9f9e98effd9f1ae0">to_degrees</a>( <a class="code" href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">angle</a> ) * recoil_per_degree );</div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;    }</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;}</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160; </div>
<div class="line"><a name="l03299"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aa81de937ba74331a08f3ef8e049a3c28"> 3299</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#aa81de937ba74331a08f3ef8e049a3c28">target_ui::apply_aim_turning_penalty</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;    <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">predicted_recoil</a>;</div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;}</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160; </div>
<div class="line"><a name="l03304"></a><span class="lineno"><a class="line" href="classtarget__ui.html#af1178602a3d2f7e37c9dbebf22dd29a3"> 3304</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#af1178602a3d2f7e37c9dbebf22dd29a3">target_ui::action_switch_mode</a>()</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;{</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;    <a class="code" href="classuilist.html">uilist</a> menu;</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;    menu.<a class="code" href="classuilist.html#a5ed3c6e3829c033040fa9f11f1a7d0aa">settext</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Select preferences&quot;</span> ) );</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;    <span class="keyword">const</span> std::pair&lt;int, int&gt; aim_modes_range = std::make_pair( 0, 100 );</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;    <span class="keyword">const</span> std::pair&lt;int, int&gt; firing_modes_range = std::make_pair( 100, 200 );</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160; </div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.empty() ) {</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;        menu.<a class="code" href="classuilist.html#a18fd9765355d9e418bc2c399048e0645">addentry</a>( -1, <span class="keyword">false</span>, 0, <span class="stringliteral">&quot;  &quot;</span> + std::string( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Default aiming mode&quot;</span> ) ) );</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;        menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().force_color = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;        menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code" href="color_8h.html#a95b67111e2e4be7fcac981d2b7b208f6">c_cyan</a>;</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160; </div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin(); it != <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end(); ++it ) {</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> is_active_aim_mode = <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> == it;</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;            <span class="keyword">const</span> std::string text = ( it-&gt;name.empty() ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Immediate&quot;</span> ) : it-&gt;name ) +</div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;                                     ( is_active_aim_mode ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot; (active)&quot;</span> ) : <span class="stringliteral">&quot;&quot;</span> );</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            menu.<a class="code" href="classuilist.html#a18fd9765355d9e418bc2c399048e0645">addentry</a>( aim_modes_range.first + std::distance( <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin(), it ),</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;                           <span class="keyword">true</span>, <a class="code" href="ui_8h.html#a06d5f3667ed71fa40939c4e7367e30ce">MENU_AUTOASSIGN</a>, text );</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;            <span class="keywordflow">if</span>( is_active_aim_mode ) {</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a>;</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;            }</div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;        }</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;    }</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160; </div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;    <span class="keyword">const</span> std::map&lt;gun_mode_id, gun_mode&gt; gun_modes = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">gun_all_modes</a>();</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;    <span class="keywordflow">if</span>( !gun_modes.empty() ) {</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;        menu.<a class="code" href="classuilist.html#a18fd9765355d9e418bc2c399048e0645">addentry</a>( -1, <span class="keyword">false</span>, 0, <span class="stringliteral">&quot;  &quot;</span> + std::string( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Firing mode&quot;</span> ) ) );</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;        menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().force_color = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;        menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code" href="color_8h.html#a95b67111e2e4be7fcac981d2b7b208f6">c_cyan</a>;</div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160; </div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">auto</span> it = gun_modes.begin(); it != gun_modes.end(); ++it ) {</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> active_gun_mode = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a3b83c2e0d1313b542801169382be1605">gun_get_mode_id</a>() == it-&gt;first;</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160; </div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            <span class="comment">// If gun mode is from a gunmod use gunmod&#39;s name, pay attention to the &quot;-&gt;&quot; on tname</span></div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            std::string text = ( it-&gt;second.target == <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> )</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;                               ? it-&gt;second.tname()</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;                               : it-&gt;second-&gt;tname() + <span class="stringliteral">&quot; (&quot;</span> + <a class="code" href="calendar_8cpp.html#abf1cdb8f4662bf96c8d762e9229df8d9">std::to_string</a>( it-&gt;second.qty ) + <span class="stringliteral">&quot;)&quot;</span>;</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160; </div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;            text += ( active_gun_mode ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot; (active)&quot;</span> ) : <span class="stringliteral">&quot;&quot;</span> );</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160; </div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;            menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.emplace_back( firing_modes_range.first + <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( std::distance(</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;                                           gun_modes.begin(), it ) ),</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;                                       <span class="keyword">true</span>, <a class="code" href="ui_8h.html#a06d5f3667ed71fa40939c4e7367e30ce">MENU_AUTOASSIGN</a>, text );</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;            <span class="keywordflow">if</span>( active_gun_mode ) {</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;                menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.back().text_color = <a class="code" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a>;</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;                <span class="keywordflow">if</span>( menu.<a class="code" href="classuilist.html#ab0890d56d6d29dd98a0b3f17bb3ebba3">selected</a> == 0 ) {</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;                    menu.<a class="code" href="classuilist.html#ab0890d56d6d29dd98a0b3f17bb3ebba3">selected</a> = menu.<a class="code" href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">entries</a>.size() - 1;</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;                }</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;            }</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;        }</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;    }</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160; </div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;    menu.<a class="code" href="group__UI.html#ga7604af7545244003f0a52ac87ce37979">query</a>();</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="namespacecatacurses.html#a7407bbe97af63fd80e0a4d26bf0274ab">refresh</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;    <span class="keywordflow">if</span>( menu.<a class="code" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> &gt;= firing_modes_range.first &amp;&amp; menu.<a class="code" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> &lt; firing_modes_range.second ) {</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;        <span class="comment">// gun mode select</span></div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;        <span class="keyword">const</span> std::map&lt;gun_mode_id, gun_mode&gt; all_gun_modes = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">gun_all_modes</a>();</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;        <span class="keywordtype">int</span> skip = menu.<a class="code" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> - firing_modes_range.first;</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const gun_mode_id, gun_mode&gt; &amp;it : all_gun_modes ) {</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;            <span class="keywordflow">if</span>( skip-- == 0 ) {</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code" href="classgun__mode.html#a29fb11a5199f83a9c5801bf2af6d99e9">melee</a>() ) {</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;                    <a class="code" href="namespacecatacurses.html#a7407bbe97af63fd80e0a4d26bf0274ab">refresh</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;                }</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;                <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#afcc181d2e2fe380ac28dd70f814798c2">gun_set_mode</a>( it.first );</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;            }</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;        }</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( menu.<a class="code" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> &gt;= aim_modes_range.first &amp;&amp; menu.<a class="code" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> &lt; aim_modes_range.second ) {</div>
<div class="line"><a name="l03372"></a><span class="lineno"> 3372</span>&#160;        <span class="comment">// aiming mode select</span></div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160;        <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin();</div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;        std::advance( <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>, menu.<a class="code" href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">ret</a> - aim_modes_range.first );</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;        <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classavatar.html#a98553758b9d158c58dd11c77d97ff55e">preferred_aiming_mode</a> = <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a>-&gt;action;</div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;    } <span class="comment">// else - just refresh</span></div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160; </div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;        <a class="code" href="classstring__id.html">itype_id</a> ammo_current = <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">ammo_current</a>();</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;        <span class="keywordflow">if</span>( ammo_current.<a class="code" href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">is_null</a>() ) {</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;            <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = 0;</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;            <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <a class="code" href="classitem.html#a11cf8d500b6d8106302470dce5ca9177">item::find_type</a>( ammo_current );</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;            <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">range</a>();</div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;        }</div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code" href="classgun__mode.html#a29fb11a5199f83a9c5801bf2af6d99e9">melee</a>() ) {</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;            <a class="code" href="namespacecatacurses.html#a7407bbe97af63fd80e0a4d26bf0274ab">refresh</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;            <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#adb2ea39327f1a8da37740b4bfb171a5d">current_reach_range</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> );</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;            <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code" href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">target</a>-&gt;<a class="code" href="classitem.html#a77cad1ee17273a24e50fe42e03eea269">gun_range</a>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> );</div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;            <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>().<a class="code" href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">target</a>-&gt;<a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>();</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;        }</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    }</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160; </div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;    <a class="code" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">on_range_ammo_changed</a>();</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacecatacurses.html#a7407bbe97af63fd80e0a4d26bf0274ab">refresh</a>;</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;}</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160; </div>
<div class="line"><a name="l03401"></a><span class="lineno"><a class="line" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d"> 3401</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">target_ui::action_switch_ammo</a>()</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;{</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;        <span class="comment">// For turrets that use vehicle tanks &amp; can fire multiple liquids</span></div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#af1938c9e7db9350ae08fef7a921f19c6">ammo_options</a>().size() &gt; 1 ) {</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> opts = <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#af1938c9e7db9350ae08fef7a921f19c6">ammo_options</a>();</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160;            <span class="keyword">auto</span> iter = opts.find( <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">ammo_current</a>() );</div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;            <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#a21fc6c32651797ffe152775d1b51687b">ammo_select</a>( ++iter != opts.end() ? *iter : *opts.begin() );</div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;            <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> = <a class="code" href="classitem.html#a11cf8d500b6d8106302470dce5ca9177">item::find_type</a>( <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">ammo_current</a>() );</div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;            <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> = <a class="code" href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">turret</a>-&gt;<a class="code" href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">range</a>();</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;        }</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        <span class="comment">// Leave aiming UI and open reloading UI since</span></div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;        <span class="comment">// reloading annihilates our aim anyway</span></div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;    }</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;    <a class="code" href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">on_range_ammo_changed</a>();</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;}</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160; </div>
<div class="line"><a name="l03421"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4"> 3421</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">target_ui::action_aim</a>()</div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;{</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;    <a class="code" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160;    <a class="code" href="classtarget__ui.html#aa81de937ba74331a08f3ef8e049a3c28">apply_aim_turning_penalty</a>();</div>
<div class="line"><a name="l03425"></a><span class="lineno"> 3425</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil = <a class="code" href="ranged_8cpp.html#a7ff8232af89fc85c44dee1cd0525f655">calculate_aim_cap</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = 0; i &lt; 10; ++i ) {</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;        <a class="code" href="ranged_8cpp.html#ae6e2f802cc8fb025d3dd4ada3da65c55">do_aim</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, *<a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>, min_recoil );</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;    }</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160; </div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160;    <span class="comment">// We&#39;ve changed pc.recoil, update penalty</span></div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;    <a class="code" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">recalc_aim_turning_penalty</a>();</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160; </div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#af3d3fb7cfb98cf3c36f0f0681414274a">get_moves</a>() &gt; 0;</div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;}</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160; </div>
<div class="line"><a name="l03436"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a4924621b242d0938e9a03fcefdfa6a9d"> 3436</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a4924621b242d0938e9a03fcefdfa6a9d">target_ui::action_drop_aim</a>()</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;{</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;    <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160; </div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160;    <span class="comment">// We&#39;ve changed pc.recoil, update penalty</span></div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    <a class="code" href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">recalc_aim_turning_penalty</a>();</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160; </div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160;}</div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160; </div>
<div class="line"><a name="l03446"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c"> 3446</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">target_ui::action_aim_and_shoot</a>( <span class="keyword">const</span> std::string &amp;<a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> )</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;{</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;    std::vector&lt;aim_type&gt;::iterator it;</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;    <span class="keywordflow">for</span>( it = <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin(); it != <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end(); it++ ) {</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == it-&gt;action ) {</div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        }</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;    }</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;    <span class="keywordflow">if</span>( it == <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.end() ) {</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Could not find a valid aim_type for %s&quot;</span>, <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a>.c_str() );</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160;        <a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> = <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.begin();</div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;    }</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;    <span class="keywordtype">int</span> aim_threshold = it-&gt;threshold;</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160;    <a class="code" href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">set_last_target</a>();</div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;    <a class="code" href="classtarget__ui.html#aa81de937ba74331a08f3ef8e049a3c28">apply_aim_turning_penalty</a>();</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> min_recoil = <a class="code" href="ranged_8cpp.html#a7ff8232af89fc85c44dee1cd0525f655">calculate_aim_cap</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;        <a class="code" href="ranged_8cpp.html#ae6e2f802cc8fb025d3dd4ada3da65c55">do_aim</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> ? *<a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> : <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>(), min_recoil );</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;    } <span class="keywordflow">while</span>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#af3d3fb7cfb98cf3c36f0f0681414274a">get_moves</a>() &gt; 0 &amp;&amp; <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &gt; aim_threshold &amp;&amp;</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160;             <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> - <a class="code" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> &gt; min_recoil );</div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160; </div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;    <span class="comment">// If we made it under the aim threshold, go ahead and fire.</span></div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;    <span class="comment">// Also fire if we&#39;re at our best aim level already.</span></div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;    <span class="comment">// If no critter is at dst then sight dispersion does not apply,</span></div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160;    <span class="comment">// so it would lock into an infinite loop.</span></div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    <span class="keywordtype">bool</span> done_aiming = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &lt;= aim_threshold || <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> - <a class="code" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a> &lt;= min_recoil ||</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;                       ( !<a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>().<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) &amp;&amp; <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &lt;= min_recoil );</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    <span class="keywordflow">return</span> done_aiming;</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;}</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160; </div>
<div class="line"><a name="l03476"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd"> 3476</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">target_ui::draw_terrain_overlay</a>()</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160;{</div>
<div class="line"><a name="l03478"></a><span class="lineno"> 3478</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a> = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() + <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">view_offset</a>;</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160; </div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;    <span class="comment">// Removes parts that don&#39;t belong to currently visible Z level</span></div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> filter_this_z = [&amp;<a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>]( <span class="keyword">const</span> std::vector&lt;tripoint&gt; &amp;<a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> ) {</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;        std::vector&lt;tripoint&gt; this_z = <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a>;</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;        this_z.erase( std::remove_if( this_z.begin(), this_z.end(),</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;        [&amp;<a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;            return p.z != center.z;</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;        } ), this_z.end() );</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;        <span class="keywordflow">return</span> this_z;</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;    };</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160; </div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;    <span class="comment">// FIXME: TILES version of g-&gt;draw_line helpfully draws a cursor at last point.</span></div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160;    <span class="comment">//        This creates a fake cursor if &#39;dst&#39; is on a z-level we cannot see.</span></div>
<div class="line"><a name="l03492"></a><span class="lineno"> 3492</span>&#160; </div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;    <span class="comment">// Draw approximate line of fire for each turret in range</span></div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> &amp;&amp; <a class="code" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a> ) {</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;        <span class="comment">// TODO: TILES version doesn&#39;t know how to draw more than 1 line at a time.</span></div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;        <span class="comment">//       We merge all lines together and draw them as a big malformed one</span></div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;        std::set&lt;tripoint&gt; points;</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtarget__ui_1_1turret__with__lof.html">turret_with_lof</a> &amp;it : <a class="code" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a> ) {</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160;            std::vector&lt;tripoint&gt; this_z = filter_this_z( it.line );</div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p : this_z ) {</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;                points.insert( p );</div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;            }</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;        }</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;        <span class="comment">// Since &quot;trajectory&quot; for each turret is just a straight line,</span></div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;        <span class="comment">// we can draw it even if the player can&#39;t see some parts</span></div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160;        points.erase( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ); <span class="comment">// Workaround for fake cursor on TILES</span></div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;        std::vector&lt;tripoint&gt; l( points.begin(), points.end() );</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z ) {</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;            <span class="comment">// Workaround for fake cursor bug on TILES</span></div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;            l.push_back( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;        }</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;        <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_line( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>, l, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    }</div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160; </div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    <span class="comment">// Draw trajectory</span></div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> != <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> &amp;&amp; <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> != <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> ) {</div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160;        std::vector&lt;tripoint&gt; this_z = filter_this_z( <a class="code" href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">traj</a> );</div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160; </div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;        <span class="comment">// Draw a highlighted trajectory only if we can see the endpoint.</span></div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;        <span class="comment">// Provides feedback to the player, but avoids leaking information</span></div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;        <span class="comment">// about tiles they can&#39;t see.</span></div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;        <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_line( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>, this_z );</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160;    }</div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160; </div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;    <span class="comment">// Since draw_line does nothing if destination is not visible,</span></div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    <span class="comment">// cursor also disappears. Draw it explicitly.</span></div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z ) {</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;        <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_cursor( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;    }</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160; </div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;    <span class="comment">// Draw spell AOE</span></div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;        <a class="code" href="structdrawsq__params.html">drawsq_params</a> params = <a class="code" href="structdrawsq__params.html">drawsq_params</a>().<a class="code" href="structdrawsq__params.html#ae80016e06fb7c6696a44fcf775374e3d">highlight</a>( <span class="keyword">true</span> ).<a class="code" href="structdrawsq__params.html#a85d5bbbff2bde51a2fdb0ac52036b1d1">center</a>( <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a> );</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;tile : <a class="code" href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">spell_aoe</a> ) {</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160;            <span class="keywordflow">if</span>( tile.z != <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z ) {</div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;            }</div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;<span class="preprocessor">#ifdef TILES</span></div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a> ) {</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;                <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;draw_highlight( tile );</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;                <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#ad189f4216a9eaacbf9c5aa0ceedaea18">drawsq</a>( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;w_terrain, tile, params );</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;<span class="preprocessor">#ifdef TILES</span></div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;            }</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;        }</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;    }</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;}</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160; </div>
<div class="line"><a name="l03551"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a93a478e95d201324548329f39a087208"> 3551</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a93a478e95d201324548329f39a087208">target_ui::draw_ui_window</a>()</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;{</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;    <span class="comment">// Clear target window and make it non-transparent.</span></div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;    <span class="keywordtype">int</span> width = <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;    <span class="keywordtype">int</span> height = <a class="code" href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">getmaxy</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> y = 0; y &lt; height; y++ ) {</div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> x = 0; x &lt; width; x++ ) {</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;            <a class="code" href="output_8cpp.html#afb5597c87a5847c7d64b878ab3a77d5b">mvwputch</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( x, y ), <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="charliteral">&#39; &#39;</span> );</div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;        }</div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;    }</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160; </div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;    <a class="code" href="output_8cpp.html#afea9968fcee47ebca0e45d27099d1c22">draw_border</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;    <a class="code" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">draw_window_title</a>();</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;    <a class="code" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">draw_help_notice</a>();</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160; </div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;    <span class="keywordtype">int</span> text_y = 1; <span class="comment">// Skip top border</span></div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160; </div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;    <a class="code" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">panel_cursor_info</a>( text_y );</div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;    text_y += <a class="code" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ? 0 : 1;</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160; </div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;        <a class="code" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">panel_gun_info</a>( text_y );</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;        <a class="code" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">panel_recoil</a>( text_y );</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;        text_y += <a class="code" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ? 0 : 1;</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        <a class="code" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">panel_spell_info</a>( text_y );</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;        text_y += <a class="code" href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">compact</a> ? 0 : 1;</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;    }</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160; </div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;    <span class="keywordtype">bool</span> fill_with_blank_if_no_target = !<a class="code" href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">tiny</a>;</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;    <a class="code" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">panel_target_info</a>( text_y, fill_with_blank_if_no_target );</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;    text_y++;</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160; </div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;        <a class="code" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">panel_turret_list</a>( text_y );</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ) {</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;        <span class="comment">// TODO: these are old, consider refactoring</span></div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;            text_y = <a class="code" href="ranged_8cpp.html#a0702c7984ec8768691cb9a805616d1de">print_aim</a>( *<span class="keyword">this</span>, *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, text_y, <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>, *<a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>(), <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> );</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">TargetMode::Throw</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a> ) {</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;            <span class="keywordtype">bool</span> blind = <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a>;</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;            <a class="code" href="ranged_8cpp.html#aad8bc17f1bcf65d90738d8d06460c91a">draw_throw_aim</a>( *<span class="keyword">this</span>, *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>, <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, text_y, <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>, *<a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, blind );</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;        }</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160;    }</div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160; </div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> ) {</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;        <a class="code" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">draw_controls_list</a>( text_y );</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;    }</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160; </div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160;    <a class="code" href="namespacecatacurses.html#aa9823d249c21fa50daf277957fabb175">wnoutrefresh</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;}</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160; </div>
<div class="line"><a name="l03603"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a5898f18e796130f0a4aa0b5099c7a4a0"> 3603</a></span>&#160;<a class="code" href="structaim__type.html">aim_type</a> <a class="code" href="classtarget__ui.html#a5898f18e796130f0a4aa0b5099c7a4a0">target_ui::get_selected_aim_type</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;    <span class="keywordflow">return</span> this-&gt;<a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> != this-&gt;<a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a>.cend() ? *( this-&gt;<a class="code" href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">aim_mode</a> ) : <a class="code" href="ranged_8cpp.html#aa68fa53ae2a9bc0bb461af10bec001fe">get_default_aim_type</a>();</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;}</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160; </div>
<div class="line"><a name="l03608"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a8606ff468dc8ac0fab74c239c455e2f7"> 3608</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classtarget__ui.html#a8606ff468dc8ac0fab74c239c455e2f7">target_ui::get_sight_dispersion</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">sight_dispersion</a>;</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;}</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160; </div>
<div class="line"><a name="l03613"></a><span class="lineno"><a class="line" href="classtarget__ui.html#aac34aeff88a5103d4af19a2ad067a677"> 3613</a></span>&#160;std::string <a class="code" href="classtarget__ui.html#aac34aeff88a5103d4af19a2ad067a677">target_ui::uitext_title</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;    <span class="keywordflow">switch</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> ) {</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a>:</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a>:</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Firing %s&quot;</span> ), <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">TargetMode::Throw</a>:</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Throwing %s&quot;</span> ), <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a>:</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Blind throwing %s&quot;</span> ), <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Set target&quot;</span> );</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;    }</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160;}</div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160; </div>
<div class="line"><a name="l03628"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a7f3d575ebc23cdd3a199a8c17579a225"> 3628</a></span>&#160;std::string <a class="code" href="classtarget__ui.html#a7f3d575ebc23cdd3a199a8c17579a225">target_ui::uitext_fire</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">TargetMode::Throw</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">TargetMode::ThrowBlind</a> ) {</div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="translation_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to throw&quot;</span>, <span class="stringliteral">&quot;to throw&quot;</span> ).<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">TargetMode::Reach</a> ) {</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="translation_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to attack&quot;</span>, <span class="stringliteral">&quot;to attack&quot;</span> ).<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">TargetMode::Spell</a> ) {</div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="translation_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to cast the spell&quot;</span>, <span class="stringliteral">&quot;to cast&quot;</span> ).<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="translation_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a>( <span class="stringliteral">&quot;[Hotkey] to fire&quot;</span>, <span class="stringliteral">&quot;to fire&quot;</span> ).<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;    }</div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;}</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160; </div>
<div class="line"><a name="l03641"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e"> 3641</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">target_ui::draw_window_title</a>()</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;{</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160;    <a class="code" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 2, 0 ), <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot;&lt; &quot;</span> );</div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;    <a class="code" href="output_8cpp.html#ab7abbbd98907f496533db9bc2a02cf4a">trim_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 4, 0 ), <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 7, <a class="code" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a>, <a class="code" href="classtarget__ui.html#aac34aeff88a5103d4af19a2ad067a677">uitext_title</a>() );</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;    <a class="code" href="output_8cpp.html#aedec608a42edd33ec812f7769a9ed0c9">wprintz</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot; &gt;&quot;</span> );</div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;}</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160; </div>
<div class="line"><a name="l03648"></a><span class="lineno"><a class="line" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38"> 3648</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">target_ui::draw_help_notice</a>()</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160;{</div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="keywordtype">int</span> text_y = <a class="code" href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">getmaxy</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 1;</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;    <span class="keywordtype">int</span> width = <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;    <span class="keyword">const</span> std::string label_help = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>(</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;                                       <a class="code" href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">narrow</a> ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] show help&quot;</span> ) : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] show all controls&quot;</span> ),</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160;                                       <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#abe76d2c284f2a277cbd2f367963fa9ab">get_desc</a>( <span class="stringliteral">&quot;HELP_KEYBINDINGS&quot;</span>, 1 ) );</div>
<div class="line"><a name="l03655"></a><span class="lineno"> 3655</span>&#160;    <span class="keywordtype">int</span> label_width = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <a class="code" href="catacharset_8cpp.html#af20ee33da59ccceb9f4c14005c0bbe80">utf8_width</a>( label_help ), width - 6 ); <span class="comment">// 6 for borders and &quot;&lt; &quot; + &quot; &gt;&quot;</span></div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;    <span class="keywordtype">int</span> text_x = width - label_width - 6;</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;    <a class="code" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( text_x + 1, text_y ), <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot;&lt; &quot;</span> );</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;    <a class="code" href="output_8cpp.html#ab7abbbd98907f496533db9bc2a02cf4a">trim_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( text_x + 3, text_y ), label_width, <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, label_help );</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    <a class="code" href="output_8cpp.html#aedec608a42edd33ec812f7769a9ed0c9">wprintz</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>, <span class="stringliteral">&quot; &gt;&quot;</span> );</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160;}</div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160; </div>
<div class="line"><a name="l03662"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7"> 3662</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">target_ui::draw_controls_list</a>( <span class="keywordtype">int</span> text_y )</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;{</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;    <span class="comment">// Change UI colors for visual feedback</span></div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;    <span class="comment">// TODO: Colorize keys inside brackets to be consistent with other UI windows</span></div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> col_enabled = <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>;</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> col_disabled = <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> col_move = ( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> != <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a> ? col_enabled : col_disabled );</div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> col_fire = ( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">Status::Good</a> ? col_enabled : col_disabled );</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160; </div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;    <span class="comment">// Get first key bound to given action OR &#39; &#39; if there are none.</span></div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> bound_key = [<span class="keyword">this</span>]( <span class="keyword">const</span> std::string &amp; s ) {</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160;        <span class="keyword">const</span> std::vector&lt;input_event&gt; keys = this-&gt;<a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#a1cd0c2537bc31a2c039e1178efb2ffdc">keys_bound_to</a>( s, <span class="comment">/*maximum_modifier_count=*/</span>1 );</div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;        <span class="keywordflow">return</span> keys.empty() ? <a class="code" href="structinput__event.html">input_event</a>() : keys.front();</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;    };</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> colored = [col_enabled]( <a class="code" href="classnc__color.html">nc_color</a> <a class="code" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>, <span class="keyword">const</span> std::string &amp; s ) {</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a> == col_enabled ) {</div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;            <span class="comment">// col_enabled is the default one when printing</span></div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;            <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( s, <a class="code" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a> );</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;        }</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;    };</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160; </div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160;    <span class="keyword">struct </span><a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474">line</a> {</div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;        <span class="keywordtype">size_t</span> order; <span class="comment">// Lines with highest &#39;order&#39; are removed first</span></div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;        std::string str;</div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;    };</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;    std::vector&lt;line&gt; lines;</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160; </div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;    <span class="comment">// Compile full list</span></div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">shifting_view</a> ) {</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;        lines.push_back( {8, colored( col_move, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Shift view with directional keys&quot;</span> ) )} );</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;        lines.push_back( {8, colored( col_move, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Move cursor with directional keys&quot;</span> ) )} );</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;    }</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="input_8cpp.html#aceedd903724817bad81fbc03216ff125">is_mouse_enabled</a>() ) {</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160;        std::string <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa3734a903022249b3010be1897042568e">move</a> = <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Mouse: LMB: Target, Wheel: Cycle,&quot;</span> );</div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;        std::string <a class="code" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> = <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;RMB: Fire&quot;</span> );</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;        lines.push_back( {7, colored( col_move, <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa3734a903022249b3010be1897042568e">move</a> ) + <span class="stringliteral">&quot; &quot;</span> + colored( col_fire, <a class="code" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> )} );</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;    }</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;    {</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;        std::string cycle = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] Cycle targets;&quot;</span> ), <a class="code" href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">ctxt</a>.<a class="code" href="classinput__context.html#abe76d2c284f2a277cbd2f367963fa9ab">get_desc</a>( <span class="stringliteral">&quot;NEXT_TARGET&quot;</span>, 1 ) );</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;        std::string <a class="code" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] %s.&quot;</span> ), bound_key( <span class="stringliteral">&quot;FIRE&quot;</span> ).short_description(),</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160;                                          <a class="code" href="classtarget__ui.html#a7f3d575ebc23cdd3a199a8c17579a225">uitext_fire</a>() );</div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;        lines.push_back( {0, colored( col_move, cycle ) + <span class="stringliteral">&quot; &quot;</span> + colored( col_fire, <a class="code" href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a> )} );</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;    }</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;    {</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;        std::string text = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] target self; [%s] toggle snap-to-target&quot;</span> ),</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160;                                          bound_key( <span class="stringliteral">&quot;CENTER&quot;</span> ).short_description(),</div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;                                          bound_key( <span class="stringliteral">&quot;TOGGLE_SNAP_TO_TARGET&quot;</span> ).short_description() );</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;        lines.push_back( {3, colored( col_enabled, text )} );</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    }</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> ) {</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;        std::string aim_and_fire;</div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structaim__type.html">aim_type</a> &amp;e : <a class="code" href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">aim_types</a> ) {</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;            <span class="keywordflow">if</span>( e.has_threshold ) {</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;                aim_and_fire += <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;[%s] &quot;</span>, bound_key( e.action ).short_description() );</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;            }</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;        }</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160;        aim_and_fire += <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;to aim and fire.&quot;</span> );</div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160; </div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160;        std::string aim = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] to steady your aim.  (10 moves)&quot;</span> ),</div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;                                         bound_key( <span class="stringliteral">&quot;AIM&quot;</span> ).short_description() );</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160; </div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;        std::string dropaim = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] to stop aiming.&quot;</span> ),</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;                                             bound_key( <span class="stringliteral">&quot;STOPAIM&quot;</span> ).short_description() );</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160; </div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;        lines.push_back( {2, colored( col_fire, aim )} );</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;        lines.push_back( { 2, colored( col_fire, dropaim ) } );</div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;        lines.push_back( {4, colored( col_fire, aim_and_fire )} );</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;    }</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> || ( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">TargetMode::Reach</a> &amp;&amp;</div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;            <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() &amp;&amp; <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">get_aim_types</a>( *relevant ).size() &gt; 1 ) ) {</div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;        lines.push_back( {5, colored( col_enabled, <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] to switch firing modes.&quot;</span> ),</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;                                      bound_key( <span class="stringliteral">&quot;SWITCH_MODE&quot;</span> ).short_description() ) )</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;                         } );</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">TargetMode::Fire</a> || <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">TargetMode::TurretManual</a> ) {</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;            lines.push_back( { 6, colored( col_enabled, <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] to reload/switch ammo.&quot;</span> ),</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;                                           bound_key( <span class="stringliteral">&quot;SWITCH_AMMO&quot;</span> ).short_description() ) )</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;                             } );</div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;        }</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;    }</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> == <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;        <span class="keyword">const</span> std::string <a class="code" href="structlabel.html">label</a> = <a class="code" href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">draw_turret_lines</a></div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;                                  ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] Hide lines of fire&quot;</span> )</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;                                  : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;[%s] Show lines of fire&quot;</span> );</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;        lines.push_back( {1, colored( col_enabled, <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="structlabel.html">label</a>, bound_key( <span class="stringliteral">&quot;TOGGLE_TURRET_LINES&quot;</span> ).short_description() ) )} );</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;    }</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160; </div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;    <span class="comment">// Shrink the list until it fits</span></div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;    <span class="keywordtype">int</span> height = <a class="code" href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">getmaxy</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;    <span class="keywordtype">int</span> available_lines = height - text_y - 1; <span class="comment">// 1 for bottom border</span></div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;    <span class="keywordflow">if</span>( available_lines &lt;= 0 ) {</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;    }</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;    <span class="keywordflow">while</span>( lines.size() &gt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>( available_lines ) ) {</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;        lines.erase( std::max_element( lines.begin(), lines.end(), []( <span class="keyword">const</span> <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474">line</a> &amp; l1, <span class="keyword">const</span> <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474">line</a> &amp; l2 ) {</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;            return l1.order &lt; l2.order;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;        } ) );</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;    }</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160; </div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;    text_y = height - lines.size() - 1;</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474">line</a> &amp;l : lines ) {</div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;        <a class="code" href="classnc__color.html">nc_color</a> col = col_enabled;</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;        <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), col, col, l.str );</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;    }</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;}</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160; </div>
<div class="line"><a name="l03770"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962"> 3770</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">target_ui::panel_cursor_info</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a name="l03771"></a><span class="lineno"> 3771</span>&#160;{</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;    std::string label_range;</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a> == <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ) {</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160;        label_range = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Range: %d&quot;</span> ), <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> );</div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;        label_range = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Range: %d/%d&quot;</span> ), <a class="code" href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">dist_fn</a>( <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a> ), <a class="code" href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">range</a> );</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;    }</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">Status::OutOfRange</a> &amp;&amp; <a class="code" href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">mode</a> != <a class="code" href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">TargetMode::Turrets</a> ) {</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;        <span class="comment">// Since each turret has its own range, highlighting cursor</span></div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;        <span class="comment">// range with red would be misleading</span></div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;        label_range = <a class="code" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( label_range, <a class="code" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a> );</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;    }</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160; </div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160;    std::vector&lt;std::string&gt; labels;</div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;    labels.push_back( label_range );</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a> &gt; 0 ) {</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160;        labels.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Elevation: %d&quot;</span> ), <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) );</div>
<div class="line"><a name="l03788"></a><span class="lineno"> 3788</span>&#160;    }</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;    labels.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Targets: %d&quot;</span> ), <a class="code" href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">targets</a>.size() ) );</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160; </div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> col = <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;    <span class="keywordtype">int</span> width = <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> );</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160;    <span class="keywordtype">int</span> text_x = 1;</div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> std::string &amp;s : labels ) {</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;        <span class="keywordtype">int</span> x_left = width - text_x - 1;</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;        <span class="keywordtype">int</span> len = <a class="code" href="catacharset_8cpp.html#af20ee33da59ccceb9f4c14005c0bbe80">utf8_width</a>( s, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;        <span class="keywordflow">if</span>( len &gt; x_left ) {</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160;            text_x = 1;</div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;            text_y++;</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;        }</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160;        <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( text_x, text_y ), col, col, s );</div>
<div class="line"><a name="l03802"></a><span class="lineno"> 3802</span>&#160;        text_x += len + 1; <span class="comment">// 1 for space</span></div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;    }</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;    text_y++;</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;}</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160; </div>
<div class="line"><a name="l03807"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77"> 3807</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">target_ui::panel_gun_info</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;{</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;    <a class="code" href="classgun__mode.html">gun_mode</a> m = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>();</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;    std::string mode_name = m.<a class="code" href="classgun__mode.html#a583a586a605731dbd36af20553c0e51d">tname</a>();</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;    std::string gunmod_name;</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;    <span class="keywordflow">if</span>( m.<a class="code" href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">target</a> != <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a> ) {</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160;        <span class="comment">// Gun mode comes from a gunmod, not base gun. Add gunmod&#39;s name</span></div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;        gunmod_name = m-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() + <span class="stringliteral">&quot; &quot;</span>;</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;    }</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160;    std::string str = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Firing mode: &lt;color_cyan&gt;%s%s (%d)&lt;/color&gt;&quot;</span> ),</div>
<div class="line"><a name="l03817"></a><span class="lineno"> 3817</span>&#160;                                     gunmod_name, mode_name, m.<a class="code" href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">qty</a></div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;                                   );</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> clr = <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;    <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160; </div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">status</a> == <a class="code" href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">Status::OutOfAmmo</a> ) {</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;        <a class="code" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), <a class="code" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;OUT OF AMMO&quot;</span> ) );</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a> ) {</div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;        <span class="keywordtype">bool</span> is_favorite = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#a187a2679361c6546be613657dbad3b3f">is_ammo_container</a>() &amp;&amp; <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#ae92e7a0bc79eedb9b113fd7cbda37b57">first_ammo</a>().<a class="code" href="classitem.html#a05c24ca1052a7a8cb9fd314acdb49f40">is_favorite</a>;</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;        str = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( m-&gt;<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>() ? <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Ammo: %s%s (%d/%d)&quot;</span> ) : <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Ammo: %s%s&quot;</span> ),</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;                             <a class="code" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a>-&gt;<a class="code" href="structitype.html#ad35fbe0013544c1c396944b20b264421">nname</a>( <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( m-&gt;<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>(), 1 ) ), <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a>-&gt;<a class="code" href="structitype.html#af4d6fc9396d1e09f23d2008f974ac757">color</a> ),</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;                             <a class="code" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( is_favorite ? <span class="stringliteral">&quot; *&quot;</span> : <span class="stringliteral">&quot;&quot;</span>, <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a>-&gt;<a class="code" href="structitype.html#af4d6fc9396d1e09f23d2008f974ac757">color</a> ), m-&gt;<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>(),</div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;                             m-&gt;<a class="code" href="classitem.html#a084b8b7138242ba272d566bf49d007c3">ammo_capacity</a>( <a class="code" href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">ammo</a>-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;type ) );</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;        <span class="comment">// Weapon doesn&#39;t use ammunition</span></div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;        text_y++;</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;    }</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;}</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160; </div>
<div class="line"><a name="l03837"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183"> 3837</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">target_ui::panel_recoil</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;{</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> val = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">recoil_total</a>();</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> min_recoil = <a class="code" href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">relevant</a>-&gt;<a class="code" href="classitem.html#afb76ea7bd94d06815e5ab68b520b2a19">sight_dispersion</a>( *you ).second;</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> recoil_range = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a> - min_recoil;</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;    std::string str;</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;    <span class="keywordflow">if</span>( val &gt;= min_recoil + ( recoil_range * 2 / 3 ) ) {</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;        str = <a class="code" href="translations_8h.html#a46bdf4dff9d320938561cade1c9a5f7e">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_red&gt;High&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( val &gt;= min_recoil + ( recoil_range / 2 ) ) {</div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;        str = <a class="code" href="translations_8h.html#a46bdf4dff9d320938561cade1c9a5f7e">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_yellow&gt;Medium&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( val &gt;= min_recoil + ( recoil_range / 4 ) ) {</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;        str = <a class="code" href="translations_8h.html#a46bdf4dff9d320938561cade1c9a5f7e">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_light_green&gt;Low&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;        str = <a class="code" href="translations_8h.html#a46bdf4dff9d320938561cade1c9a5f7e">pgettext</a>( <span class="stringliteral">&quot;amount of backward momentum&quot;</span>, <span class="stringliteral">&quot;&lt;color_cyan&gt;None&lt;/color&gt;&quot;</span> );</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;    }</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;    str = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Recoil: %s&quot;</span> ), str );</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> clr = <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;    <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;}</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160; </div>
<div class="line"><a name="l03857"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb"> 3857</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">target_ui::panel_spell_info</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;{</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;    <a class="code" href="classnc__color.html">nc_color</a> clr = <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160; </div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;    <a class="code" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), <a class="code" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Casting: %s (Level %u)&quot;</span> ),</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;               <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#abdf34d5415c3fdafcd84fe3a7101bddb">name</a>(),</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;               <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a006cfd33c15f732b2463eda1ae0686cc">get_level</a>() );</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">no_mana</a> || <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a593232b1e5fc4c81d536724d40322efd">energy_source</a>() == <a class="code" href="magic_8h.html#aecee704c18d07f266d2b907c070bd7a1a334c4a4c42fdb79d7ebc3e73b517e6f8">magic_energy_type::none</a> ) {</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a593232b1e5fc4c81d536724d40322efd">energy_source</a>() == <a class="code" href="magic_8h.html#aecee704c18d07f266d2b907c070bd7a1ad2ccda10db94c2b5d51beed10484c025">magic_energy_type::hp</a> ) {</div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;            text_y += <a class="code" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y ), <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2,</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                                      clr,</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                                      <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Cost: %s %s&quot;</span> ), <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a0d3f68783edb1af2e111e85f7a1715fa">energy_cost_string</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ), <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#aeb55e6084337fb199e3cab09260ad916">energy_string</a>() );</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;            text_y += <a class="code" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y ), <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2,</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160;                                      clr,</div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160;                                      <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Cost: %s %s (Current: %s)&quot;</span> ), <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a0d3f68783edb1af2e111e85f7a1715fa">energy_cost_string</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ), <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#aeb55e6084337fb199e3cab09260ad916">energy_string</a>(),</div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;                                      <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a1dc2bd4fd1f177c091237236627bd993">energy_cur_string</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> ) );</div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;        }</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;    }</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160; </div>
<div class="line"><a name="l03877"></a><span class="lineno"> 3877</span>&#160;    std::string fail_str;</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">no_fail</a> ) {</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;        fail_str = <a class="code" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;0.0 % Failure Chance&quot;</span> ), <a class="code" href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a> );</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;        fail_str = <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#afe11a0854d38e947a10d02e29f7fd84c">colorized_fail_percent</a>( *<a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a> );</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160;    }</div>
<div class="line"><a name="l03883"></a><span class="lineno"> 3883</span>&#160;    <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), clr, clr, fail_str );</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160; </div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a63f22c8f5a1730ab6651342e9becbfdc">aoe</a>( <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>() ) &gt; 0 ) {</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;        <a class="code" href="classnc__color.html">nc_color</a> <a class="code" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a> = <a class="code" href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a>;</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;        <span class="keyword">const</span> std::string fx = <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#aa34fc8ebf8b820ac055f4b4dd9d78c35">effect</a>();</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160;        <span class="keyword">const</span> std::string aoes = <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a335dc296fd7e166be557e69dc6d9f147">aoe_string</a>( <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>() );</div>
<div class="line"><a name="l03889"></a><span class="lineno"> 3889</span>&#160;        <span class="keywordflow">if</span>( fx == <span class="stringliteral">&quot;attack&quot;</span> || fx == <span class="stringliteral">&quot;area_pull&quot;</span> || fx == <span class="stringliteral">&quot;area_push&quot;</span> || fx == <span class="stringliteral">&quot;ter_transform&quot;</span> ) {</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160; </div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#ab26955ff4600c3a2855e6fe02dc0d216">shape</a>() == <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca29d6fc960c94b5a330f850284e75ab1f">spell_shape::cone</a> ) {</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;                text_y += <a class="code" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y ), <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, <a class="code" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>,</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;                                          <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Cone Arc: %s degrees&quot;</span> ), aoes );</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#ab26955ff4600c3a2855e6fe02dc0d216">shape</a>() == <a class="code" href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474">spell_shape::line</a> ) {</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;                text_y += <a class="code" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y ), <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, <a class="code" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>,</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;                                          <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Line width: %s&quot;</span> ), aoes );</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;                text_y += <a class="code" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y ), <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, <a class="code" href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a>,</div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;                                          <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Effective Spell Radius: %s%s&quot;</span> ), aoes,</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;                                          <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a4bee370b3c3d69be45411856fb2f333f">in_aoe</a>( <a class="code" href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">src</a>, <a class="code" href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">dst</a>, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>() ) ? <a class="code" href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot; WARNING!  IN RANGE&quot;</span> ),</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;                                                  <a class="code" href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a> ) : <span class="stringliteral">&quot;&quot;</span> );</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160;            }</div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;        }</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    }</div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160; </div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;    <a class="code" href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), <a class="code" href="color_8h.html#aab11865a3631a7ce78da82b7fb386b71">c_light_red</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Damage: %s&quot;</span> ),</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;               <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#a731bc4db74246a1e9265ea6f25abd7ad">damage_string</a>( <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>() ) );</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160; </div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;    text_y += <a class="code" href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y ), <a class="code" href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">getmaxx</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a> ) - 2, clr,</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;                              <a class="code" href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">casting</a>-&gt;<a class="code" href="classspell.html#acc66691f05cd20a085370d79df52bafa">description</a>() );</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160;}</div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160; </div>
<div class="line"><a name="l03913"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d"> 3913</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">target_ui::panel_target_info</a>( <span class="keywordtype">int</span> &amp;text_y, <span class="keywordtype">bool</span> fill_with_blank_if_no_target )</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;{</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;    <span class="keywordtype">int</span> max_lines = 6;</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) {</div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *<a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) ) {</div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;            <span class="comment">// FIXME: print_info doesn&#39;t really care about line limit</span></div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;            <span class="comment">//        and can always occupy up to 4 of them (or even more?).</span></div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;            <span class="comment">//        To make things consistent, we ask it for 2 lines</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;            <span class="comment">//        and somewhat reliably get 4.</span></div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;            <span class="keywordtype">int</span> fix_for_print_info = max_lines - 2;</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;            <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>-&gt;<a class="code" href="classCreature.html#ab0d27ad3c2c730a3c88ee897e55f344f">print_info</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, text_y, fix_for_print_info, 1 );</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160;            text_y += max_lines;</div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;            std::vector&lt;std::string&gt; buf;</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a9976ba9d9bccdaff264bd834628b97ec">sees_with_infrared</a>( *<a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) ) {</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;                <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>-&gt;<a class="code" href="classCreature.html#a1eadbc3e5891d1ff578ac49291e12b66">describe_infrared</a>( buf );</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a9333ab3cffa25b588ec5aa932db8d73d">sees_with_specials</a>( *<a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a> ) ) {</div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;                <a class="code" href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">dst_critter</a>-&gt;<a class="code" href="classCreature.html#a6293c17885ef44d613618b4953a1be17">describe_specials</a>( buf );</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;            }</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; static_cast&lt;size_t&gt;( max_lines ); i++, text_y++ ) {</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;                <span class="keywordflow">if</span>( i &gt;= buf.size() ) {</div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;                }</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160;                <a class="code" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y ), buf[i] );</div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;            }</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;        }</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( fill_with_blank_if_no_target ) {</div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;        <span class="comment">// Fill with blank lines to prevent other panels from jumping around</span></div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160;        <span class="comment">// when the cursor moves.</span></div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;        text_y += max_lines;</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;        <span class="comment">// TODO: print info about tile?</span></div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;    }</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;}</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160; </div>
<div class="line"><a name="l03947"></a><span class="lineno"><a class="line" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea"> 3947</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">target_ui::panel_turret_list</a>( <span class="keywordtype">int</span> &amp;text_y )</div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;{</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160;    <a class="code" href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">mvwprintw</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Turrets in range: %d/%d&quot;</span> ), <a class="code" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a>.size(),</div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;               <a class="code" href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">vturrets</a>-&gt;size() );</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160; </div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtarget__ui_1_1turret__with__lof.html">turret_with_lof</a> &amp;it : <a class="code" href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">turrets_in_range</a> ) {</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;        std::string str = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <span class="stringliteral">&quot;* %s&quot;</span>, it.turret-&gt;name() );</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;        <a class="code" href="classnc__color.html">nc_color</a> clr = <a class="code" href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a>;</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;        <a class="code" href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a>( <a class="code" href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">w_target</a>, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( 1, text_y++ ), clr, clr, str );</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160;    }</div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;}</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160; </div>
<div class="line"><a name="l03959"></a><span class="lineno"><a class="line" href="classtarget__ui.html#a50ee1e0b8e7d1141e4d6c2019fe6df39"> 3959</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classtarget__ui.html#a50ee1e0b8e7d1141e4d6c2019fe6df39">target_ui::on_target_accepted</a>( <span class="keywordtype">bool</span> harmful )<span class="keyword"> const</span></div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160;    <span class="comment">// TODO: all of this should be moved into on-hit code</span></div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> lt_ptr = <a class="code" href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">you</a>-&gt;<a class="code" href="classCharacter.html#a15520bb61b6da84f9bd753fa43dcbabc">last_target</a>.lock();</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html">npc</a> *<span class="keyword">const</span> guy = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( lt_ptr.get() ) ) {</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;        <span class="keywordflow">if</span>( harmful ) {</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;            <span class="keywordflow">if</span>( !guy-&gt;guaranteed_hostile() ) {</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;                <span class="comment">// TODO: get rid of this. Or combine it with effect_hit_by_player</span></div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160;                guy-&gt;hit_by_player = <span class="keyword">true</span>; <span class="comment">// used for morale penalty</span></div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;            }</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;        }</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classmonster.html">monster</a> *<span class="keyword">const</span> mon = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classmonster.html">monster</a> *<span class="keyword">&gt;</span>( lt_ptr.get() ) ) {</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;        mon-&gt;add_effect( <a class="code" href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a>, 10_minutes );</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    }</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160;}</div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160; </div>
<div class="line"><a name="l03975"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a18e93476c9d626924c31cf14193305b3"> 3975</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="ranged_8cpp.html#a18e93476c9d626924c31cf14193305b3">gunmode_checks_common</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classmap.html">map</a> &amp;m, std::vector&lt;std::string&gt; &amp;messages,</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classgun__mode.html">gun_mode</a> &amp;gmode )</div>
<div class="line"><a name="l03977"></a><span class="lineno"> 3977</span>&#160;{</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;    <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;    <span class="keywordflow">if</span>( you.<a class="code" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code" href="ranged_8cpp.html#a0fb9c66af29eade7d376e89264128bcd">trait_BRAWLER</a> ) ) {</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;        messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Pfft.  You are a brawler; using this %s is beneath you.&quot;</span> ),</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;                                           gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() ) );</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;    }</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160; </div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;    <span class="comment">// Check that passed gun mode is valid and we are able to use it</span></div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;    <span class="keywordflow">if</span>( !( gmode &amp;&amp; you.<a class="code" href="classCharacter.html#a4eddeb86babf626e7869882079b40651">can_use</a>( *gmode ) ) ) {</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;        messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You can&#39;t currently fire your %s.&quot;</span> ),</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160;                                           gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() ) );</div>
<div class="line"><a name="l03989"></a><span class="lineno"> 3989</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;    }</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160; </div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <span class="keyword">const</span> <a class="code" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = m.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;    <span class="keywordflow">if</span>( vp &amp;&amp; vp-&gt;vehicle().player_in_control( you ) &amp;&amp; ( gmode-&gt;<a class="code" href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">is_two_handed</a>( you ) ||</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;            gmode-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#ae4145a31d8da9f94a59bb3d6fb13436f">flag_FIRE_TWOHAND</a> ) ) ) {</div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You can&#39;t fire your %s while driving.&quot;</span> ),</div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;                                           gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() ) );</div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;    }</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160; </div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;    <span class="keywordflow">if</span>( gmode-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#ae4145a31d8da9f94a59bb3d6fb13436f">flag_FIRE_TWOHAND</a> ) &amp;&amp; ( !you.<a class="code" href="classCharacter.html#a3abc3f2f3d7ad4ec9967ec6ccbcc1c97">has_two_arms_lifting</a>() ||</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;            you.<a class="code" href="classCharacter.html#addcf2c54cf8c3920f66328e2441830fb">worn_with_flag</a>( <a class="code" href="flag_8cpp.html#a7198b972ee7b7e58fde85d42d517297f">flag_RESTRICT_HANDS</a> ) ) ) {</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;        messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You need two free hands to fire your %s.&quot;</span> ),</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;                                           gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() ) );</div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;    }</div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160; </div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;}</div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160; </div>
<div class="line"><a name="l04010"></a><span class="lineno"><a class="line" href="ranged_8cpp.html#a207024a5d17769a16bfc8a7a434d72cd"> 4010</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="ranged_8cpp.html#a207024a5d17769a16bfc8a7a434d72cd">gunmode_checks_weapon</a>( <a class="code" href="classavatar.html">avatar</a> &amp;you, <span class="keyword">const</span> <a class="code" href="classmap.html">map</a> &amp;m, std::vector&lt;std::string&gt; &amp;messages,</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;                            <span class="keyword">const</span> <a class="code" href="classgun__mode.html">gun_mode</a> &amp;gmode )</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;{</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;    <span class="keywordtype">bool</span> result = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;    <span class="keywordflow">if</span>( !gmode-&gt;<a class="code" href="classitem.html#aafdd6e14936eb02b0d71a96e7e325746">ammo_sufficient</a>( &amp;you ) &amp;&amp;</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;        !gmode-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#aa4483d80251dc96dd0c8313d8a6366f9">flag_RELOAD_AND_SHOOT</a> ) ) {</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;        <span class="keywordflow">if</span>( !gmode-&gt;<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>() ) {</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;            messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s is empty!&quot;</span> ), gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() ) );</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;            messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your %s needs %i charges to fire!&quot;</span> ),</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;                                               gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>(), gmode-&gt;<a class="code" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>() ) );</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;        }</div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;    }</div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160; </div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;    <span class="keywordflow">if</span>( gmode-&gt;<a class="code" href="classitem.html#a6d3164628041c6ccdce14aedd711b640">get_gun_energy_drain</a>() &gt; 0_kJ ) {</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::energy</a> energy_drain = gmode-&gt;<a class="code" href="classitem.html#a6d3164628041c6ccdce14aedd711b640">get_gun_energy_drain</a>();</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;        <span class="keywordtype">bool</span> is_mech_weapon = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;        <span class="keywordflow">if</span>( you.<a class="code" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;            <a class="code" href="classmonster.html">monster</a> *mons = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>().<a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>.get();</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;            <span class="keywordflow">if</span>( !mons-&gt;<a class="code" href="classmonster.html#aa30f973bf524ba275ada847f6118b048">type</a>-&gt;<a class="code" href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mech_weapon</a>.<a class="code" href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">is_empty</a>() ) {</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;                is_mech_weapon = <span class="keyword">true</span>;</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;            }</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;        }</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160; </div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;        <span class="keywordflow">if</span>( gmode-&gt;<a class="code" href="classitem.html#a1ce97bab127dbbcd371f4e83bb441c38">energy_remaining</a>( &amp;you ) &lt; energy_drain ) {</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;            result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;            <span class="keywordflow">if</span>( is_mech_weapon ) {</div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;                messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Your mech has an empty battery, its %s will not fire.&quot;</span> ),</div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;                                                   gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() ) );</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( gmode-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a7d8a64454549e0bab5aa7d7a7091f9d1">flag_USES_BIONIC_POWER</a> ) ) {</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;                messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>(</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;                                        <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You need at least %2$d kJ of bionic power to fire the %1$s!&quot;</span> ),</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;                                        gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>(), <a class="code" href="namespaceunits.html#a7f3948de70e78d68af74fb3d119cf176">units::to_kilojoule</a>( energy_drain ) ) );</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( gmode-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a3e2d3cbf6b78ce65033d1f9cbf1f59bf">flag_USE_UPS</a> ) ) {</div>
<div class="line"><a name="l04045"></a><span class="lineno"> 4045</span>&#160;                messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>(</div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;                                        <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You need a UPS with at least %2$d kJ to fire the %1$s!&quot;</span> ),</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;                                        gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>(), <a class="code" href="namespaceunits.html#a7f3948de70e78d68af74fb3d119cf176">units::to_kilojoule</a>( energy_drain ) ) );</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;            }</div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;        }</div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;    }</div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160; </div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;    <span class="keywordflow">if</span>( gmode-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a6e2d5c45635a3d1a0b2afd71e4748d57">flag_MOUNTED_GUN</a> ) ) {</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> v_mountable = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>( m.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ).<a class="code" href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">part_with_feature</a>( <span class="stringliteral">&quot;MOUNTABLE&quot;</span>,</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;                                 <span class="keyword">true</span> ) );</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;        <span class="keywordtype">bool</span> t_mountable = m.<a class="code" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a6360286fa7a45a7d705397a23a639f54">ter_furn_flag::TFLAG_MOUNTABLE</a>, you.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;        <span class="keywordflow">if</span>( !t_mountable &amp;&amp; !v_mountable ) {</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;            messages.push_back( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>(</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;                                    <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;You must stand near acceptable terrain or furniture to fire the %s.  A table, a mound of dirt, a broken window, etc.&quot;</span> ),</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;                                    gmode-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() ) );</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;            result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;        }</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;    }</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160; </div>
<div class="line"><a name="l04064"></a><span class="lineno"> 4064</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;}</div>
<div class="ttc" id="aactivity__actor__definitions_8h_html"><div class="ttname"><a href="activity__actor__definitions_8h.html">activity_actor_definitions.h</a></div></div>
<div class="ttc" id="aavatar_8h_html"><div class="ttname"><a href="avatar_8h.html">avatar.h</a></div></div>
<div class="ttc" id="aavatar_8h_html_a7fe2c1a3376948380f856732d4f34c5c"><div class="ttname"><a href="avatar_8h.html#a7fe2c1a3376948380f856732d4f34c5c">get_avatar</a></div><div class="ttdeci">avatar &amp; get_avatar()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13817">game.cpp:13817</a></div></div>
<div class="ttc" id="aballistics_8cpp_html_a3090f41e3e1093c0ac85ed679237a6df"><div class="ttname"><a href="ballistics_8cpp.html#a3090f41e3e1093c0ac85ed679237a6df">projectile_attack</a></div><div class="ttdeci">dealt_projectile_attack projectile_attack(const projectile &amp;proj_arg, const tripoint &amp;source, const tripoint &amp;target_arg, const dispersion_sources &amp;dispersion, Creature *origin, const vehicle *in_veh, const weakpoint_attack &amp;wp_attack, bool first)</div><div class="ttdoc">Fires a projectile at the target point from the source point with total_dispersion dispersion.</div><div class="ttdef"><b>Definition:</b> <a href="ballistics_8cpp_source.html#l00201">ballistics.cpp:201</a></div></div>
<div class="ttc" id="aballistics_8h_html"><div class="ttname"><a href="ballistics_8h.html">ballistics.h</a></div></div>
<div class="ttc" id="abionics_8h_html"><div class="ttname"><a href="bionics_8h.html">bionics.h</a></div></div>
<div class="ttc" id="abodypart_8cpp_html_aa097cb26e12eaa87b56e93c3568a5a74"><div class="ttname"><a href="bodypart_8cpp.html#aa097cb26e12eaa87b56e93c3568a5a74">body_part_name_accusative</a></div><div class="ttdeci">std::string body_part_name_accusative(const bodypart_id &amp;bp, int number)</div><div class="ttdoc">Returns the matching accusative name of the body_part token, i.e.</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8cpp_source.html#l00798">bodypart.cpp:798</a></div></div>
<div class="ttc" id="abodypart_8h_html_a426444e2d486ce1ee315d8b8acc86b40"><div class="ttname"><a href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a></div><div class="ttdeci">int_id&lt; body_part_type &gt; bodypart_id</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00032">bodypart.h:32</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a0cb65464a3fa34c1ed5474f5d2d853a7"><div class="ttname"><a href="cached__options_8cpp.html#a0cb65464a3fa34c1ed5474f5d2d853a7">fov_3d_z_range</a></div><div class="ttdeci">int fov_3d_z_range</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00003">cached_options.cpp:3</a></div></div>
<div class="ttc" id="acached__options_8cpp_html_a9b72c9314ac0439a25820b3abf2229f3"><div class="ttname"><a href="cached__options_8cpp.html#a9b72c9314ac0439a25820b3abf2229f3">use_tiles</a></div><div class="ttdeci">bool use_tiles</div><div class="ttdef"><b>Definition:</b> <a href="cached__options_8cpp_source.html#l00014">cached_options.cpp:14</a></div></div>
<div class="ttc" id="acached__options_8h_html"><div class="ttname"><a href="cached__options_8h.html">cached_options.h</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_a359120c15f92d54a49fec9de7bcb571f"><div class="ttname"><a href="calendar_8cpp.html#a359120c15f92d54a49fec9de7bcb571f">x_in_y</a></div><div class="ttdeci">bool x_in_y(const time_duration &amp;a, const time_duration &amp;b)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00784">calendar.cpp:784</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_a4249b6f1d0842211bfe53e5f9e206a10"><div class="ttname"><a href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a></div><div class="ttdeci">time_duration rng(time_duration lo, time_duration hi)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00779">calendar.cpp:779</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_abf1cdb8f4662bf96c8d762e9229df8d9"><div class="ttname"><a href="calendar_8cpp.html#abf1cdb8f4662bf96c8d762e9229df8d9">to_string</a></div><div class="ttdeci">std::string to_string(const time_duration &amp;d, const bool compact)</div><div class="ttdoc">Returns a string showing a duration.</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00546">calendar.cpp:546</a></div></div>
<div class="ttc" id="acalendar_8h_html"><div class="ttname"><a href="calendar_8h.html">calendar.h</a></div></div>
<div class="ttc" id="acata__scope__helpers_8h_html"><div class="ttname"><a href="cata__scope__helpers_8h.html">cata_scope_helpers.h</a></div></div>
<div class="ttc" id="acata__tiles_8h_html_affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667"><div class="ttname"><a href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">text_alignment::center</a></div><div class="ttdeci">@ center</div></div>
<div class="ttc" id="acata__utility_8cpp_html_a179b3f9b48b6d93e55bd110a79054d26"><div class="ttname"><a href="cata__utility_8cpp.html#a179b3f9b48b6d93e55bd110a79054d26">multi_lerp</a></div><div class="ttdeci">float multi_lerp(const std::vector&lt; std::pair&lt; float, float &gt;&gt; &amp;points, float x)</div><div class="ttdoc">From points, finds p1 and p2 such that p1.first &lt; x &lt; p2.first Then linearly interpolates between p1....</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8cpp_source.html#l00267">cata_utility.cpp:267</a></div></div>
<div class="ttc" id="acata__utility_8h_html"><div class="ttname"><a href="cata__utility_8h.html">cata_utility.h</a></div></div>
<div class="ttc" id="acata__utility_8h_html_ad22b4a043b6eb4c2c06f87f83b720b15"><div class="ttname"><a href="cata__utility_8h.html#ad22b4a043b6eb4c2c06f87f83b720b15">clamp</a></div><div class="ttdeci">constexpr T clamp(const T &amp;val, const T &amp;min, const T &amp;max)</div><div class="ttdoc">Clamp first argument so that it is no lower than second and no higher than third.</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8h_source.html#l00221">cata_utility.h:221</a></div></div>
<div class="ttc" id="acata__variant_8h_html_adfe42687fffdd05d233096b4e7dac2f4a1e3f04102267eaf5e8d0ca424fd5c561"><div class="ttname"><a href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a1e3f04102267eaf5e8d0ca424fd5c561">cata_variant_type::field_type_id</a></div><div class="ttdeci">@ field_type_id</div></div>
<div class="ttc" id="acata__variant_8h_html_adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e"><div class="ttname"><a href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">cata_variant_type::tripoint</a></div><div class="ttdeci">@ tripoint</div></div>
<div class="ttc" id="acata__variant_8h_html_adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9"><div class="ttname"><a href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">cata_variant_type::point</a></div><div class="ttdeci">@ point</div></div>
<div class="ttc" id="acatacharset_8cpp_html_af20ee33da59ccceb9f4c14005c0bbe80"><div class="ttname"><a href="catacharset_8cpp.html#af20ee33da59ccceb9f4c14005c0bbe80">utf8_width</a></div><div class="ttdeci">int utf8_width(const std::string_view s, const bool ignore_tags)</div><div class="ttdef"><b>Definition:</b> <a href="catacharset_8cpp_source.html#l00104">catacharset.cpp:104</a></div></div>
<div class="ttc" id="acatacharset_8h_html"><div class="ttname"><a href="catacharset_8h.html">catacharset.h</a></div></div>
<div class="ttc" id="acharacter_8h_html"><div class="ttname"><a href="character_8h.html">character.h</a></div></div>
<div class="ttc" id="acharacter_8h_html_abaafa6561de05c3b1324214e3048745a"><div class="ttname"><a href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a></div><div class="ttdeci">Character &amp; get_player_character()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13807">game.cpp:13807</a></div></div>
<div class="ttc" id="aclassCharacter_html"><div class="ttname"><a href="classCharacter.html">Character</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00522">character.h:523</a></div></div>
<div class="ttc" id="aclassCharacter_html_a05331bfbde3df1348a870d987597d29a"><div class="ttname"><a href="classCharacter.html#a05331bfbde3df1348a870d987597d29a">Character::get_weapon_dispersion</a></div><div class="ttdeci">dispersion_sources get_weapon_dispersion(const item &amp;obj) const</div><div class="ttdoc">Returns a weapon's modified dispersion value.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02290">ranged.cpp:2290</a></div></div>
<div class="ttc" id="aclassCharacter_html_a057d68671b298012a18f4e289b39935d"><div class="ttname"><a href="classCharacter.html#a057d68671b298012a18f4e289b39935d">Character::recoil</a></div><div class="ttdeci">double recoil</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01117">character.h:1117</a></div></div>
<div class="ttc" id="aclassCharacter_html_a0bd7efcad4b20c844c502639525095b0"><div class="ttname"><a href="classCharacter.html#a0bd7efcad4b20c844c502639525095b0">Character::get_standard_stamina_cost</a></div><div class="ttdeci">int get_standard_stamina_cost(const item *thrown_item=nullptr) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02982">character.cpp:2982</a></div></div>
<div class="ttc" id="aclassCharacter_html_a15520bb61b6da84f9bd753fa43dcbabc"><div class="ttname"><a href="classCharacter.html#a15520bb61b6da84f9bd753fa43dcbabc">Character::last_target</a></div><div class="ttdeci">weak_ptr_fast&lt; Creature &gt; last_target</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02761">character.h:2761</a></div></div>
<div class="ttc" id="aclassCharacter_html_a17446e14fd6046648a505c4aaec3d976"><div class="ttname"><a href="classCharacter.html#a17446e14fd6046648a505c4aaec3d976">Character::mod_power_level</a></div><div class="ttdeci">void mod_power_level(const units::energy &amp;npower)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02852">character.cpp:2852</a></div></div>
<div class="ttc" id="aclassCharacter_html_a191d57983e5a0064be49504c11e8b56a"><div class="ttname"><a href="classCharacter.html#a191d57983e5a0064be49504c11e8b56a">Character::get_modifier</a></div><div class="ttdeci">float get_modifier(const character_modifier_id &amp;mod, const skill_id &amp;skill=skill_id::NULL_ID()) const</div><div class="ttdef"><b>Definition:</b> <a href="character__modifier_8cpp_source.html#l00401">character_modifier.cpp:401</a></div></div>
<div class="ttc" id="aclassCharacter_html_a1e1996b6d6fc0a86d917cd155e1656d8"><div class="ttname"><a href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">Character::disp_name</a></div><div class="ttdeci">std::string disp_name(bool possessive=false, bool capitalize_first=false) const override</div><div class="ttdoc">Returns either &quot;you&quot; or the player's name.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00829">character.cpp:829</a></div></div>
<div class="ttc" id="aclassCharacter_html_a1f4afdf9827faa33b0d2436fa27d9fd2"><div class="ttname"><a href="classCharacter.html#a1f4afdf9827faa33b0d2436fa27d9fd2">Character::is_driving</a></div><div class="ttdeci">bool is_driving() const</div><div class="ttdoc">Checks if a Character is driving.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11987">character.cpp:11987</a></div></div>
<div class="ttc" id="aclassCharacter_html_a26369a0a81eef76cfe75214d22ed32b4"><div class="ttname"><a href="classCharacter.html#a26369a0a81eef76cfe75214d22ed32b4">Character::str_cur</a></div><div class="ttdeci">int str_cur</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00577">character.h:577</a></div></div>
<div class="ttc" id="aclassCharacter_html_a2725bcbfa9e92e0590930e6a8e35764c"><div class="ttname"><a href="classCharacter.html#a2725bcbfa9e92e0590930e6a8e35764c">Character::rem_morale</a></div><div class="ttdeci">void rem_morale(const morale_type &amp;type, const itype *item_type=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="character__morale_8cpp_source.html#l00154">character_morale.cpp:154</a></div></div>
<div class="ttc" id="aclassCharacter_html_a2c1e0d2a430258c132cbdff827fc8e89"><div class="ttname"><a href="classCharacter.html#a2c1e0d2a430258c132cbdff827fc8e89">Character::most_accurate_aiming_method_limit</a></div><div class="ttdeci">int most_accurate_aiming_method_limit(const item &amp;gun) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01017">character.cpp:1017</a></div></div>
<div class="ttc" id="aclassCharacter_html_a34a927d0f161ac92ab0d462397828bd5"><div class="ttname"><a href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">Character::get_dex</a></div><div class="ttdeci">int get_dex() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04131">character.cpp:4131</a></div></div>
<div class="ttc" id="aclassCharacter_html_a379081ad133b17e4ab3d230270b2414d"><div class="ttname"><a href="classCharacter.html#a379081ad133b17e4ab3d230270b2414d">Character::i_rem</a></div><div class="ttdeci">item i_rem(const item *it)</div><div class="ttdoc">Remove a specific item from player possession.</div><div class="ttdef"><b>Definition:</b> <a href="character__inventory_8cpp_source.html#l00433">character_inventory.cpp:433</a></div></div>
<div class="ttc" id="aclassCharacter_html_a3abc3f2f3d7ad4ec9967ec6ccbcc1c97"><div class="ttname"><a href="classCharacter.html#a3abc3f2f3d7ad4ec9967ec6ccbcc1c97">Character::has_two_arms_lifting</a></div><div class="ttdeci">bool has_two_arms_lifting() const</div><div class="ttdoc">Returns true if the character has two functioning arms.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02083">character.cpp:2083</a></div></div>
<div class="ttc" id="aclassCharacter_html_a455c06bf0dab6e3558f759fe43e27e98"><div class="ttname"><a href="classCharacter.html#a455c06bf0dab6e3558f759fe43e27e98">Character::throw_range</a></div><div class="ttdeci">int throw_range(const item &amp;) const</div><div class="ttdoc">Maximum thrown range with a given item, taking all active effects into account.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l05937">character.cpp:5937</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4eddeb86babf626e7869882079b40651"><div class="ttname"><a href="classCharacter.html#a4eddeb86babf626e7869882079b40651">Character::can_use</a></div><div class="ttdeci">bool can_use(const item &amp;it, const item &amp;context=item()) const</div><div class="ttdoc">Checks if character stats and skills meet minimum requirements for the item.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03271">character.cpp:3271</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5147c11c1cf4730c70f6412784153731"><div class="ttname"><a href="classCharacter.html#a5147c11c1cf4730c70f6412784153731">Character::thrown_item_total_damage_raw</a></div><div class="ttdeci">int thrown_item_total_damage_raw(const item &amp;thrown) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01281">ranged.cpp:1281</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5aba683ccf77cb560a0a932308289bd9"><div class="ttname"><a href="classCharacter.html#a5aba683ccf77cb560a0a932308289bd9">Character::get_str</a></div><div class="ttdeci">int get_str() const</div><div class="ttdoc">Getters for stats exclusive to characters.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04127">character.cpp:4127</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6243be833eae8764b8dc841fb05cf867"><div class="ttname"><a href="classCharacter.html#a6243be833eae8764b8dc841fb05cf867">Character::aim_per_move</a></div><div class="ttdeci">double aim_per_move(const item &amp;gun, double recoil, const Target_attributes &amp;target_attributes=Target_attributes(), std::optional&lt; std::reference_wrapper&lt; const aim_mods_cache &gt;&gt; aim_cache=std::nullopt) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01087">character.cpp:1087</a></div></div>
<div class="ttc" id="aclassCharacter_html_a63b23888fb1be74df6371f5f349ce558"><div class="ttname"><a href="classCharacter.html#a63b23888fb1be74df6371f5f349ce558">Character::volume</a></div><div class="ttdeci">int volume</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00600">character.h:600</a></div></div>
<div class="ttc" id="aclassCharacter_html_a64b5eefd36bce677403f1912c414f977"><div class="ttname"><a href="classCharacter.html#a64b5eefd36bce677403f1912c414f977">Character::gun_value</a></div><div class="ttdeci">double gun_value(const item &amp;weap, int ammo=10) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02339">ranged.cpp:2339</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6535a02158a1d6b23b0a6bb623dfae19"><div class="ttname"><a href="classCharacter.html#a6535a02158a1d6b23b0a6bb623dfae19">Character::practice</a></div><div class="ttdeci">bool practice(const skill_id &amp;id, int amount, int cap=99, bool suppress_warning=false)</div><div class="ttdoc">This handles giving xp for a skill.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02683">character.cpp:2683</a></div></div>
<div class="ttc" id="aclassCharacter_html_a67b51491c2529df09755e07bc633cc55"><div class="ttname"><a href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">Character::is_mounted</a></div><div class="ttdeci">bool is_mounted() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01732">character.cpp:1732</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6853521cfe7399330d90c08271e003b4"><div class="ttname"><a href="classCharacter.html#a6853521cfe7399330d90c08271e003b4">Character::throwing_dispersion</a></div><div class="ttdeci">int throwing_dispersion(const item &amp;to_throw, Creature *critter=nullptr, bool is_blind_throw=false) const</div><div class="ttdoc">Dispersion of a thrown item, against a given target, taking into account whether or not the throw was...</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01183">ranged.cpp:1183</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6b1320339a403e092d041e141e62e6ba"><div class="ttname"><a href="classCharacter.html#a6b1320339a403e092d041e141e62e6ba">Character::last_target_pos</a></div><div class="ttdeci">std::optional&lt; tripoint &gt; last_target_pos</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02762">character.h:2762</a></div></div>
<div class="ttc" id="aclassCharacter_html_a72472dd1bc3a1fba8b053682ae5a2244"><div class="ttname"><a href="classCharacter.html#a72472dd1bc3a1fba8b053682ae5a2244">Character::has_proficiency</a></div><div class="ttdeci">bool has_proficiency(const proficiency_id &amp;prof) const</div><div class="ttdef"><b>Definition:</b> <a href="character__proficiency_8cpp_source.html#l00019">character_proficiency.cpp:19</a></div></div>
<div class="ttc" id="aclassCharacter_html_a74cf2e51a768e3d2e2114aeaddb5fda4"><div class="ttname"><a href="classCharacter.html#a74cf2e51a768e3d2e2114aeaddb5fda4">Character::has_morale</a></div><div class="ttdeci">int has_morale(const morale_type &amp;type) const</div><div class="ttdef"><b>Definition:</b> <a href="character__morale_8cpp_source.html#l00149">character_morale.cpp:149</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7a1a328276dae4040ef931b5976d04ba"><div class="ttname"><a href="classCharacter.html#a7a1a328276dae4040ef931b5976d04ba">Character::get_targetable_creatures</a></div><div class="ttdeci">std::vector&lt; Creature * &gt; get_targetable_creatures(int range, bool melee) const</div><div class="ttdoc">As above, but includes all creatures the player can detect well enough to target with ranged weapons,...</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10505">character.cpp:10505</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7a8f9ffd035435c9f2777e007059e68d"><div class="ttname"><a href="classCharacter.html#a7a8f9ffd035435c9f2777e007059e68d">Character::get_aim_types</a></div><div class="ttdeci">std::vector&lt; aim_type &gt; get_aim_types(const item &amp;gun) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02006">ranged.cpp:2006</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7c11a4f12bee9f80279bff21faa54153"><div class="ttname"><a href="classCharacter.html#a7c11a4f12bee9f80279bff21faa54153">Character::apply_damage</a></div><div class="ttdeci">void apply_damage(Creature *source, bodypart_id hurt, int dam, bool bypass_med=false) override</div><div class="ttdoc">Actually hurt the player, hurts a body_part directly, no armor reduction.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08207">character.cpp:8207</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7cf71d2bd6c350f2ceda3f1d64046e63"><div class="ttname"><a href="classCharacter.html#a7cf71d2bd6c350f2ceda3f1d64046e63">Character::add_msg_player_or_npc</a></div><div class="ttdeci">virtual void add_msg_player_or_npc(const std::string &amp;, const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l01060">creature.h:1060</a></div></div>
<div class="ttc" id="aclassCharacter_html_a906192bd3a5f29a61ee12695e18d2eb5"><div class="ttname"><a href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">Character::sees</a></div><div class="ttdeci">bool sees(const tripoint &amp;t, bool is_avatar=false, int range_mod=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11397">character.cpp:11397</a></div></div>
<div class="ttc" id="aclassCharacter_html_a91dc4715c36eef7d116f944be9a4d435"><div class="ttname"><a href="classCharacter.html#a91dc4715c36eef7d116f944be9a4d435">Character::add_msg_if_player</a></div><div class="ttdeci">virtual void add_msg_if_player(const std::string &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00976">creature.h:976</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9333ab3cffa25b588ec5aa932db8d73d"><div class="ttname"><a href="classCharacter.html#a9333ab3cffa25b588ec5aa932db8d73d">Character::sees_with_specials</a></div><div class="ttdeci">bool sees_with_specials(const Creature &amp;critter) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l06064">character.cpp:6064</a></div></div>
<div class="ttc" id="aclassCharacter_html_a93a3570e884214ba5c0eb3cdf1af75cc"><div class="ttname"><a href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">Character::get_skill_level</a></div><div class="ttdeci">float get_skill_level(const skill_id &amp;ident) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03428">character.cpp:3428</a></div></div>
<div class="ttc" id="aclassCharacter_html_a94f04577f690dc8400ff13aa991cd6ed"><div class="ttname"><a href="classCharacter.html#a94f04577f690dc8400ff13aa991cd6ed">Character::gun_engagement_moves</a></div><div class="ttdeci">int gun_engagement_moves(const item &amp;gun, int target=0, int start=MAX_RECOIL, const Target_attributes &amp;attributes=Target_attributes()) const</div><div class="ttdoc">How many moves does it take to aim gun to the target accuracy.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00588">ranged.cpp:588</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9976ba9d9bccdaff264bd834628b97ec"><div class="ttname"><a href="classCharacter.html#a9976ba9d9bccdaff264bd834628b97ec">Character::sees_with_infrared</a></div><div class="ttdeci">bool sees_with_infrared(const Creature &amp;critter) const</div><div class="ttdoc">Check whether the this player can see the other creature with infrared.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10481">character.cpp:10481</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9e1fc0ad25d91346b7bfe54d24a4aacd"><div class="ttname"><a href="classCharacter.html#a9e1fc0ad25d91346b7bfe54d24a4aacd">Character::handle_gun_overheat</a></div><div class="ttdeci">bool handle_gun_overheat(item &amp;it)</div><div class="ttdoc">Handles overheat mechanics for guns, returns true if the gun cant fire due to overheat effects.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00771">ranged.cpp:771</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9f90838e7733c76ae2b1eaa7b9e418cb"><div class="ttname"><a href="classCharacter.html#a9f90838e7733c76ae2b1eaa7b9e418cb">Character::fire_gun</a></div><div class="ttdeci">int fire_gun(const tripoint &amp;target, int shots=1)</div><div class="ttdoc">Fires a gun or auxiliary gunmod (ignoring any current mode)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00857">ranged.cpp:857</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa376cb5765a50c43ee63c4a3b151832e"><div class="ttname"><a href="classCharacter.html#aa376cb5765a50c43ee63c4a3b151832e">Character::practice_proficiency</a></div><div class="ttdeci">bool practice_proficiency(const proficiency_id &amp;prof, const time_duration &amp;amount, const std::optional&lt; time_duration &gt; &amp;max=std::nullopt)</div><div class="ttdef"><b>Definition:</b> <a href="character__proficiency_8cpp_source.html#l00071">character_proficiency.cpp:71</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa58280d717f23351fb1cdc6f7a83047f"><div class="ttname"><a href="classCharacter.html#aa58280d717f23351fb1cdc6f7a83047f">Character::gen_aim_mods_cache</a></div><div class="ttdeci">aim_mods_cache gen_aim_mods_cache(const item &amp;gun) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00935">character.cpp:935</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa9a4335ab1fd0d975199750b1ebf5bef"><div class="ttname"><a href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">Character::get_wielded_item</a></div><div class="ttdeci">item_location get_wielded_item() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00674">character.cpp:674</a></div></div>
<div class="ttc" id="aclassCharacter_html_aaef1f2b773b9e659b6b69f813ea4dafb"><div class="ttname"><a href="classCharacter.html#aaef1f2b773b9e659b6b69f813ea4dafb">Character::ranged_dex_mod</a></div><div class="ttdeci">int ranged_dex_mod() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04212">character.cpp:4212</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab00eb5ef085c40f7666fbb6f7a3e98e6"><div class="ttname"><a href="classCharacter.html#ab00eb5ef085c40f7666fbb6f7a3e98e6">Character::thrown_item_projectile</a></div><div class="ttdeci">projectile thrown_item_projectile(const item &amp;thrown) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01272">ranged.cpp:1272</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab6b6b317ae10bfb8f358fe289d645c96"><div class="ttname"><a href="classCharacter.html#ab6b6b317ae10bfb8f358fe289d645c96">Character::add_morale</a></div><div class="ttdeci">void add_morale(const morale_type &amp;type, int bonus, int max_bonus=0, const time_duration &amp;duration=1_hours, const time_duration &amp;decay_start=30_minutes, bool capped=false, const itype *item_type=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="character__morale_8cpp_source.html#l00142">character_morale.cpp:142</a></div></div>
<div class="ttc" id="aclassCharacter_html_abb0a1847902e6db0bd3c923ee8187702"><div class="ttname"><a href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">Character::get_per</a></div><div class="ttdeci">int get_per() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04135">character.cpp:4135</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac29de3d2bc90dd1c8d921b539fb05cfb"><div class="ttname"><a href="classCharacter.html#ac29de3d2bc90dd1c8d921b539fb05cfb">Character::mod_stamina</a></div><div class="ttdeci">void mod_stamina(int mod)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l06940">character.cpp:6940</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac3d46549b7cdaac1f98991167ad5f1b3"><div class="ttname"><a href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">Character::mounted_creature</a></div><div class="ttdeci">shared_ptr_fast&lt; monster &gt; mounted_creature</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02800">character.h:2800</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac6f590f28f979103633d198e32524c06"><div class="ttname"><a href="classCharacter.html#ac6f590f28f979103633d198e32524c06">Character::is_prone</a></div><div class="ttdeci">bool is_prone() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02184">character.cpp:2184</a></div></div>
<div class="ttc" id="aclassCharacter_html_accd6b165a9454cad9972bc153061215a"><div class="ttname"><a href="classCharacter.html#accd6b165a9454cad9972bc153061215a">Character::recoil_vehicle</a></div><div class="ttdeci">double recoil_vehicle() const</div><div class="ttdoc">Get maximum recoil penalty due to vehicle motion.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l12348">character.cpp:12348</a></div></div>
<div class="ttc" id="aclassCharacter_html_ace68b093955008a3faf37ba2d09bb0b5"><div class="ttname"><a href="classCharacter.html#ace68b093955008a3faf37ba2d09bb0b5">Character::throw_dispersion_per_dodge</a></div><div class="ttdeci">int throw_dispersion_per_dodge(bool add_encumbrance=true) const</div><div class="ttdoc">How much dispersion does one point of target's dodge add when throwing at said target?</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01170">ranged.cpp:1170</a></div></div>
<div class="ttc" id="aclassCharacter_html_acfb04a0e86c82c14248f911ebcb23f90"><div class="ttname"><a href="classCharacter.html#acfb04a0e86c82c14248f911ebcb23f90">Character::throw_item</a></div><div class="ttdeci">dealt_projectile_attack throw_item(const tripoint &amp;target, const item &amp;to_throw, const std::optional&lt; tripoint &gt; &amp;blind_throw_from_pos=std::nullopt)</div><div class="ttdoc">Execute a throw.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01308">ranged.cpp:1308</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad142b103f316b95f28681bd5502e79ef"><div class="ttname"><a href="classCharacter.html#ad142b103f316b95f28681bd5502e79ef">Character::view_offset</a></div><div class="ttdeci">tripoint view_offset</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02705">character.h:2705</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad34f7b20c4a0e5a8f659efe14482fd2b"><div class="ttname"><a href="classCharacter.html#ad34f7b20c4a0e5a8f659efe14482fd2b">Character::handle_gun_damage</a></div><div class="ttdeci">bool handle_gun_damage(item &amp;it)</div><div class="ttdoc">Returns true if a gun misfires, jams, or has other problems, else returns false.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00606">ranged.cpp:606</a></div></div>
<div class="ttc" id="aclassCharacter_html_adb54bdcb284abb66b6be99c8ae225065"><div class="ttname"><a href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">Character::getID</a></div><div class="ttdeci">character_id getID() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00652">character.cpp:652</a></div></div>
<div class="ttc" id="aclassCharacter_html_add870e576ff59aa6943af286576219e9"><div class="ttname"><a href="classCharacter.html#add870e576ff59aa6943af286576219e9">Character::enchantment_cache</a></div><div class="ttdeci">pimpl&lt; enchant_cache &gt; enchantment_cache</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l04105">character.h:4105</a></div></div>
<div class="ttc" id="aclassCharacter_html_addcf2c54cf8c3920f66328e2441830fb"><div class="ttname"><a href="classCharacter.html#addcf2c54cf8c3920f66328e2441830fb">Character::worn_with_flag</a></div><div class="ttdeci">bool worn_with_flag(const flag_id &amp;flag, const bodypart_id &amp;bp) const</div><div class="ttdoc">Returns true if the player is wearing an item with the given flag.</div><div class="ttdef"><b>Definition:</b> <a href="character__attire_8cpp_source.html#l00548">character_attire.cpp:548</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae47514f140700c67ea21ccbadf66d106"><div class="ttname"><a href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">Character::get_name</a></div><div class="ttdeci">std::string get_name() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l05731">character.cpp:5731</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae68b7a6565646ba662e448bded8b6599"><div class="ttname"><a href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">Character::weapon</a></div><div class="ttdeci">item weapon</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02715">character.h:2715</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae6c99add30790add67dd94133805269f"><div class="ttname"><a href="classCharacter.html#ae6c99add30790add67dd94133805269f">Character::thrown_item_adjusted_damage</a></div><div class="ttdeci">int thrown_item_adjusted_damage(const item &amp;thrown) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01252">ranged.cpp:1252</a></div></div>
<div class="ttc" id="aclassCharacter_html_aec46a4b513360ef60f6143830bbb711d"><div class="ttname"><a href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">Character::recoil_total</a></div><div class="ttdeci">double recoil_total() const</div><div class="ttdoc">Current total maximum recoil penalty from all sources.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l12360">character.cpp:12360</a></div></div>
<div class="ttc" id="aclassCharacter_html_aec5b22f2b058eb8923e91190f4a9ac8b"><div class="ttname"><a href="classCharacter.html#aec5b22f2b058eb8923e91190f4a9ac8b">Character::impact</a></div><div class="ttdeci">int impact(int force, const tripoint &amp;pos) override</div><div class="ttdoc">Deals falling/collision damage with terrain/creature at pos.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l12557">character.cpp:12557</a></div></div>
<div class="ttc" id="aclassCharacter_html_aedc66fc50d352420cae7791b4a0f57f7"><div class="ttname"><a href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">Character::get_speed</a></div><div class="ttdeci">int get_speed() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04192">character.cpp:4192</a></div></div>
<div class="ttc" id="aclassCharacter_html_aef9cb6bfa6f5446ffbdf160e18ffdb86"><div class="ttname"><a href="classCharacter.html#aef9cb6bfa6f5446ffbdf160e18ffdb86">Character::encumb</a></div><div class="ttdeci">int encumb(const bodypart_id &amp;bp) const</div><div class="ttdoc">Returns ENC provided by armor, etc.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04046">character.cpp:4046</a></div></div>
<div class="ttc" id="aclassCharacter_html_af0503012f1ff927cbb5ad126e39cb103"><div class="ttname"><a href="classCharacter.html#af0503012f1ff927cbb5ad126e39cb103">Character::add_msg_if_player</a></div><div class="ttdeci">void add_msg_if_player(const std::string &amp;msg) const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00856">character.cpp:856</a></div></div>
<div class="ttc" id="aclassCharacter_html_af06dd97724f4f05df782e7a4b4f9cfe1"><div class="ttname"><a href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">Character::has_trait</a></div><div class="ttdeci">bool has_trait(const trait_id &amp;b) const override</div><div class="ttdoc">Returns true if the player has the entered trait.</div><div class="ttdef"><b>Definition:</b> <a href="mutation_8cpp_source.html#l00111">mutation.cpp:111</a></div></div>
<div class="ttc" id="aclassCharacter_html_af707ac7d1e7995274f21a9f0ac740c9a"><div class="ttname"><a href="classCharacter.html#af707ac7d1e7995274f21a9f0ac740c9a">Character::get_arm_str</a></div><div class="ttdeci">int get_arm_str() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04200">character.cpp:4200</a></div></div>
<div class="ttc" id="aclassCharacter_html_af987a23fb823861daf5d77051e3dc60f"><div class="ttname"><a href="classCharacter.html#af987a23fb823861daf5d77051e3dc60f">Character::set_activity_level</a></div><div class="ttdeci">void set_activity_level(float new_level)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l06547">character.cpp:6547</a></div></div>
<div class="ttc" id="aclassCharacter_html_af9c7419575e23d52745c94009929fafb"><div class="ttname"><a href="classCharacter.html#af9c7419575e23d52745c94009929fafb">Character::has_active_bionic</a></div><div class="ttdeci">bool has_active_bionic(const bionic_id &amp;b) const</div><div class="ttdoc">Returns true if the player has the entered bionic id and it is powered on.</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l02658">bionics.cpp:2658</a></div></div>
<div class="ttc" id="aclassCharacter_html_afca93d0bd4fe00f5c087d4040cbf98ae"><div class="ttname"><a href="classCharacter.html#afca93d0bd4fe00f5c087d4040cbf98ae">Character::meets_requirements</a></div><div class="ttdeci">bool meets_requirements(const item &amp;it, const item &amp;context=item()) const</div><div class="ttdoc">Checks whether the character meets overall requirements to be able to use the item.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03547">character.cpp:3547</a></div></div>
<div class="ttc" id="aclassCreature_html"><div class="ttname"><a href="classCreature.html">Creature</a></div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00250">creature.h:251</a></div></div>
<div class="ttc" id="aclassCreature_html_a1a65722d07102550f16d17ebd79e2743"><div class="ttname"><a href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">Creature::pos</a></div><div class="ttdeci">tripoint pos() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00178">creature.cpp:178</a></div></div>
<div class="ttc" id="aclassCreature_html_a1c8ea56d06ff96a720201c46a40969aa"><div class="ttname"><a href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">Creature::ranged_target_size</a></div><div class="ttdeci">double ranged_target_size() const</div><div class="ttdoc">Size of the target this creature presents to ranged weapons.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00547">ranged.cpp:547</a></div></div>
<div class="ttc" id="aclassCreature_html_a1eadbc3e5891d1ff578ac49291e12b66"><div class="ttname"><a href="classCreature.html#a1eadbc3e5891d1ff578ac49291e12b66">Creature::describe_infrared</a></div><div class="ttdeci">void describe_infrared(std::vector&lt; std::string &gt; &amp;buf) const</div><div class="ttdoc">Describe this creature as seen by the avatar via infrared vision.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l03199">creature.cpp:3199</a></div></div>
<div class="ttc" id="aclassCreature_html_a21b8fbeb525a28615eec6a6c22beff44"><div class="ttname"><a href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">Creature::facing</a></div><div class="ttdeci">FacingDirection facing</div><div class="ttdoc">return the direction the creature is facing, for sdl horizontal flip</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00303">creature.h:303</a></div></div>
<div class="ttc" id="aclassCreature_html_a3efb920d8e3d22ee766b62012ad0f9cd"><div class="ttname"><a href="classCreature.html#a3efb920d8e3d22ee766b62012ad0f9cd">Creature::as_avatar</a></div><div class="ttdeci">virtual avatar * as_avatar()</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00280">creature.h:280</a></div></div>
<div class="ttc" id="aclassCreature_html_a55d12f92d62a7c89c44b466d7e7cb00d"><div class="ttname"><a href="classCreature.html#a55d12f92d62a7c89c44b466d7e7cb00d">Creature::as_character</a></div><div class="ttdeci">virtual Character * as_character()</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00274">creature.h:274</a></div></div>
<div class="ttc" id="aclassCreature_html_a5698402eb4d7bbb013213f11f5768c92"><div class="ttname"><a href="classCreature.html#a5698402eb4d7bbb013213f11f5768c92">Creature::attitude_to</a></div><div class="ttdeci">virtual Attitude attitude_to(const Creature &amp;other) const =0</div><div class="ttdoc">Attitude (of this creature) towards another creature.</div></div>
<div class="ttc" id="aclassCreature_html_a5a2346f549de9c87e8f2afeec1e71366"><div class="ttname"><a href="classCreature.html#a5a2346f549de9c87e8f2afeec1e71366">Creature::is_underwater</a></div><div class="ttdeci">virtual bool is_underwater() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00292">creature.cpp:292</a></div></div>
<div class="ttc" id="aclassCreature_html_a5f818f1aa899ba2e2765f327a020a878"><div class="ttname"><a href="classCreature.html#a5f818f1aa899ba2e2765f327a020a878">Creature::sees</a></div><div class="ttdeci">bool sees(const Creature &amp;critter) const override</div><div class="ttdoc">The functions check whether this creature can see the target.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00358">creature.cpp:358</a></div></div>
<div class="ttc" id="aclassCreature_html_a6293c17885ef44d613618b4953a1be17"><div class="ttname"><a href="classCreature.html#a6293c17885ef44d613618b4953a1be17">Creature::describe_specials</a></div><div class="ttdeci">void describe_specials(std::vector&lt; std::string &gt; &amp;buf) const</div><div class="ttdoc">Describe this creature as detected by the avatar's special senses.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l03227">creature.cpp:3227</a></div></div>
<div class="ttc" id="aclassCreature_html_a73b9cb6320e4447addaec375887e7861"><div class="ttname"><a href="classCreature.html#a73b9cb6320e4447addaec375887e7861">Creature::dispersion_for_even_chance_of_good_hit</a></div><div class="ttdeci">static std::vector&lt; int &gt; dispersion_for_even_chance_of_good_hit</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l01271">creature.h:1271</a></div></div>
<div class="ttc" id="aclassCreature_html_a7bf62f4f36b0475f1f39ea27f3beebb0"><div class="ttname"><a href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">Creature::has_effect</a></div><div class="ttdeci">bool has_effect(const efftype_id &amp;eff_id, const bodypart_id &amp;bp) const</div><div class="ttdoc">Check if creature has the matching effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01770">creature.cpp:1770</a></div></div>
<div class="ttc" id="aclassCreature_html_a891bc2d0c564449cb462178317819254"><div class="ttname"><a href="classCreature.html#a891bc2d0c564449cb462178317819254">Creature::mod_moves</a></div><div class="ttdeci">void mod_moves(int nmoves)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02008">creature.cpp:2008</a></div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217">Creature::Attitude</a></div><div class="ttdeci">Attitude</div><div class="ttdoc">Simplified attitude towards any creature: hostile - hate, want to kill, etc.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00352">creature.h:352</a></div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747">Creature::Attitude::HOSTILE</a></div><div class="ttdeci">@ HOSTILE</div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217af6a34a956d1ce0a552bf4731b9f9d9c0"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217af6a34a956d1ce0a552bf4731b9f9d9c0">Creature::Attitude::FRIENDLY</a></div><div class="ttdeci">@ FRIENDLY</div></div>
<div class="ttc" id="aclassCreature_html_aaa501dbe3d1e90d47da43fb9ea57b3be"><div class="ttname"><a href="classCreature.html#aaa501dbe3d1e90d47da43fb9ea57b3be">Creature::get_dodge</a></div><div class="ttdeci">virtual float get_dodge() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02148">creature.cpp:2148</a></div></div>
<div class="ttc" id="aclassCreature_html_ab0d27ad3c2c730a3c88ee897e55f344f"><div class="ttname"><a href="classCreature.html#ab0d27ad3c2c730a3c88ee897e55f344f">Creature::print_info</a></div><div class="ttdeci">virtual int print_info(const catacurses::window &amp;w, int vStart, int vLines, int column) const =0</div><div class="ttdoc">Write information about this creature.</div></div>
<div class="ttc" id="aclassCreature_html_ac209d32cbfd3774af3d5c0500e2fae52"><div class="ttname"><a href="classCreature.html#ac209d32cbfd3774af3d5c0500e2fae52">Creature::is_avatar</a></div><div class="ttdeci">virtual bool is_avatar() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00265">creature.h:265</a></div></div>
<div class="ttc" id="aclassCreature_html_ac9fd76782cca4157eda2afcb7d66f02e"><div class="ttname"><a href="classCreature.html#ac9fd76782cca4157eda2afcb7d66f02e">Creature::get_size</a></div><div class="ttdeci">virtual creature_size get_size() const =0</div></div>
<div class="ttc" id="aclassCreature_html_aec78049b0ee4401d3a4c073663735aad"><div class="ttname"><a href="classCreature.html#aec78049b0ee4401d3a4c073663735aad">Creature::has_flag</a></div><div class="ttdeci">virtual bool has_flag(const mon_flag_id &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00752">creature.h:752</a></div></div>
<div class="ttc" id="aclassCreature_html_aed84fe52e1335d48d53f482f8a278c87"><div class="ttname"><a href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">Creature::is_npc</a></div><div class="ttdeci">virtual bool is_npc() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00268">creature.h:268</a></div></div>
<div class="ttc" id="aclassCreature_html_af3d3fb7cfb98cf3c36f0f0681414274a"><div class="ttname"><a href="classCreature.html#af3d3fb7cfb98cf3c36f0f0681414274a">Creature::get_moves</a></div><div class="ttdeci">int get_moves() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02004">creature.cpp:2004</a></div></div>
<div class="ttc" id="aclassCreature_html_af826bfbdc9d7f81a8b9e53775f43d080"><div class="ttname"><a href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">Creature::set_moves</a></div><div class="ttdeci">void set_moves(int nmoves)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02012">creature.cpp:2012</a></div></div>
<div class="ttc" id="aclassCreature_html_afc6e990c7faf2e750a941b8a92f892e2"><div class="ttname"><a href="classCreature.html#afc6e990c7faf2e750a941b8a92f892e2">Creature::archery_aim_counter</a></div><div class="ttdeci">int archery_aim_counter</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l01255">creature.h:1255</a></div></div>
<div class="ttc" id="aclassSkill_html_a879f0e8d0da73f0cdebd825134cd32d6"><div class="ttname"><a href="classSkill.html#a879f0e8d0da73f0cdebd825134cd32d6">Skill::time_to_attack</a></div><div class="ttdeci">time_info_t time_to_attack() const</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00087">skill.h:87</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html"><div class="ttname"><a href="classaim__activity__actor.html">aim_activity_actor</a></div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00044">activity_actor_definitions.h:45</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a064e415f122aefc25c29b9d3eee4fa4e"><div class="ttname"><a href="classaim__activity__actor.html#a064e415f122aefc25c29b9d3eee4fa4e">aim_activity_actor::aborted</a></div><div class="ttdeci">bool aborted</div><div class="ttdoc">Target UI requested to abort aiming.</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00061">activity_actor_definitions.h:61</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a14fa61e3a66db776b55f75a6dba7f67d"><div class="ttname"><a href="classaim__activity__actor.html#a14fa61e3a66db776b55f75a6dba7f67d">aim_activity_actor::abort_if_no_targets</a></div><div class="ttdeci">bool abort_if_no_targets</div><div class="ttdoc">if true abort if no targets are available when re-entering aiming ui after shooting</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00063">activity_actor_definitions.h:63</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a289353e8cf59d999c2e3db1db5d89f12"><div class="ttname"><a href="classaim__activity__actor.html#a289353e8cf59d999c2e3db1db5d89f12">aim_activity_actor::snap_to_target</a></div><div class="ttdeci">bool snap_to_target</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00055">activity_actor_definitions.h:55</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a59cdab2e147fa7c2d2d46b9440083e05"><div class="ttname"><a href="classaim__activity__actor.html#a59cdab2e147fa7c2d2d46b9440083e05">aim_activity_actor::first_turn</a></div><div class="ttdeci">bool first_turn</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00051">activity_actor_definitions.h:51</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a5a65a1ad1452654bdf0ce924ba8dcf53"><div class="ttname"><a href="classaim__activity__actor.html#a5a65a1ad1452654bdf0ce924ba8dcf53">aim_activity_actor::reload_requested</a></div><div class="ttdeci">bool reload_requested</div><div class="ttdoc">Target UI requested to abort aiming and reload weapon Implies aborted = true.</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00068">activity_actor_definitions.h:68</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a5e4630c6a7a1630c7d93714d221ed78e"><div class="ttname"><a href="classaim__activity__actor.html#a5e4630c6a7a1630c7d93714d221ed78e">aim_activity_actor::aif_duration</a></div><div class="ttdeci">int aif_duration</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00053">activity_actor_definitions.h:53</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a8f9b4001d182a0fc1ab4fdd8bd5b1507"><div class="ttname"><a href="classaim__activity__actor.html#a8f9b4001d182a0fc1ab4fdd8bd5b1507">aim_activity_actor::aiming_at_critter</a></div><div class="ttdeci">bool aiming_at_critter</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00054">activity_actor_definitions.h:54</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_a9835661ff059c7c690bf26075417b9b9"><div class="ttname"><a href="classaim__activity__actor.html#a9835661ff059c7c690bf26075417b9b9">aim_activity_actor::acceptable_losses</a></div><div class="ttdeci">std::vector&lt; weak_ptr_fast&lt; Creature &gt; &gt; acceptable_losses</div><div class="ttdoc">A friendly creature may enter line of fire during aim-and-shoot, and that generates a warning to proc...</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00075">activity_actor_definitions.h:75</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_ab7b696d1eb458e907dbccf99a5dd54aa"><div class="ttname"><a href="classaim__activity__actor.html#ab7b696d1eb458e907dbccf99a5dd54aa">aim_activity_actor::shifting_view</a></div><div class="ttdeci">bool shifting_view</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00058">activity_actor_definitions.h:58</a></div></div>
<div class="ttc" id="aclassaim__activity__actor_html_ae287f1e168ac9ea8cfc16f0f55d323ef"><div class="ttname"><a href="classaim__activity__actor.html#ae287f1e168ac9ea8cfc16f0f55d323ef">aim_activity_actor::action</a></div><div class="ttdeci">std::string action</div><div class="ttdef"><b>Definition:</b> <a href="activity__actor__definitions_8h_source.html#l00052">activity_actor_definitions.h:52</a></div></div>
<div class="ttc" id="aclassavatar_html"><div class="ttname"><a href="classavatar.html">avatar</a></div><div class="ttdef"><b>Definition:</b> <a href="avatar_8h_source.html#l00083">avatar.h:84</a></div></div>
<div class="ttc" id="aclassavatar_html_a8344dc1c4b8cd02a9633f3275cc69a2d"><div class="ttname"><a href="classavatar.html#a8344dc1c4b8cd02a9633f3275cc69a2d">avatar::aim_cache_dirty</a></div><div class="ttdeci">bool aim_cache_dirty</div><div class="ttdef"><b>Definition:</b> <a href="avatar_8h_source.html#l00381">avatar.h:381</a></div></div>
<div class="ttc" id="aclassavatar_html_a98553758b9d158c58dd11c77d97ff55e"><div class="ttname"><a href="classavatar.html#a98553758b9d158c58dd11c77d97ff55e">avatar::preferred_aiming_mode</a></div><div class="ttdeci">std::string preferred_aiming_mode</div><div class="ttdef"><b>Definition:</b> <a href="avatar_8h_source.html#l00283">avatar.h:283</a></div></div>
<div class="ttc" id="aclasscata_1_1event_html"><div class="ttname"><a href="classcata_1_1event.html">cata::event</a></div><div class="ttdef"><b>Definition:</b> <a href="event_8h_source.html#l00923">event.h:924</a></div></div>
<div class="ttc" id="aclasscatacurses_1_1window_html"><div class="ttname"><a href="classcatacurses_1_1window.html">catacurses::window</a></div><div class="ttdoc">A wrapper over a pointer to a curses window.</div><div class="ttdef"><b>Definition:</b> <a href="cursesdef_8h_source.html#l00054">cursesdef.h:55</a></div></div>
<div class="ttc" id="aclasscreature__tracker_html"><div class="ttname"><a href="classcreature__tracker.html">creature_tracker</a></div><div class="ttdef"><b>Definition:</b> <a href="creature__tracker_8h_source.html#l00024">creature_tracker.h:25</a></div></div>
<div class="ttc" id="aclasscreature__tracker_html_aba3c6663688bcd1806ea685d6961cb72"><div class="ttname"><a href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_tracker::creature_at</a></div><div class="ttdeci">T * creature_at(const tripoint &amp;p, bool allow_hallucination=false)</div><div class="ttdoc">Returns the Creature at the given location.</div><div class="ttdef"><b>Definition:</b> <a href="creature__tracker_8cpp_source.html#l00303">creature_tracker.cpp:303</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html"><div class="ttname"><a href="classdispersion__sources.html">dispersion_sources</a></div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00008">dispersion.h:9</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_a3b8451b0f7c962f1b9f1c19e48d0cf65"><div class="ttname"><a href="classdispersion__sources.html#a3b8451b0f7c962f1b9f1c19e48d0cf65">dispersion_sources::add_multiplier</a></div><div class="ttdeci">void add_multiplier(double new_multiplier)</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00025">dispersion.h:25</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_a61a49ec23021c4865d0dd9110a0b8b4e"><div class="ttname"><a href="classdispersion__sources.html#a61a49ec23021c4865d0dd9110a0b8b4e">dispersion_sources::add_spread</a></div><div class="ttdeci">void add_spread(double new_spread)</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00028">dispersion.h:28</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_ac3dc7f13e78a217aeaba57740f3af17c"><div class="ttname"><a href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">dispersion_sources::max</a></div><div class="ttdeci">double max() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00031">dispersion.cpp:31</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_af9119f90d39a52caf16086dca87b1cac"><div class="ttname"><a href="classdispersion__sources.html#af9119f90d39a52caf16086dca87b1cac">dispersion_sources::add_range</a></div><div class="ttdeci">void add_range(double new_source)</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8h_source.html#l00022">dispersion.h:22</a></div></div>
<div class="ttc" id="aclassenum__bitset_html"><div class="ttname"><a href="classenum__bitset.html">enum_bitset&lt; tname::segments &gt;</a></div></div>
<div class="ttc" id="aclassenum__bitset_html_a4817796a50f9f258865e0413ff1f91f9"><div class="ttname"><a href="classenum__bitset.html#a4817796a50f9f258865e0413ff1f91f9">enum_bitset::set</a></div><div class="ttdeci">enum_bitset &amp; set(E e, bool val=true)</div><div class="ttdef"><b>Definition:</b> <a href="enum__bitset_8h_source.html#l00048">enum_bitset.h:48</a></div></div>
<div class="ttc" id="aclassevent__bus_html_a29fab483aed46dcf2697e6e504e685dc"><div class="ttname"><a href="classevent__bus.html#a29fab483aed46dcf2697e6e504e685dc">event_bus::send_with_talker</a></div><div class="ttdeci">void send_with_talker(Creature *, Creature *, const cata::event &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="event__bus_8cpp_source.html#l00085">event_bus.cpp:85</a></div></div>
<div class="ttc" id="aclassevent__bus_html_ab753616a3a663185377ac52560068194"><div class="ttname"><a href="classevent__bus.html#ab753616a3a663185377ac52560068194">event_bus::send</a></div><div class="ttdeci">void send(const cata::event &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="event__bus_8cpp_source.html#l00072">event_bus.cpp:72</a></div></div>
<div class="ttc" id="aclassgun__mode_html"><div class="ttname"><a href="classgun__mode.html">gun_mode</a></div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00012">gun_mode.h:13</a></div></div>
<div class="ttc" id="aclassgun__mode_html_a0b58020ecc1a637010d13f0ee7c40ef8"><div class="ttname"><a href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">gun_mode::qty</a></div><div class="ttdeci">int qty</div><div class="ttdoc">burst size for is_gun() firearms, or melee range for is_melee() weapons</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00021">gun_mode.h:21</a></div></div>
<div class="ttc" id="aclassgun__mode_html_a29fb11a5199f83a9c5801bf2af6d99e9"><div class="ttname"><a href="classgun__mode.html#a29fb11a5199f83a9c5801bf2af6d99e9">gun_mode::melee</a></div><div class="ttdeci">bool melee() const</div><div class="ttdoc">if true perform a melee attach as opposed to shooting</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00033">gun_mode.h:33</a></div></div>
<div class="ttc" id="aclassgun__mode_html_a583a586a605731dbd36af20553c0e51d"><div class="ttname"><a href="classgun__mode.html#a583a586a605731dbd36af20553c0e51d">gun_mode::tname</a></div><div class="ttdeci">std::string tname() const</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00057">gun_mode.h:57</a></div></div>
<div class="ttc" id="aclassgun__mode_html_aadaa36507ace08fc621348ae1052647e"><div class="ttname"><a href="classgun__mode.html#aadaa36507ace08fc621348ae1052647e">gun_mode::target</a></div><div class="ttdeci">item * target</div><div class="ttdoc">pointer to item providing this mode - base gun or attached gunmod</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00019">gun_mode.h:19</a></div></div>
<div class="ttc" id="aclassinput__context_html"><div class="ttname"><a href="classinput__context.html">input_context</a></div><div class="ttdoc">Represents a context in which a set of actions can be performed.</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8h_source.html#l00039">input_context.h:40</a></div></div>
<div class="ttc" id="aclassinput__context_html_a0acd9546d02155a0b3a270560f20713a"><div class="ttname"><a href="classinput__context.html#a0acd9546d02155a0b3a270560f20713a">input_context::get_direction</a></div><div class="ttdeci">std::optional&lt; tripoint &gt; get_direction(const std::string &amp;action) const</div><div class="ttdoc">Convert a direction action (UP, DOWN etc) to a delta vector.</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l00551">input_context.cpp:551</a></div></div>
<div class="ttc" id="aclassinput__context_html_a1cd0c2537bc31a2c039e1178efb2ffdc"><div class="ttname"><a href="classinput__context.html#a1cd0c2537bc31a2c039e1178efb2ffdc">input_context::keys_bound_to</a></div><div class="ttdeci">std::vector&lt; input_event &gt; keys_bound_to(const std::string &amp;action_descriptor, int maximum_modifier_count=-1, bool restrict_to_printable=true, bool restrict_to_keyboard=true) const</div><div class="ttdoc">Keys (and only keys, other input types are not included) that trigger the given action.</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l00203">input_context.cpp:203</a></div></div>
<div class="ttc" id="aclassinput__context_html_a26d796fbe876b21a2d8b85eb5d59195f"><div class="ttname"><a href="classinput__context.html#a26d796fbe876b21a2d8b85eb5d59195f">input_context::register_directions</a></div><div class="ttdeci">void register_directions()</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l00492">input_context.cpp:492</a></div></div>
<div class="ttc" id="aclassinput__context_html_a43aa2fcd42cabfd04056def8986bc927"><div class="ttname"><a href="classinput__context.html#a43aa2fcd42cabfd04056def8986bc927">input_context::handle_input</a></div><div class="ttdeci">const std::string &amp; handle_input()</div><div class="ttdoc">Handles input and returns the next action in the queue.</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l00427">input_context.cpp:427</a></div></div>
<div class="ttc" id="aclassinput__context_html_a78a04063aa3ae17a4597ee7dcc584bfa"><div class="ttname"><a href="classinput__context.html#a78a04063aa3ae17a4597ee7dcc584bfa">input_context::get_coordinates</a></div><div class="ttdeci">std::optional&lt; tripoint &gt; get_coordinates(const catacurses::window &amp;capture_win_, const point &amp;offset=point_zero, bool center_cursor=false) const</div><div class="ttdoc">Get the coordinates associated with the last mouse click (if any).</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l01144">input_context.cpp:1144</a></div></div>
<div class="ttc" id="aclassinput__context_html_abe76d2c284f2a277cbd2f367963fa9ab"><div class="ttname"><a href="classinput__context.html#abe76d2c284f2a277cbd2f367963fa9ab">input_context::get_desc</a></div><div class="ttdeci">std::string get_desc(const std::string &amp;action_descriptor, unsigned int max_limit=0, const input_event_filter &amp;evt_filter=allow_all_keys) const</div><div class="ttdoc">Get a description text for the key/other input method associated with the given action.</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l00269">input_context.cpp:269</a></div></div>
<div class="ttc" id="aclassinput__context_html_ac66ac124d5c0ac5637b5806f124d428f"><div class="ttname"><a href="classinput__context.html#ac66ac124d5c0ac5637b5806f124d428f">input_context::register_action</a></div><div class="ttdeci">void register_action(const std::string &amp;action_descriptor)</div><div class="ttdoc">Register an action with this input context.</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l00180">input_context.cpp:180</a></div></div>
<div class="ttc" id="aclassinput__context_html_aec8e809c4ee9afcde858709e07b5f64b"><div class="ttname"><a href="classinput__context.html#aec8e809c4ee9afcde858709e07b5f64b">input_context::set_iso</a></div><div class="ttdeci">void set_iso(bool mode=true)</div><div class="ttdef"><b>Definition:</b> <a href="input__context_8cpp_source.html#l01268">input_context.cpp:1268</a></div></div>
<div class="ttc" id="aclassint__id_html_a315169d32cce4267b7c8dceff4b0d1d7"><div class="ttname"><a href="classint__id.html#a315169d32cce4267b7c8dceff4b0d1d7">int_id::obj</a></div><div class="ttdeci">const ammo_effect &amp; obj() const</div><div class="ttdef"><b>Definition:</b> <a href="ammo__effect_8cpp_source.html#l00026">ammo_effect.cpp:26</a></div></div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00028">item_location.h:29</a></div></div>
<div class="ttc" id="aclassitem__location_html_a350bb267073f30205f780b394324a32c"><div class="ttname"><a href="classitem__location.html#a350bb267073f30205f780b394324a32c">item_location::get_item</a></div><div class="ttdeci">item * get_item()</div><div class="ttdoc">Gets the selected item or nullptr.</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8cpp_source.html#l01087">item_location.cpp:1087</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00195">item.h:196</a></div></div>
<div class="ttc" id="aclassitem_html_a018fe1a11eaa7e18cae915d683088c02"><div class="ttname"><a href="classitem.html#a018fe1a11eaa7e18cae915d683088c02">item::put_in</a></div><div class="ttdeci">ret_val&lt; void &gt; put_in(const item &amp;payload, pocket_type pk_type, bool unseal_pockets=false, Character *carrier=nullptr)</div><div class="ttdoc">Puts the given item into this one.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01784">item.cpp:1784</a></div></div>
<div class="ttc" id="aclassitem_html_a05c24ca1052a7a8cb9fd314acdb49f40"><div class="ttname"><a href="classitem.html#a05c24ca1052a7a8cb9fd314acdb49f40">item::is_favorite</a></div><div class="ttdeci">bool is_favorite</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03213">item.h:3213</a></div></div>
<div class="ttc" id="aclassitem_html_a0795ac0d3e2ba958ab3a6ff4e282482b"><div class="ttname"><a href="classitem.html#a0795ac0d3e2ba958ab3a6ff4e282482b">item::made_of</a></div><div class="ttdeci">const std::map&lt; material_id, int &gt; &amp; made_of() const</div><div class="ttdoc">The ids of all the materials this is made of.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09146">item.cpp:9146</a></div></div>
<div class="ttc" id="aclassitem_html_a084b8b7138242ba272d566bf49d007c3"><div class="ttname"><a href="classitem.html#a084b8b7138242ba272d566bf49d007c3">item::ammo_capacity</a></div><div class="ttdeci">int ammo_capacity(const ammotype &amp;ammo, bool include_linked=false) const</div><div class="ttdoc">ammo capacity for a specific ammo</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10801">item.cpp:10801</a></div></div>
<div class="ttc" id="aclassitem_html_a0b12108a604ac9d940716bb8f1368cf5"><div class="ttname"><a href="classitem.html#a0b12108a604ac9d940716bb8f1368cf5">item::get_var</a></div><div class="ttdeci">double get_var(const std::string &amp;name, double default_value) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01839">item.cpp:1839</a></div></div>
<div class="ttc" id="aclassitem_html_a11cf8d500b6d8106302470dce5ca9177"><div class="ttname"><a href="classitem.html#a11cf8d500b6d8106302470dce5ca9177">item::find_type</a></div><div class="ttdeci">static const itype * find_type(const itype_id &amp;type)</div><div class="ttdoc">Returns the item type of the given identifier.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l14581">item.cpp:14581</a></div></div>
<div class="ttc" id="aclassitem_html_a13b2b008995a2f2f2daa63be578b27c8"><div class="ttname"><a href="classitem.html#a13b2b008995a2f2f2daa63be578b27c8">item::base_damage_thrown</a></div><div class="ttdeci">damage_instance base_damage_thrown() const</div><div class="ttdoc">All damage types this item deals when thrown (no skill modifiers etc.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07503">item.cpp:7503</a></div></div>
<div class="ttc" id="aclassitem_html_a159a8d7dbb5135f556838aec5e223287"><div class="ttname"><a href="classitem.html#a159a8d7dbb5135f556838aec5e223287">item::magazine_default</a></div><div class="ttdeci">itype_id magazine_default(bool conversion=false) const</div><div class="ttdoc">Get the default magazine type (if any) for the current effective ammo type.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11185">item.cpp:11185</a></div></div>
<div class="ttc" id="aclassitem_html_a187a2679361c6546be613657dbad3b3f"><div class="ttname"><a href="classitem.html#a187a2679361c6546be613657dbad3b3f">item::is_ammo_container</a></div><div class="ttdeci">bool is_ammo_container() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09578">item.cpp:9578</a></div></div>
<div class="ttc" id="aclassitem_html_a19e6dd5afd4bada41c8d97792fd0815d"><div class="ttname"><a href="classitem.html#a19e6dd5afd4bada41c8d97792fd0815d">item::get_property_int64_t</a></div><div class="ttdeci">int64_t get_property_int64_t(const std::string &amp;prop, int64_t def=0) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07686">item.cpp:7686</a></div></div>
<div class="ttc" id="aclassitem_html_a1a94ea108d695febf7f2bcf090f097fa"><div class="ttname"><a href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">item::gun_current_mode</a></div><div class="ttdeci">gun_mode gun_current_mode() const</div><div class="ttdoc">Get the current mode for this gun (or an invalid mode if item is not a gun)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11420">item.cpp:11420</a></div></div>
<div class="ttc" id="aclassitem_html_a1ce97bab127dbbcd371f4e83bb441c38"><div class="ttname"><a href="classitem.html#a1ce97bab127dbbcd371f4e83bb441c38">item::energy_remaining</a></div><div class="ttdeci">units::energy energy_remaining(const Character *carrier=nullptr) const</div><div class="ttdoc">Energy available from battery/UPS/bionics.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10750">item.cpp:10750</a></div></div>
<div class="ttc" id="aclassitem_html_a2899a37f781e1efea9465a98277141c7"><div class="ttname"><a href="classitem.html#a2899a37f781e1efea9465a98277141c7">item::get_min_str</a></div><div class="ttdeci">int get_min_str() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l14704">item.cpp:14704</a></div></div>
<div class="ttc" id="aclassitem_html_a28fa4969a257ea0b79acc9c60595ee7b"><div class="ttname"><a href="classitem.html#a28fa4969a257ea0b79acc9c60595ee7b">item::can_contain</a></div><div class="ttdeci">ret_val&lt; void &gt; can_contain(const item &amp;it, bool nested=false, bool ignore_rigidity=false, bool ignore_pkt_settings=true, bool is_pick_up_inv=false, const item_location &amp;parent_it=item_location(), units::volume remaining_parent_volume=10000000_ml, bool allow_nested=true) const</div><div class="ttdoc">Can the pocket contain the specified item?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10101">item.cpp:10101</a></div></div>
<div class="ttc" id="aclassitem_html_a2912b2e15a4eec07a5070fffbbd152e8"><div class="ttname"><a href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">item::is_gun</a></div><div class="ttdeci">bool is_gun() const</div><div class="ttdoc">Can this item be used to perform a ranged attack?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09297">item.cpp:9297</a></div></div>
<div class="ttc" id="aclassitem_html_a2993eb10a5ae589e6bb1be0a74cb65c1"><div class="ttname"><a href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">item::active</a></div><div class="ttdeci">bool active</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03212">item.h:3212</a></div></div>
<div class="ttc" id="aclassitem_html_a2eefa8e0a7fd8e2c60f3e4247a629685"><div class="ttname"><a href="classitem.html#a2eefa8e0a7fd8e2c60f3e4247a629685">item::has_fault_flag</a></div><div class="ttdeci">bool has_fault_flag(const std::string &amp;searched_flag) const</div><div class="ttdoc">Does this item part have a fault with this flag.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07563">item.cpp:7563</a></div></div>
<div class="ttc" id="aclassitem_html_a30837987c08ac5daf3b1e377e0ecaa21"><div class="ttname"><a href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">item::tname</a></div><div class="ttdeci">std::string tname(unsigned int quantity=1, tname::segment_bitset const &amp;segments=tname::default_tname) const</div><div class="ttdoc">Return the (translated) item name.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06814">item.cpp:6814</a></div></div>
<div class="ttc" id="aclassitem_html_a3157f01f1da6fe89bdbc87db2605afb9"><div class="ttname"><a href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">item::weight</a></div><div class="ttdeci">units::mass weight(bool include_contents=true, bool integral=false) const</div><div class="ttdoc">Total weight of an item accounting for all contained/integrated items.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07081">item.cpp:7081</a></div></div>
<div class="ttc" id="aclassitem_html_a3694c5d9138956736af2444bd7b3972e"><div class="ttname"><a href="classitem.html#a3694c5d9138956736af2444bd7b3972e">item::gun_noise</a></div><div class="ttdeci">sound_data gun_noise(bool burst=false) const</div><div class="ttdoc">Returns the sound of the gun being fired.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02185">ranged.cpp:2185</a></div></div>
<div class="ttc" id="aclassitem_html_a3b83c2e0d1313b542801169382be1605"><div class="ttname"><a href="classitem.html#a3b83c2e0d1313b542801169382be1605">item::gun_get_mode_id</a></div><div class="ttdeci">gun_mode_id gun_get_mode_id() const</div><div class="ttdoc">Get id of mode a gun is currently set to, e.g.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11425">item.cpp:11425</a></div></div>
<div class="ttc" id="aclassitem_html_a3d8542661f2e2a82e8cb3792584912f3"><div class="ttname"><a href="classitem.html#a3d8542661f2e2a82e8cb3792584912f3">item::gun_skill</a></div><div class="ttdeci">skill_id gun_skill() const</div><div class="ttdoc">The skill used to operate the gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10391">item.cpp:10391</a></div></div>
<div class="ttc" id="aclassitem_html_a3e532e4e5b7cef943634b1d910f99384"><div class="ttname"><a href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">item::has_flag</a></div><div class="ttdeci">bool has_flag(const flag_id &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07578">item.cpp:7578</a></div></div>
<div class="ttc" id="aclassitem_html_a40963a016376016eb408bdb9dbb94388"><div class="ttname"><a href="classitem.html#a40963a016376016eb408bdb9dbb94388">item::count_by_charges</a></div><div class="ttdeci">bool count_by_charges() const</div><div class="ttdoc">Return true if this item's type is counted by charges (true for stackable, ammo, or comestible)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08618">item.cpp:8618</a></div></div>
<div class="ttc" id="aclassitem_html_a428ea67bcf1a68b717f7cd4871b0b980"><div class="ttname"><a href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">item::ammo_remaining</a></div><div class="ttdeci">int ammo_remaining(const Character *carrier=nullptr, bool include_linked=false) const</div><div class="ttdoc">Quantity of ammunition currently loaded in tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10739">item.cpp:10739</a></div></div>
<div class="ttc" id="aclassitem_html_a4800c32ea052d36233db889257cc7867"><div class="ttname"><a href="classitem.html#a4800c32ea052d36233db889257cc7867">item::min_cycle_recoil</a></div><div class="ttdeci">int min_cycle_recoil() const</div><div class="ttdoc">The minimum force required to cycle the gun, can be overridden by mods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10438">item.cpp:10438</a></div></div>
<div class="ttc" id="aclassitem_html_a4938361b8fe897c4e85d66020ef91aff"><div class="ttname"><a href="classitem.html#a4938361b8fe897c4e85d66020ef91aff">item::set_var</a></div><div class="ttdeci">void set_var(const std::string &amp;name, int value)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01809">item.cpp:1809</a></div></div>
<div class="ttc" id="aclassitem_html_a4adcc4a3a5f5fb20a4d245d79109640a"><div class="ttname"><a href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">item::ammo_data</a></div><div class="ttdeci">const itype * ammo_data() const</div><div class="ttdoc">Specific ammo data, returns nullptr if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10995">item.cpp:10995</a></div></div>
<div class="ttc" id="aclassitem_html_a5ac32d5d8193f5fad10893881f53cb1c"><div class="ttname"><a href="classitem.html#a5ac32d5d8193f5fad10893881f53cb1c">item::attack_time</a></div><div class="ttdeci">int attack_time(const Character &amp;you) const</div><div class="ttdoc">Base number of moves (Creature::moves) that a single melee attack with this items takes.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07444">item.cpp:7444</a></div></div>
<div class="ttc" id="aclassitem_html_a5b29c86dff457effe5dc4b9e7a24da12"><div class="ttname"><a href="classitem.html#a5b29c86dff457effe5dc4b9e7a24da12">item::set_flag</a></div><div class="ttdeci">item &amp; set_flag(const flag_id &amp;flag)</div><div class="ttdoc">Idempotent filter setting an item specific flag.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07602">item.cpp:7602</a></div></div>
<div class="ttc" id="aclassitem_html_a5cc833f71e0454446fd0f877d24f6585"><div class="ttname"><a href="classitem.html#a5cc833f71e0454446fd0f877d24f6585">item::common_ammo_default</a></div><div class="ttdeci">itype_id common_ammo_default(bool conversion=true) const</div><div class="ttdoc">Get default ammo for the first ammotype common to an item and its current magazine or &quot;NULL&quot; if none ...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11129">item.cpp:11129</a></div></div>
<div class="ttc" id="aclassitem_html_a616aedf5cb1225f658078d1ffa48e8f6"><div class="ttname"><a href="classitem.html#a616aedf5cb1225f658078d1ffa48e8f6">item::total_contained_volume</a></div><div class="ttdeci">units::volume total_contained_volume() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l12005">item.cpp:12005</a></div></div>
<div class="ttc" id="aclassitem_html_a624c3b7ec10ae766a9e75718af71e647"><div class="ttname"><a href="classitem.html#a624c3b7ec10ae766a9e75718af71e647">item::ammo_current</a></div><div class="ttdeci">itype_id ammo_current() const</div><div class="ttdoc">Specific ammo type, returns &quot;null&quot; if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11021">item.cpp:11021</a></div></div>
<div class="ttc" id="aclassitem_html_a660699e1c63b2ab0b4e5ac88e61d8ad6"><div class="ttname"><a href="classitem.html#a660699e1c63b2ab0b4e5ac88e61d8ad6">item::faults</a></div><div class="ttdeci">cata::heap&lt; std::set&lt; fault_id &gt; &gt; faults</div><div class="ttdoc">What faults (if any) currently apply to this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03077">item.h:3077</a></div></div>
<div class="ttc" id="aclassitem_html_a686df014e8aa8bc4637883802d05f935"><div class="ttname"><a href="classitem.html#a686df014e8aa8bc4637883802d05f935">item::volume</a></div><div class="ttdeci">units::volume volume(bool integral=false, bool ignore_contents=false, int charges_in_vol=-1) const</div><div class="ttdoc">Total volume of an item accounting for all contained/integrated items NOTE: Result is rounded up to n...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07360">item.cpp:7360</a></div></div>
<div class="ttc" id="aclassitem_html_a6a3f16444c412bce4b75a7d600d6a3fe"><div class="ttname"><a href="classitem.html#a6a3f16444c412bce4b75a7d600d6a3fe">item::ammo_set</a></div><div class="ttdeci">item &amp; ammo_set(const itype_id &amp;ammo, int qty=-1)</div><div class="ttdoc">Filter setting the ammo for this instance Any existing ammo is removed.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00719">item.cpp:719</a></div></div>
<div class="ttc" id="aclassitem_html_a6bfb92ab5d41e0eb3a1da160fac71b0e"><div class="ttname"><a href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">item::charges</a></div><div class="ttdeci">int charges</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03133">item.h:3133</a></div></div>
<div class="ttc" id="aclassitem_html_a6d1575c31b1dc0df51cbe3a1dfbfef16"><div class="ttname"><a href="classitem.html#a6d1575c31b1dc0df51cbe3a1dfbfef16">item::on_contents_changed</a></div><div class="ttdeci">void on_contents_changed()</div><div class="ttdoc">Callback when contents of the item are affected in any way other than just processing.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06722">item.cpp:6722</a></div></div>
<div class="ttc" id="aclassitem_html_a6d3164628041c6ccdce14aedd711b640"><div class="ttname"><a href="classitem.html#a6d3164628041c6ccdce14aedd711b640">item::get_gun_energy_drain</a></div><div class="ttdeci">units::energy get_gun_energy_drain() const</div><div class="ttdoc">Get gun energy drain.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l14586">item.cpp:14586</a></div></div>
<div class="ttc" id="aclassitem_html_a6dc463a17ae0cac2850b6d1bc8b34fa7"><div class="ttname"><a href="classitem.html#a6dc463a17ae0cac2850b6d1bc8b34fa7">item::inc_damage</a></div><div class="ttdeci">bool inc_damage()</div><div class="ttdoc">Same as mod_damage( itype::damage_scale ), advances item to next damage level.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08947">item.cpp:8947</a></div></div>
<div class="ttc" id="aclassitem_html_a723753bab4cc789e3ec186846c9916a3"><div class="ttname"><a href="classitem.html#a723753bab4cc789e3ec186846c9916a3">item::is_container</a></div><div class="ttdeci">bool is_container() const</div><div class="ttdoc">Whether this is container.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09667">item.cpp:9667</a></div></div>
<div class="ttc" id="aclassitem_html_a768c08639c1047f61b9aab2b894e9bcd"><div class="ttname"><a href="classitem.html#a768c08639c1047f61b9aab2b894e9bcd">item::ammo_effects</a></div><div class="ttdeci">std::set&lt; std::string &gt; ammo_effects(bool with_ammo=true) const</div><div class="ttdoc">Get ammo effects for item optionally inclusive of any resulting from the loaded ammo.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11143">item.cpp:11143</a></div></div>
<div class="ttc" id="aclassitem_html_a77cad1ee17273a24e50fe42e03eea269"><div class="ttname"><a href="classitem.html#a77cad1ee17273a24e50fe42e03eea269">item::gun_range</a></div><div class="ttdeci">int gun_range(const Character *p) const</div><div class="ttdoc">The weapons range in map squares.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10648">item.cpp:10648</a></div></div>
<div class="ttc" id="aclassitem_html_a7dc5d9ccf5638ae80cebe1864050fa26"><div class="ttname"><a href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">item::ammo_required</a></div><div class="ttdeci">int ammo_required() const</div><div class="ttdoc">Quantity of ammunition consumed per usage of tool or with each shot of gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10821">item.cpp:10821</a></div></div>
<div class="ttc" id="aclassitem_html_a7f1ae4e309841707eea0852dd4cd95a3"><div class="ttname"><a href="classitem.html#a7f1ae4e309841707eea0852dd4cd95a3">item::activate</a></div><div class="ttdeci">item &amp; activate()</div><div class="ttdoc">Filter converting instance to active state.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00685">item.cpp:685</a></div></div>
<div class="ttc" id="aclassitem_html_a8b6013a4dab952626df6834f46ec048f"><div class="ttname"><a href="classitem.html#a8b6013a4dab952626df6834f46ec048f">item::force_insert_item</a></div><div class="ttdeci">void force_insert_item(const item &amp;it, pocket_type pk_type)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01803">item.cpp:1803</a></div></div>
<div class="ttc" id="aclassitem_html_a9a1f33d04abe5ec73a31213be8d0c44e"><div class="ttname"><a href="classitem.html#a9a1f33d04abe5ec73a31213be8d0c44e">item::set_favorite</a></div><div class="ttdeci">void set_favorite(bool favorite)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l14753">item.cpp:14753</a></div></div>
<div class="ttc" id="aclassitem_html_a9e2c24734b538e61e186fb6777b62c25"><div class="ttname"><a href="classitem.html#a9e2c24734b538e61e186fb6777b62c25">item::made_of_any</a></div><div class="ttdeci">bool made_of_any(const std::set&lt; material_id &gt; &amp;mat_idents) const</div><div class="ttdoc">Check we are made of at least one of a set (e.g.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09218">item.cpp:9218</a></div></div>
<div class="ttc" id="aclassitem_html_aa1a2ecb3e9ebf95dc7fedac4c1de32b4"><div class="ttname"><a href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">item::gun_all_modes</a></div><div class="ttdeci">std::map&lt; gun_mode_id, gun_mode &gt; gun_all_modes() const</div><div class="ttdoc">Get all possible modes for this gun inclusive of any attached gunmods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11361">item.cpp:11361</a></div></div>
<div class="ttc" id="aclassitem_html_aafdd6e14936eb02b0d71a96e7e325746"><div class="ttname"><a href="classitem.html#aafdd6e14936eb02b0d71a96e7e325746">item::ammo_sufficient</a></div><div class="ttdeci">bool ammo_sufficient(const Character *carrier, int qty=1) const</div><div class="ttdoc">Check if sufficient ammo is loaded for given number of uses.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10855">item.cpp:10855</a></div></div>
<div class="ttc" id="aclassitem_html_ab07d96e30c441a84435972df842f4c77"><div class="ttname"><a href="classitem.html#ab07d96e30c441a84435972df842f4c77">item::ammo_default</a></div><div class="ttdeci">itype_id ammo_default(bool conversion=true) const</div><div class="ttdoc">Default ammo for the the item magazine pocket, if item has ammo_types().</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11081">item.cpp:11081</a></div></div>
<div class="ttc" id="aclassitem_html_ab22fc9a4e0f9c6f5569b93e00deccfac"><div class="ttname"><a href="classitem.html#ab22fc9a4e0f9c6f5569b93e00deccfac">item::magazine_current</a></div><div class="ttdeci">item * magazine_current()</div><div class="ttdoc">Currently loaded magazine (if any)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11207">item.cpp:11207</a></div></div>
<div class="ttc" id="aclassitem_html_ac11fd08d9b41ad301b7135906df8c33e"><div class="ttname"><a href="classitem.html#ac11fd08d9b41ad301b7135906df8c33e">item::gunmod_find_by_flag</a></div><div class="ttdeci">item * gunmod_find_by_flag(const flag_id &amp;flag)</div><div class="ttdoc">Get first attached gunmod with flag or nullptr if no such mod or item is not a gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11261">item.cpp:11261</a></div></div>
<div class="ttc" id="aclassitem_html_ac1d2c4c33b8a499812f3437cb2fad742"><div class="ttname"><a href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">item::type</a></div><div class="ttdeci">const itype * type</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03074">item.h:3074</a></div></div>
<div class="ttc" id="aclassitem_html_acd78321ba4d5c09d39f1d58d20b68484"><div class="ttname"><a href="classitem.html#acd78321ba4d5c09d39f1d58d20b68484">item::gunmods</a></div><div class="ttdeci">std::vector&lt; item * &gt; gunmods()</div><div class="ttdoc">Returns all gunmods currently attached to this item (always empty if item not a gun)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11217">item.cpp:11217</a></div></div>
<div class="ttc" id="aclassitem_html_adaaa3ece39eb40637371659dad8550e3"><div class="ttname"><a href="classitem.html#adaaa3ece39eb40637371659dad8550e3">item::faults_potential</a></div><div class="ttdeci">std::set&lt; fault_id &gt; faults_potential() const</div><div class="ttdoc">What faults can potentially occur with this item?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09821">item.cpp:9821</a></div></div>
<div class="ttc" id="aclassitem_html_adb2ea39327f1a8da37740b4bfb171a5d"><div class="ttname"><a href="classitem.html#adb2ea39327f1a8da37740b4bfb171a5d">item::current_reach_range</a></div><div class="ttdeci">int current_reach_range(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07532">item.cpp:7532</a></div></div>
<div class="ttc" id="aclassitem_html_adce43f2490a85e2dc212a26ce5ded4fc"><div class="ttname"><a href="classitem.html#adce43f2490a85e2dc212a26ce5ded4fc">item::is_magazine</a></div><div class="ttdeci">bool is_magazine() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09445">item.cpp:9445</a></div></div>
<div class="ttc" id="aclassitem_html_adfd6f9946d4895a6ef2190e07c2486a3"><div class="ttname"><a href="classitem.html#adfd6f9946d4895a6ef2190e07c2486a3">item::gun_dispersion</a></div><div class="ttdeci">int gun_dispersion(bool with_ammo=true, bool with_scaling=true) const</div><div class="ttdoc">Summed dispersion of a gun, including values from mods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10455">item.cpp:10455</a></div></div>
<div class="ttc" id="aclassitem_html_ae8a58c6fe3c80cded11d6f3ccfa548a3"><div class="ttname"><a href="classitem.html#ae8a58c6fe3c80cded11d6f3ccfa548a3">item::damage</a></div><div class="ttdeci">int damage() const</div><div class="ttdoc">How much damage has the item sustained?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00858">item.cpp:858</a></div></div>
<div class="ttc" id="aclassitem_html_ae92e7a0bc79eedb9b113fd7cbda37b57"><div class="ttname"><a href="classitem.html#ae92e7a0bc79eedb9b113fd7cbda37b57">item::first_ammo</a></div><div class="ttdeci">item &amp; first_ammo()</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10840">item.cpp:10840</a></div></div>
<div class="ttc" id="aclassitem_html_ae9daf89e99f089da259528d1ed85e75d"><div class="ttname"><a href="classitem.html#ae9daf89e99f089da259528d1ed85e75d">item::get_total_capacity</a></div><div class="ttdeci">units::volume get_total_capacity(bool unrestricted_pockets_only=false) const</div><div class="ttdoc">It returns the maximum volume of any contents, including liquids, ammo, magazines,...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11903">item.cpp:11903</a></div></div>
<div class="ttc" id="aclassitem_html_aeb49bb1b64eba3731e606ffe83e95b4f"><div class="ttname"><a href="classitem.html#aeb49bb1b64eba3731e606ffe83e95b4f">item::has_property</a></div><div class="ttdeci">bool has_property(const std::string &amp;prop) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07675">item.cpp:7675</a></div></div>
<div class="ttc" id="aclassitem_html_aed15b9f2983bf68f5701e2b7e3b6ac73"><div class="ttname"><a href="classitem.html#aed15b9f2983bf68f5701e2b7e3b6ac73">item::ammo_types</a></div><div class="ttdeci">std::set&lt; ammotype &gt; ammo_types(bool conversion=true) const</div><div class="ttdoc">Ammo types (ammunition_type) the item magazine pocket can contain.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11056">item.cpp:11056</a></div></div>
<div class="ttc" id="aclassitem_html_af0ba40b31415b6f32050d014a501b4b1"><div class="ttname"><a href="classitem.html#af0ba40b31415b6f32050d014a501b4b1">item::gun_damage</a></div><div class="ttdeci">damage_instance gun_damage(bool with_ammo=true, bool shot=false) const</div><div class="ttdoc">Summed ranged damage, armor piercing, and multipliers for both, of a gun, including values from mods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10507">item.cpp:10507</a></div></div>
<div class="ttc" id="aclassitem_html_af373f646c1ee172941490dc7cc04bbcd"><div class="ttname"><a href="classitem.html#af373f646c1ee172941490dc7cc04bbcd">item::is_two_handed</a></div><div class="ttdeci">bool is_two_handed(const Character &amp;guy) const</div><div class="ttdoc">Whether the character needs both hands to wield this item.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09137">item.cpp:9137</a></div></div>
<div class="ttc" id="aclassitem_html_afb76ea7bd94d06815e5ab68b520b2a19"><div class="ttname"><a href="classitem.html#afb76ea7bd94d06815e5ab68b520b2a19">item::sight_dispersion</a></div><div class="ttdeci">std::pair&lt; int, int &gt; sight_dispersion(const Character &amp;character) const</div><div class="ttdoc">Get lowest actual and effective dispersion of either integral or any attached sights for specific cha...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10483">item.cpp:10483</a></div></div>
<div class="ttc" id="aclassitem_html_afcc181d2e2fe380ac28dd70f814798c2"><div class="ttname"><a href="classitem.html#afcc181d2e2fe380ac28dd70f814798c2">item::gun_set_mode</a></div><div class="ttdeci">bool gun_set_mode(const gun_mode_id &amp;mode)</div><div class="ttdoc">Try to set the mode for a gun, returning false if no such mode is possible.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11433">item.cpp:11433</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00345">map.h:346</a></div></div>
<div class="ttc" id="aclassmap_html_a0f73359be972a030063b4e84f770275e"><div class="ttname"><a href="classmap.html#a0f73359be972a030063b4e84f770275e">map::find_clear_path</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; find_clear_path(const tripoint &amp;source, const tripoint &amp;destination) const</div><div class="ttdoc">Iteratively tries Bresenham lines with different biases until it finds a clear line or decides there ...</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l07616">map.cpp:7616</a></div></div>
<div class="ttc" id="aclassmap_html_a32a9de57ddea3145ca42e6acfde7f3d6"><div class="ttname"><a href="classmap.html#a32a9de57ddea3145ca42e6acfde7f3d6">map::add_field</a></div><div class="ttdeci">bool add_field(const tripoint &amp;p, const field_type_id &amp;type_id, int intensity=INT_MAX, const time_duration &amp;age=0_turns, bool hit_player=true)</div><div class="ttdoc">Add field entry at point, or set intensity if present.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06563">map.cpp:6563</a></div></div>
<div class="ttc" id="aclassmap_html_a34187b9eff71461437403611d0d122a7"><div class="ttname"><a href="classmap.html#a34187b9eff71461437403611d0d122a7">map::ranged_target_size</a></div><div class="ttdeci">double ranged_target_size(const tripoint &amp;p) const</div><div class="ttdoc">Size of map objects at p for purposes of ranged combat.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02638">map.cpp:2638</a></div></div>
<div class="ttc" id="aclassmap_html_a426c21f7244ff80a61685a89e9146fec"><div class="ttname"><a href="classmap.html#a426c21f7244ff80a61685a89e9146fec">map::getlocal</a></div><div class="ttdeci">tripoint getlocal(const tripoint &amp;p) const</div><div class="ttdoc">Inverse of getabs.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09635">map.cpp:9635</a></div></div>
<div class="ttc" id="aclassmap_html_a47284179cd831f04aaa7ff3242a5fb7b"><div class="ttname"><a href="classmap.html#a47284179cd831f04aaa7ff3242a5fb7b">map::ambient_light_at</a></div><div class="ttdeci">float ambient_light_at(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="lightmap_8cpp_source.html#l00640">lightmap.cpp:640</a></div></div>
<div class="ttc" id="aclassmap_html_a501f3a1d449ac022f1b36b99da653e94"><div class="ttname"><a href="classmap.html#a501f3a1d449ac022f1b36b99da653e94">map::getabs</a></div><div class="ttdeci">tripoint getabs(const tripoint &amp;p) const</div><div class="ttdoc">Translates local (to this map) coordinates of a square to global absolute coordinates.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09614">map.cpp:9614</a></div></div>
<div class="ttc" id="aclassmap_html_a516c0764134cc86b57297811520395f7"><div class="ttname"><a href="classmap.html#a516c0764134cc86b57297811520395f7">map::has_flag_ter_or_furn</a></div><div class="ttdeci">bool has_flag_ter_or_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03122">map.cpp:3122</a></div></div>
<div class="ttc" id="aclassmap_html_a5579e13088b4ccd9c5a75458919d528a"><div class="ttname"><a href="classmap.html#a5579e13088b4ccd9c5a75458919d528a">map::add_item_or_charges</a></div><div class="ttdeci">item &amp; add_item_or_charges(const tripoint &amp;pos, item obj, bool overflow=true)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05177">map.cpp:5177</a></div></div>
<div class="ttc" id="aclassmap_html_a7481e86917674a912940956719d2eaa3"><div class="ttname"><a href="classmap.html#a7481e86917674a912940956719d2eaa3">map::invalidate_map_cache</a></div><div class="ttdeci">void invalidate_map_cache(int zlev)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00375">map.cpp:375</a></div></div>
<div class="ttc" id="aclassmap_html_aa487d96256c3d35db7a1bf273156b64a"><div class="ttname"><a href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">map::veh_at</a></div><div class="ttdeci">optional_vpart_position veh_at(const tripoint &amp;p) const</div><div class="ttdoc">Checks if tile is occupied by vehicle and by which part.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01316">map.cpp:1316</a></div></div>
<div class="ttc" id="aclassmap_html_ad189f4216a9eaacbf9c5aa0ceedaea18"><div class="ttname"><a href="classmap.html#ad189f4216a9eaacbf9c5aa0ceedaea18">map::drawsq</a></div><div class="ttdeci">void drawsq(const catacurses::window &amp;w, const tripoint &amp;p, const drawsq_params &amp;params) const</div><div class="ttdoc">Draw the map tile at the given coordinate.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l07059">map.cpp:7059</a></div></div>
<div class="ttc" id="aclassmonster_html"><div class="ttname"><a href="classmonster.html">monster</a></div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00085">monster.h:86</a></div></div>
<div class="ttc" id="aclassmonster_html_a02fa605494e946663ddd216166828f2a"><div class="ttname"><a href="classmonster.html#a02fa605494e946663ddd216166828f2a">monster::as_monster</a></div><div class="ttdeci">monster * as_monster() override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00101">monster.h:101</a></div></div>
<div class="ttc" id="aclassmonster_html_aa30f973bf524ba275ada847f6118b048"><div class="ttname"><a href="classmonster.html#aa30f973bf524ba275ada847f6118b048">monster::type</a></div><div class="ttdeci">const mtype * type</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00550">monster.h:550</a></div></div>
<div class="ttc" id="aclassnc__color_html"><div class="ttname"><a href="classnc__color.html">nc_color</a></div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00347">color.h:348</a></div></div>
<div class="ttc" id="aclassnpc_html"><div class="ttname"><a href="classnpc.html">npc</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00791">npc.h:792</a></div></div>
<div class="ttc" id="aclassnpc_html_ac7ecd979db776f376e3ccb34553e45d6"><div class="ttname"><a href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">npc::pretend_fire</a></div><div class="ttdeci">void pretend_fire(npc *source, int shots, item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00835">ranged.cpp:835</a></div></div>
<div class="ttc" id="aclassnpc_html_adc0b90f197e58b09eb6eb92132d432f0"><div class="ttname"><a href="classnpc.html#adc0b90f197e58b09eb6eb92132d432f0">npc::guaranteed_hostile</a></div><div class="ttdeci">bool guaranteed_hostile() const</div><div class="ttdoc">Is enemy or will turn into one (can't be convinced not to attack).</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02312">npc.cpp:2312</a></div></div>
<div class="ttc" id="aclasson__out__of__scope_html"><div class="ttname"><a href="classon__out__of__scope.html">on_out_of_scope</a></div><div class="ttdef"><b>Definition:</b> <a href="cata__scope__helpers_8h_source.html#l00007">cata_scope_helpers.h:8</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html"><div class="ttname"><a href="classoptional__vpart__position.html">optional_vpart_position</a></div><div class="ttdoc">Simple wrapper to forward functions that may return a std::optional to vpart_position.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00124">vpart_position.h:125</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_a4c78451e42e97753079ecd2a54c7143d"><div class="ttname"><a href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">optional_vpart_position::part_with_feature</a></div><div class="ttdeci">std::optional&lt; vpart_reference &gt; part_with_feature(const std::string &amp;f, bool unbroken) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02698">vehicle.cpp:2698</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_acf1ddbf380ff79f8fd707a0453b1608b"><div class="ttname"><a href="classoptional__vpart__position.html#acf1ddbf380ff79f8fd707a0453b1608b">optional_vpart_position::cargo</a></div><div class="ttdeci">std::optional&lt; vpart_reference &gt; cargo() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02710">vehicle.cpp:2710</a></div></div>
<div class="ttc" id="aclasspanel__manager_html_a3f6290efcd5bca21c3cf44762bca2a91"><div class="ttname"><a href="classpanel__manager.html#a3f6290efcd5bca21c3cf44762bca2a91">panel_manager::get_current_layout_id</a></div><div class="ttdeci">std::string get_current_layout_id() const</div><div class="ttdef"><b>Definition:</b> <a href="panels_8cpp_source.html#l00385">panels.cpp:385</a></div></div>
<div class="ttc" id="aclasspanel__manager_html_a5acbe61fa6ec7eaf06ea15c80f14ebc6"><div class="ttname"><a href="classpanel__manager.html#a5acbe61fa6ec7eaf06ea15c80f14ebc6">panel_manager::get_manager</a></div><div class="ttdeci">static panel_manager &amp; get_manager()</div><div class="ttdef"><b>Definition:</b> <a href="panels_8h_source.html#l00132">panels.h:132</a></div></div>
<div class="ttc" id="aclassrestore__on__out__of__scope_html"><div class="ttname"><a href="classrestore__on__out__of__scope.html">restore_on_out_of_scope</a></div><div class="ttdef"><b>Definition:</b> <a href="cata__scope__helpers_8h_source.html#l00031">cata_scope_helpers.h:32</a></div></div>
<div class="ttc" id="aclassret__val__common_html_a933807b816264e791e488ed5e7abb1c3"><div class="ttname"><a href="classret__val__common.html#a933807b816264e791e488ed5e7abb1c3">ret_val_common::success</a></div><div class="ttdeci">bool success() const</div><div class="ttdef"><b>Definition:</b> <a href="ret__val_8h_source.html#l00013">ret_val.h:13</a></div></div>
<div class="ttc" id="aclassret__val_html"><div class="ttname"><a href="classret__val.html">ret_val</a></div><div class="ttdoc">The class represents a composite return value of an arbitrary function (result).</div><div class="ttdef"><b>Definition:</b> <a href="ret__val_8h_source.html#l00048">ret_val.h:49</a></div></div>
<div class="ttc" id="aclassspell_html"><div class="ttname"><a href="classspell.html">spell</a></div><div class="ttdef"><b>Definition:</b> <a href="magic_8h_source.html#l00421">magic.h:422</a></div></div>
<div class="ttc" id="aclassspell_html_a006cfd33c15f732b2463eda1ae0686cc"><div class="ttname"><a href="classspell.html#a006cfd33c15f732b2463eda1ae0686cc">spell::get_level</a></div><div class="ttdeci">int get_level() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01570">magic.cpp:1570</a></div></div>
<div class="ttc" id="aclassspell_html_a0d3f68783edb1af2e111e85f7a1715fa"><div class="ttname"><a href="classspell.html#a0d3f68783edb1af2e111e85f7a1715fa">spell::energy_cost_string</a></div><div class="ttdeci">std::string energy_cost_string(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01353">magic.cpp:1353</a></div></div>
<div class="ttc" id="aclassspell_html_a1dc2bd4fd1f177c091237236627bd993"><div class="ttname"><a href="classspell.html#a1dc2bd4fd1f177c091237236627bd993">spell::energy_cur_string</a></div><div class="ttdeci">std::string energy_cur_string(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01373">magic.cpp:1373</a></div></div>
<div class="ttc" id="aclassspell_html_a335dc296fd7e166be557e69dc6d9f147"><div class="ttname"><a href="classspell.html#a335dc296fd7e166be557e69dc6d9f147">spell::aoe_string</a></div><div class="ttdeci">std::string aoe_string(const Creature &amp;caster) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00895">magic.cpp:895</a></div></div>
<div class="ttc" id="aclassspell_html_a4bee370b3c3d69be45411856fb2f333f"><div class="ttname"><a href="classspell.html#a4bee370b3c3d69be45411856fb2f333f">spell::in_aoe</a></div><div class="ttdeci">bool in_aoe(const tripoint &amp;source, const tripoint &amp;target, const Creature &amp;caster) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00885">magic.cpp:885</a></div></div>
<div class="ttc" id="aclassspell_html_a593232b1e5fc4c81d536724d40322efd"><div class="ttname"><a href="classspell.html#a593232b1e5fc4c81d536724d40322efd">spell::energy_source</a></div><div class="ttdeci">magic_energy_type energy_source() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01459">magic.cpp:1459</a></div></div>
<div class="ttc" id="aclassspell_html_a63f22c8f5a1730ab6651342e9becbfdc"><div class="ttname"><a href="classspell.html#a63f22c8f5a1730ab6651342e9becbfdc">spell::aoe</a></div><div class="ttdeci">int aoe(const Creature &amp;caster) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00854">magic.cpp:854</a></div></div>
<div class="ttc" id="aclassspell_html_a731bc4db74246a1e9265ea6f25abd7ad"><div class="ttname"><a href="classspell.html#a731bc4db74246a1e9265ea6f25abd7ad">spell::damage_string</a></div><div class="ttdeci">std::string damage_string(const Character &amp;caster) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00773">magic.cpp:773</a></div></div>
<div class="ttc" id="aclassspell_html_a7d44bdaf4c9faff438e6b30973d68615"><div class="ttname"><a href="classspell.html#a7d44bdaf4c9faff438e6b30973d68615">spell::id</a></div><div class="ttdeci">spell_id id() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00662">magic.cpp:662</a></div></div>
<div class="ttc" id="aclassspell_html_aa34fc8ebf8b820ac055f4b4dd9d78c35"><div class="ttname"><a href="classspell.html#aa34fc8ebf8b820ac055f4b4dd9d78c35">spell::effect</a></div><div class="ttdeci">std::string effect() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01454">magic.cpp:1454</a></div></div>
<div class="ttc" id="aclassspell_html_ab00175ffc465d406a7ec24331c6c55f2"><div class="ttname"><a href="classspell.html#ab00175ffc465d406a7ec24331c6c55f2">spell::range</a></div><div class="ttdeci">int range(const Creature &amp;caster) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00905">magic.cpp:905</a></div></div>
<div class="ttc" id="aclassspell_html_ab2631d5fc9da8a5ec04f7c3757e6c9f5"><div class="ttname"><a href="classspell.html#ab2631d5fc9da8a5ec04f7c3757e6c9f5">spell::can_cast</a></div><div class="ttdeci">bool can_cast(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01093">magic.cpp:1093</a></div></div>
<div class="ttc" id="aclassspell_html_ab26955ff4600c3a2855e6fe02dc0d216"><div class="ttname"><a href="classspell.html#ab26955ff4600c3a2855e6fe02dc0d216">spell::shape</a></div><div class="ttdeci">spell_shape shape() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01312">magic.cpp:1312</a></div></div>
<div class="ttc" id="aclassspell_html_abdf34d5415c3fdafcd84fe3a7101bddb"><div class="ttname"><a href="classspell.html#abdf34d5415c3fdafcd84fe3a7101bddb">spell::name</a></div><div class="ttdeci">std::string name() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01207">magic.cpp:1207</a></div></div>
<div class="ttc" id="aclassspell_html_acc66691f05cd20a085370d79df52bafa"><div class="ttname"><a href="classspell.html#acc66691f05cd20a085370d79df52bafa">spell::description</a></div><div class="ttdeci">std::string description() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01543">magic.cpp:1543</a></div></div>
<div class="ttc" id="aclassspell_html_ad572a7c2376afa1bd84ca8ab9603ed2a"><div class="ttname"><a href="classspell.html#ad572a7c2376afa1bd84ca8ab9603ed2a">spell::damage</a></div><div class="ttdeci">int damage(const Creature &amp;caster) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l00705">magic.cpp:705</a></div></div>
<div class="ttc" id="aclassspell_html_adc1aee8fd855fce28ebb1dcc39e37a12"><div class="ttname"><a href="classspell.html#adc1aee8fd855fce28ebb1dcc39e37a12">spell::is_valid_target</a></div><div class="ttdeci">bool is_valid_target(const Creature &amp;caster, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01474">magic.cpp:1474</a></div></div>
<div class="ttc" id="aclassspell_html_aeb55e6084337fb199e3cab09260ad916"><div class="ttname"><a href="classspell.html#aeb55e6084337fb199e3cab09260ad916">spell::energy_string</a></div><div class="ttdeci">std::string energy_string() const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01337">magic.cpp:1337</a></div></div>
<div class="ttc" id="aclassspell_html_afe11a0854d38e947a10d02e29f7fd84c"><div class="ttname"><a href="classspell.html#afe11a0854d38e947a10d02e29f7fd84c">spell::colorized_fail_percent</a></div><div class="ttdeci">std::string colorized_fail_percent(const Character &amp;guy) const</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01289">magic.cpp:1289</a></div></div>
<div class="ttc" id="aclassstring__id_html"><div class="ttname"><a href="classstring__id.html">string_id&lt; ammunition_type &gt;</a></div></div>
<div class="ttc" id="aclassstring__id_html_a1b2100ed077789ba45aaf5081791b36c"><div class="ttname"><a href="classstring__id.html#a1b2100ed077789ba45aaf5081791b36c">string_id&lt; itype &gt;::NULL_ID</a></div><div class="ttdeci">static const string_id&lt; itype &gt; &amp; NULL_ID()</div><div class="ttdoc">Returns a null id whose string_id&lt;T&gt;::is_null() must always return true.</div></div>
<div class="ttc" id="aclassstring__id_html_a2c0e3a434bcb9e3c353b337053ff22d8"><div class="ttname"><a href="classstring__id.html#a2c0e3a434bcb9e3c353b337053ff22d8">string_id::c_str</a></div><div class="ttdeci">const char * c_str() const</div><div class="ttdoc">Interface to the plain C-string of the id.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00252">string_id.h:252</a></div></div>
<div class="ttc" id="aclassstring__id_html_a3ca78345025397b3d3ac22729ba1684b"><div class="ttname"><a href="classstring__id.html#a3ca78345025397b3d3ac22729ba1684b">string_id::is_null</a></div><div class="ttdeci">bool is_null() const</div><div class="ttdoc">Returns whether this represents the id of the null-object (in which case it's the null-id).</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00322">string_id.h:322</a></div></div>
<div class="ttc" id="aclassstring__id_html_ac180a60056901aaf79f5c4b728a257bd"><div class="ttname"><a href="classstring__id.html#ac180a60056901aaf79f5c4b728a257bd">string_id::is_empty</a></div><div class="ttdeci">bool is_empty() const</div><div class="ttdoc">Returns whether this id is empty.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00303">string_id.h:303</a></div></div>
<div class="ttc" id="aclassstring__id_html_ae75b0a209b55081a67c5fe6c17a4be00"><div class="ttname"><a href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">string_id::str</a></div><div class="ttdeci">const std::string &amp; str() const</div><div class="ttdoc">Returns the identifier as plain std::string.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00260">string_id.h:260</a></div></div>
<div class="ttc" id="aclasstarget__ui_html"><div class="ttname"><a href="classtarget__ui.html">target_ui</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00168">ranged.cpp:169</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a11be420f4d6ffd6128dd23d01be6c310"><div class="ttname"><a href="classtarget__ui.html#a11be420f4d6ffd6128dd23d01be6c310">target_ui::run</a></div><div class="ttdeci">target_handler::trajectory run()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02463">ranged.cpp:2463</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a122323ec4c1e72c291e76643ccfd3fde"><div class="ttname"><a href="classtarget__ui.html#a122323ec4c1e72c291e76643ccfd3fde">target_ui::shifting_view</a></div><div class="ttdeci">bool shifting_view</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00288">ranged.cpp:288</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a1403890979533cd6ea29897e3ee81ab5"><div class="ttname"><a href="classtarget__ui.html#a1403890979533cd6ea29897e3ee81ab5">target_ui::recalc_aim_turning_penalty</a></div><div class="ttdeci">void recalc_aim_turning_penalty()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03255">ranged.cpp:3255</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a146d794c8cb9c23e6ba71727c9a25852"><div class="ttname"><a href="classtarget__ui.html#a146d794c8cb9c23e6ba71727c9a25852">target_ui::no_fail</a></div><div class="ttdeci">bool no_fail</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00203">ranged.cpp:203</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a14b8ebef108aaa7ad8c5176a04f600bb"><div class="ttname"><a href="classtarget__ui.html#a14b8ebef108aaa7ad8c5176a04f600bb">target_ui::panel_spell_info</a></div><div class="ttdeci">void panel_spell_info(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03857">ranged.cpp:3857</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a1591b490e9f8d48547b108ae481f982e"><div class="ttname"><a href="classtarget__ui.html#a1591b490e9f8d48547b108ae481f982e">target_ui::choose_initial_target</a></div><div class="ttdeci">tripoint choose_initial_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03011">ranged.cpp:3011</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a15d523ae27fc66cbff7adac5e9fa91dd"><div class="ttname"><a href="classtarget__ui.html#a15d523ae27fc66cbff7adac5e9fa91dd">target_ui::draw_terrain_overlay</a></div><div class="ttdeci">void draw_terrain_overlay()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03476">ranged.cpp:3476</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a190a8193e6454bb636bc8f5288b4a27b"><div class="ttname"><a href="classtarget__ui.html#a190a8193e6454bb636bc8f5288b4a27b">target_ui::relevant</a></div><div class="ttdeci">item * relevant</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00189">ranged.cpp:189</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a1e6534092ef1b213639575c914030eb1"><div class="ttname"><a href="classtarget__ui.html#a1e6534092ef1b213639575c914030eb1">target_ui::tiny</a></div><div class="ttdeci">bool tiny</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00293">ranged.cpp:293</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a21275763803a2ce0d00e02dc0076a36c"><div class="ttname"><a href="classtarget__ui.html#a21275763803a2ce0d00e02dc0076a36c">target_ui::action_aim_and_shoot</a></div><div class="ttdeci">bool action_aim_and_shoot(const std::string &amp;action)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03446">ranged.cpp:3446</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a246e6aa2bb08bb724c44571e8451ac30"><div class="ttname"><a href="classtarget__ui.html#a246e6aa2bb08bb724c44571e8451ac30">target_ui::w_target</a></div><div class="ttdeci">catacurses::window w_target</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00249">ranged.cpp:249</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a270f72c5bfef55a533d3cd9b3cf57ea0"><div class="ttname"><a href="classtarget__ui.html#a270f72c5bfef55a533d3cd9b3cf57ea0">target_ui::snap_to_target</a></div><div class="ttdeci">bool snap_to_target</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00285">ranged.cpp:285</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a281f9ea6ae900ff7991e457f1d34b8f6"><div class="ttname"><a href="classtarget__ui.html#a281f9ea6ae900ff7991e457f1d34b8f6">target_ui::targets</a></div><div class="ttdeci">std::vector&lt; Creature * &gt; targets</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00246">ranged.cpp:246</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a2e6f4c9c827b91ce215a1a7b32a4affb"><div class="ttname"><a href="classtarget__ui.html#a2e6f4c9c827b91ce215a1a7b32a4affb">target_ui::sight_dispersion</a></div><div class="ttdeci">int sight_dispersion</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00255">ranged.cpp:255</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a34b69263e28fa4472b51104ec1d2e6f0"><div class="ttname"><a href="classtarget__ui.html#a34b69263e28fa4472b51104ec1d2e6f0">target_ui::compact</a></div><div class="ttdeci">bool compact</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00291">ranged.cpp:291</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202">target_ui::Status</a></div><div class="ttdeci">Status</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00225">ranged.cpp:225</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a0c6ad70beb3a7e76c3fc7adab7c46acc">target_ui::Status::Good</a></div><div class="ttdeci">@ Good</div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a365b2699d38b61ef4b4c8a1066c8468f">target_ui::Status::OutOfRange</a></div><div class="ttdeci">@ OutOfRange</div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202a45c9ef8264639e178f18806be2b9a408">target_ui::Status::BadTarget</a></div><div class="ttdeci">@ BadTarget</div></div>
<div class="ttc" id="aclasstarget__ui_html_a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773"><div class="ttname"><a href="classtarget__ui.html#a3594a3a61aa50c8a0ce8c7ea20796202aaa5b08f858f7353c5d012d6706525773">target_ui::Status::OutOfAmmo</a></div><div class="ttdeci">@ OutOfAmmo</div></div>
<div class="ttc" id="aclasstarget__ui_html_a362df365f84b306e2ff14edf099a1000"><div class="ttname"><a href="classtarget__ui.html#a362df365f84b306e2ff14edf099a1000">target_ui::dst_critter</a></div><div class="ttdeci">Creature * dst_critter</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00244">ranged.cpp:244</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a3ead422f4a78394c13bc3f4c6c953f42"><div class="ttname"><a href="classtarget__ui.html#a3ead422f4a78394c13bc3f4c6c953f42">target_ui::set_cursor_pos</a></div><div class="ttdeci">bool set_cursor_pos(const tripoint &amp;new_pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02857">ranged.cpp:2857</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a4924621b242d0938e9a03fcefdfa6a9d"><div class="ttname"><a href="classtarget__ui.html#a4924621b242d0938e9a03fcefdfa6a9d">target_ui::action_drop_aim</a></div><div class="ttdeci">bool action_drop_aim()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03436">ranged.cpp:3436</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a4b525b1e2a39f4748409b97e8984947b"><div class="ttname"><a href="classtarget__ui.html#a4b525b1e2a39f4748409b97e8984947b">target_ui::narrow</a></div><div class="ttdeci">bool narrow</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00296">ranged.cpp:296</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a4bb70bd52ece44447bec77880106009d"><div class="ttname"><a href="classtarget__ui.html#a4bb70bd52ece44447bec77880106009d">target_ui::panel_target_info</a></div><div class="ttdeci">void panel_target_info(int &amp;text_y, bool fill_with_blank_if_no_target)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03913">ranged.cpp:3913</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a4e5479e5dd0b2883bbf2927c489ddb6a"><div class="ttname"><a href="classtarget__ui.html#a4e5479e5dd0b2883bbf2927c489ddb6a">target_ui::ctxt</a></div><div class="ttdeci">input_context ctxt</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00251">ranged.cpp:251</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a50ee1e0b8e7d1141e4d6c2019fe6df39"><div class="ttname"><a href="classtarget__ui.html#a50ee1e0b8e7d1141e4d6c2019fe6df39">target_ui::on_target_accepted</a></div><div class="ttdeci">void on_target_accepted(bool harmful) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03959">ranged.cpp:3959</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a542ba80f542b41ea6a81f1ab8b14b521"><div class="ttname"><a href="classtarget__ui.html#a542ba80f542b41ea6a81f1ab8b14b521">target_ui::traj</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; traj</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00236">ranged.cpp:236</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a545580558b81b3d44c43b52fc5ff1b77"><div class="ttname"><a href="classtarget__ui.html#a545580558b81b3d44c43b52fc5ff1b77">target_ui::panel_gun_info</a></div><div class="ttdeci">void panel_gun_info(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03807">ranged.cpp:3807</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a5898f18e796130f0a4aa0b5099c7a4a0"><div class="ttname"><a href="classtarget__ui.html#a5898f18e796130f0a4aa0b5099c7a4a0">target_ui::get_selected_aim_type</a></div><div class="ttdeci">aim_type get_selected_aim_type() const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03603">ranged.cpp:3603</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a5c885fc69abc2190e1850b7f23601ac2"><div class="ttname"><a href="classtarget__ui.html#a5c885fc69abc2190e1850b7f23601ac2">target_ui::try_reacquire_target</a></div><div class="ttdeci">bool try_reacquire_target(bool critter, tripoint &amp;new_dst)</div><div class="ttdoc">Try to re-acquire target for aim-and-fire.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03039">ranged.cpp:3039</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a607a068ce45aeed17810fd8ca433e5a3"><div class="ttname"><a href="classtarget__ui.html#a607a068ce45aeed17810fd8ca433e5a3">target_ui::aim_mode</a></div><div class="ttdeci">std::vector&lt; aim_type &gt;::iterator aim_mode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00259">ranged.cpp:259</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a63ac73585a9794e93d181362f7473b50"><div class="ttname"><a href="classtarget__ui.html#a63ac73585a9794e93d181362f7473b50">target_ui::draw_turret_lines</a></div><div class="ttdeci">bool draw_turret_lines</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00282">ranged.cpp:282</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a6c0468c35f79fb501be1a3a50b4081d4"><div class="ttname"><a href="classtarget__ui.html#a6c0468c35f79fb501be1a3a50b4081d4">target_ui::action_aim</a></div><div class="ttdeci">bool action_aim()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03421">ranged.cpp:3421</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a779bc721417ab8ee4a6b103d8a1030f5"><div class="ttname"><a href="classtarget__ui.html#a779bc721417ab8ee4a6b103d8a1030f5">target_ui::toggle_snap_to_target</a></div><div class="ttdeci">void toggle_snap_to_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03191">ranged.cpp:3191</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a7d5114b61c688d3810c108986ddc8bf7"><div class="ttname"><a href="classtarget__ui.html#a7d5114b61c688d3810c108986ddc8bf7">target_ui::draw_controls_list</a></div><div class="ttdeci">void draw_controls_list(int text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03662">ranged.cpp:3662</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a7f3d575ebc23cdd3a199a8c17579a225"><div class="ttname"><a href="classtarget__ui.html#a7f3d575ebc23cdd3a199a8c17579a225">target_ui::uitext_fire</a></div><div class="ttdeci">std::string uitext_fire() const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03628">ranged.cpp:3628</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a83609daab209a1d8e462919182014d33"><div class="ttname"><a href="classtarget__ui.html#a83609daab209a1d8e462919182014d33">target_ui::you</a></div><div class="ttdeci">avatar * you</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00185">ranged.cpp:185</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a8606ff468dc8ac0fab74c239c455e2f7"><div class="ttname"><a href="classtarget__ui.html#a8606ff468dc8ac0fab74c239c455e2f7">target_ui::get_sight_dispersion</a></div><div class="ttdeci">int get_sight_dispersion() const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03608">ranged.cpp:3608</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a86966228ce7aad77c233058bf1285962"><div class="ttname"><a href="classtarget__ui.html#a86966228ce7aad77c233058bf1285962">target_ui::panel_cursor_info</a></div><div class="ttdeci">void panel_cursor_info(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03770">ranged.cpp:3770</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a93a478e95d201324548329f39a087208"><div class="ttname"><a href="classtarget__ui.html#a93a478e95d201324548329f39a087208">target_ui::draw_ui_window</a></div><div class="ttdeci">void draw_ui_window()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03551">ranged.cpp:3551</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a954878eb50877ad7fc1902a28beb2539"><div class="ttname"><a href="classtarget__ui.html#a954878eb50877ad7fc1902a28beb2539">target_ui::dst</a></div><div class="ttdeci">tripoint dst</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00241">ranged.cpp:241</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a97d244cde8cae12d0266daf6fc083014"><div class="ttname"><a href="classtarget__ui.html#a97d244cde8cae12d0266daf6fc083014">target_ui::confirm_non_enemy_target</a></div><div class="ttdeci">bool confirm_non_enemy_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03115">ranged.cpp:3115</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_a9f08c10cac1401587f330fb97f5c2183"><div class="ttname"><a href="classtarget__ui.html#a9f08c10cac1401587f330fb97f5c2183">target_ui::panel_recoil</a></div><div class="ttdeci">void panel_recoil(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03837">ranged.cpp:3837</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa3c8602522a1638d3af42b10f1750e26"><div class="ttname"><a href="classtarget__ui.html#aa3c8602522a1638d3af42b10f1750e26">target_ui::range</a></div><div class="ttdeci">int range</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00191">ranged.cpp:191</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa53ba52da62f64baa29130908cf8637b"><div class="ttname"><a href="classtarget__ui.html#aa53ba52da62f64baa29130908cf8637b">target_ui::set_last_target</a></div><div class="ttdeci">void set_last_target()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03102">ranged.cpp:3102</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa81de937ba74331a08f3ef8e049a3c28"><div class="ttname"><a href="classtarget__ui.html#aa81de937ba74331a08f3ef8e049a3c28">target_ui::apply_aim_turning_penalty</a></div><div class="ttdeci">void apply_aim_turning_penalty() const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03299">ranged.cpp:3299</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa955ab0c7cfbd2c8c5d439f5aed608ef"><div class="ttname"><a href="classtarget__ui.html#aa955ab0c7cfbd2c8c5d439f5aed608ef">target_ui::update_turrets_in_range</a></div><div class="ttdeci">void update_turrets_in_range()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03243">ranged.cpp:3243</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6">target_ui::ExitCode</a></div><div class="ttdeci">ExitCode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00209">ranged.cpp:209</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a4d1c8263ba1036754f8db14a98f9f006">target_ui::ExitCode::Reload</a></div><div class="ttdeci">@ Reload</div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6a727b63583e01fa2b3952dab580c84dc2">target_ui::ExitCode::Abort</a></div><div class="ttdeci">@ Abort</div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6abd2b7e5f85a6ea65065c4ebc6d7c95bb">target_ui::ExitCode::Fire</a></div><div class="ttdeci">@ Fire</div></div>
<div class="ttc" id="aclasstarget__ui_html_aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398"><div class="ttname"><a href="classtarget__ui.html#aa98e28471bb023e99404674ad6331ad6ac85a251cc457840f1e032f1b733e9398">target_ui::ExitCode::Timeout</a></div><div class="ttdeci">@ Timeout</div></div>
<div class="ttc" id="aclasstarget__ui_html_aac34aeff88a5103d4af19a2ad067a677"><div class="ttname"><a href="classtarget__ui.html#aac34aeff88a5103d4af19a2ad067a677">target_ui::uitext_title</a></div><div class="ttdeci">std::string uitext_title() const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03613">ranged.cpp:3613</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aaf459ec49ad96c44eddeb94d0c22fb36"><div class="ttname"><a href="classtarget__ui.html#aaf459ec49ad96c44eddeb94d0c22fb36">target_ui::on_range_ammo_changed</a></div><div class="ttdeci">void on_range_ammo_changed()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02991">ranged.cpp:2991</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ab236848678058afb7605e6d82a5c8fa9"><div class="ttname"><a href="classtarget__ui.html#ab236848678058afb7605e6d82a5c8fa9">target_ui::dist_fn</a></div><div class="ttdeci">int dist_fn(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03097">ranged.cpp:3097</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ab290e475e7cd308b447788ec369053b0"><div class="ttname"><a href="classtarget__ui.html#ab290e475e7cd308b447788ec369053b0">target_ui::handle_cursor_movement</a></div><div class="ttdeci">bool handle_cursor_movement(const std::string &amp;action, bool &amp;skip_redraw)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02798">ranged.cpp:2798</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ab855722580bd112ef0590b5a9b4f3556"><div class="ttname"><a href="classtarget__ui.html#ab855722580bd112ef0590b5a9b4f3556">target_ui::spell_aoe</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_aoe</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00269">ranged.cpp:269</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_abb6df512b8b794227dc5f1d9afe17bf1"><div class="ttname"><a href="classtarget__ui.html#abb6df512b8b794227dc5f1d9afe17bf1">target_ui::status</a></div><div class="ttdeci">Status status</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00233">ranged.cpp:233</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac0a5aad7e60b30082e7ec2ff97f8f6d4"><div class="ttname"><a href="classtarget__ui.html#ac0a5aad7e60b30082e7ec2ff97f8f6d4">target_ui::predicted_recoil</a></div><div class="ttdeci">double predicted_recoil</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00265">ranged.cpp:265</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac2200f3f97047dbc1e1cf14bae201c34"><div class="ttname"><a href="classtarget__ui.html#ac2200f3f97047dbc1e1cf14bae201c34">target_ui::veh</a></div><div class="ttdeci">vehicle * veh</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00199">ranged.cpp:199</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac352f6aae1cb28945f8115b76fea2eb6"><div class="ttname"><a href="classtarget__ui.html#ac352f6aae1cb28945f8115b76fea2eb6">target_ui::list_friendlies_in_lof</a></div><div class="ttdeci">std::vector&lt; weak_ptr_fast&lt; Creature &gt; &gt; list_friendlies_in_lof()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03166">ranged.cpp:3166</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ac9b01fafb341eaec6c8f85582fd7f32f"><div class="ttname"><a href="classtarget__ui.html#ac9b01fafb341eaec6c8f85582fd7f32f">target_ui::no_mana</a></div><div class="ttdeci">bool no_mana</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00205">ranged.cpp:205</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_acbdcdc8f41dd8bcbf887b12d96c9948d"><div class="ttname"><a href="classtarget__ui.html#acbdcdc8f41dd8bcbf887b12d96c9948d">target_ui::action_switch_ammo</a></div><div class="ttdeci">bool action_switch_ammo()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03401">ranged.cpp:3401</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_acc5b1b952d220d0cd766f9c32ab5eb38"><div class="ttname"><a href="classtarget__ui.html#acc5b1b952d220d0cd766f9c32ab5eb38">target_ui::draw_help_notice</a></div><div class="ttdeci">void draw_help_notice()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03648">ranged.cpp:3648</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad1e40f0212d403109c8969d7308e493f"><div class="ttname"><a href="classtarget__ui.html#ad1e40f0212d403109c8969d7308e493f">target_ui::update_status</a></div><div class="ttdeci">void update_status()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03067">ranged.cpp:3067</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad2ca7887fd647df92c825e8ee153ff84"><div class="ttname"><a href="classtarget__ui.html#ad2ca7887fd647df92c825e8ee153ff84">target_ui::prompt_friendlies_in_lof</a></div><div class="ttdeci">bool prompt_friendlies_in_lof()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03130">ranged.cpp:3130</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad4a9c004a4c4cf26ad705174612584ea"><div class="ttname"><a href="classtarget__ui.html#ad4a9c004a4c4cf26ad705174612584ea">target_ui::panel_turret_list</a></div><div class="ttdeci">void panel_turret_list(int &amp;text_y)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03947">ranged.cpp:3947</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ad62889056a10382de6835688498cf20e"><div class="ttname"><a href="classtarget__ui.html#ad62889056a10382de6835688498cf20e">target_ui::draw_window_title</a></div><div class="ttdeci">void draw_window_title()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03641">ranged.cpp:3641</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_adc208237a3fd537eb7f50022e4e1b74d"><div class="ttname"><a href="classtarget__ui.html#adc208237a3fd537eb7f50022e4e1b74d">target_ui::set_view_offset</a></div><div class="ttdeci">void set_view_offset(const tripoint &amp;new_offset) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03229">ranged.cpp:3229</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997">target_ui::TargetMode</a></div><div class="ttdeci">TargetMode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00173">ranged.cpp:173</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8ce61dd2505effd96f937fa743b6491f">target_ui::TargetMode::Throw</a></div><div class="ttdeci">@ Throw</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a8f61cfb2c3938627416432409d2f6e86">target_ui::TargetMode::ThrowBlind</a></div><div class="ttdeci">@ ThrowBlind</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a90be8abd7ec18957825330f13ca888bb">target_ui::TargetMode::Turrets</a></div><div class="ttdeci">@ Turrets</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997a968ae4f03d7e0c30fe4eb26b83c855dd">target_ui::TargetMode::Spell</a></div><div class="ttdeci">@ Spell</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997ab350f6de1060afddbefbdf47552464ae">target_ui::TargetMode::Reach</a></div><div class="ttdeci">@ Reach</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997abd2b7e5f85a6ea65065c4ebc6d7c95bb">target_ui::TargetMode::Fire</a></div><div class="ttdeci">@ Fire</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997af2e067641e81adda1d3883190c756e70">target_ui::TargetMode::TurretManual</a></div><div class="ttdeci">@ TurretManual</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae0dd055ba040ba97125cbf165a33c997afd3508f354d330de0aaa9207ba65bf4e"><div class="ttname"><a href="classtarget__ui.html#ae0dd055ba040ba97125cbf165a33c997afd3508f354d330de0aaa9207ba65bf4e">target_ui::TargetMode::SelectOnly</a></div><div class="ttdeci">@ SelectOnly</div></div>
<div class="ttc" id="aclasstarget__ui_html_ae5ae79a739fcab56301077b8802355ce"><div class="ttname"><a href="classtarget__ui.html#ae5ae79a739fcab56301077b8802355ce">target_ui::ammo</a></div><div class="ttdeci">const itype * ammo</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00193">ranged.cpp:193</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae7a7446b4088911709b2eb6a1d3973e5"><div class="ttname"><a href="classtarget__ui.html#ae7a7446b4088911709b2eb6a1d3973e5">target_ui::vturrets</a></div><div class="ttdeci">const std::vector&lt; vehicle_part * &gt; * vturrets</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00197">ranged.cpp:197</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae8d4216fdc3f48ee8f6dd5f22c33d9d9"><div class="ttname"><a href="classtarget__ui.html#ae8d4216fdc3f48ee8f6dd5f22c33d9d9">target_ui::turrets_in_range</a></div><div class="ttdeci">std::vector&lt; turret_with_lof &gt; turrets_in_range</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00278">ranged.cpp:278</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_ae9e40adc2b44c3cd4cdbcc62dd8a1e30"><div class="ttname"><a href="classtarget__ui.html#ae9e40adc2b44c3cd4cdbcc62dd8a1e30">target_ui::turret</a></div><div class="ttdeci">turret_data * turret</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00195">ranged.cpp:195</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_aeee1b122468e838a1f62691b2cd43396"><div class="ttname"><a href="classtarget__ui.html#aeee1b122468e838a1f62691b2cd43396">target_ui::mode</a></div><div class="ttdeci">TargetMode mode</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00187">ranged.cpp:187</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af007dd5fcc266ee10d673299ca90c29c"><div class="ttname"><a href="classtarget__ui.html#af007dd5fcc266ee10d673299ca90c29c">target_ui::cycle_targets</a></div><div class="ttdeci">void cycle_targets(int direction)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03202">ranged.cpp:3202</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af1178602a3d2f7e37c9dbebf22dd29a3"><div class="ttname"><a href="classtarget__ui.html#af1178602a3d2f7e37c9dbebf22dd29a3">target_ui::action_switch_mode</a></div><div class="ttdeci">bool action_switch_mode()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03304">ranged.cpp:3304</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af17fecf6fc24afc0a1af11ee1447b39a"><div class="ttname"><a href="classtarget__ui.html#af17fecf6fc24afc0a1af11ee1447b39a">target_ui::update_target_list</a></div><div class="ttdeci">void update_target_list()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02997">ranged.cpp:2997</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af184a9cc7c52521c129182e2cc643375"><div class="ttname"><a href="classtarget__ui.html#af184a9cc7c52521c129182e2cc643375">target_ui::casting</a></div><div class="ttdeci">spell * casting</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00201">ranged.cpp:201</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af1dc50e9e2195f48ffdb87a1daacc178"><div class="ttname"><a href="classtarget__ui.html#af1dc50e9e2195f48ffdb87a1daacc178">target_ui::activity</a></div><div class="ttdeci">aim_activity_actor * activity</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00207">ranged.cpp:207</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af3857720f2059a0a2f23896bc7e808c7"><div class="ttname"><a href="classtarget__ui.html#af3857720f2059a0a2f23896bc7e808c7">target_ui::init_window_and_input</a></div><div class="ttdeci">void init_window_and_input()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02716">ranged.cpp:2716</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_af8c42cdc72ea5432ee63a1d2ba3f6967"><div class="ttname"><a href="classtarget__ui.html#af8c42cdc72ea5432ee63a1d2ba3f6967">target_ui::aim_types</a></div><div class="ttdeci">std::vector&lt; aim_type &gt; aim_types</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00257">ranged.cpp:257</a></div></div>
<div class="ttc" id="aclasstarget__ui_html_afe4c97cc5abb0ce402bd9e89411e1778"><div class="ttname"><a href="classtarget__ui.html#afe4c97cc5abb0ce402bd9e89411e1778">target_ui::src</a></div><div class="ttdeci">tripoint src</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00238">ranged.cpp:238</a></div></div>
<div class="ttc" id="aclasstime__duration_html"><div class="ttname"><a href="classtime__duration.html">time_duration</a></div><div class="ttdoc">A duration defined as a number of specific time units.</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8h_source.html#l00196">calendar.h:197</a></div></div>
<div class="ttc" id="aclasstranslation_html_a30b5b9d586c786942c2321701a53e572"><div class="ttname"><a href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translation::translated</a></div><div class="ttdeci">std::string translated(int num=1) const</div><div class="ttdoc">Returns raw string if no translation is needed, otherwise returns the translated string.</div><div class="ttdef"><b>Definition:</b> <a href="translation_8cpp_source.html#l00294">translation.cpp:294</a></div></div>
<div class="ttc" id="aclassturret__data_html"><div class="ttname"><a href="classturret__data.html">turret_data</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00583">vehicle.h:584</a></div></div>
<div class="ttc" id="aclassturret__data_html_a21fc6c32651797ffe152775d1b51687b"><div class="ttname"><a href="classturret__data.html#a21fc6c32651797ffe152775d1b51687b">turret_data::ammo_select</a></div><div class="ttdeci">bool ammo_select(const itype_id &amp;ammo)</div><div class="ttdoc">Attempts selecting ammo type and returns true if selection was valid.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00168">turret.cpp:168</a></div></div>
<div class="ttc" id="aclassturret__data_html_a3a01d6f45d3f23cf6b5a32c5e17440b7ab2fdab230a2c39f3595a947861863cb7"><div class="ttname"><a href="classturret__data.html#a3a01d6f45d3f23cf6b5a32c5e17440b7ab2fdab230a2c39f3595a947861863cb7">turret_data::status::ready</a></div><div class="ttdeci">@ ready</div></div>
<div class="ttc" id="aclassturret__data_html_a541ea995045e847f2cd59cf8b9014ed3"><div class="ttname"><a href="classturret__data.html#a541ea995045e847f2cd59cf8b9014ed3">turret_data::ammo_data</a></div><div class="ttdeci">const itype * ammo_data() const</div><div class="ttdoc">Specific ammo data or returns nullptr if no ammo available.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00115">turret.cpp:115</a></div></div>
<div class="ttc" id="aclassturret__data_html_a585d18f2c33116bc1e9028210fccadbc"><div class="ttname"><a href="classturret__data.html#a585d18f2c33116bc1e9028210fccadbc">turret_data::query</a></div><div class="ttdeci">status query() const</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00236">turret.cpp:236</a></div></div>
<div class="ttc" id="aclassturret__data_html_a737465cce9c8f1e87eec808ee1363421"><div class="ttname"><a href="classturret__data.html#a737465cce9c8f1e87eec808ee1363421">turret_data::base</a></div><div class="ttdeci">item_location base()</div><div class="ttdoc">Get base item location.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00079">turret.cpp:79</a></div></div>
<div class="ttc" id="aclassturret__data_html_a78df34a41feb7bf25a677dba1e8181d5"><div class="ttname"><a href="classturret__data.html#a78df34a41feb7bf25a677dba1e8181d5">turret_data::range</a></div><div class="ttdeci">int range() const</div><div class="ttdoc">Maximum range considering current ammo (if any)</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00190">turret.cpp:190</a></div></div>
<div class="ttc" id="aclassturret__data_html_ad8b9e08531f26de34c61d5821ca69d7c"><div class="ttname"><a href="classturret__data.html#ad8b9e08531f26de34c61d5821ca69d7c">turret_data::in_range</a></div><div class="ttdeci">bool in_range(const tripoint &amp;target) const</div><div class="ttdoc">Check if target is in range of this turret (considers current ammo) Assumes this turret's status is '...</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00202">turret.cpp:202</a></div></div>
<div class="ttc" id="aclassturret__data_html_aee56a3a0b07255f5b008cd16898b75e0"><div class="ttname"><a href="classturret__data.html#aee56a3a0b07255f5b008cd16898b75e0">turret_data::ammo_current</a></div><div class="ttdeci">itype_id ammo_current() const</div><div class="ttdoc">Specific ammo type or returns &quot;null&quot; if no ammo available.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00126">turret.cpp:126</a></div></div>
<div class="ttc" id="aclassturret__data_html_af1938c9e7db9350ae08fef7a921f19c6"><div class="ttname"><a href="classturret__data.html#af1938c9e7db9350ae08fef7a921f19c6">turret_data::ammo_options</a></div><div class="ttdeci">std::set&lt; itype_id &gt; ammo_options() const</div><div class="ttdoc">What ammo is available for this turret (may be multiple if uses tanks)</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00141">turret.cpp:141</a></div></div>
<div class="ttc" id="aclassui__adaptor_html"><div class="ttname"><a href="classui__adaptor.html">ui_adaptor</a></div><div class="ttdoc">Adaptor between UI code and the UI management system.</div><div class="ttdef"><b>Definition:</b> <a href="ui__manager_8h_source.html#l00074">ui_manager.h:75</a></div></div>
<div class="ttc" id="aclassuilist_html"><div class="ttname"><a href="classuilist.html">uilist</a></div><div class="ttdoc">uilist: scrolling vertical list menu</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00231">ui.h:232</a></div></div>
<div class="ttc" id="aclassuilist_html_a0baa34622db6972a59d47d478bfd21d6"><div class="ttname"><a href="classuilist.html#a0baa34622db6972a59d47d478bfd21d6">uilist::ret</a></div><div class="ttdeci">int ret</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00525">ui.h:525</a></div></div>
<div class="ttc" id="aclassuilist_html_a18fd9765355d9e418bc2c399048e0645"><div class="ttname"><a href="classuilist.html#a18fd9765355d9e418bc2c399048e0645">uilist::addentry</a></div><div class="ttdeci">void addentry(const std::string &amp;txt)</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l01210">ui.cpp:1210</a></div></div>
<div class="ttc" id="aclassuilist_html_a5ed3c6e3829c033040fa9f11f1a7d0aa"><div class="ttname"><a href="classuilist.html#a5ed3c6e3829c033040fa9f11f1a7d0aa">uilist::settext</a></div><div class="ttdeci">void settext(const std::string &amp;str)</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l01259">ui.cpp:1259</a></div></div>
<div class="ttc" id="aclassuilist_html_ab0890d56d6d29dd98a0b3f17bb3ebba3"><div class="ttname"><a href="classuilist.html#ab0890d56d6d29dd98a0b3f17bb3ebba3">uilist::selected</a></div><div class="ttdeci">int selected</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00526">ui.h:526</a></div></div>
<div class="ttc" id="aclassuilist_html_af5fc2972d43a795c49a632dbcf58132b"><div class="ttname"><a href="classuilist.html#af5fc2972d43a795c49a632dbcf58132b">uilist::entries</a></div><div class="ttdeci">std::vector&lt; uilist_entry &gt; entries</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00422">ui.h:422</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html"><div class="ttname"><a href="classunits_1_1quantity.html">units::quantity</a></div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00028">units.h:29</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html_a96f3f957dba2ea5583a55060ffa04363"><div class="ttname"><a href="classunits_1_1quantity.html#a96f3f957dba2ea5583a55060ffa04363">units::quantity::value</a></div><div class="ttdeci">constexpr const value_type &amp; value() const</div><div class="ttdoc">Access the raw dimensionless value.</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00060">units.h:60</a></div></div>
<div class="ttc" id="aclassvehicle_html"><div class="ttname"><a href="classvehicle.html">vehicle</a></div><div class="ttdoc">A vehicle as a whole with all its components.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00801">vehicle.h:802</a></div></div>
<div class="ttc" id="aclassvehicle_html_accfab81af66cd979bdfff4c39e5a3a8e"><div class="ttname"><a href="classvehicle.html#accfab81af66cd979bdfff4c39e5a3a8e">vehicle::turret_query</a></div><div class="ttdeci">turret_data turret_query(vehicle_part &amp;pt)</div><div class="ttdoc">Get firing data for a turret.</div><div class="ttdef"><b>Definition:</b> <a href="turret_8cpp_source.html#l00060">turret.cpp:60</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae8132c34a1ea24866889e6e599796adc"><div class="ttname"><a href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">vehicle::global_part_pos3</a></div><div class="ttdeci">tripoint global_part_pos3(const int &amp;index) const</div><div class="ttdoc">Get the coordinates of the studied part of the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03442">vehicle.cpp:3442</a></div></div>
<div class="ttc" id="aclassvisitable_html_a31e8c573cb6e4870cc005915efc103b3"><div class="ttname"><a href="classvisitable.html#a31e8c573cb6e4870cc005915efc103b3">visitable::find_parent</a></div><div class="ttdeci">item * find_parent(const item &amp;it) const</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00049">visitable.cpp:49</a></div></div>
<div class="ttc" id="aclassvisitable_html_af49d5ef7b3f2f0a8664c23097a56373f"><div class="ttname"><a href="classvisitable.html#af49d5ef7b3f2f0a8664c23097a56373f">visitable::has_item</a></div><div class="ttdeci">bool has_item(const item &amp;it) const</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00075">visitable.cpp:75</a></div></div>
<div class="ttc" id="acolor_8cpp_html_a0f25678be1fc95cb81381a004493a4cc"><div class="ttname"><a href="color_8cpp.html#a0f25678be1fc95cb81381a004493a4cc">colorize</a></div><div class="ttdeci">std::string colorize(const std::string &amp;text, const nc_color &amp;color)</div><div class="ttdef"><b>Definition:</b> <a href="color_8cpp_source.html#l00742">color.cpp:742</a></div></div>
<div class="ttc" id="acolor_8h_html"><div class="ttname"><a href="color_8h.html">color.h</a></div></div>
<div class="ttc" id="acolor_8h_html_a0d06dc49b9761bbc54607397213728bb"><div class="ttname"><a href="color_8h.html#a0d06dc49b9761bbc54607397213728bb">c_white</a></div><div class="ttdeci">#define c_white</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00016">color.h:16</a></div></div>
<div class="ttc" id="acolor_8h_html_a1b1e3c0bef566a83c3535e38a93ad733"><div class="ttname"><a href="color_8h.html#a1b1e3c0bef566a83c3535e38a93ad733">c_light_gray</a></div><div class="ttdeci">#define c_light_gray</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00017">color.h:17</a></div></div>
<div class="ttc" id="acolor_8h_html_a2236aa1fe66b707a104f19ad45c23230"><div class="ttname"><a href="color_8h.html#a2236aa1fe66b707a104f19ad45c23230">c_light_green</a></div><div class="ttdeci">#define c_light_green</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00026">color.h:26</a></div></div>
<div class="ttc" id="acolor_8h_html_a5738d18ff9e165cca088a623cb1883ae"><div class="ttname"><a href="color_8h.html#a5738d18ff9e165cca088a623cb1883ae">c_dark_gray</a></div><div class="ttdeci">#define c_dark_gray</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00018">color.h:18</a></div></div>
<div class="ttc" id="acolor_8h_html_a7b00fb82de0be83f6fc5f7965ea86623"><div class="ttname"><a href="color_8h.html#a7b00fb82de0be83f6fc5f7965ea86623">c_light_blue</a></div><div class="ttdeci">#define c_light_blue</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00027">color.h:27</a></div></div>
<div class="ttc" id="acolor_8h_html_a95b67111e2e4be7fcac981d2b7b208f6"><div class="ttname"><a href="color_8h.html#a95b67111e2e4be7fcac981d2b7b208f6">c_cyan</a></div><div class="ttdeci">#define c_cyan</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00022">color.h:22</a></div></div>
<div class="ttc" id="acolor_8h_html_aab11865a3631a7ce78da82b7fb386b71"><div class="ttname"><a href="color_8h.html#aab11865a3631a7ce78da82b7fb386b71">c_light_red</a></div><div class="ttdeci">#define c_light_red</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00025">color.h:25</a></div></div>
<div class="ttc" id="acolor_8h_html_af0a87eaef36305269f4506dfa34d94c0"><div class="ttname"><a href="color_8h.html#af0a87eaef36305269f4506dfa34d94c0">c_red</a></div><div class="ttdeci">#define c_red</div><div class="ttdef"><b>Definition:</b> <a href="color_8h_source.html#l00019">color.h:19</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a31847b31c6ef002e9d16afd7fd0005e3"><div class="ttname"><a href="coordinates_8h.html#a31847b31c6ef002e9d16afd7fd0005e3">line_to</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &amp;&amp;RhsInBounds &gt; &gt; line_to(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00798">coordinates.h:798</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a560abf1cd341e88e2f13f454ec2ecc99"><div class="ttname"><a href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale &gt; &gt; closest_points_first(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc, int min_dist, int max_dist)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00848">coordinates.h:848</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a8e2cbab6dac12095f06b4cff66857fbb"><div class="ttname"><a href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a></div><div class="ttdeci">int rl_dist(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00769">coordinates.h:769</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a9d7b6c83d7cf9846d5f1b56e02d88268"><div class="ttname"><a href="coordinates_8h.html#a9d7b6c83d7cf9846d5f1b56e02d88268">square_dist</a></div><div class="ttdeci">int square_dist(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00755">coordinates.h:755</a></div></div>
<div class="ttc" id="acreature_8h_html_a72acd342747a434c8b399cdceeadeea2"><div class="ttname"><a href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2">creature_size</a></div><div class="ttdeci">creature_size</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00068">creature.h:68</a></div></div>
<div class="ttc" id="acreature_8h_html_a72acd342747a434c8b399cdceeadeea2a075a3e36a0a52dcbc568c05788e8a713"><div class="ttname"><a href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2a075a3e36a0a52dcbc568c05788e8a713">creature_size::medium</a></div><div class="ttdeci">@ medium</div></div>
<div class="ttc" id="acreature_8h_html_a72acd342747a434c8b399cdceeadeea2aac651433a999fb14f71f6754f0199781"><div class="ttname"><a href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aac651433a999fb14f71f6754f0199781">creature_size::num_sizes</a></div><div class="ttdeci">@ num_sizes</div></div>
<div class="ttc" id="acreature_8h_html_a72acd342747a434c8b399cdceeadeea2aafacdb0a401ccdf6b48551bbc00e8a74"><div class="ttname"><a href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aafacdb0a401ccdf6b48551bbc00e8a74">creature_size::large</a></div><div class="ttdeci">@ large</div></div>
<div class="ttc" id="acreature_8h_html_a72acd342747a434c8b399cdceeadeea2ab7cf27ffe6ea83cdcf8af2ef29de9285"><div class="ttname"><a href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2ab7cf27ffe6ea83cdcf8af2ef29de9285">creature_size::huge</a></div><div class="ttdeci">@ huge</div></div>
<div class="ttc" id="acreature_8h_html_a72acd342747a434c8b399cdceeadeea2ad60cadf1a41c651e1f0ade50136bad43"><div class="ttname"><a href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2ad60cadf1a41c651e1f0ade50136bad43">creature_size::tiny</a></div><div class="ttdeci">@ tiny</div></div>
<div class="ttc" id="acreature_8h_html_a72acd342747a434c8b399cdceeadeea2aeb5c1399a871211c7e7ed732d15e3a8b"><div class="ttname"><a href="creature_8h.html#a72acd342747a434c8b399cdceeadeea2aeb5c1399a871211c7e7ed732d15e3a8b">creature_size::small</a></div><div class="ttdeci">@ small</div></div>
<div class="ttc" id="acreature_8h_html_ab97a871dbf59ff8692908611795f7642a21507b40c80068eda19865706fdc2403"><div class="ttname"><a href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a21507b40c80068eda19865706fdc2403">FacingDirection::RIGHT</a></div><div class="ttdeci">@ RIGHT</div></div>
<div class="ttc" id="acreature_8h_html_ab97a871dbf59ff8692908611795f7642a684d325a7303f52e64011467ff5c5758"><div class="ttname"><a href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a684d325a7303f52e64011467ff5c5758">FacingDirection::LEFT</a></div><div class="ttdeci">@ LEFT</div></div>
<div class="ttc" id="acreature_8h_html_aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126"><div class="ttname"><a href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea26decc94d83c358f67f11c3cbd99b126">get_body_part_flags::sorted</a></div><div class="ttdeci">@ sorted</div></div>
<div class="ttc" id="acreature__tracker_8h_html"><div class="ttname"><a href="creature__tracker_8h.html">creature_tracker.h</a></div></div>
<div class="ttc" id="acreature__tracker_8h_html_a16f631f70e72b53e590770670fb301fb"><div class="ttname"><a href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a></div><div class="ttdeci">creature_tracker &amp; get_creature_tracker()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13827">game.cpp:13827</a></div></div>
<div class="ttc" id="acursesdef_8h_html"><div class="ttname"><a href="cursesdef_8h.html">cursesdef.h</a></div></div>
<div class="ttc" id="adamage_8h_html"><div class="ttname"><a href="damage_8h.html">damage.h</a></div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="debug_8h.html">debug.h</a></div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level D_ERROR and class D_MAIN, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00069">debug.h:69</a></div></div>
<div class="ttc" id="adialogue_8h_html_abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8"><div class="ttname"><a href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a></div><div class="ttdeci">@ action</div><div class="ttdef"><b>Definition:</b> <a href="dialogue_8h_source.html#l00044">dialogue.h:43</a></div></div>
<div class="ttc" id="adispersion_8h_html"><div class="ttname"><a href="dispersion_8h.html">dispersion.h</a></div></div>
<div class="ttc" id="aeditmap_8cpp_html_a025a5c063205294df20818edc4cfe355"><div class="ttname"><a href="editmap_8cpp.html#a025a5c063205294df20818edc4cfe355">color</a></div><div class="ttdeci">static nc_color color(const T_t &amp;t)</div></div>
<div class="ttc" id="aenums_8h_html"><div class="ttname"><a href="enums_8h.html">enums.h</a></div></div>
<div class="ttc" id="aenums_8h_html_a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a"><div class="ttname"><a href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">ot_match_type::type</a></div><div class="ttdeci">@ type</div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea2f644bab8f796b847285eab073040f10">m_good</a></div><div class="ttdeci">@ m_good</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00347">enums.h:347</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a></div><div class="ttdeci">@ m_info</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00352">enums.h:352</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a></div><div class="ttdeci">@ m_bad</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00348">enums.h:348</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096eaed9222dd268c0a08567f6c9081b3e687">m_warning</a></div><div class="ttdeci">@ m_warning</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00351">enums.h:351</a></div></div>
<div class="ttc" id="aenums_8h_html_aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481"><div class="ttname"><a href="enums_8h.html#aa183bf705d2a0eb8309dfc13fb1adddcaaaddc3454ccbefbb2d8d8461f8f7f481">distraction_type::noise</a></div><div class="ttdeci">@ noise</div></div>
<div class="ttc" id="aenums_8h_html_ade8f325e8cc8463cef8f944f3209d0e5a5918e24870f0ea98b9978dae8a69c533"><div class="ttname"><a href="enums_8h.html#ade8f325e8cc8463cef8f944f3209d0e5a5918e24870f0ea98b9978dae8a69c533">phase_id::LIQUID</a></div><div class="ttdeci">@ LIQUID</div></div>
<div class="ttc" id="aevent_8h_html"><div class="ttname"><a href="event_8h.html">event.h</a></div></div>
<div class="ttc" id="aevent_8h_html_a333a7721472705fe444b24f107f9a731a365dbc32084e314b4788756b6fa66ecb"><div class="ttname"><a href="event_8h.html#a333a7721472705fe444b24f107f9a731a365dbc32084e314b4788756b6fa66ecb">event_type::character_gets_headshot</a></div><div class="ttdeci">@ character_gets_headshot</div></div>
<div class="ttc" id="aevent__bus_8h_html"><div class="ttname"><a href="event__bus_8h.html">event_bus.h</a></div></div>
<div class="ttc" id="aevent__bus_8h_html_a4f760194b9225ccf92a1419748def636"><div class="ttname"><a href="event__bus_8h.html#a4f760194b9225ccf92a1419748def636">get_event_bus</a></div><div class="ttdeci">event_bus &amp; get_event_bus()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13832">game.cpp:13832</a></div></div>
<div class="ttc" id="aflag_8cpp_html_a14c2f85962f78884b152b105f984a9f4"><div class="ttname"><a href="flag_8cpp.html#a14c2f85962f78884b152b105f984a9f4">flag_TANGLE</a></div><div class="ttdeci">const flag_id flag_TANGLE(&quot;TANGLE&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a2f1dc9188e7d82056be9cd27d40a1ded"><div class="ttname"><a href="flag_8cpp.html#a2f1dc9188e7d82056be9cd27d40a1ded">flag_ACT_ON_RANGED_HIT</a></div><div class="ttdeci">const flag_id flag_ACT_ON_RANGED_HIT(&quot;ACT_ON_RANGED_HIT&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a355f9f8a9e0571a45af1c696fb28977c"><div class="ttname"><a href="flag_8cpp.html#a355f9f8a9e0571a45af1c696fb28977c">flag_WONT_TRAIN_MARKSMANSHIP</a></div><div class="ttdeci">const flag_id flag_WONT_TRAIN_MARKSMANSHIP(&quot;WONT_TRAIN_MARKSMANSHIP&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a3bcbf7092a1bea453e53428f8bc5881f"><div class="ttname"><a href="flag_8cpp.html#a3bcbf7092a1bea453e53428f8bc5881f">flag_CONSUMABLE</a></div><div class="ttdeci">const flag_id flag_CONSUMABLE(&quot;CONSUMABLE&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a3e2d3cbf6b78ce65033d1f9cbf1f59bf"><div class="ttname"><a href="flag_8cpp.html#a3e2d3cbf6b78ce65033d1f9cbf1f59bf">flag_USE_UPS</a></div><div class="ttdeci">const flag_id flag_USE_UPS(&quot;USE_UPS&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a5685feafd05d6c3a374460c0b50ad725"><div class="ttname"><a href="flag_8cpp.html#a5685feafd05d6c3a374460c0b50ad725">flag_NEVER_JAMS</a></div><div class="ttdeci">const flag_id flag_NEVER_JAMS(&quot;NEVER_JAMS&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a5d1fa7fb2e0d7c717f7bc1cc461407db"><div class="ttname"><a href="flag_8cpp.html#a5d1fa7fb2e0d7c717f7bc1cc461407db">flag_VEHICLE</a></div><div class="ttdeci">const flag_id flag_VEHICLE(&quot;VEHICLE&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a6e2d5c45635a3d1a0b2afd71e4748d57"><div class="ttname"><a href="flag_8cpp.html#a6e2d5c45635a3d1a0b2afd71e4748d57">flag_MOUNTED_GUN</a></div><div class="ttdeci">const flag_id flag_MOUNTED_GUN(&quot;MOUNTED_GUN&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a7198b972ee7b7e58fde85d42d517297f"><div class="ttname"><a href="flag_8cpp.html#a7198b972ee7b7e58fde85d42d517297f">flag_RESTRICT_HANDS</a></div><div class="ttdeci">const flag_id flag_RESTRICT_HANDS(&quot;RESTRICT_HANDS&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a7d8a64454549e0bab5aa7d7a7091f9d1"><div class="ttname"><a href="flag_8cpp.html#a7d8a64454549e0bab5aa7d7a7091f9d1">flag_USES_BIONIC_POWER</a></div><div class="ttdeci">const flag_id flag_USES_BIONIC_POWER(&quot;USES_BIONIC_POWER&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a7dffac54d4c781ade6642ecb6365d4db"><div class="ttname"><a href="flag_8cpp.html#a7dffac54d4c781ade6642ecb6365d4db">flag_RELOAD_EJECT</a></div><div class="ttdeci">const flag_id flag_RELOAD_EJECT(&quot;RELOAD_EJECT&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a8b16e2df6770ff1c280c38e754697b0d"><div class="ttname"><a href="flag_8cpp.html#a8b16e2df6770ff1c280c38e754697b0d">flag_NON_FOULING</a></div><div class="ttdeci">const flag_id flag_NON_FOULING(&quot;NON_FOULING&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a91b719509dce6a71673f9183835e8939"><div class="ttname"><a href="flag_8cpp.html#a91b719509dce6a71673f9183835e8939">flag_WATERPROOF_GUN</a></div><div class="ttdeci">const flag_id flag_WATERPROOF_GUN(&quot;WATERPROOF_GUN&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a959a7603cf7b380c637eede6d2a6dd17"><div class="ttname"><a href="flag_8cpp.html#a959a7603cf7b380c637eede6d2a6dd17">flag_BRASS_CATCHER</a></div><div class="ttdeci">const flag_id flag_BRASS_CATCHER(&quot;BRASS_CATCHER&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_aa1084eab5da5ecd3f6efe55e0216eb96"><div class="ttname"><a href="flag_8cpp.html#aa1084eab5da5ecd3f6efe55e0216eb96">flag_PRIMITIVE_RANGED_WEAPON</a></div><div class="ttdeci">const flag_id flag_PRIMITIVE_RANGED_WEAPON(&quot;PRIMITIVE_RANGED_WEAPON&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_aa4483d80251dc96dd0c8313d8a6366f9"><div class="ttname"><a href="flag_8cpp.html#aa4483d80251dc96dd0c8313d8a6366f9">flag_RELOAD_AND_SHOOT</a></div><div class="ttdeci">const flag_id flag_RELOAD_AND_SHOOT(&quot;RELOAD_AND_SHOOT&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_ac577a11efabcd415739ddfea395ace5e"><div class="ttname"><a href="flag_8cpp.html#ac577a11efabcd415739ddfea395ace5e">flag_CASING</a></div><div class="ttdeci">const flag_id flag_CASING(&quot;CASING&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_acb6e90c0baf497df88a7a259edd77dc3"><div class="ttname"><a href="flag_8cpp.html#acb6e90c0baf497df88a7a259edd77dc3">flag_UNDERWATER_GUN</a></div><div class="ttdeci">const flag_id flag_UNDERWATER_GUN(&quot;UNDERWATER_GUN&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_ae4145a31d8da9f94a59bb3d6fb13436f"><div class="ttname"><a href="flag_8cpp.html#ae4145a31d8da9f94a59bb3d6fb13436f">flag_FIRE_TWOHAND</a></div><div class="ttdeci">const flag_id flag_FIRE_TWOHAND(&quot;FIRE_TWOHAND&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_ae84bc064f3667f365835de3b66ba89de"><div class="ttname"><a href="flag_8cpp.html#ae84bc064f3667f365835de3b66ba89de">flag_CUSTOM_EXPLOSION</a></div><div class="ttdeci">const flag_id flag_CUSTOM_EXPLOSION(&quot;CUSTOM_EXPLOSION&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_aedfde22bea9f851fe42ce054812293f2"><div class="ttname"><a href="flag_8cpp.html#aedfde22bea9f851fe42ce054812293f2">flag_CHOKE</a></div><div class="ttdeci">const flag_id flag_CHOKE(&quot;CHOKE&quot;)</div></div>
<div class="ttc" id="aflag_8h_html"><div class="ttname"><a href="flag_8h.html">flag.h</a></div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00382">game.cpp:382</a></div></div>
<div class="ttc" id="agame_8cpp_html_afa1063326b0c16b43c6f3dc8c3df403d"><div class="ttname"><a href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13822">game.cpp:13822</a></div></div>
<div class="ttc" id="agame_8h_html"><div class="ttname"><a href="game_8h.html">game.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html"><div class="ttname"><a href="game__constants_8h.html">game_constants.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a32b6b0daa47aeb1caa71bc0585e24684"><div class="ttname"><a href="game__constants_8h.html#a32b6b0daa47aeb1caa71bc0585e24684">accuracy_critical</a></div><div class="ttdeci">constexpr double accuracy_critical</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00130">game_constants.h:130</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a3984a9476d1edc78e4e7b886a08d4d4b"><div class="ttname"><a href="game__constants_8h.html#a3984a9476d1edc78e4e7b886a08d4d4b">OVERMAP_HEIGHT</a></div><div class="ttdeci">constexpr int OVERMAP_HEIGHT</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00075">game_constants.h:75</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a45b6e116f09ae6af4ef31f1495cf48a1"><div class="ttname"><a href="game__constants_8h.html#a45b6e116f09ae6af4ef31f1495cf48a1">accuracy_grazing</a></div><div class="ttdeci">constexpr double accuracy_grazing</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00133">game_constants.h:133</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a8226e8a134603e5bc06df05efd13d8d1"><div class="ttname"><a href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a></div><div class="ttdeci">constexpr double MAX_RECOIL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00137">game_constants.h:137</a></div></div>
<div class="ttc" id="agame__constants_8h_html_aad0eacfa516a8f7e005674027d7640fe"><div class="ttname"><a href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a></div><div class="ttdeci">constexpr int OVERMAP_DEPTH</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00073">game_constants.h:73</a></div></div>
<div class="ttc" id="agame__constants_8h_html_ae5e219227693b7de2d1bb823567b01c7"><div class="ttname"><a href="game__constants_8h.html#ae5e219227693b7de2d1bb823567b01c7">accuracy_standard</a></div><div class="ttdeci">constexpr double accuracy_standard</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00132">game_constants.h:132</a></div></div>
<div class="ttc" id="agame__constants_8h_html_ae9c0ec5b4724c15132efddb8862ca652"><div class="ttname"><a href="game__constants_8h.html#ae9c0ec5b4724c15132efddb8862ca652">MAX_SKILL</a></div><div class="ttdeci">constexpr int MAX_SKILL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00120">game_constants.h:120</a></div></div>
<div class="ttc" id="aglobal__vars_8h_html_a54b344f3b76633f42ae19af82cc1cc89a7b774effe4a349c6dd82ad4f4f21d34c"><div class="ttname"><a href="global__vars_8h.html#a54b344f3b76633f42ae19af82cc1cc89a7b774effe4a349c6dd82ad4f4f21d34c">var_type::u</a></div><div class="ttdeci">@ u</div></div>
<div class="ttc" id="agroup__UI_html_ga7604af7545244003f0a52ac87ce37979"><div class="ttname"><a href="group__UI.html#ga7604af7545244003f0a52ac87ce37979">uilist::query</a></div><div class="ttdeci">void query(bool loop=true, int timeout=-1)</div><div class="ttdoc">Handle input and update display.</div><div class="ttdef"><b>Definition:</b> <a href="ui_8cpp_source.html#l01032">ui.cpp:1032</a></div></div>
<div class="ttc" id="agun__mode_8h_html"><div class="ttname"><a href="gun__mode_8h.html">gun_mode.h</a></div></div>
<div class="ttc" id="ahandle__action_8cpp_html_ad56544ec96a0f79ea4e47ae8f8754d10"><div class="ttname"><a href="handle__action_8cpp.html#ad56544ec96a0f79ea4e47ae8f8754d10">fire</a></div><div class="ttdeci">static void fire()</div><div class="ttdef"><b>Definition:</b> <a href="handle__action_8cpp_source.html#l01635">handle_action.cpp:1635</a></div></div>
<div class="ttc" id="ainput_8cpp_html_aceedd903724817bad81fbc03216ff125"><div class="ttname"><a href="input_8cpp.html#aceedd903724817bad81fbc03216ff125">is_mouse_enabled</a></div><div class="ttdeci">bool is_mouse_enabled()</div><div class="ttdef"><b>Definition:</b> <a href="input_8cpp_source.html#l00054">input.cpp:54</a></div></div>
<div class="ttc" id="ainput_8h_html"><div class="ttname"><a href="input_8h.html">input.h</a></div></div>
<div class="ttc" id="ainput__context_8h_html"><div class="ttname"><a href="input__context_8h.html">input_context.h</a></div></div>
<div class="ttc" id="ainput__enums_8h_html_af2ddbd916f900586e2430bb9e0bb9ea1a90272dda245ae1fb3cf197e91a8689dc"><div class="ttname"><a href="input__enums_8h.html#af2ddbd916f900586e2430bb9e0bb9ea1a90272dda245ae1fb3cf197e91a8689dc">input_event_t::timeout</a></div><div class="ttdeci">@ timeout</div></div>
<div class="ttc" id="aitem_8cpp_html_a69e37326c7c5f142d13f8ac8e070b728"><div class="ttname"><a href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a></div><div class="ttdeci">item &amp; null_item_reference()</div><div class="ttdoc">Returns a reference to a null item (see item::is_null).</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00248">item.cpp:248</a></div></div>
<div class="ttc" id="aitem_8h_html"><div class="ttname"><a href="item_8h.html">item.h</a></div></div>
<div class="ttc" id="aitem__location_8h_html"><div class="ttname"><a href="item__location_8h.html">item_location.h</a></div></div>
<div class="ttc" id="aitype_8h_html"><div class="ttname"><a href="itype_8h.html">itype.h</a></div></div>
<div class="ttc" id="aitype_8h_html_a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180"><div class="ttname"><a href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">itype_variant_kind::gun</a></div><div class="ttdeci">@ gun</div></div>
<div class="ttc" id="aline_8cpp_html_a22f984836636053038f43340f9c50149"><div class="ttname"><a href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a></div><div class="ttdeci">units::angle coord_to_angle(const tripoint &amp;a, const tripoint &amp;b)</div><div class="ttdoc">Calculates the horizontal angle between the lines from (0,0,0) to a and the line from (0,...</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00940">line.cpp:940</a></div></div>
<div class="ttc" id="aline_8cpp_html_a2d906c9af0b0586f48bc34cff0838817"><div class="ttname"><a href="line_8cpp.html#a2d906c9af0b0586f48bc34cff0838817">rl_dist_exact</a></div><div class="ttdeci">float rl_dist_exact(const tripoint &amp;loc1, const tripoint &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00259">line.cpp:259</a></div></div>
<div class="ttc" id="aline_8cpp_html_a40b9d88f6d95e646490329d0071ec931"><div class="ttname"><a href="line_8cpp.html#a40b9d88f6d95e646490329d0071ec931">trigdist</a></div><div class="ttdeci">bool trigdist</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00018">line.cpp:18</a></div></div>
<div class="ttc" id="aline_8cpp_html_a755929144f419e0be862e2a7a87b6ab7"><div class="ttname"><a href="line_8cpp.html#a755929144f419e0be862e2a7a87b6ab7">iso_tangent</a></div><div class="ttdeci">double iso_tangent(double distance, const units::angle &amp;vertex)</div><div class="ttdoc">Calculate base of an isosceles triangle.</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00020">line.cpp:20</a></div></div>
<div class="ttc" id="aline_8cpp_html_aaa43dcdfe5b511b116fafb32c5cff349"><div class="ttname"><a href="line_8cpp.html#aaa43dcdfe5b511b116fafb32c5cff349">atan2</a></div><div class="ttdeci">units::angle atan2(const point &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00288">line.cpp:288</a></div></div>
<div class="ttc" id="aline_8h_html"><div class="ttname"><a href="line_8h.html">line.h</a></div></div>
<div class="ttc" id="aline_8h_html_a3621d2006812bd84f3ed6999b38f90a3"><div class="ttname"><a href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a></div><div class="ttdeci">direction</div><div class="ttdef"><b>Definition:</b> <a href="line_8h_source.html#l00042">line.h:42</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a188caae18b60b66f9f44214c7e28ac1f"><div class="ttname"><a href="magic_8cpp.html#a188caae18b60b66f9f44214c7e28ac1f">a</a></div><div class="ttdeci">static constexpr double a</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01566">magic.cpp:1566</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a6753ecfe87da659675b18c2f81d6ec12"><div class="ttname"><a href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a></div><div class="ttdeci">static constexpr double c</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01568">magic.cpp:1568</a></div></div>
<div class="ttc" id="amagic_8h_html"><div class="ttname"><a href="magic_8h.html">magic.h</a></div></div>
<div class="ttc" id="amagic_8h_html_a0d790bdb16f7b815ef552e2220820e9ca29d6fc960c94b5a330f850284e75ab1f"><div class="ttname"><a href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca29d6fc960c94b5a330f850284e75ab1f">spell_shape::cone</a></div><div class="ttdeci">@ cone</div></div>
<div class="ttc" id="amagic_8h_html_a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474"><div class="ttname"><a href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca6438c669e0d0de98e6929c2cc0fac474">spell_shape::line</a></div><div class="ttdeci">@ line</div></div>
<div class="ttc" id="amagic_8h_html_a0d790bdb16f7b815ef552e2220820e9ca9e1b93b20faf4a4798c106c0db299473"><div class="ttname"><a href="magic_8h.html#a0d790bdb16f7b815ef552e2220820e9ca9e1b93b20faf4a4798c106c0db299473">spell_shape::blast</a></div><div class="ttdeci">@ blast</div></div>
<div class="ttc" id="amagic_8h_html_a43ffd543787e68e5333debafdbb7ead7a447b7147e84be512208dcc0995d67ebc"><div class="ttname"><a href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a447b7147e84be512208dcc0995d67ebc">spell_target::item</a></div><div class="ttdeci">@ item</div></div>
<div class="ttc" id="amagic_8h_html_a43ffd543787e68e5333debafdbb7ead7a590f53e8699817c6fa498cc11a4cbe63"><div class="ttname"><a href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a590f53e8699817c6fa498cc11a4cbe63">spell_target::self</a></div><div class="ttdeci">@ self</div></div>
<div class="ttc" id="amagic_8h_html_aecee704c18d07f266d2b907c070bd7a1a334c4a4c42fdb79d7ebc3e73b517e6f8"><div class="ttname"><a href="magic_8h.html#aecee704c18d07f266d2b907c070bd7a1a334c4a4c42fdb79d7ebc3e73b517e6f8">magic_energy_type::none</a></div><div class="ttdeci">@ none</div></div>
<div class="ttc" id="amagic_8h_html_aecee704c18d07f266d2b907c070bd7a1ad2ccda10db94c2b5d51beed10484c025"><div class="ttname"><a href="magic_8h.html#aecee704c18d07f266d2b907c070bd7a1ad2ccda10db94c2b5d51beed10484c025">magic_energy_type::hp</a></div><div class="ttdeci">@ hp</div></div>
<div class="ttc" id="amap_8h_html"><div class="ttname"><a href="map_8h.html">map.h</a></div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a6360286fa7a45a7d705397a23a639f54"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a6360286fa7a45a7d705397a23a639f54">ter_furn_flag::TFLAG_MOUNTABLE</a></div><div class="ttdeci">@ TFLAG_MOUNTABLE</div></div>
<div class="ttc" id="amapgen_8cpp_html_a4f3a5fd278254d867d914ad5953679e2"><div class="ttname"><a href="mapgen_8cpp.html#a4f3a5fd278254d867d914ad5953679e2">line</a></div><div class="ttdeci">void line(map *m, const ter_id &amp;type, const point &amp;p1, const point &amp;p2, int z)</div><div class="ttdef"><b>Definition:</b> <a href="mapgen_8cpp_source.html#l07721">mapgen.cpp:7721</a></div></div>
<div class="ttc" id="amath__defines_8h_html"><div class="ttname"><a href="math__defines_8h.html">math_defines.h</a></div></div>
<div class="ttc" id="amath__defines_8h_html_ae71449b1cc6e6250b91f539153a7a0d3"><div class="ttname"><a href="math__defines_8h.html#ae71449b1cc6e6250b91f539153a7a0d3">M_PI</a></div><div class="ttdeci">#define M_PI</div><div class="ttdef"><b>Definition:</b> <a href="math__defines_8h_source.html#l00023">math_defines.h:23</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a5834219bcffc7118c95b395b8cdeec20"><div class="ttname"><a href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">round</a></div><div class="ttdeci">double round(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00110">math_parser_func.h:110</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a9009aa9e5eb1323238ebddffd8e1aedf"><div class="ttname"><a href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a></div><div class="ttdeci">double max(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00035">math_parser_func.h:35</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a993dede52d23a9a3d15b01a342391ef4"><div class="ttname"><a href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a></div><div class="ttdeci">double min(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00043">math_parser_func.h:43</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_aeb3bbc4ec861ea58cbfca028920e4cc6"><div class="ttname"><a href="math__parser__func_8h.html#aeb3bbc4ec861ea58cbfca028920e4cc6">sqrt</a></div><div class="ttdeci">double sqrt(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00061">math_parser_func.h:61</a></div></div>
<div class="ttc" id="amemory__fast_8h_html"><div class="ttname"><a href="memory__fast_8h.html">memory_fast.h</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ab8afe5baa726add2054cce385cad8855"><div class="ttname"><a href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast</a></div><div class="ttdeci">std::weak_ptr&lt; T &gt; weak_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00017">memory_fast.h:17</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ada897699f31fc8b37c5af09d95d45840"><div class="ttname"><a href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast</a></div><div class="ttdeci">std::shared_ptr&lt; T &gt; shared_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00016">memory_fast.h:16</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a3ea1aed1d11cd410cce07fb5be7aa34f"><div class="ttname"><a href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a></div><div class="ttdeci">void add_msg_if_player_sees(const tripoint &amp;target, std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l01007">messages.cpp:1007</a></div></div>
<div class="ttc" id="amessages_8h_html"><div class="ttname"><a href="messages_8h.html">messages.h</a></div></div>
<div class="ttc" id="amessages_8h_html_ab6590bda29b082a7282bcc1a9cc8f02a"><div class="ttname"><a href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a></div><div class="ttdeci">#define add_msg_debug(type,...)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00177">messages.h:177</a></div></div>
<div class="ttc" id="amonster_8h_html"><div class="ttname"><a href="monster_8h.html">monster.h</a></div></div>
<div class="ttc" id="amorale__types_8cpp_html_a7a7fa39cff1d7efe58e013c63b7f0ee6"><div class="ttname"><a href="morale__types_8cpp.html#a7a7fa39cff1d7efe58e013c63b7f0ee6">MORALE_PYROMANIA_STARTFIRE</a></div><div class="ttdeci">const morale_type MORALE_PYROMANIA_STARTFIRE(&quot;morale_pyromania_startfire&quot;)</div></div>
<div class="ttc" id="amorale__types_8cpp_html_ae932ffaaef9c3a4092fc8727141405bf"><div class="ttname"><a href="morale__types_8cpp.html#ae932ffaaef9c3a4092fc8727141405bf">MORALE_PYROMANIA_NOFIRE</a></div><div class="ttdeci">const morale_type MORALE_PYROMANIA_NOFIRE(&quot;morale_pyromania_nofire&quot;)</div></div>
<div class="ttc" id="amorale__types_8h_html"><div class="ttname"><a href="morale__types_8h.html">morale_types.h</a></div></div>
<div class="ttc" id="amtype_8cpp_html_a1ce59be15eeebc2aa195dc5a5cf38358"><div class="ttname"><a href="mtype_8cpp.html#a1ce59be15eeebc2aa195dc5a5cf38358">mon_flag_RIDEABLE_MECH</a></div><div class="ttdeci">mon_flag_id mon_flag_RIDEABLE_MECH</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8cpp_source.html#l00142">mtype.cpp:142</a></div></div>
<div class="ttc" id="amtype_8cpp_html_aef6cb4006fa1626010cdd2dba9c988db"><div class="ttname"><a href="mtype_8cpp.html#aef6cb4006fa1626010cdd2dba9c988db">mon_flag_HARDTOSHOOT</a></div><div class="ttdeci">mon_flag_id mon_flag_HARDTOSHOOT</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8cpp_source.html#l00095">mtype.cpp:95</a></div></div>
<div class="ttc" id="amtype_8cpp_html_af8eb4198f7564379a407e89c13cdd1b7"><div class="ttname"><a href="mtype_8cpp.html#af8eb4198f7564379a407e89c13cdd1b7">mon_flag_IMMOBILE</a></div><div class="ttdeci">mon_flag_id mon_flag_IMMOBILE</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8cpp_source.html#l00101">mtype.cpp:101</a></div></div>
<div class="ttc" id="amtype_8h_html"><div class="ttname"><a href="mtype_8h.html">mtype.h</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02rotatable__symbols_8cpp_03_html_a0828f572b03c625d4b291dd36d0d0a4c"><div class="ttname"><a href="namespaceanonymous__namespace_02rotatable__symbols_8cpp_03.html#a0828f572b03c625d4b291dd36d0d0a4c">anonymous_namespace{rotatable_symbols.cpp}::symbols</a></div><div class="ttdeci">std::vector&lt; rotatable_symbol &gt; symbols</div><div class="ttdef"><b>Definition:</b> <a href="rotatable__symbols_8cpp_source.html#l00031">rotatable_symbols.cpp:31</a></div></div>
<div class="ttc" id="anamespacecalendar_html_ae15fcbf1c971589eb49c1a657fb6a580"><div class="ttname"><a href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a></div><div class="ttdeci">time_point turn</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00038">calendar.cpp:38</a></div></div>
<div class="ttc" id="anamespacecata_1_1hash64__detail_html_a5ca825db6fd06946302c60daa97333e4"><div class="ttname"><a href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">cata::hash64_detail::ret</a></div><div class="ttdeci">T ret</div><div class="ttdef"><b>Definition:</b> <a href="hash__utils_8h_source.html#l00097">hash_utils.h:97</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_a576fd20080b8f49e27acf97af45b374b"><div class="ttname"><a href="namespacecatacurses.html#a576fd20080b8f49e27acf97af45b374b">catacurses::newwin</a></div><div class="ttdeci">window newwin(int nlines, int ncols, const point &amp;begin)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00058">ncurses_def.cpp:58</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_a7407bbe97af63fd80e0a4d26bf0274ab"><div class="ttname"><a href="namespacecatacurses.html#a7407bbe97af63fd80e0a4d26bf0274ab">catacurses::refresh</a></div><div class="ttdeci">void refresh()</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00181">ncurses_def.cpp:181</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_a929fe85d472028f52d8a5cdfc0d35017"><div class="ttname"><a href="namespacecatacurses.html#a929fe85d472028f52d8a5cdfc0d35017">catacurses::getmaxx</a></div><div class="ttdeci">int getmaxx(const window &amp;win)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00091">ncurses_def.cpp:91</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_aa9823d249c21fa50daf277957fabb175"><div class="ttname"><a href="namespacecatacurses.html#aa9823d249c21fa50daf277957fabb175">catacurses::wnoutrefresh</a></div><div class="ttdeci">void wnoutrefresh(const window &amp;win)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00067">ncurses_def.cpp:67</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_abde9c157650e464f0a27441d81c84644"><div class="ttname"><a href="namespacecatacurses.html#abde9c157650e464f0a27441d81c84644">catacurses::mvwprintw</a></div><div class="ttdeci">void mvwprintw(const window &amp;win, const point &amp;p, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00163">ncurses_def.cpp:163</a></div></div>
<div class="ttc" id="anamespacecatacurses_html_adc81ca40445dc062af12fb6d7a4793d0"><div class="ttname"><a href="namespacecatacurses.html#adc81ca40445dc062af12fb6d7a4793d0">catacurses::getmaxy</a></div><div class="ttdeci">int getmaxy(const window &amp;win)</div><div class="ttdef"><b>Definition:</b> <a href="ncurses__def_8cpp_source.html#l00099">ncurses_def.cpp:99</a></div></div>
<div class="ttc" id="anamespacedebugmode_html_ac654a55a1b56b11554103f87859968f2a784256c4603f053783c251704220cd0c"><div class="ttname"><a href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2a784256c4603f053783c251704220cd0c">debugmode::DF_RANGED</a></div><div class="ttdeci">@ DF_RANGED</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00273">debug.h:273</a></div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998">enchant_vals::mod</a></div><div class="ttdeci">mod</div><div class="ttdef"><b>Definition:</b> <a href="magic__enchantment_8h_source.html#l00031">magic_enchantment.h:31</a></div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998a3d3e5fcb0b68fc939d4e32a894e620a8"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998a3d3e5fcb0b68fc939d4e32a894e620a8">enchant_vals::mod::ATTACK_SPEED</a></div><div class="ttdeci">@ ATTACK_SPEED</div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998ac01550f8cffa20cf080d109e61087f58"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998ac01550f8cffa20cf080d109e61087f58">enchant_vals::mod::RECOIL_MODIFIER</a></div><div class="ttdeci">@ RECOIL_MODIFIER</div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998ac3248d624360335e5425f9570bb48629"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998ac3248d624360335e5425f9570bb48629">enchant_vals::mod::WEAPON_DISPERSION</a></div><div class="ttdeci">@ WEAPON_DISPERSION</div></div>
<div class="ttc" id="anamespaceenchant__vals_html_acd6a6ebb27f9ecb82b3bce1d3aef2998ae9eb92b40afbf5f24dc08c3543737d84"><div class="ttname"><a href="namespaceenchant__vals.html#acd6a6ebb27f9ecb82b3bce1d3aef2998ae9eb92b40afbf5f24dc08c3543737d84">enchant_vals::mod::RANGED_DAMAGE</a></div><div class="ttdeci">@ RANGED_DAMAGE</div></div>
<div class="ttc" id="anamespaceexplosion__handler_html_af4ae8e07a9627dbfe22b2d07ea577587"><div class="ttname"><a href="namespaceexplosion__handler.html#af4ae8e07a9627dbfe22b2d07ea577587">explosion_handler::explosion</a></div><div class="ttdeci">void explosion(const Creature *source, const tripoint &amp;p, float power, float factor, bool fire, int casing_mass, float frag_mass)</div><div class="ttdoc">Queue an explosion at p of intensity (power) with (shrapnel) chunks of shrapnel.</div><div class="ttdef"><b>Definition:</b> <a href="explosion_8cpp_source.html#l00489">explosion.cpp:489</a></div></div>
<div class="ttc" id="anamespacekeycode_html_a16ca776f0df120afb4f1b16a92e2d7f7aa6efe66b8fc51ca203d5f0015d983eac"><div class="ttname"><a href="namespacekeycode.html#a16ca776f0df120afb4f1b16a92e2d7f7aa6efe66b8fc51ca203d5f0015d983eac">keycode::end</a></div><div class="ttdeci">@ end</div><div class="ttdef"><b>Definition:</b> <a href="input_8h_source.html#l00095">input.h:95</a></div></div>
<div class="ttc" id="anamespacemath__opers_html_a2f0118617735cc810b9d76d62bd182f6"><div class="ttname"><a href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">math_opers::pos</a></div><div class="ttdeci">constexpr double pos(double, double r)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__impl_8h_source.html#l00203">math_parser_impl.h:203</a></div></div>
<div class="ttc" id="anamespaceom__direction_html_af97f9dbddaa758278662da3478826c61"><div class="ttname"><a href="namespaceom__direction.html#af97f9dbddaa758278662da3478826c61">om_direction::size</a></div><div class="ttdeci">const size_t size</div><div class="ttdef"><b>Definition:</b> <a href="omdata_8h_source.html#l00066">omdata.h:66</a></div></div>
<div class="ttc" id="anamespacesfx_html_a1f138eaa92db132e81ce591751c512cc"><div class="ttname"><a href="namespacesfx.html#a1f138eaa92db132e81ce591751c512cc">sfx::get_heard_volume</a></div><div class="ttdeci">int get_heard_volume(const tripoint &amp;source)</div><div class="ttdoc">Functions from sfx that do not use the SDL_mixer API at all.</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l02045">sounds.cpp:2045</a></div></div>
<div class="ttc" id="anamespacesfx_html_a8fa2bb887ac81392fb686cc4079b5d5a"><div class="ttname"><a href="namespacesfx.html#a8fa2bb887ac81392fb686cc4079b5d5a">sfx::play_variant_sound</a></div><div class="ttdeci">void play_variant_sound(const std::string &amp;id, const std::string &amp;variant, int volume, units::angle angle, double pitch_min=-1.0, double pitch_max=-1.0)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l01999">sounds.cpp:1999</a></div></div>
<div class="ttc" id="anamespacesfx_html_aa186eb63210729f73d7c76dcda527ff5"><div class="ttname"><a href="namespacesfx.html#aa186eb63210729f73d7c76dcda527ff5">sfx::get_heard_angle</a></div><div class="ttdeci">units::angle get_heard_angle(const tripoint &amp;source)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l02058">sounds.cpp:2058</a></div></div>
<div class="ttc" id="anamespacesfx_html_ab522c25b68b3f305b3f006ee41a7bd83"><div class="ttname"><a href="namespacesfx.html#ab522c25b68b3f305b3f006ee41a7bd83">sfx::generate_gun_sound</a></div><div class="ttdeci">void generate_gun_sound(const Character &amp;source_arg, const item &amp;firing)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l02006">sounds.cpp:2006</a></div></div>
<div class="ttc" id="anamespacesounds_html_a6bb79ae1c9c3dcd8c8e0b28c66b0398d"><div class="ttname"><a href="namespacesounds.html#a6bb79ae1c9c3dcd8c8e0b28c66b0398d">sounds::sound</a></div><div class="ttdeci">void sound(const tripoint &amp;p, int vol, sound_t category, const std::string &amp;description, bool ambient=false, const std::string &amp;id=&quot;&quot;, const std::string &amp;variant=&quot;default&quot;)</div><div class="ttdoc">Sound at (p) of intensity (vol)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l00318">sounds.cpp:318</a></div></div>
<div class="ttc" id="anamespacesounds_html_af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed"><div class="ttname"><a href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3ac222ae0d4e9c59bd254b72521b9e74ed">sounds::sound_t::combat</a></div><div class="ttdeci">@ combat</div></div>
<div class="ttc" id="anamespacespell__effect_html_a7c43bcc07956a3d9de33c074d6507544"><div class="ttname"><a href="namespacespell__effect.html#a7c43bcc07956a3d9de33c074d6507544">spell_effect::spell_effect_cone</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_effect_cone(const override_parameters &amp;params, const tripoint &amp;source, const tripoint &amp;target)</div><div class="ttdef"><b>Definition:</b> <a href="magic__spell__effect_8cpp_source.html#l00278">magic_spell_effect.cpp:278</a></div></div>
<div class="ttc" id="anamespacespell__effect_html_a867e7cee9db7df16c4334db9c0637501"><div class="ttname"><a href="namespacespell__effect.html#a867e7cee9db7df16c4334db9c0637501">spell_effect::spell_effect_line</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_effect_line(const override_parameters &amp;params, const tripoint &amp;source, const tripoint &amp;target)</div><div class="ttdef"><b>Definition:</b> <a href="magic__spell__effect_8cpp_source.html#l00295">magic_spell_effect.cpp:295</a></div></div>
<div class="ttc" id="anamespacespell__effect_html_a9e71032270fa0320ba243005a7b50a5f"><div class="ttname"><a href="namespacespell__effect.html#a9e71032270fa0320ba243005a7b50a5f">spell_effect::spell_effect_blast</a></div><div class="ttdeci">std::set&lt; tripoint &gt; spell_effect_blast(const override_parameters &amp;params, const tripoint &amp;, const tripoint &amp;target)</div><div class="ttdef"><b>Definition:</b> <a href="magic__spell__effect_8cpp_source.html#l00225">magic_spell_effect.cpp:225</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a10911d1ab9fa4b1484138f1bc379baa5"><div class="ttname"><a href="namespacetarget__handler.html#a10911d1ab9fa4b1484138f1bc379baa5">target_handler::mode_spell</a></div><div class="ttdeci">trajectory mode_spell(avatar &amp;you, spell &amp;casting, bool no_fail, bool no_mana)</div><div class="ttdoc">Casting a spell.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00511">ranged.cpp:511</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a15e531943e7385d987d87f82f5957821"><div class="ttname"><a href="namespacetarget__handler.html#a15e531943e7385d987d87f82f5957821">target_handler::mode_fire</a></div><div class="ttdeci">trajectory mode_fire(avatar &amp;you, aim_activity_actor &amp;activity)</div><div class="ttdoc">Firing ranged weapon.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00428">ranged.cpp:428</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a2ee0da8af1b540479f0a5def5357a8b5"><div class="ttname"><a href="namespacetarget__handler.html#a2ee0da8af1b540479f0a5def5357a8b5">target_handler::mode_reach</a></div><div class="ttdeci">trajectory mode_reach(avatar &amp;you, item_location weapon)</div><div class="ttdoc">Reach attacking.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00455">ranged.cpp:455</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a3371a56d7b45012072236fb97eda5cc0"><div class="ttname"><a href="namespacetarget__handler.html#a3371a56d7b45012072236fb97eda5cc0">target_handler::mode_turrets</a></div><div class="ttdeci">trajectory mode_turrets(avatar &amp;you, vehicle &amp;veh, const std::vector&lt; vehicle_part * &gt; &amp;turrets)</div><div class="ttdoc">Selecting target for turrets (when using vehicle controls)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00481">ranged.cpp:481</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_a9f06978559f45ddb20b5a1caec3f9c1f"><div class="ttname"><a href="namespacetarget__handler.html#a9f06978559f45ddb20b5a1caec3f9c1f">target_handler::mode_turret_manual</a></div><div class="ttdeci">trajectory mode_turret_manual(avatar &amp;you, turret_data &amp;turret)</div><div class="ttdoc">Manually firing vehicle turret.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00467">ranged.cpp:467</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_abf6b4d399e1ef6b51df0dc4621a5720d"><div class="ttname"><a href="namespacetarget__handler.html#abf6b4d399e1ef6b51df0dc4621a5720d">target_handler::mode_throw</a></div><div class="ttdeci">trajectory mode_throw(avatar &amp;you, item &amp;relevant, bool blind_throwing)</div><div class="ttdoc">Throwing item.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00442">ranged.cpp:442</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_ad17e5a6408a9a9dbe8ac07aa89b0dac4"><div class="ttname"><a href="namespacetarget__handler.html#ad17e5a6408a9a9dbe8ac07aa89b0dac4">target_handler::mode_select_only</a></div><div class="ttdeci">trajectory mode_select_only(avatar &amp;you, int range)</div><div class="ttdoc">Generic target select without fire something.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00417">ranged.cpp:417</a></div></div>
<div class="ttc" id="anamespacetarget__handler_html_aea843144f5e69546ddea88eeda177640"><div class="ttname"><a href="namespacetarget__handler.html#aea843144f5e69546ddea88eeda177640">target_handler::trajectory</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; trajectory</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00029">ranged.h:29</a></div></div>
<div class="ttc" id="anamespacetname_html_a24cc3734547252a92df94fedcff08ae3"><div class="ttname"><a href="namespacetname.html#a24cc3734547252a92df94fedcff08ae3">tname::unprefixed_tname</a></div><div class="ttdeci">constexpr segment_bitset unprefixed_tname(default_tname_bits &amp;~tname_prefix_bits)</div></div>
<div class="ttc" id="anamespacetname_html_aa6dc2a5ef81ad3157f8280d5645e3ea6a8b926ca329dfb31daa1211d0e158e05e"><div class="ttname"><a href="namespacetname.html#aa6dc2a5ef81ad3157f8280d5645e3ea6a8b926ca329dfb31daa1211d0e158e05e">tname::segments::CONTENTS</a></div><div class="ttdeci">@ CONTENTS</div></div>
<div class="ttc" id="anamespaceui__manager_html_ae38f3a918052ef286ee60daac47f52d4"><div class="ttname"><a href="namespaceui__manager.html#ae38f3a918052ef286ee60daac47f52d4">ui_manager::redraw</a></div><div class="ttdeci">void redraw()</div><div class="ttdoc">Invalidate the top window and redraw all invalidated windows.</div><div class="ttdef"><b>Definition:</b> <a href="ui__manager_8cpp_source.html#l00504">ui_manager.cpp:504</a></div></div>
<div class="ttc" id="anamespaceui_html"><div class="ttname"><a href="namespaceui.html">ui</a></div><div class="ttdef"><b>Definition:</b> <a href="overmap__ui_8h_source.html#l00024">overmap_ui.h:25</a></div></div>
<div class="ttc" id="anamespaceunits_html_a144476d36f26d6e1916493c3636d54dc"><div class="ttname"><a href="namespaceunits.html#a144476d36f26d6e1916493c3636d54dc">units::to_milliliter</a></div><div class="ttdeci">constexpr value_type to_milliliter(const quantity&lt; value_type, volume_in_milliliter_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00316">units.h:316</a></div></div>
<div class="ttc" id="anamespaceunits_html_a2c7fe916bf04655f9fb4f2abdc5d28ed"><div class="ttname"><a href="namespaceunits.html#a2c7fe916bf04655f9fb4f2abdc5d28ed">units::angle</a></div><div class="ttdeci">quantity&lt; double, angle_in_radians_tag &gt; angle</div><div class="ttdef"><b>Definition:</b> <a href="units__fwd_8h_source.html#l00075">units_fwd.h:75</a></div></div>
<div class="ttc" id="anamespaceunits_html_a7f3948de70e78d68af74fb3d119cf176"><div class="ttname"><a href="namespaceunits.html#a7f3948de70e78d68af74fb3d119cf176">units::to_kilojoule</a></div><div class="ttdeci">constexpr value_type to_kilojoule(const quantity&lt; value_type, energy_in_millijoule_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00578">units.h:578</a></div></div>
<div class="ttc" id="anamespaceunits_html_a8306911daadc1a4d7a7b46e9786f4a4c"><div class="ttname"><a href="namespaceunits.html#a8306911daadc1a4d7a7b46e9786f4a4c">units::to_gram</a></div><div class="ttdeci">constexpr value_type to_gram(const quantity&lt; value_type, mass_in_milligram_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00364">units.h:364</a></div></div>
<div class="ttc" id="anamespaceunits_html_a9ce2bc1618fa4acf9f9e98effd9f1ae0"><div class="ttname"><a href="namespaceunits.html#a9ce2bc1618fa4acf9f9e98effd9f1ae0">units::to_degrees</a></div><div class="ttdeci">constexpr double to_degrees(const units::angle v)</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00757">units.h:757</a></div></div>
<div class="ttc" id="anamespaceunits_html_a9e6793937cd630b03c24d520c5415904"><div class="ttname"><a href="namespaceunits.html#a9e6793937cd630b03c24d520c5415904">units::to_joule</a></div><div class="ttdeci">constexpr value_type to_joule(const quantity&lt; value_type, energy_in_millijoule_tag &gt; &amp;v)</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00572">units.h:572</a></div></div>
<div class="ttc" id="anamespaceunits_html_ae3cb4452221bae58dc798b8fc5865007"><div class="ttname"><a href="namespaceunits.html#ae3cb4452221bae58dc798b8fc5865007">units::from_arcmin</a></div><div class="ttdeci">constexpr quantity&lt; double, angle_in_radians_tag &gt; from_arcmin(const value_type v)</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00763">units.h:763</a></div></div>
<div class="ttc" id="anpc_8h_html"><div class="ttname"><a href="npc_8h.html">npc.h</a></div></div>
<div class="ttc" id="aoptions_8h_html"><div class="ttname"><a href="options_8h.html">options.h</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a000abea6447dfafd5f9b787aa6753609"><div class="ttname"><a href="output_8cpp.html#a000abea6447dfafd5f9b787aa6753609">TERMX</a></div><div class="ttdeci">int TERMX</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00049">output.cpp:49</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a1184e3eda011b110d09bf2dcf08228f5"><div class="ttname"><a href="output_8cpp.html#a1184e3eda011b110d09bf2dcf08228f5">mvwprintz</a></div><div class="ttdeci">void mvwprintz(const catacurses::window &amp;w, const point &amp;p, const nc_color &amp;FG, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l03290">output.cpp:3290</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a2f8515020638461e15374b3bf6555c75"><div class="ttname"><a href="output_8cpp.html#a2f8515020638461e15374b3bf6555c75">fold_and_print_from</a></div><div class="ttdeci">int fold_and_print_from(const catacurses::window &amp;w, const point &amp;begin, int width, int begin_line, const nc_color &amp;base_color, const std::string &amp;text)</div><div class="ttdoc">Like fold_and_print, but starts the output with the N-th line of the folded string.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00391">output.cpp:391</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a567a63be8cb70cc3eb47bf8affced8e5"><div class="ttname"><a href="output_8cpp.html#a567a63be8cb70cc3eb47bf8affced8e5">TERMY</a></div><div class="ttdeci">int TERMY</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00050">output.cpp:50</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a64a769083b78bb93dbb99935b959f3f5"><div class="ttname"><a href="output_8cpp.html#a64a769083b78bb93dbb99935b959f3f5">print_colored_text</a></div><div class="ttdeci">void print_colored_text(const catacurses::window &amp;w, const point &amp;p, nc_color &amp;color, const nc_color &amp;base_color, const std::string_view text, const report_color_error color_error)</div><div class="ttdoc">Print text with embedded color_tags, x, y are in curses system.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00239">output.cpp:239</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a71e024973a8beccd4a228d00ebd9503a"><div class="ttname"><a href="output_8cpp.html#a71e024973a8beccd4a228d00ebd9503a">uppercase_first_letter</a></div><div class="ttdeci">std::string uppercase_first_letter(const std::string &amp;str)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l02558">output.cpp:2558</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_a86a68d80cad5052d3e456a9fb8b1769d"><div class="ttname"><a href="output_8cpp.html#a86a68d80cad5052d3e456a9fb8b1769d">RatingVector</a></div><div class="ttdeci">std::vector&lt; std::tuple&lt; double, char, std::string &gt; &gt; RatingVector</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l02741">output.cpp:2741</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_aa6093ccb0ebc7f7ee1f11edd5cc2711c"><div class="ttname"><a href="output_8cpp.html#aa6093ccb0ebc7f7ee1f11edd5cc2711c">right_print</a></div><div class="ttdeci">int right_print(const catacurses::window &amp;w, const int line, const int right_indent, const nc_color &amp;FG, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00574">output.cpp:574</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ab62599a77867b8f416669b92f60f4900"><div class="ttname"><a href="output_8cpp.html#ab62599a77867b8f416669b92f60f4900">query_yn</a></div><div class="ttdeci">bool query_yn(const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00811">output.cpp:811</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ab7abbbd98907f496533db9bc2a02cf4a"><div class="ttname"><a href="output_8cpp.html#ab7abbbd98907f496533db9bc2a02cf4a">trim_and_print</a></div><div class="ttdeci">void trim_and_print(const catacurses::window &amp;w, const point &amp;begin, const int width, const nc_color &amp;base_color, const std::string &amp;text, const report_color_error color_error)</div><div class="ttdoc">Prints a single line of text.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00268">output.cpp:268</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_ab9659cbe9ec23a2efd813f795cb7fb73"><div class="ttname"><a href="output_8cpp.html#ab9659cbe9ec23a2efd813f795cb7fb73">fold_and_print</a></div><div class="ttdeci">int fold_and_print(const catacurses::window &amp;w, const point &amp;begin, int width, const nc_color &amp;base_color, const std::string &amp;text, const char split)</div><div class="ttdoc">Fold and print text in the given window.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00379">output.cpp:379</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_add34b080694a5b887cf3b201051bf1c0"><div class="ttname"><a href="output_8cpp.html#add34b080694a5b887cf3b201051bf1c0">get_labeled_bar</a></div><div class="ttdeci">std::string get_labeled_bar(const double val, const int width, const std::string &amp;label, char c)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l02724">output.cpp:2724</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_add4e31deb8a6e0444b89c79343c34a9c"><div class="ttname"><a href="output_8cpp.html#add4e31deb8a6e0444b89c79343c34a9c">insert_table</a></div><div class="ttdeci">void insert_table(const catacurses::window &amp;w, int pad, int line, int columns, const nc_color &amp;FG, const std::string &amp;divider, bool r_align, const std::vector&lt; std::string &gt; &amp;data)</div><div class="ttdoc">Inserts a table into a window, with data right-aligned.</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l02793">output.cpp:2793</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_aedec608a42edd33ec812f7769a9ed0c9"><div class="ttname"><a href="output_8cpp.html#aedec608a42edd33ec812f7769a9ed0c9">wprintz</a></div><div class="ttdeci">void wprintz(const catacurses::window &amp;w, const nc_color &amp;FG, const std::string &amp;text)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l03298">output.cpp:3298</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_afb5597c87a5847c7d64b878ab3a77d5b"><div class="ttname"><a href="output_8cpp.html#afb5597c87a5847c7d64b878ab3a77d5b">mvwputch</a></div><div class="ttdeci">void mvwputch(const catacurses::window &amp;w, const point &amp;p, nc_color FG, int ch)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00590">output.cpp:590</a></div></div>
<div class="ttc" id="aoutput_8cpp_html_afea9968fcee47ebca0e45d27099d1c22"><div class="ttname"><a href="output_8cpp.html#afea9968fcee47ebca0e45d27099d1c22">draw_border</a></div><div class="ttdeci">void draw_border(const catacurses::window &amp;w, nc_color border_color, const std::string &amp;title, nc_color title_color)</div><div class="ttdef"><b>Definition:</b> <a href="output_8cpp_source.html#l00688">output.cpp:688</a></div></div>
<div class="ttc" id="aoutput_8h_html"><div class="ttname"><a href="output_8h.html">output.h</a></div></div>
<div class="ttc" id="aoutput_8h_html_a4be67498ee67b5186fcae5cf706f7512"><div class="ttname"><a href="output_8h.html#a4be67498ee67b5186fcae5cf706f7512">enumerate_as_string</a></div><div class="ttdeci">std::string enumerate_as_string(const Container &amp;values, enumeration_conjunction conj=enumeration_conjunction::and_)</div><div class="ttdef"><b>Definition:</b> <a href="output_8h_source.html#l00647">output.h:647</a></div></div>
<div class="ttc" id="aoutput_8h_html_acff0d12357d8a4690e781eed41b36b98a334c4a4c42fdb79d7ebc3e73b517e6f8"><div class="ttname"><a href="output_8h.html#acff0d12357d8a4690e781eed41b36b98a334c4a4c42fdb79d7ebc3e73b517e6f8">enumeration_conjunction::none</a></div><div class="ttdeci">@ none</div></div>
<div class="ttc" id="apanels_8h_html"><div class="ttname"><a href="panels_8h.html">panels.h</a></div></div>
<div class="ttc" id="apocket__type_8h_html"><div class="ttname"><a href="pocket__type_8h.html">pocket_type.h</a></div></div>
<div class="ttc" id="apocket__type_8h_html_af41ed729a50321996f6fa60225086cf1a9ad53f422a98449de1c9f7bd20b2de8a"><div class="ttname"><a href="pocket__type_8h.html#af41ed729a50321996f6fa60225086cf1a9ad53f422a98449de1c9f7bd20b2de8a">pocket_type::MAGAZINE</a></div><div class="ttdeci">@ MAGAZINE</div></div>
<div class="ttc" id="apocket__type_8h_html_af41ed729a50321996f6fa60225086cf1a9bbab5f947b9e3fbb8a399ecc257459b"><div class="ttname"><a href="pocket__type_8h.html#af41ed729a50321996f6fa60225086cf1a9bbab5f947b9e3fbb8a399ecc257459b">pocket_type::CONTAINER</a></div><div class="ttdeci">@ CONTAINER</div></div>
<div class="ttc" id="apoint_8h_html"><div class="ttname"><a href="point_8h.html">point.h</a></div></div>
<div class="ttc" id="apoint_8h_html_a4b1a6bcaa42d2c06ecc3afc63305bfdf"><div class="ttname"><a href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a></div><div class="ttdeci">constexpr tripoint tripoint_zero</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00250">point.h:250</a></div></div>
<div class="ttc" id="aprojectile_8cpp_html_a25f4dcd2b5815a4943a73a6b674ba9e0"><div class="ttname"><a href="projectile_8cpp.html#a25f4dcd2b5815a4943a73a6b674ba9e0">multi_projectile_hit_message</a></div><div class="ttdeci">void multi_projectile_hit_message(Creature *critter, int hit_count, int damage_taken, const std::string &amp;projectile_name)</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8cpp_source.html#l00202">projectile.cpp:202</a></div></div>
<div class="ttc" id="aprojectile_8h_html"><div class="ttname"><a href="projectile_8h.html">projectile.h</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a035c67a119c3f5a39b1069944798c9fc"><div class="ttname"><a href="ranged_8cpp.html#a035c67a119c3f5a39b1069944798c9fc">cycle_action</a></div><div class="ttdeci">static void cycle_action(item &amp;weap, const itype_id &amp;ammo, const tripoint &amp;pos)</div><div class="ttdoc">Handle spent ammo casings and linkages.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02116">ranged.cpp:2116</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a0445510734214e05ba923feabd4b85d9"><div class="ttname"><a href="ranged_8cpp.html#a0445510734214e05ba923feabd4b85d9">material_glass</a></div><div class="ttdeci">static const material_id material_glass(&quot;glass&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0702c7984ec8768691cb9a805616d1de"><div class="ttname"><a href="ranged_8cpp.html#a0702c7984ec8768691cb9a805616d1de">print_aim</a></div><div class="ttdeci">static int print_aim(const target_ui &amp;ui, Character &amp;you, const catacurses::window &amp;w, int line_number, input_context &amp;ctxt, const item &amp;weapon, const tripoint &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01941">ranged.cpp:1941</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a08481f62adb6937636ea44b855311037"><div class="ttname"><a href="ranged_8cpp.html#a08481f62adb6937636ea44b855311037">effect_downed</a></div><div class="ttdeci">static const efftype_id effect_downed(&quot;downed&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0c6f7a1d7eeb2c38d69b568d85eb9f0d"><div class="ttname"><a href="ranged_8cpp.html#a0c6f7a1d7eeb2c38d69b568d85eb9f0d">skill_launcher</a></div><div class="ttdeci">static const skill_id skill_launcher(&quot;launcher&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0ea533037e4a6a02394d39e2d62174bc"><div class="ttname"><a href="ranged_8cpp.html#a0ea533037e4a6a02394d39e2d62174bc">fault_gun_dirt</a></div><div class="ttdeci">static const fault_id fault_gun_dirt(&quot;fault_gun_dirt&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0f268fc372aed3ee28ba36bd2d2d5287"><div class="ttname"><a href="ranged_8cpp.html#a0f268fc372aed3ee28ba36bd2d2d5287">fault_overheat_venting</a></div><div class="ttdeci">static const fault_id fault_overheat_venting(&quot;fault_overheat_venting&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a0fb9c66af29eade7d376e89264128bcd"><div class="ttname"><a href="ranged_8cpp.html#a0fb9c66af29eade7d376e89264128bcd">trait_BRAWLER</a></div><div class="ttdeci">static const trait_id trait_BRAWLER(&quot;BRAWLER&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a13b78ee77e8e3b8527bff0ce8e7a5651"><div class="ttname"><a href="ranged_8cpp.html#a13b78ee77e8e3b8527bff0ce8e7a5651">make_gun_sound_effect</a></div><div class="ttdeci">static void make_gun_sound_effect(const Character &amp;p, bool burst, item *weapon)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02172">ranged.cpp:2172</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a157369b3ee1f3f5a889eb1d42ed97638"><div class="ttname"><a href="ranged_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">damage_bash</a></div><div class="ttdeci">static const damage_type_id damage_bash(&quot;bash&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a18e93476c9d626924c31cf14193305b3"><div class="ttname"><a href="ranged_8cpp.html#a18e93476c9d626924c31cf14193305b3">gunmode_checks_common</a></div><div class="ttdeci">bool gunmode_checks_common(avatar &amp;you, const map &amp;m, std::vector&lt; std::string &gt; &amp;messages, const gun_mode &amp;gmode)</div><div class="ttdoc">Common checks for gunmode (when firing a weapon / manually firing turret)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l03975">ranged.cpp:3975</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a1942f5c7424513a78ab3491db37341f1"><div class="ttname"><a href="ranged_8cpp.html#a1942f5c7424513a78ab3491db37341f1">confidence_estimate</a></div><div class="ttdeci">static double confidence_estimate(const Target_attributes &amp;attributes, const dispersion_sources &amp;dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01563">ranged.cpp:1563</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a1d5482b7403ee4ac3e70e88ecfee2141"><div class="ttname"><a href="ranged_8cpp.html#a1d5482b7403ee4ac3e70e88ecfee2141">skill_dodge</a></div><div class="ttdeci">static const skill_id skill_dodge(&quot;dodge&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a1d815a8053cfecc8a05374bf92924ba2"><div class="ttname"><a href="ranged_8cpp.html#a1d815a8053cfecc8a05374bf92924ba2">skill_swimming</a></div><div class="ttdeci">static const skill_id skill_swimming(&quot;swimming&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a1e9f8f3600585654b27d71a2dc99a449"><div class="ttname"><a href="ranged_8cpp.html#a1e9f8f3600585654b27d71a2dc99a449">material_high_steel</a></div><div class="ttdeci">static const material_id material_high_steel(&quot;high_steel&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a207024a5d17769a16bfc8a7a434d72cd"><div class="ttname"><a href="ranged_8cpp.html#a207024a5d17769a16bfc8a7a434d72cd">gunmode_checks_weapon</a></div><div class="ttdeci">bool gunmode_checks_weapon(avatar &amp;you, const map &amp;m, std::vector&lt; std::string &gt; &amp;messages, const gun_mode &amp;gmode)</div><div class="ttdoc">Various checks for gunmode when firing a weapon.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l04010">ranged.cpp:4010</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a217238d7885e55ae74878bbb1f99cddd"><div class="ttname"><a href="ranged_8cpp.html#a217238d7885e55ae74878bbb1f99cddd">dispersion_from_skill</a></div><div class="ttdeci">static double dispersion_from_skill(double skill, double weapon_dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02267">ranged.cpp:2267</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a221acbe15b21618febcda6765ff3223c"><div class="ttname"><a href="ranged_8cpp.html#a221acbe15b21618febcda6765ff3223c">calculate_ranged_chances</a></div><div class="ttdeci">static std::vector&lt; aim_type_prediction &gt; calculate_ranged_chances(const target_ui &amp;ui, const Character &amp;you, target_ui::TargetMode mode, const input_context &amp;ctxt, const item &amp;weapon, const dispersion_sources &amp;dispersion, const std::vector&lt; confidence_rating &gt; &amp;confidence_ratings, const Target_attributes &amp;target, const tripoint &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01692">ranged.cpp:1692</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a263771acb00bdae9183f85580fcb1b43"><div class="ttname"><a href="ranged_8cpp.html#a263771acb00bdae9183f85580fcb1b43">material_case_hardened_steel</a></div><div class="ttdeci">static const material_id material_case_hardened_steel(&quot;case_hardened_steel&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a26815bd1f0ea7814c8d82103ce7458d8"><div class="ttname"><a href="ranged_8cpp.html#a26815bd1f0ea7814c8d82103ce7458d8">material_budget_steel</a></div><div class="ttdeci">static const material_id material_budget_steel(&quot;budget_steel&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a26f773999c96865544c00b5496637d56"><div class="ttname"><a href="ranged_8cpp.html#a26f773999c96865544c00b5496637d56">tr_practice_target</a></div><div class="ttdeci">static const trap_str_id tr_practice_target(&quot;tr_practice_target&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a282ca1601a24be0ae7aae003597e7ada"><div class="ttname"><a href="ranged_8cpp.html#a282ca1601a24be0ae7aae003597e7ada">ammo_arrow</a></div><div class="ttdeci">static const ammotype ammo_arrow(&quot;arrow&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a2d15a168c57c6a43e0e7130e7aac2120"><div class="ttname"><a href="ranged_8cpp.html#a2d15a168c57c6a43e0e7130e7aac2120">mod_stamina_archery</a></div><div class="ttdeci">static void mod_stamina_archery(Character &amp;you, const item &amp;relevant)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01497">ranged.cpp:1497</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a2f8b66e6fc62f3d92b208655f5525bba"><div class="ttname"><a href="ranged_8cpp.html#a2f8b66e6fc62f3d92b208655f5525bba">skill_archery</a></div><div class="ttdeci">static const skill_id skill_archery(&quot;archery&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a308f7276ae25fff301d31c7fd64270e4"><div class="ttname"><a href="ranged_8cpp.html#a308f7276ae25fff301d31c7fd64270e4">effect_quadruped_full</a></div><div class="ttdeci">static const efftype_id effect_quadruped_full(&quot;quadruped_full&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a316a84fb241b414c913730a952265b72"><div class="ttname"><a href="ranged_8cpp.html#a316a84fb241b414c913730a952265b72">occupied_tile_fraction</a></div><div class="ttdeci">double occupied_tile_fraction(creature_size target_size)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00526">ranged.cpp:526</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a37b3abec3c86a9a6473849010adee218"><div class="ttname"><a href="ranged_8cpp.html#a37b3abec3c86a9a6473849010adee218">material_tempered_steel</a></div><div class="ttdeci">static const material_id material_tempered_steel(&quot;tempered_steel&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a3be9304af3e12dfef2f28becb7b93011"><div class="ttname"><a href="ranged_8cpp.html#a3be9304af3e12dfef2f28becb7b93011">effect_on_roof</a></div><div class="ttdeci">static const efftype_id effect_on_roof(&quot;on_roof&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a3eadead4a9aa7fee079c0b1acce7965e"><div class="ttname"><a href="ranged_8cpp.html#a3eadead4a9aa7fee079c0b1acce7965e">skill_gun</a></div><div class="ttdeci">static const skill_id skill_gun(&quot;gun&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4daea1de5d5e6f0b8d268b627b874139"><div class="ttname"><a href="ranged_8cpp.html#a4daea1de5d5e6f0b8d268b627b874139">ammo_strange_arrow</a></div><div class="ttdeci">static const ammotype ammo_strange_arrow(&quot;strange_arrow&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4de2ef4c2e145815427b09adfaa0def5"><div class="ttname"><a href="ranged_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a></div><div class="ttdeci">static const efftype_id effect_hit_by_player(&quot;hit_by_player&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4df4dd60924cd337468bb34326d879a7"><div class="ttname"><a href="ranged_8cpp.html#a4df4dd60924cd337468bb34326d879a7">json_flag_FILTHY</a></div><div class="ttdeci">static const flag_id json_flag_FILTHY(&quot;FILTHY&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a4fd0e174103e30dd7949347118557bc8"><div class="ttname"><a href="ranged_8cpp.html#a4fd0e174103e30dd7949347118557bc8">print_ranged_chance</a></div><div class="ttdeci">static int print_ranged_chance(const catacurses::window &amp;w, int line_number, const std::vector&lt; aim_type_prediction &gt; &amp;aim_chances)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01805">ranged.cpp:1805</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a512959ad2b35ea057f2fed5445fc23c4"><div class="ttname"><a href="ranged_8cpp.html#a512959ad2b35ea057f2fed5445fc23c4">trait_PYROMANIA</a></div><div class="ttdeci">static const trait_id trait_PYROMANIA(&quot;PYROMANIA&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a52f20bf5a32adb49385320ff391b2f8e"><div class="ttname"><a href="ranged_8cpp.html#a52f20bf5a32adb49385320ff391b2f8e">fault_overheat_safety</a></div><div class="ttdeci">static const fault_id fault_overheat_safety(&quot;fault_overheat_safety&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a57ab4ea57b22b751cee023b1798c68f2"><div class="ttname"><a href="ranged_8cpp.html#a57ab4ea57b22b751cee023b1798c68f2">ammo_40x53mm</a></div><div class="ttdeci">static const ammotype ammo_40x53mm(&quot;40x53mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a5894429e236b2dc2ee157ce48d7ad02e"><div class="ttname"><a href="ranged_8cpp.html#a5894429e236b2dc2ee157ce48d7ad02e">ammo_40x46mm</a></div><div class="ttdeci">static const ammotype ammo_40x46mm(&quot;40x46mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a591e788884fe3dc8032be8a9fc2ceb3c"><div class="ttname"><a href="ranged_8cpp.html#a591e788884fe3dc8032be8a9fc2ceb3c">character_modifier_melee_thrown_move_balance_mod</a></div><div class="ttdeci">static const character_modifier_id character_modifier_melee_thrown_move_balance_mod(&quot;melee_thrown_move_balance_mod&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a5a31fd4e066d23b9f26579e931b87113"><div class="ttname"><a href="ranged_8cpp.html#a5a31fd4e066d23b9f26579e931b87113">proficiency_prof_bow_expert</a></div><div class="ttdeci">static const proficiency_id proficiency_prof_bow_expert(&quot;prof_bow_expert&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a5a490676abb8e2a402ec62817da5311b"><div class="ttname"><a href="ranged_8cpp.html#a5a490676abb8e2a402ec62817da5311b">fault_overheat_explosion</a></div><div class="ttdeci">static const fault_id fault_overheat_explosion(&quot;fault_overheat_explosion&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a5b115344b066e0eebf72b6fcafaebfb2"><div class="ttname"><a href="ranged_8cpp.html#a5b115344b066e0eebf72b6fcafaebfb2">ammo_120mm</a></div><div class="ttdeci">static const ammotype ammo_120mm(&quot;120mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a5fa8fef66699e3dfe7059a6e9cc672a6"><div class="ttname"><a href="ranged_8cpp.html#a5fa8fef66699e3dfe7059a6e9cc672a6">material_med_steel</a></div><div class="ttdeci">static const material_id material_med_steel(&quot;med_steel&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a609c386685fa395233e3f1765e57a38b"><div class="ttname"><a href="ranged_8cpp.html#a609c386685fa395233e3f1765e57a38b">ammo_bolt</a></div><div class="ttdeci">static const ammotype ammo_bolt(&quot;bolt&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a613a8b59e4b2f2aaf05091d354bb4aa3"><div class="ttname"><a href="ranged_8cpp.html#a613a8b59e4b2f2aaf05091d354bb4aa3">time_to_attack</a></div><div class="ttdeci">static int time_to_attack(const Character &amp;p, const itype &amp;firing)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02107">ranged.cpp:2107</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a638a17e59573d9d6bac0a05980096c37"><div class="ttname"><a href="ranged_8cpp.html#a638a17e59573d9d6bac0a05980096c37">ammo_84x246mm</a></div><div class="ttdeci">static const ammotype ammo_84x246mm(&quot;84x246mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a66543644370f9b1d803abac7d90cd033"><div class="ttname"><a href="ranged_8cpp.html#a66543644370f9b1d803abac7d90cd033">ammo_flammable</a></div><div class="ttdeci">static const ammotype ammo_flammable(&quot;flammable&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a68193ecd0be34e65f12a3febf6f7b6e1"><div class="ttname"><a href="ranged_8cpp.html#a68193ecd0be34e65f12a3febf6f7b6e1">ammo_RPG_7</a></div><div class="ttdeci">static const ammotype ammo_RPG_7(&quot;RPG-7&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6a67c1570499e9c4ab345a0c6f1ba026"><div class="ttname"><a href="ranged_8cpp.html#a6a67c1570499e9c4ab345a0c6f1ba026">fault_gun_blackpowder</a></div><div class="ttdeci">static const fault_id fault_gun_blackpowder(&quot;fault_gun_blackpowder&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6a73511d720b80c22f04cdb5a5662393"><div class="ttname"><a href="ranged_8cpp.html#a6a73511d720b80c22f04cdb5a5662393">throwing_skill_adjusted</a></div><div class="ttdeci">static float throwing_skill_adjusted(const Character &amp;guy)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01242">ranged.cpp:1242</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a6b4c3a2a360b378de261413fbb7d84f0"><div class="ttname"><a href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">range_with_even_chance_of_good_hit</a></div><div class="ttdeci">int range_with_even_chance_of_good_hit(int dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00577">ranged.cpp:577</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a6cd87802123477df1237fa5271842f8b"><div class="ttname"><a href="ranged_8cpp.html#a6cd87802123477df1237fa5271842f8b">ferric</a></div><div class="ttdeci">static const std::set&lt; material_id &gt; ferric</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00152">ranged.cpp:152</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a6cda9e7cd9c37d3822410cf6280babdf"><div class="ttname"><a href="ranged_8cpp.html#a6cda9e7cd9c37d3822410cf6280babdf">material_steel</a></div><div class="ttdeci">static const material_id material_steel(&quot;steel&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a6ce4de21dacf3a60c3da7dcead0fd08f"><div class="ttname"><a href="ranged_8cpp.html#a6ce4de21dacf3a60c3da7dcead0fd08f">ammo_atlatl</a></div><div class="ttdeci">static const ammotype ammo_atlatl(&quot;atlatl&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a738f726f320c7f5b5edca445777a14fa"><div class="ttname"><a href="ranged_8cpp.html#a738f726f320c7f5b5edca445777a14fa">bio_railgun</a></div><div class="ttdeci">static const bionic_id bio_railgun(&quot;bio_railgun&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a770eb7c8ac46ca214eafc8a3778dc4be"><div class="ttname"><a href="ranged_8cpp.html#a770eb7c8ac46ca214eafc8a3778dc4be">material_iron</a></div><div class="ttdeci">static const material_id material_iron(&quot;iron&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a7c4d782d03c3f30e5b3332260ded8951"><div class="ttname"><a href="ranged_8cpp.html#a7c4d782d03c3f30e5b3332260ded8951">pl_sees</a></div><div class="ttdeci">static bool pl_sees(const Creature &amp;cr)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01935">ranged.cpp:1935</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a7c9a7d0a1b73c0f70f96584ecc262420"><div class="ttname"><a href="ranged_8cpp.html#a7c9a7d0a1b73c0f70f96584ecc262420">ammo_12mm</a></div><div class="ttdeci">static const ammotype ammo_12mm(&quot;12mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a7ff8232af89fc85c44dee1cd0525f655"><div class="ttname"><a href="ranged_8cpp.html#a7ff8232af89fc85c44dee1cd0525f655">calculate_aim_cap</a></div><div class="ttdeci">double calculate_aim_cap(const Character &amp;you, const tripoint &amp;target)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01140">ranged.cpp:1140</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a81c0e98b7eaad878f45b27c21f4d6393"><div class="ttname"><a href="ranged_8cpp.html#a81c0e98b7eaad878f45b27c21f4d6393">ammo_m235</a></div><div class="ttdeci">static const ammotype ammo_m235(&quot;m235&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a8d4ed92ee82965b00b2c043ef36261d2"><div class="ttname"><a href="ranged_8cpp.html#a8d4ed92ee82965b00b2c043ef36261d2">character_modifier_melee_thrown_move_lift_mod</a></div><div class="ttdeci">static const character_modifier_id character_modifier_melee_thrown_move_lift_mod(&quot;melee_thrown_move_lift_mod&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a9301f55736d917c84a4ebf973386a40e"><div class="ttname"><a href="ranged_8cpp.html#a9301f55736d917c84a4ebf973386a40e">predict_recoil</a></div><div class="ttdeci">static recoil_prediction predict_recoil(const Character &amp;you, const item &amp;weapon, const Target_attributes &amp;target, int sight_dispersion, const aim_type &amp;aim_mode, double start_recoil)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01659">ranged.cpp:1659</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a967f906a89a2a31d1bdb0fbc93e6ddf9"><div class="ttname"><a href="ranged_8cpp.html#a967f906a89a2a31d1bdb0fbc93e6ddf9">target_size_in_moa</a></div><div class="ttdeci">static double target_size_in_moa(int range, double size)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01597">ranged.cpp:1597</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a969d7fb0eb05d60c2c98eb568bce69f2"><div class="ttname"><a href="ranged_8cpp.html#a969d7fb0eb05d60c2c98eb568bce69f2">calc_steadiness</a></div><div class="ttdeci">double calc_steadiness(const Character &amp;you, const item &amp;weapon, const tripoint &amp;pos, double predicted_recoil)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01156">ranged.cpp:1156</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a990502dafd582f371f40de17ae3f5ef4"><div class="ttname"><a href="ranged_8cpp.html#a990502dafd582f371f40de17ae3f5ef4">ammo_atgm</a></div><div class="ttdeci">static const ammotype ammo_atgm(&quot;atgm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_a9a8aae9d14e825d1fa9707093ef0a616"><div class="ttname"><a href="ranged_8cpp.html#a9a8aae9d14e825d1fa9707093ef0a616">character_throw_assist</a></div><div class="ttdeci">static std::optional&lt; int &gt; character_throw_assist(const Character &amp;guy)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01229">ranged.cpp:1229</a></div></div>
<div class="ttc" id="aranged_8cpp_html_aa55aace1fedc5b64c6d3d0418e251c38"><div class="ttname"><a href="ranged_8cpp.html#aa55aace1fedc5b64c6d3d0418e251c38">throw_cost</a></div><div class="ttdeci">int throw_cost(const Character &amp;c, const item &amp;to_throw)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01110">ranged.cpp:1110</a></div></div>
<div class="ttc" id="aranged_8cpp_html_aa68fa53ae2a9bc0bb461af10bec001fe"><div class="ttname"><a href="ranged_8cpp.html#aa68fa53ae2a9bc0bb461af10bec001fe">get_default_aim_type</a></div><div class="ttdeci">static aim_type get_default_aim_type()</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01578">ranged.cpp:1578</a></div></div>
<div class="ttc" id="aranged_8cpp_html_aaa28e14858a862e5085b9c4d06f5bfdc"><div class="ttname"><a href="ranged_8cpp.html#aaa28e14858a862e5085b9c4d06f5bfdc">fault_overheat_melting</a></div><div class="ttdeci">static const fault_id fault_overheat_melting(&quot;fault_overheat_melting&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aaab2235167b3bf7fa8f2e8c9163d64d2"><div class="ttname"><a href="ranged_8cpp.html#aaab2235167b3bf7fa8f2e8c9163d64d2">character_modifier_thrown_dex_mod</a></div><div class="ttdeci">static const character_modifier_id character_modifier_thrown_dex_mod(&quot;thrown_dex_mod&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aad8bc17f1bcf65d90738d8d06460c91a"><div class="ttname"><a href="ranged_8cpp.html#aad8bc17f1bcf65d90738d8d06460c91a">draw_throw_aim</a></div><div class="ttdeci">static void draw_throw_aim(const target_ui &amp;ui, const Character &amp;you, const catacurses::window &amp;w, int &amp;text_y, input_context &amp;ctxt, const item &amp;weapon, const tripoint &amp;target_pos, bool is_blind_throw)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01967">ranged.cpp:1967</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ab0db3d2d826960249b5a1d47fa7881ff"><div class="ttname"><a href="ranged_8cpp.html#ab0db3d2d826960249b5a1d47fa7881ff">make_gun_projectile</a></div><div class="ttdeci">static projectile make_gun_projectile(const item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02045">ranged.cpp:2045</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ab1ce33f7e8ed6c701d44bf39e98de576"><div class="ttname"><a href="ranged_8cpp.html#ab1ce33f7e8ed6c701d44bf39e98de576">print_steadiness</a></div><div class="ttdeci">static int print_steadiness(const catacurses::window &amp;w, int line_number, double steadiness)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01546">ranged.cpp:1546</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ab1f819e79b8cfdcbf08cca629e3073ba"><div class="ttname"><a href="ranged_8cpp.html#ab1f819e79b8cfdcbf08cca629e3073ba">proficiency_prof_bow_master</a></div><div class="ttdeci">static const proficiency_id proficiency_prof_bow_master(&quot;prof_bow_master&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ab386b4796e39e527e91a503f6975c82d"><div class="ttname"><a href="ranged_8cpp.html#ab386b4796e39e527e91a503f6975c82d">ammo_66mm</a></div><div class="ttdeci">static const ammotype ammo_66mm(&quot;66mm&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_abab3d18c8a6ece5b486b6e3965e27dde"><div class="ttname"><a href="ranged_8cpp.html#abab3d18c8a6ece5b486b6e3965e27dde">ammo_bolt_ballista</a></div><div class="ttdeci">static const ammotype ammo_bolt_ballista(&quot;bolt_ballista&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ac283fa14509e26bd1becc0a28dfcb8d1"><div class="ttname"><a href="ranged_8cpp.html#ac283fa14509e26bd1becc0a28dfcb8d1">ammo_metal_rail</a></div><div class="ttdeci">static const ammotype ammo_metal_rail(&quot;metal_rail&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aca8ae2b9cbc86602a56a3885b72a4ed1"><div class="ttname"><a href="ranged_8cpp.html#aca8ae2b9cbc86602a56a3885b72a4ed1">skill_throw</a></div><div class="ttdeci">static const skill_id skill_throw(&quot;throw&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ace607007c38b8d55a601963b24f89e7e"><div class="ttname"><a href="ranged_8cpp.html#ace607007c38b8d55a601963b24f89e7e">fault_gun_chamber_spent</a></div><div class="ttdeci">static const fault_id fault_gun_chamber_spent(&quot;fault_gun_chamber_spent&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ad665e86d9214ba9ef7722492a65cac0d"><div class="ttname"><a href="ranged_8cpp.html#ad665e86d9214ba9ef7722492a65cac0d">print_confidence_rating_bar</a></div><div class="ttdeci">static void print_confidence_rating_bar(const catacurses::window &amp;w, aim_type_prediction prediction, int &amp;line_number, int width, nc_color col)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01789">ranged.cpp:1789</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ad75fbfd35a5881cf4652a8cf745f52b7"><div class="ttname"><a href="ranged_8cpp.html#ad75fbfd35a5881cf4652a8cf745f52b7">material_low_steel</a></div><div class="ttdeci">static const material_id material_low_steel(&quot;low_steel&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_ae134db696195500e4ff1835e6f784aca"><div class="ttname"><a href="ranged_8cpp.html#ae134db696195500e4ff1835e6f784aca">AIF_DURATION_LIMIT</a></div><div class="ttdeci">static constexpr int AIF_DURATION_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00155">ranged.cpp:155</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ae2f62035db4e943bb2c797e8c3febedd"><div class="ttname"><a href="ranged_8cpp.html#ae2f62035db4e943bb2c797e8c3febedd">print_confidence_ratings</a></div><div class="ttdeci">static void print_confidence_ratings(const catacurses::window &amp;w, const std::vector&lt; confidence_rating &gt; &amp;ratings, int &amp;line_number, int width, int &amp;column_number, nc_color col)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01771">ranged.cpp:1771</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ae485e14f2f0d97810da8125353dfa101"><div class="ttname"><a href="ranged_8cpp.html#ae485e14f2f0d97810da8125353dfa101">get_colored_bar</a></div><div class="ttdeci">static std::string get_colored_bar(const double val, const int width, const std::string &amp;label, RatingVector::iterator begin, RatingVector::iterator end)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01586">ranged.cpp:1586</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ae6e2f802cc8fb025d3dd4ada3da65c55"><div class="ttname"><a href="ranged_8cpp.html#ae6e2f802cc8fb025d3dd4ada3da65c55">do_aim</a></div><div class="ttdeci">static void do_aim(Character &amp;you, const item &amp;relevant, const double min_recoil)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01516">ranged.cpp:1516</a></div></div>
<div class="ttc" id="aranged_8cpp_html_ae8b9efd8abced2440e1b53139f2696d7"><div class="ttname"><a href="ranged_8cpp.html#ae8b9efd8abced2440e1b53139f2696d7">practice_archery_proficiency</a></div><div class="ttdeci">void practice_archery_proficiency(Character &amp;p, const item &amp;relevant)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01455">ranged.cpp:1455</a></div></div>
<div class="ttc" id="aranged_8cpp_html_aecd517a9e74b5a5a21f0c75f88f50090"><div class="ttname"><a href="ranged_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">damage_cut</a></div><div class="ttdeci">static const damage_type_id damage_cut(&quot;cut&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aecf1c5ee613ec0609d2ae3a7a46b4b8d"><div class="ttname"><a href="ranged_8cpp.html#aecf1c5ee613ec0609d2ae3a7a46b4b8d">ammo_homebrew_rocket</a></div><div class="ttdeci">static const ammotype ammo_homebrew_rocket(&quot;homebrew_rocket&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_aef6b532c29ec965cbee404c29746a7da"><div class="ttname"><a href="ranged_8cpp.html#aef6b532c29ec965cbee404c29746a7da">character_modifier_ranged_dispersion_manip_mod</a></div><div class="ttdeci">static const character_modifier_id character_modifier_ranged_dispersion_manip_mod(&quot;ranged_dispersion_manip_mod&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_af94296ce179c8a7441548e43d0b8235f"><div class="ttname"><a href="ranged_8cpp.html#af94296ce179c8a7441548e43d0b8235f">proficiency_prof_bow_basic</a></div><div class="ttdeci">static const proficiency_id proficiency_prof_bow_basic(&quot;prof_bow_basic&quot;)</div></div>
<div class="ttc" id="aranged_8cpp_html_afee8dcfd12a225c469ee6171063d7594"><div class="ttname"><a href="ranged_8cpp.html#afee8dcfd12a225c469ee6171063d7594">skill_driving</a></div><div class="ttdeci">static const skill_id skill_driving(&quot;driving&quot;)</div></div>
<div class="ttc" id="aranged_8h_html"><div class="ttname"><a href="ranged_8h.html">ranged.h</a></div></div>
<div class="ttc" id="aranged_8h_html_a3ad21aa630e4e68c1d2834fe0467c018"><div class="ttname"><a href="ranged_8h.html#a3ad21aa630e4e68c1d2834fe0467c018">MIN_RECOIL_IMPROVEMENT</a></div><div class="ttdeci">constexpr double MIN_RECOIL_IMPROVEMENT</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00024">ranged.h:24</a></div></div>
<div class="ttc" id="aret__val_8h_html"><div class="ttname"><a href="ret__val_8h.html">ret_val.h</a></div></div>
<div class="ttc" id="arng_8cpp_html_aad28bdad07401a34ecf9912708f8b750"><div class="ttname"><a href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a></div><div class="ttdeci">bool one_in(int chance)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00108">rng.cpp:108</a></div></div>
<div class="ttc" id="arng_8h_html"><div class="ttname"><a href="rng_8h.html">rng.h</a></div></div>
<div class="ttc" id="arng_8h_html_a12244355ee77108f1b08618e9962e4d1"><div class="ttname"><a href="rng_8h.html#a12244355ee77108f1b08618e9962e4d1">random_entry</a></div><div class="ttdeci">V random_entry(const C &amp;container, D default_value)</div><div class="ttdoc">Returns a random entry in the container.</div><div class="ttdef"><b>Definition:</b> <a href="rng_8h_source.html#l00104">rng.h:104</a></div></div>
<div class="ttc" id="askill_8h_html"><div class="ttname"><a href="skill_8h.html">skill.h</a></div></div>
<div class="ttc" id="asounds_8h_html"><div class="ttname"><a href="sounds_8h.html">sounds.h</a></div></div>
<div class="ttc" id="astring__formatter_8h_html"><div class="ttname"><a href="string__formatter_8h.html">string_formatter.h</a></div></div>
<div class="ttc" id="astring__formatter_8h_html_a8964099387da2f95396c67566bafce3d"><div class="ttname"><a href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a></div><div class="ttdeci">std::string string_format(std::string_view format, Args &amp;&amp;...args)</div><div class="ttdoc">Simple wrapper over string_formatter::parse.</div><div class="ttdef"><b>Definition:</b> <a href="string__formatter_8h_source.html#l00417">string_formatter.h:417</a></div></div>
<div class="ttc" id="astructTarget__attributes_html"><div class="ttname"><a href="structTarget__attributes.html">Target_attributes</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00085">ranged.h:85</a></div></div>
<div class="ttc" id="astructTarget__attributes_html_a3ef95402fbe3b47c2a9c7371c5f96a46"><div class="ttname"><a href="structTarget__attributes.html#a3ef95402fbe3b47c2a9c7371c5f96a46">Target_attributes::visible</a></div><div class="ttdeci">bool visible</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00090">ranged.h:90</a></div></div>
<div class="ttc" id="astructTarget__attributes_html_a76ea0e1418f9b8a6ed3955a700cc239a"><div class="ttname"><a href="structTarget__attributes.html#a76ea0e1418f9b8a6ed3955a700cc239a">Target_attributes::size</a></div><div class="ttdeci">double size</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00087">ranged.h:87</a></div></div>
<div class="ttc" id="astructTarget__attributes_html_aa5a529f43ff9026d1f50be95076b3e14"><div class="ttname"><a href="structTarget__attributes.html#aa5a529f43ff9026d1f50be95076b3e14">Target_attributes::Target_attributes</a></div><div class="ttdeci">Target_attributes()=default</div></div>
<div class="ttc" id="astructTarget__attributes_html_ab1c3e55f892cde598070c6189dfa88e6"><div class="ttname"><a href="structTarget__attributes.html#ab1c3e55f892cde598070c6189dfa88e6">Target_attributes::size_in_moa</a></div><div class="ttdeci">double size_in_moa</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00088">ranged.h:88</a></div></div>
<div class="ttc" id="astructTarget__attributes_html_acfd538a5784056d1cadff165495fa18a"><div class="ttname"><a href="structTarget__attributes.html#acfd538a5784056d1cadff165495fa18a">Target_attributes::light</a></div><div class="ttdeci">float light</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00089">ranged.h:89</a></div></div>
<div class="ttc" id="astructTarget__attributes_html_ad834b1dc87768bdad806da80b5dc9ecd"><div class="ttname"><a href="structTarget__attributes.html#ad834b1dc87768bdad806da80b5dc9ecd">Target_attributes::range</a></div><div class="ttdeci">int range</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00086">ranged.h:86</a></div></div>
<div class="ttc" id="astructaim__mods__cache_html"><div class="ttname"><a href="structaim__mods__cache.html">aim_mods_cache</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00391">character.h:391</a></div></div>
<div class="ttc" id="astructaim__type__prediction_1_1aim__confidence_html"><div class="ttname"><a href="structaim__type__prediction_1_1aim__confidence.html">aim_type_prediction::aim_confidence</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01630">ranged.cpp:1630</a></div></div>
<div class="ttc" id="astructaim__type__prediction_1_1aim__confidence_html_a203e68d0e3e766e8a9dbd4a59cb81900"><div class="ttname"><a href="structaim__type__prediction_1_1aim__confidence.html#a203e68d0e3e766e8a9dbd4a59cb81900">aim_type_prediction::aim_confidence::color</a></div><div class="ttdeci">std::string color</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01632">ranged.cpp:1632</a></div></div>
<div class="ttc" id="astructaim__type__prediction_1_1aim__confidence_html_a7d95f07bea9f9ea602884238a49543da"><div class="ttname"><a href="structaim__type__prediction_1_1aim__confidence.html#a7d95f07bea9f9ea602884238a49543da">aim_type_prediction::aim_confidence::label</a></div><div class="ttdeci">std::string label</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01631">ranged.cpp:1631</a></div></div>
<div class="ttc" id="astructaim__type__prediction_1_1aim__confidence_html_aadb7a11b006a31248cab2d525e55daf1"><div class="ttname"><a href="structaim__type__prediction_1_1aim__confidence.html#aadb7a11b006a31248cab2d525e55daf1">aim_type_prediction::aim_confidence::chance</a></div><div class="ttdeci">int chance</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01633">ranged.cpp:1633</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html"><div class="ttname"><a href="structaim__type__prediction.html">aim_type_prediction</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01629">ranged.cpp:1629</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_a06f406ce06d1987183e399e054bd40a4"><div class="ttname"><a href="structaim__type__prediction.html#a06f406ce06d1987183e399e054bd40a4">aim_type_prediction::chances</a></div><div class="ttdeci">std::vector&lt; aim_confidence &gt; chances</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01639">ranged.cpp:1639</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_a2c9a4e350971e1aae39533618e323d4f"><div class="ttname"><a href="structaim__type__prediction.html#a2c9a4e350971e1aae39533618e323d4f">aim_type_prediction::chance_to_hit</a></div><div class="ttdeci">int chance_to_hit</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01642">ranged.cpp:1642</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_a2e72fff16a3ec72943a7dd9482dff8bf"><div class="ttname"><a href="structaim__type__prediction.html#a2e72fff16a3ec72943a7dd9482dff8bf">aim_type_prediction::is_default</a></div><div class="ttdeci">bool is_default</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01640">ranged.cpp:1640</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_a8d589a89e9239f64703618d8bf60f672"><div class="ttname"><a href="structaim__type__prediction.html#a8d589a89e9239f64703618d8bf60f672">aim_type_prediction::steadiness</a></div><div class="ttdeci">double steadiness</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01644">ranged.cpp:1644</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_aa1ed8d79daea94f79f6c5a17e25332ab"><div class="ttname"><a href="structaim__type__prediction.html#aa1ed8d79daea94f79f6c5a17e25332ab">aim_type_prediction::confidence</a></div><div class="ttdeci">double confidence</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01643">ranged.cpp:1643</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_aaeeb40de07b50ebc88e227fa4f5f05f1"><div class="ttname"><a href="structaim__type__prediction.html#aaeeb40de07b50ebc88e227fa4f5f05f1">aim_type_prediction::ratings</a></div><div class="ttdeci">std::vector&lt; confidence_rating &gt; ratings</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01638">ranged.cpp:1638</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_abd5d5da2ed456b35987cc924ad03f607"><div class="ttname"><a href="structaim__type__prediction.html#abd5d5da2ed456b35987cc924ad03f607">aim_type_prediction::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01636">ranged.cpp:1636</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_ad254eae18ae704d8c9d75bfe0770730f"><div class="ttname"><a href="structaim__type__prediction.html#ad254eae18ae704d8c9d75bfe0770730f">aim_type_prediction::hotkey</a></div><div class="ttdeci">std::string hotkey</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01637">ranged.cpp:1637</a></div></div>
<div class="ttc" id="astructaim__type__prediction_html_ae8c7262761667bf3ba7fc0b3d1b54677"><div class="ttname"><a href="structaim__type__prediction.html#ae8c7262761667bf3ba7fc0b3d1b54677">aim_type_prediction::moves</a></div><div class="ttdeci">int moves</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01641">ranged.cpp:1641</a></div></div>
<div class="ttc" id="astructaim__type_html"><div class="ttname"><a href="structaim__type.html">aim_type</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00371">character.h:371</a></div></div>
<div class="ttc" id="astructaim__type_html_a26dc7ca55f61cd28bc534dc21d53164d"><div class="ttname"><a href="structaim__type.html#a26dc7ca55f61cd28bc534dc21d53164d">aim_type::has_threshold</a></div><div class="ttdeci">bool has_threshold</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00375">character.h:375</a></div></div>
<div class="ttc" id="astructaim__type_html_a51fa794edcf0ce9509763b0b48a8e1b5"><div class="ttname"><a href="structaim__type.html#a51fa794edcf0ce9509763b0b48a8e1b5">aim_type::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00372">character.h:372</a></div></div>
<div class="ttc" id="astructaim__type_html_a7763c382e69ad4d525dfe8716672c565"><div class="ttname"><a href="structaim__type.html#a7763c382e69ad4d525dfe8716672c565">aim_type::threshold</a></div><div class="ttdeci">int threshold</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00376">character.h:376</a></div></div>
<div class="ttc" id="astructaim__type_html_abab67c2762f5ce5d549988ac7405dcb0"><div class="ttname"><a href="structaim__type.html#abab67c2762f5ce5d549988ac7405dcb0">aim_type::action</a></div><div class="ttdeci">std::string action</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00373">character.h:373</a></div></div>
<div class="ttc" id="astructbionic__data_html_a01bb3ba6e83ceeb4fed579177f084ae3"><div class="ttname"><a href="structbionic__data.html#a01bb3ba6e83ceeb4fed579177f084ae3">bionic_data::power_trigger</a></div><div class="ttdeci">units::energy power_trigger</div><div class="ttdoc">Power cost when the bionic's special effect is triggered.</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8h_source.html#l00043">bionics.h:43</a></div></div>
<div class="ttc" id="astructcommon__ranged__data_html_a497cd4533098e79f14f8a97fcec6ca1a"><div class="ttname"><a href="structcommon__ranged__data.html#a497cd4533098e79f14f8a97fcec6ca1a">common_ranged_data::dispersion</a></div><div class="ttdeci">int dispersion</div><div class="ttdoc">Dispersion &quot;bonus&quot; from gun.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00624">itype.h:624</a></div></div>
<div class="ttc" id="astructcommon__ranged__data_html_a94254f1acb94261bb47c4b7aaa3b0c89"><div class="ttname"><a href="structcommon__ranged__data.html#a94254f1acb94261bb47c4b7aaa3b0c89">common_ranged_data::damage</a></div><div class="ttdeci">damage_instance damage</div><div class="ttdoc">Damage, armor piercing and multipliers for each.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00612">itype.h:612</a></div></div>
<div class="ttc" id="astructconfidence__rating_html"><div class="ttname"><a href="structconfidence__rating.html">confidence_rating</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01539">ranged.cpp:1539</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_a3e948736e9d479abfa280833019cad36"><div class="ttname"><a href="structconfidence__rating.html#a3e948736e9d479abfa280833019cad36">confidence_rating::symbol</a></div><div class="ttdeci">char symbol</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01541">ranged.cpp:1541</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_a47c7756df867e77f46be130c7bb02e5c"><div class="ttname"><a href="structconfidence__rating.html#a47c7756df867e77f46be130c7bb02e5c">confidence_rating::label</a></div><div class="ttdeci">std::string label</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01543">ranged.cpp:1543</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_a95391c9a8078562cb5f37dacf9ff0267"><div class="ttname"><a href="structconfidence__rating.html#a95391c9a8078562cb5f37dacf9ff0267">confidence_rating::aim_level</a></div><div class="ttdeci">double aim_level</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01540">ranged.cpp:1540</a></div></div>
<div class="ttc" id="astructconfidence__rating_html_afe2900a64ed6d6d39f4f2322216abf36"><div class="ttname"><a href="structconfidence__rating.html#afe2900a64ed6d6d39f4f2322216abf36">confidence_rating::color</a></div><div class="ttdeci">std::string color</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01542">ranged.cpp:1542</a></div></div>
<div class="ttc" id="astructdamage__instance_html"><div class="ttname"><a href="structdamage__instance.html">damage_instance</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00132">damage.h:132</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a2cc3ee4ff8f77ab6cd74168b1999246a"><div class="ttname"><a href="structdamage__instance.html#a2cc3ee4ff8f77ab6cd74168b1999246a">damage_instance::damage_units</a></div><div class="ttdeci">std::vector&lt; damage_unit &gt; damage_units</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00133">damage.h:133</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a96f6f6d008ed8744ce549cefcfec3951"><div class="ttname"><a href="structdamage__instance.html#a96f6f6d008ed8744ce549cefcfec3951">damage_instance::total_damage</a></div><div class="ttdeci">float total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00372">damage.cpp:372</a></div></div>
<div class="ttc" id="astructdamage__instance_html_a9eff5065ef6631935e95d061ca756ae4"><div class="ttname"><a href="structdamage__instance.html#a9eff5065ef6631935e95d061ca756ae4">damage_instance::add_damage</a></div><div class="ttdeci">void add_damage(const damage_type_id &amp;dt, float amt, float arpen=0.0f, float arpen_mult=1.0f, float dmg_mult=1.0f, float unc_arpen_mult=1.0f, float unc_dmg_mult=1.0f)</div><div class="ttdoc">Adds damage to the instance.</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00316">damage.cpp:316</a></div></div>
<div class="ttc" id="astructdamage__instance_html_ae17bfa13ed37fd55281fa769a152e941"><div class="ttname"><a href="structdamage__instance.html#ae17bfa13ed37fd55281fa769a152e941">damage_instance::add</a></div><div class="ttdeci">void add(const damage_instance &amp;added_di)</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00484">damage.cpp:484</a></div></div>
<div class="ttc" id="astructdamage__instance_html_af81002fc0a5fafe2690d31403941d2d6"><div class="ttname"><a href="structdamage__instance.html#af81002fc0a5fafe2690d31403941d2d6">damage_instance::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00479">damage.cpp:479</a></div></div>
<div class="ttc" id="astructdamage__unit_html"><div class="ttname"><a href="structdamage__unit.html">damage_unit</a></div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00110">damage.h:110</a></div></div>
<div class="ttc" id="astructdamage__unit_html_a5937d5d78a6db9efaefb0bf9517377d3"><div class="ttname"><a href="structdamage__unit.html#a5937d5d78a6db9efaefb0bf9517377d3">damage_unit::amount</a></div><div class="ttdeci">float amount</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00112">damage.h:112</a></div></div>
<div class="ttc" id="astructdamage__unit_html_a8c5cf76dd074bd5dac9b76aaece0ecf4"><div class="ttname"><a href="structdamage__unit.html#a8c5cf76dd074bd5dac9b76aaece0ecf4">damage_unit::damage_multiplier</a></div><div class="ttdeci">float damage_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00115">damage.h:115</a></div></div>
<div class="ttc" id="astructdamage__unit_html_ab4d1b13f7ebe2f16a43038e1441ec2b5"><div class="ttname"><a href="structdamage__unit.html#ab4d1b13f7ebe2f16a43038e1441ec2b5">damage_unit::res_pen</a></div><div class="ttdeci">float res_pen</div><div class="ttdef"><b>Definition:</b> <a href="damage_8h_source.html#l00113">damage.h:113</a></div></div>
<div class="ttc" id="astructdealt__damage__instance_html_a86b702070a1c313624abc78ff34eff48"><div class="ttname"><a href="structdealt__damage__instance.html#a86b702070a1c313624abc78ff34eff48">dealt_damage_instance::total_damage</a></div><div class="ttdeci">int total_damage() const</div><div class="ttdef"><b>Definition:</b> <a href="damage_8cpp_source.html#l00586">damage.cpp:586</a></div></div>
<div class="ttc" id="astructdealt__projectile__attack_html"><div class="ttname"><a href="structdealt__projectile__attack.html">dealt_projectile_attack</a></div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00069">projectile.h:69</a></div></div>
<div class="ttc" id="astructdealt__projectile__attack_html_a466f327979e41691bc19c91e622078b6"><div class="ttname"><a href="structdealt__projectile__attack.html#a466f327979e41691bc19c91e622078b6">dealt_projectile_attack::hit_critter</a></div><div class="ttdeci">Creature * hit_critter</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00071">projectile.h:71</a></div></div>
<div class="ttc" id="astructdealt__projectile__attack_html_a7dd960a5108456f89dc1f8ef369a1096"><div class="ttname"><a href="structdealt__projectile__attack.html#a7dd960a5108456f89dc1f8ef369a1096">dealt_projectile_attack::end_point</a></div><div class="ttdeci">tripoint end_point</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00073">projectile.h:73</a></div></div>
<div class="ttc" id="astructdealt__projectile__attack_html_ab874a1233da5daa95ff296cdb1ee1849"><div class="ttname"><a href="structdealt__projectile__attack.html#ab874a1233da5daa95ff296cdb1ee1849">dealt_projectile_attack::missed_by</a></div><div class="ttdeci">double missed_by</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00074">projectile.h:74</a></div></div>
<div class="ttc" id="astructdealt__projectile__attack_html_aca4d2ea74ab244bb1defe86449a45c39"><div class="ttname"><a href="structdealt__projectile__attack.html#aca4d2ea74ab244bb1defe86449a45c39">dealt_projectile_attack::dealt_dam</a></div><div class="ttdeci">dealt_damage_instance dealt_dam</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00072">projectile.h:72</a></div></div>
<div class="ttc" id="astructdrawsq__params_html"><div class="ttname"><a href="structdrawsq__params.html">drawsq_params</a></div><div class="ttdoc">Draw parameters used by map::drawsq() and similar methods.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00168">map.h:168</a></div></div>
<div class="ttc" id="astructdrawsq__params_html_a85d5bbbff2bde51a2fdb0ac52036b1d1"><div class="ttname"><a href="structdrawsq__params.html#a85d5bbbff2bde51a2fdb0ac52036b1d1">drawsq_params::center</a></div><div class="ttdeci">constexpr drawsq_params &amp; center(const tripoint &amp;p)</div><div class="ttdoc">Set view center.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00271">map.h:271</a></div></div>
<div class="ttc" id="astructdrawsq__params_html_ae80016e06fb7c6696a44fcf775374e3d"><div class="ttname"><a href="structdrawsq__params.html#ae80016e06fb7c6696a44fcf775374e3d">drawsq_params::highlight</a></div><div class="ttdeci">constexpr drawsq_params &amp; highlight(bool v)</div><div class="ttdoc">Highlight the tile.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00186">map.h:186</a></div></div>
<div class="ttc" id="astructinput__event_html"><div class="ttname"><a href="structinput__event.html">input_event</a></div><div class="ttdoc">An instance of an input, like a keypress etc.</div><div class="ttdef"><b>Definition:</b> <a href="input__enums_8h_source.html#l00063">input_enums.h:63</a></div></div>
<div class="ttc" id="astructislot__ammo_html"><div class="ttname"><a href="structislot__ammo.html">islot_ammo</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00966">itype.h:966</a></div></div>
<div class="ttc" id="astructislot__gun_html"><div class="ttname"><a href="structislot__gun.html">islot_gun</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00686">itype.h:686</a></div></div>
<div class="ttc" id="astructislot__gun_html_a014b797e92e543ea47be93a1d6771a90"><div class="ttname"><a href="structislot__gun.html#a014b797e92e543ea47be93a1d6771a90">islot_gun::blackpowder_tolerance</a></div><div class="ttdeci">int blackpowder_tolerance</div><div class="ttdoc">One in X chance for gun to require major cleanup after firing blackpowder shot.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00729">itype.h:729</a></div></div>
<div class="ttc" id="astructislot__gun_html_a25ca55cb76e90794dc8ac200c8baf211"><div class="ttname"><a href="structislot__gun.html#a25ca55cb76e90794dc8ac200c8baf211">islot_gun::heat_per_shot</a></div><div class="ttdeci">double heat_per_shot</div><div class="ttdoc">Used only in overheat-based guns.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00781">itype.h:781</a></div></div>
<div class="ttc" id="astructislot__gun_html_a2dab58d1ca33c9221bb4f30fc0b17edb"><div class="ttname"><a href="structislot__gun.html#a2dab58d1ca33c9221bb4f30fc0b17edb">islot_gun::cooling_value</a></div><div class="ttdeci">double cooling_value</div><div class="ttdoc">The amount by which the item's overheat value is reduced every turn.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00776">itype.h:776</a></div></div>
<div class="ttc" id="astructislot__gun_html_a40255e8d661dc99204ed70dbe6013a02"><div class="ttname"><a href="structislot__gun.html#a40255e8d661dc99204ed70dbe6013a02">islot_gun::durability</a></div><div class="ttdeci">int durability</div><div class="ttdoc">Gun durability, affects gun being damaged during shooting.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00698">itype.h:698</a></div></div>
<div class="ttc" id="astructislot__gun_html_a7c8efa3250a559891c258d4a10cb2a43"><div class="ttname"><a href="structislot__gun.html#a7c8efa3250a559891c258d4a10cb2a43">islot_gun::hurt_part_when_fired</a></div><div class="ttdeci">std::map&lt; bodypart_str_id, int &gt; hurt_part_when_fired</div><div class="ttdoc">Used for the skullgun cbm.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00795">itype.h:795</a></div></div>
<div class="ttc" id="astructitem_1_1sound__data_html"><div class="ttname"><a href="structitem_1_1sound__data.html">item::sound_data</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02620">item.h:2620</a></div></div>
<div class="ttc" id="astructitem_1_1sound__data_html_a939db72176db475c72387bc928304f16"><div class="ttname"><a href="structitem_1_1sound__data.html#a939db72176db475c72387bc928304f16">item::sound_data::sound</a></div><div class="ttdeci">std::string sound</div><div class="ttdoc">Sound description, can be used with sounds::sound, it is already translated.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02624">item.h:2624</a></div></div>
<div class="ttc" id="astructitem_1_1sound__data_html_aa2fb844ce506ca62f0c5d1d549f54826"><div class="ttname"><a href="structitem_1_1sound__data.html#aa2fb844ce506ca62f0c5d1d549f54826">item::sound_data::volume</a></div><div class="ttdeci">int volume</div><div class="ttdoc">Volume of the sound.</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l02622">item.h:2622</a></div></div>
<div class="ttc" id="astructitype_html"><div class="ttname"><a href="structitype.html">itype</a></div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01186">itype.h:1186</a></div></div>
<div class="ttc" id="astructitype_html_a15ce9f3914d2afb7992e4683a0996791"><div class="ttname"><a href="structitype.html#a15ce9f3914d2afb7992e4683a0996791">itype::explosion</a></div><div class="ttdeci">explosion_data explosion</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01352">itype.h:1352</a></div></div>
<div class="ttc" id="astructitype_html_a291870408701f0174d8c46b7f770fbaf"><div class="ttname"><a href="structitype.html#a291870408701f0174d8c46b7f770fbaf">itype::get_id</a></div><div class="ttdeci">itype_id get_id() const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01497">itype.h:1497</a></div></div>
<div class="ttc" id="astructitype_html_a623ec8243b1e599086fa3a23c3179370"><div class="ttname"><a href="structitype.html#a623ec8243b1e599086fa3a23c3179370">itype::gun</a></div><div class="ttdeci">cata::value_ptr&lt; islot_gun &gt; gun</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01207">itype.h:1207</a></div></div>
<div class="ttc" id="astructitype_html_a72121b6b478fae1969a4b559f3ded22f"><div class="ttname"><a href="structitype.html#a72121b6b478fae1969a4b559f3ded22f">itype::has_flag</a></div><div class="ttdeci">bool has_flag(const flag_id &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00164">itype.cpp:164</a></div></div>
<div class="ttc" id="astructitype_html_a7cb80d77696cefb42ac6e75756b47e60"><div class="ttname"><a href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">itype::ammo</a></div><div class="ttdeci">cata::value_ptr&lt; islot_ammo &gt; ammo</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01212">itype.h:1212</a></div></div>
<div class="ttc" id="astructitype_html_ab018b62882b32eef884f4efd769c0993"><div class="ttname"><a href="structitype.html#ab018b62882b32eef884f4efd769c0993">itype::id</a></div><div class="ttdeci">itype_id id</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01276">itype.h:1276</a></div></div>
<div class="ttc" id="astructitype_html_aba9992b8bc80b65d4153370b3e0755ec"><div class="ttname"><a href="structitype.html#aba9992b8bc80b65d4153370b3e0755ec">itype::magazine</a></div><div class="ttdeci">cata::value_ptr&lt; islot_magazine &gt; magazine</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01209">itype.h:1209</a></div></div>
<div class="ttc" id="astructitype_html_ad35fbe0013544c1c396944b20b264421"><div class="ttname"><a href="structitype.html#ad35fbe0013544c1c396944b20b264421">itype::nname</a></div><div class="ttdeci">std::string nname(unsigned int quantity) const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00095">itype.cpp:95</a></div></div>
<div class="ttc" id="astructitype_html_aef9a3f51d54f46dd1d5a7accaf483922"><div class="ttname"><a href="structitype.html#aef9a3f51d54f46dd1d5a7accaf483922">itype::mat_portion_total</a></div><div class="ttdeci">int mat_portion_total</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01363">itype.h:1363</a></div></div>
<div class="ttc" id="astructitype_html_af4d6fc9396d1e09f23d2008f974ac757"><div class="ttname"><a href="structitype.html#af4d6fc9396d1e09f23d2008f974ac757">itype::color</a></div><div class="ttdeci">nc_color color</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01420">itype.h:1420</a></div></div>
<div class="ttc" id="astructlabel_html"><div class="ttname"><a href="structlabel.html">label</a></div><div class="ttdoc">Struct used for storing labels (easier to json opposed to a std::map&lt;point, std::string&gt;)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00687">vehicle.h:687</a></div></div>
<div class="ttc" id="astructmtype_html_abe1e1f1cacb0be37406c667e226003c4"><div class="ttname"><a href="structmtype.html#abe1e1f1cacb0be37406c667e226003c4">mtype::mech_weapon</a></div><div class="ttdeci">itype_id mech_weapon</div><div class="ttdoc">If this monster is a rideable mech with built-in weapons, this is the weapons id.</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00327">mtype.h:327</a></div></div>
<div class="ttc" id="astructpoint_html"><div class="ttname"><a href="structpoint.html">point</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00020">point.h:20</a></div></div>
<div class="ttc" id="astructpoint_html_a9a82ca9504acabb1e30569f89c805471"><div class="ttname"><a href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">point::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00024">point.h:24</a></div></div>
<div class="ttc" id="astructpoint_html_ad679b07fb69d55f5ad454d0f1f2891d5"><div class="ttname"><a href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">point::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00023">point.h:23</a></div></div>
<div class="ttc" id="astructprojectile_html"><div class="ttname"><a href="structprojectile.html">projectile</a></div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00017">projectile.h:17</a></div></div>
<div class="ttc" id="astructprojectile_html_a221a35c5c50354f9e29ec63ebfd6669f"><div class="ttname"><a href="structprojectile.html#a221a35c5c50354f9e29ec63ebfd6669f">projectile::shot_impact</a></div><div class="ttdeci">damage_instance shot_impact</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00030">projectile.h:30</a></div></div>
<div class="ttc" id="astructprojectile_html_a2bbf20562006058aa939aa5339860ba7"><div class="ttname"><a href="structprojectile.html#a2bbf20562006058aa939aa5339860ba7">projectile::set_drop</a></div><div class="ttdeci">void set_drop(const item &amp;it)</div><div class="ttdoc">Copies item it as a drop for this projectile.</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8cpp_source.html#l00072">projectile.cpp:72</a></div></div>
<div class="ttc" id="astructprojectile_html_a312bc9a78fe7a5fdefb44e3755154db3"><div class="ttname"><a href="structprojectile.html#a312bc9a78fe7a5fdefb44e3755154db3">projectile::range</a></div><div class="ttdeci">int range</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00022">projectile.h:22</a></div></div>
<div class="ttc" id="astructprojectile_html_a3eb9cbe946d6bf2131eeae97d2d1230d"><div class="ttname"><a href="structprojectile.html#a3eb9cbe946d6bf2131eeae97d2d1230d">projectile::set_custom_explosion</a></div><div class="ttdeci">void set_custom_explosion(const explosion_data &amp;ex)</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8cpp_source.html#l00105">projectile.cpp:105</a></div></div>
<div class="ttc" id="astructprojectile_html_a4536010a51aee3302d749f2eb4dcaf35"><div class="ttname"><a href="structprojectile.html#a4536010a51aee3302d749f2eb4dcaf35">projectile::proj_effects</a></div><div class="ttdeci">std::set&lt; std::string &gt; proj_effects</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00033">projectile.h:33</a></div></div>
<div class="ttc" id="astructprojectile_html_a69088085addc2ca2b0e5328faab85c87"><div class="ttname"><a href="structprojectile.html#a69088085addc2ca2b0e5328faab85c87">projectile::multi_projectile_effects</a></div><div class="ttdeci">bool multi_projectile_effects</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00026">projectile.h:26</a></div></div>
<div class="ttc" id="astructprojectile_html_a82d8f657f8cfc4e180c15bfab8ca8a6e"><div class="ttname"><a href="structprojectile.html#a82d8f657f8cfc4e180c15bfab8ca8a6e">projectile::impact</a></div><div class="ttdeci">damage_instance impact</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00018">projectile.h:18</a></div></div>
<div class="ttc" id="astructprojectile_html_a8f7965237723889c4066c90c05220523"><div class="ttname"><a href="structprojectile.html#a8f7965237723889c4066c90c05220523">projectile::critical_multiplier</a></div><div class="ttdeci">float critical_multiplier</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00031">projectile.h:31</a></div></div>
<div class="ttc" id="astructprojectile_html_aa2af53bce63feecb719ef1edba54689e"><div class="ttname"><a href="structprojectile.html#aa2af53bce63feecb719ef1edba54689e">projectile::speed</a></div><div class="ttdeci">int speed</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00021">projectile.h:21</a></div></div>
<div class="ttc" id="astructprojectile_html_ac535de1b5134a85ddcc5d1deffbf0d31"><div class="ttname"><a href="structprojectile.html#ac535de1b5134a85ddcc5d1deffbf0d31">projectile::count</a></div><div class="ttdeci">int count</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00024">projectile.h:24</a></div></div>
<div class="ttc" id="astructprojectile_html_af0fefe18f0e831be4b4d7d9693b35cbc"><div class="ttname"><a href="structprojectile.html#af0fefe18f0e831be4b4d7d9693b35cbc">projectile::shot_spread</a></div><div class="ttdeci">int shot_spread</div><div class="ttdef"><b>Definition:</b> <a href="projectile_8h_source.html#l00028">projectile.h:28</a></div></div>
<div class="ttc" id="astructrecoil__prediction_html"><div class="ttname"><a href="structrecoil__prediction.html">recoil_prediction</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01650">ranged.cpp:1650</a></div></div>
<div class="ttc" id="astructrecoil__prediction_html_abfa8d33a8f4a583d4460678e290d7efb"><div class="ttname"><a href="structrecoil__prediction.html#abfa8d33a8f4a583d4460678e290d7efb">recoil_prediction::moves</a></div><div class="ttdeci">int moves</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01652">ranged.cpp:1652</a></div></div>
<div class="ttc" id="astructrecoil__prediction_html_af135e1f559f055da9d184aeffcf02193"><div class="ttname"><a href="structrecoil__prediction.html#af135e1f559f055da9d184aeffcf02193">recoil_prediction::recoil</a></div><div class="ttdeci">double recoil</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01651">ranged.cpp:1651</a></div></div>
<div class="ttc" id="astructspell__effect_1_1override__parameters_html"><div class="ttname"><a href="structspell__effect_1_1override__parameters.html">spell_effect::override_parameters</a></div><div class="ttdef"><b>Definition:</b> <a href="magic_8h_source.html#l00738">magic.h:738</a></div></div>
<div class="ttc" id="astructtarget__ui_1_1turret__with__lof_html"><div class="ttname"><a href="structtarget__ui_1_1turret__with__lof.html">target_ui::turret_with_lof</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00272">ranged.cpp:272</a></div></div>
<div class="ttc" id="astructtarget__ui_1_1turret__with__lof_html_a4422bb428b5d266bad798974571c9baf"><div class="ttname"><a href="structtarget__ui_1_1turret__with__lof.html#a4422bb428b5d266bad798974571c9baf">target_ui::turret_with_lof::line</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; line</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00274">ranged.cpp:274</a></div></div>
<div class="ttc" id="astructtarget__ui_1_1turret__with__lof_html_aaa416c09474e4040a712a05bbb5e99cf"><div class="ttname"><a href="structtarget__ui_1_1turret__with__lof.html#aaa416c09474e4040a712a05bbb5e99cf">target_ui::turret_with_lof::turret</a></div><div class="ttdeci">vehicle_part * turret</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00273">ranged.cpp:273</a></div></div>
<div class="ttc" id="astructtime__info__t_html"><div class="ttname"><a href="structtime__info__t.html">time_info_t</a></div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00023">skill.h:23</a></div></div>
<div class="ttc" id="astructtime__info__t_html_a1cb4c0bb33cbe25f4e889533d8ae1721"><div class="ttname"><a href="structtime__info__t.html#a1cb4c0bb33cbe25f4e889533d8ae1721">time_info_t::time_reduction_per_level</a></div><div class="ttdeci">int time_reduction_per_level</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00029">skill.h:29</a></div></div>
<div class="ttc" id="astructtime__info__t_html_a562e779c37f25968ccd5f5298a8c308c"><div class="ttname"><a href="structtime__info__t.html#a562e779c37f25968ccd5f5298a8c308c">time_info_t::min_time</a></div><div class="ttdeci">int min_time</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00025">skill.h:25</a></div></div>
<div class="ttc" id="astructtime__info__t_html_ab3676d37128ef1625abe58686c8c2bfb"><div class="ttname"><a href="structtime__info__t.html#ab3676d37128ef1625abe58686c8c2bfb">time_info_t::base_time</a></div><div class="ttdeci">int base_time</div><div class="ttdef"><b>Definition:</b> <a href="skill_8h_source.html#l00027">skill.h:27</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00129">point.h:129</a></div></div>
<div class="ttc" id="astructtripoint_html_a89f6c0a16e2bfd7ce4f1f1d20404c4d7"><div class="ttname"><a href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">tripoint::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00133">point.h:133</a></div></div>
<div class="ttc" id="astructtripoint_html_ac944c0e329b5eba2602f7a52f66bbbb9"><div class="ttname"><a href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">tripoint::z</a></div><div class="ttdeci">int z</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00134">point.h:134</a></div></div>
<div class="ttc" id="astructtripoint_html_accc0725c936dbebb2486f969f39e2e5f"><div class="ttname"><a href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">tripoint::xy</a></div><div class="ttdeci">constexpr point xy() const</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00202">point.h:202</a></div></div>
<div class="ttc" id="astructtripoint_html_affdc0d5b75024cbfacd208a495def3dc"><div class="ttname"><a href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">tripoint::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00132">point.h:132</a></div></div>
<div class="ttc" id="astructvehicle__part_html"><div class="ttname"><a href="structvehicle__part.html">vehicle_part</a></div><div class="ttdoc">Structure, describing vehicle part (i.e., wheel, seat)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00254">vehicle.h:254</a></div></div>
<div class="ttc" id="astructweakpoint__attack_html"><div class="ttname"><a href="structweakpoint__attack.html">weakpoint_attack</a></div><div class="ttdef"><b>Definition:</b> <a href="weakpoint_8h_source.html#l00024">weakpoint.h:24</a></div></div>
<div class="ttc" id="astructweakpoint__attack_html_a0dd6f503710c5851bab2e59107d40ab3"><div class="ttname"><a href="structweakpoint__attack.html#a0dd6f503710c5851bab2e59107d40ab3">weakpoint_attack::is_thrown</a></div><div class="ttdeci">bool is_thrown</div><div class="ttdef"><b>Definition:</b> <a href="weakpoint_8h_source.html#l00044">weakpoint.h:44</a></div></div>
<div class="ttc" id="astructweakpoint__attack_html_aed78ef37bb4ef0b99cc10318b569c016"><div class="ttname"><a href="structweakpoint__attack.html#aed78ef37bb4ef0b99cc10318b569c016">weakpoint_attack::weapon</a></div><div class="ttdeci">const item * weapon</div><div class="ttdef"><b>Definition:</b> <a href="weakpoint_8h_source.html#l00040">weakpoint.h:40</a></div></div>
<div class="ttc" id="atranslation_8cpp_html_a176e288c640c6506a86330cb10fbe13a"><div class="ttname"><a href="translation_8cpp.html#a176e288c640c6506a86330cb10fbe13a">to_translation</a></div><div class="ttdeci">translation to_translation(const std::string &amp;raw)</div><div class="ttdoc">Shorthands for translation::to_translation.</div><div class="ttdef"><b>Definition:</b> <a href="translation_8cpp_source.html#l00420">translation.cpp:420</a></div></div>
<div class="ttc" id="atranslations_8h_html"><div class="ttname"><a href="translations_8h.html">translations.h</a></div></div>
<div class="ttc" id="atranslations_8h_html_a45dd4e3da9b83845bcd1c2d8e80cf802"><div class="ttname"><a href="translations_8h.html#a45dd4e3da9b83845bcd1c2d8e80cf802">n_gettext</a></div><div class="ttdeci">#define n_gettext(STRING1, STRING2, COUNT)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00091">translations.h:91</a></div></div>
<div class="ttc" id="atranslations_8h_html_a46bdf4dff9d320938561cade1c9a5f7e"><div class="ttname"><a href="translations_8h.html#a46bdf4dff9d320938561cade1c9a5f7e">pgettext</a></div><div class="ttdeci">#define pgettext(STRING1, STRING2)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00092">translations.h:92</a></div></div>
<div class="ttc" id="atranslations_8h_html_a9e39a96618079002323c6e554271d3e2"><div class="ttname"><a href="translations_8h.html#a9e39a96618079002323c6e554271d3e2">translate_marker_context</a></div><div class="ttdeci">#define translate_marker_context(c, x)</div><div class="ttdoc">Same as translate_marker, but also provides a context (string literal).</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00025">translations.h:25</a></div></div>
<div class="ttc" id="atranslations_8h_html_ab92bb4161a6308b302d283816975c3a6"><div class="ttname"><a href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a></div><div class="ttdeci">#define _(STRING)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00089">translations.h:89</a></div></div>
<div class="ttc" id="atrap_8h_html"><div class="ttname"><a href="trap_8h.html">trap.h</a></div></div>
<div class="ttc" id="atry__parse__integer_8cpp_html_ae51236610f306440113477987363490b"><div class="ttname"><a href="try__parse__integer_8cpp.html#ae51236610f306440113477987363490b">try_parse_integer&lt; int &gt;</a></div><div class="ttdeci">template ret_val&lt; int &gt; try_parse_integer&lt; int &gt;(const std::string_view, bool use_locale)</div></div>
<div class="ttc" id="atry__parse__integer_8h_html"><div class="ttname"><a href="try__parse__integer_8h.html">try_parse_integer.h</a></div></div>
<div class="ttc" id="atype__id_8h_html"><div class="ttname"><a href="type__id_8h.html">type_id.h</a></div></div>
<div class="ttc" id="aui_8h_html"><div class="ttname"><a href="ui_8h.html">ui.h</a></div></div>
<div class="ttc" id="aui_8h_html_a06d5f3667ed71fa40939c4e7367e30ce"><div class="ttname"><a href="ui_8h.html#a06d5f3667ed71fa40939c4e7367e30ce">MENU_AUTOASSIGN</a></div><div class="ttdeci">const int MENU_AUTOASSIGN</div><div class="ttdef"><b>Definition:</b> <a href="ui_8h_source.html#l00038">ui.h:38</a></div></div>
<div class="ttc" id="aui__manager_8h_html"><div class="ttname"><a href="ui__manager_8h.html">ui_manager.h</a></div></div>
<div class="ttc" id="aunits_8h_html"><div class="ttname"><a href="units_8h.html">units.h</a></div></div>
<div class="ttc" id="aunits__utility_8cpp_html_a1e30191582247e71dd6bca985f5fba36"><div class="ttname"><a href="units__utility_8cpp.html#a1e30191582247e71dd6bca985f5fba36">normalize</a></div><div class="ttdeci">units::angle normalize(units::angle a, units::angle mod)</div><div class="ttdoc">Given an angle, add or subtract multiples of 360_degrees until it's in the range [0,...</div><div class="ttdef"><b>Definition:</b> <a href="units__utility_8cpp_source.html#l00010">units_utility.cpp:10</a></div></div>
<div class="ttc" id="aunits__utility_8h_html"><div class="ttname"><a href="units__utility_8h.html">units_utility.h</a></div></div>
<div class="ttc" id="avalue__ptr_8h_html"><div class="ttname"><a href="value__ptr_8h.html">value_ptr.h</a></div></div>
<div class="ttc" id="avehicle_8h_html"><div class="ttname"><a href="vehicle_8h.html">vehicle.h</a></div></div>
<div class="ttc" id="avpart__position_8h_html"><div class="ttname"><a href="vpart__position_8h.html">vpart_position.h</a></div></div>
<div class="ttc" id="avpart__position_8h_html_a8da46e924794d004c9899494ecd600c5"><div class="ttname"><a href="vpart__position_8h.html#a8da46e924794d004c9899494ecd600c5">veh_pointer_or_null</a></div><div class="ttdeci">vehicle * veh_pointer_or_null(const optional_vpart_position &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00185">vpart_position.h:185</a></div></div>
<div class="ttc" id="aweakpoint_8h_html"><div class="ttname"><a href="weakpoint_8h.html">weakpoint.h</a></div></div>
<div class="ttc" id="awidget_8h_html_ac9c40e0d5ffae2a9e10019da79b7983fa3734a903022249b3010be1897042568e"><div class="ttname"><a href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa3734a903022249b3010be1897042568e">widget_var::move</a></div><div class="ttdeci">@ move</div></div>
<div class="ttc" id="awidget_8h_html_ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61"><div class="ttname"><a href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">widget_var::move_cost</a></div><div class="ttdeci">@ move_cost</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 7 2024 08:48:31 for Cataclysm DDA by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
