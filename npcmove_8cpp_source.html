<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm DDA: src/npcmove.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm DDA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">npcmove.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="npcmove_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="npc_8h.html">npc.h</a>&quot;</span> <span class="comment">// IWYU pragma: associated</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;cfloat&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;climits&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;numeric&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;ostream&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;tuple&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="active__item__cache_8h.html">active_item_cache.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="activity__handlers_8h.html">activity_handlers.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ammo_8h.html">ammo.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="avatar_8h.html">avatar.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="basecamp_8h.html">basecamp.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="bionics_8h.html">bionics.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="bodypart_8h.html">bodypart.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cata__algo_8h.html">cata_algo.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="character_8h.html">character.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="character__id_8h.html">character_id.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="clzones_8h.html">clzones.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="colony_8h.html">colony.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coordinates_8h.html">coordinates.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="creature_8h.html">creature.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="creature__tracker_8h.html">creature_tracker.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="damage_8h.html">damage.h</a>&quot;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">debug.h</a>&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dialogue__chatbin_8h.html">dialogue_chatbin.h</a>&quot;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dispersion_8h.html">dispersion.h</a>&quot;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="effect_8h.html">effect.h</a>&quot;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="enums_8h.html">enums.h</a>&quot;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="event__bus_8h.html">event_bus.h</a>&quot;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="explosion_8h.html">explosion.h</a>&quot;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="field_8h.html">field.h</a>&quot;</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="field__type_8h.html">field_type.h</a>&quot;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="flag_8h.html">flag.h</a>&quot;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="flat__set_8h.html">flat_set.h</a>&quot;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="game_8h.html">game.h</a>&quot;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="game__constants_8h.html">game_constants.h</a>&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gates_8h.html">gates.h</a>&quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gun__mode_8h.html">gun_mode.h</a>&quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="item_8h.html">item.h</a>&quot;</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="item__factory_8h.html">item_factory.h</a>&quot;</span></div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="itype_8h.html">itype.h</a>&quot;</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="iuse_8h.html">iuse.h</a>&quot;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="iuse__actor_8h.html">iuse_actor.h</a>&quot;</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="line_8h.html">line.h</a>&quot;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="map_8h.html">map.h</a>&quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="map__iterator_8h.html">map_iterator.h</a>&quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mapdata_8h.html">mapdata.h</a>&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="material_8h.html">material.h</a>&quot;</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="messages_8h.html">messages.h</a>&quot;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mission_8h.html">mission.h</a>&quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="monster_8h.html">monster.h</a>&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mtype_8h.html">mtype.h</a>&quot;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="npc__attack_8h.html">npc_attack.h</a>&quot;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="npctalk_8h.html">npctalk.h</a>&quot;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="omdata_8h.html">omdata.h</a>&quot;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="options_8h.html">options.h</a>&quot;</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="overmap_8h.html">overmap.h</a>&quot;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="overmap__location_8h.html">overmap_location.h</a>&quot;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="overmapbuffer_8h.html">overmapbuffer.h</a>&quot;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="player__activity_8h.html">player_activity.h</a>&quot;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="projectile_8h.html">projectile.h</a>&quot;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ranged_8h.html">ranged.h</a>&quot;</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ret__val_8h.html">ret_val.h</a>&quot;</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="rng_8h.html">rng.h</a>&quot;</span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sounds_8h.html">sounds.h</a>&quot;</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="stomach_8h.html">stomach.h</a>&quot;</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="talker_8h.html">talker.h</a>&quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="translations_8h.html">translations.h</a>&quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="units_8h.html">units.h</a>&quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="value__ptr_8h.html">value_ptr.h</a>&quot;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="veh__type_8h.html">veh_type.h</a>&quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vehicle_8h.html">vehicle.h</a>&quot;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="viewer_8h.html">viewer.h</a>&quot;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="visitable_8h.html">visitable.h</a>&quot;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vehicle__selector_8h.html">vehicle_selector.h</a>&quot;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vpart__position_8h.html">vpart_position.h</a>&quot;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vpart__range_8h.html">vpart_range.h</a>&quot;</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a998c1f0ad926f40dc54ed31ef34e105e">   85</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">activity_id</a> <a class="code" href="npcmove_8cpp.html#a998c1f0ad926f40dc54ed31ef34e105e">ACT_CRAFT</a>( <span class="stringliteral">&quot;ACT_CRAFT&quot;</span> );</div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#acdc2d231ebdbf7d9571d84ebe9993c5f">   86</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">activity_id</a> <a class="code" href="npcmove_8cpp.html#acdc2d231ebdbf7d9571d84ebe9993c5f">ACT_FIRSTAID</a>( <span class="stringliteral">&quot;ACT_FIRSTAID&quot;</span> );</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a0313dde9b91b312463fd84bf985b42a6">   87</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">activity_id</a> <a class="code" href="npcmove_8cpp.html#a0313dde9b91b312463fd84bf985b42a6">ACT_MOVE_LOOT</a>( <span class="stringliteral">&quot;ACT_MOVE_LOOT&quot;</span> );</div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a63e5739b23bda74126ceb8fbb66e502b">   88</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">activity_id</a> <a class="code" href="npcmove_8cpp.html#a63e5739b23bda74126ceb8fbb66e502b">ACT_OPERATION</a>( <span class="stringliteral">&quot;ACT_OPERATION&quot;</span> );</div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#aa93f72dcd6663590417f2f8fd001d032">   89</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">activity_id</a> <a class="code" href="npcmove_8cpp.html#aa93f72dcd6663590417f2f8fd001d032">ACT_PULP</a>( <span class="stringliteral">&quot;ACT_PULP&quot;</span> );</div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a86707315539643dbc391ad64dfbc2765">   90</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">activity_id</a> <a class="code" href="npcmove_8cpp.html#a86707315539643dbc391ad64dfbc2765">ACT_SPELLCASTING</a>( <span class="stringliteral">&quot;ACT_SPELLCASTING&quot;</span> );</div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a3ba251501edde65d85515f5febd2fd8b">   91</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">activity_id</a> <a class="code" href="npcmove_8cpp.html#a3ba251501edde65d85515f5febd2fd8b">ACT_TIDY_UP</a>( <span class="stringliteral">&quot;ACT_TIDY_UP&quot;</span> );</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a99bde006d277d411e266b003163d9f05">   93</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a99bde006d277d411e266b003163d9f05">bio_ads</a>( <span class="stringliteral">&quot;bio_ads&quot;</span> );</div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a2ab46842d379637d4d5711e46f5333b6">   94</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a2ab46842d379637d4d5711e46f5333b6">bio_blade</a>( <span class="stringliteral">&quot;bio_blade&quot;</span> );</div>
<div class="line"><a name="l00095"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a47b7446e791f3b97d961376a99f71c5c">   95</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a47b7446e791f3b97d961376a99f71c5c">bio_chain_lightning</a>( <span class="stringliteral">&quot;bio_chain_lightning&quot;</span> );</div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a9875fb4a0c27055032f55b2fb787a183">   96</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a9875fb4a0c27055032f55b2fb787a183">bio_claws</a>( <span class="stringliteral">&quot;bio_claws&quot;</span> );</div>
<div class="line"><a name="l00097"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#aa420c555e4d3d6c14ef7fcc8c1ab76a7">   97</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#aa420c555e4d3d6c14ef7fcc8c1ab76a7">bio_faraday</a>( <span class="stringliteral">&quot;bio_faraday&quot;</span> );</div>
<div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a97652b813a5499a1076967dbc4bd892f">   98</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a97652b813a5499a1076967dbc4bd892f">bio_heat_absorb</a>( <span class="stringliteral">&quot;bio_heat_absorb&quot;</span> );</div>
<div class="line"><a name="l00099"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#af198a4e5b75aadbc020ee447fd31226b">   99</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#af198a4e5b75aadbc020ee447fd31226b">bio_heatsink</a>( <span class="stringliteral">&quot;bio_heatsink&quot;</span> );</div>
<div class="line"><a name="l00100"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a4424b509877ff458aa661c2b49a99dda">  100</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a4424b509877ff458aa661c2b49a99dda">bio_hydraulics</a>( <span class="stringliteral">&quot;bio_hydraulics&quot;</span> );</div>
<div class="line"><a name="l00101"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a91c01a2c4b936068b288514db0a639b5">  101</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a91c01a2c4b936068b288514db0a639b5">bio_laser</a>( <span class="stringliteral">&quot;bio_laser&quot;</span> );</div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a9c88573bcf0c9acc70c79864f6b0e433">  102</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a9c88573bcf0c9acc70c79864f6b0e433">bio_leukocyte</a>( <span class="stringliteral">&quot;bio_leukocyte&quot;</span> );</div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a3bfe78dbc0d8cfc6819f0f24c7729adc">  103</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a3bfe78dbc0d8cfc6819f0f24c7729adc">bio_nanobots</a>( <span class="stringliteral">&quot;bio_nanobots&quot;</span> );</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a765cb5e0b9669d9f0c218356ed53bfea">  104</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a765cb5e0b9669d9f0c218356ed53bfea">bio_ods</a>( <span class="stringliteral">&quot;bio_ods&quot;</span> );</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a15450ecf5b34a615affe959125bf1626">  105</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a15450ecf5b34a615affe959125bf1626">bio_painkiller</a>( <span class="stringliteral">&quot;bio_painkiller&quot;</span> );</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ab79bc462345c02553b997c0ab7489bf2">  106</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#ab79bc462345c02553b997c0ab7489bf2">bio_plutfilter</a>( <span class="stringliteral">&quot;bio_plutfilter&quot;</span> );</div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ab7fca7b08d020989cad3cfad9e31c274">  107</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#ab7fca7b08d020989cad3cfad9e31c274">bio_radscrubber</a>( <span class="stringliteral">&quot;bio_radscrubber&quot;</span> );</div>
<div class="line"><a name="l00108"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a9719257cccee9b21df38a95f2ca195fa">  108</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a9719257cccee9b21df38a95f2ca195fa">bio_shock</a>( <span class="stringliteral">&quot;bio_shock&quot;</span> );</div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a978adf30232e0bcf1b9d38a73b8dd30e">  109</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> <a class="code" href="npcmove_8cpp.html#a978adf30232e0bcf1b9d38a73b8dd30e">bio_soporific</a>( <span class="stringliteral">&quot;bio_soporific&quot;</span> );</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">  111</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">damage_type_id</a> <a class="code" href="npcmove_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">damage_bash</a>( <span class="stringliteral">&quot;bash&quot;</span> );</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a35045bcfd0e1c55fb7e9b88d8e36a614">  112</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">damage_type_id</a> <a class="code" href="npcmove_8cpp.html#a35045bcfd0e1c55fb7e9b88d8e36a614">damage_bullet</a>( <span class="stringliteral">&quot;bullet&quot;</span> );</div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">  113</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">damage_type_id</a> <a class="code" href="npcmove_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">damage_cut</a>( <span class="stringliteral">&quot;cut&quot;</span> );</div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#afdae56eafce50b1f873673574188aca8">  114</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">damage_type_id</a> <a class="code" href="npcmove_8cpp.html#afdae56eafce50b1f873673574188aca8">damage_stab</a>( <span class="stringliteral">&quot;stab&quot;</span> );</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a2dde49329eef942ec57d25db274942c0">  116</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#a2dde49329eef942ec57d25db274942c0">effect_asthma</a>( <span class="stringliteral">&quot;asthma&quot;</span> );</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c2a13f94c0d13712af84b23f13e788f">  117</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#a7c2a13f94c0d13712af84b23f13e788f">effect_bandaged</a>( <span class="stringliteral">&quot;bandaged&quot;</span> );</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a39b21fc30fecd7d4fb15047600d03522">  118</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#a39b21fc30fecd7d4fb15047600d03522">effect_bite</a>( <span class="stringliteral">&quot;bite&quot;</span> );</div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">  119</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a>( <span class="stringliteral">&quot;bleed&quot;</span> );</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#aa3320a370fe1f7f1cf6e14918ca20358">  120</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#aa3320a370fe1f7f1cf6e14918ca20358">effect_bouldering</a>( <span class="stringliteral">&quot;bouldering&quot;</span> );</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ac9543c508e08b7d10d19ecb5f80e1b1c">  121</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#ac9543c508e08b7d10d19ecb5f80e1b1c">effect_catch_up</a>( <span class="stringliteral">&quot;catch_up&quot;</span> );</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#adcc47d614ba63ddb056307153d5ac06c">  122</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#adcc47d614ba63ddb056307153d5ac06c">effect_disinfected</a>( <span class="stringliteral">&quot;disinfected&quot;</span> );</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">  123</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a>( <span class="stringliteral">&quot;hit_by_player&quot;</span> );</div>
<div class="line"><a name="l00124"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ab987f0249d5dcb5a351fe48ffebffc55">  124</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#ab987f0249d5dcb5a351fe48ffebffc55">effect_hypovolemia</a>( <span class="stringliteral">&quot;hypovolemia&quot;</span> );</div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a1de43fa1f6d16ce87ab7a3a49e47c463">  125</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#a1de43fa1f6d16ce87ab7a3a49e47c463">effect_infected</a>( <span class="stringliteral">&quot;infected&quot;</span> );</div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ac95fd54d69ea350ea463a719fa7f3550">  126</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#ac95fd54d69ea350ea463a719fa7f3550">effect_lying_down</a>( <span class="stringliteral">&quot;lying_down&quot;</span> );</div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#af079f6d5681dabcbc1c4ee804c0ba556">  127</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#af079f6d5681dabcbc1c4ee804c0ba556">effect_no_sight</a>( <span class="stringliteral">&quot;no_sight&quot;</span> );</div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">  128</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a>( <span class="stringliteral">&quot;npc_fire_bad&quot;</span> );</div>
<div class="line"><a name="l00129"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#afdcaa355e9fb31990b6222e12cc0416a">  129</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#afdcaa355e9fb31990b6222e12cc0416a">effect_npc_flee_player</a>( <span class="stringliteral">&quot;npc_flee_player&quot;</span> );</div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a04a78b20202d905c65011e5f8b51db43">  130</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#a04a78b20202d905c65011e5f8b51db43">effect_npc_player_still_looking</a>( <span class="stringliteral">&quot;npc_player_still_looking&quot;</span> );</div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">  131</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a>( <span class="stringliteral">&quot;npc_run_away&quot;</span> );</div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#afcfa82c36c0dc2d76cd19d622c2b6ab4">  132</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#afcfa82c36c0dc2d76cd19d622c2b6ab4">effect_onfire</a>( <span class="stringliteral">&quot;onfire&quot;</span> );</div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#adcaf70773541073a0d4cdfce4b857bf7">  133</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#adcaf70773541073a0d4cdfce4b857bf7">effect_psi_stunned</a>( <span class="stringliteral">&quot;psi_stunned&quot;</span> );</div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ad6fd62a9ed571c6bf17d577118be3c5a">  134</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#ad6fd62a9ed571c6bf17d577118be3c5a">effect_stumbled_into_invisible</a>( <span class="stringliteral">&quot;stumbled_into_invisible&quot;</span> );</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">  135</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> <a class="code" href="npcmove_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">effect_stunned</a>( <span class="stringliteral">&quot;stunned&quot;</span> );</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a31e2ef0b23e31f445746b9eaabbeb600">  137</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">field_type_str_id</a> <a class="code" href="npcmove_8cpp.html#a31e2ef0b23e31f445746b9eaabbeb600">field_fd_last_known</a>( <span class="stringliteral">&quot;fd_last_known&quot;</span> );</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a4df4d1902dc88952a51b05cf60c02753">  139</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> <a class="code" href="npcmove_8cpp.html#a4df4d1902dc88952a51b05cf60c02753">itype_inhaler</a>( <span class="stringliteral">&quot;inhaler&quot;</span> );</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a3bad9376f4cd7fb97bfad7d8dfef4301">  140</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> <a class="code" href="npcmove_8cpp.html#a3bad9376f4cd7fb97bfad7d8dfef4301">itype_lsd</a>( <span class="stringliteral">&quot;lsd&quot;</span> );</div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a44adef81192d43188ce1a50f4b41bb3b">  141</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> <a class="code" href="npcmove_8cpp.html#a44adef81192d43188ce1a50f4b41bb3b">itype_oxygen_tank</a>( <span class="stringliteral">&quot;oxygen_tank&quot;</span> );</div>
<div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a529eaf0b3181b88487e110193c6d9986">  142</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> <a class="code" href="npcmove_8cpp.html#a529eaf0b3181b88487e110193c6d9986">itype_smoxygen_tank</a>( <span class="stringliteral">&quot;smoxygen_tank&quot;</span> );</div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a45f8e2064814b10b3c8d0c5de0995db4">  143</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> <a class="code" href="npcmove_8cpp.html#a45f8e2064814b10b3c8d0c5de0995db4">itype_thorazine</a>( <span class="stringliteral">&quot;thorazine&quot;</span> );</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160; </div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#aad2dc5891bcab35900a7abbe32f8f257">  145</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">npc_class_id</a> <a class="code" href="npcmove_8cpp.html#aad2dc5891bcab35900a7abbe32f8f257">NC_EVAC_SHOPKEEP</a>( <span class="stringliteral">&quot;NC_EVAC_SHOPKEEP&quot;</span> );</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#aaf598d0fedebd89ec20f768da3b5fd8a">  147</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">skill_id</a> <a class="code" href="npcmove_8cpp.html#aaf598d0fedebd89ec20f768da3b5fd8a">skill_firstaid</a>( <span class="stringliteral">&quot;firstaid&quot;</span> );</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#adf56eab61890bbb283d4dbd7d26dde16">  149</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">trait_id</a> <a class="code" href="npcmove_8cpp.html#adf56eab61890bbb283d4dbd7d26dde16">trait_IGNORE_SOUND</a>( <span class="stringliteral">&quot;IGNORE_SOUND&quot;</span> );</div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ae392542982be57abf21e9253ea942d4e">  150</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">trait_id</a> <a class="code" href="npcmove_8cpp.html#ae392542982be57abf21e9253ea942d4e">trait_RETURN_TO_START_POS</a>( <span class="stringliteral">&quot;RETURN_TO_START_POS&quot;</span> );</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160; </div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a47a308d1260b0a61e3ac9f492d1159ca">  152</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">zone_type_id</a> <a class="code" href="npcmove_8cpp.html#a47a308d1260b0a61e3ac9f492d1159ca">zone_type_NO_NPC_PICKUP</a>( <span class="stringliteral">&quot;NO_NPC_PICKUP&quot;</span> );</div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#abf2f82354556637a79e1feecad2969b9">  153</a></span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="classstring__id.html">zone_type_id</a> <a class="code" href="npcmove_8cpp.html#abf2f82354556637a79e1feecad2969b9">zone_type_NPC_RETREAT</a>( <span class="stringliteral">&quot;NPC_RETREAT&quot;</span> );</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160; </div>
<div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a86688811514622ffd567dd7a15f31ebf">  155</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">float</span> <a class="code" href="npcmove_8cpp.html#a86688811514622ffd567dd7a15f31ebf">MAX_FLOAT</a> = 5000000000.0f;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160; </div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">// TODO: These would be much better using common code or constants from character.cpp,</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="comment">// which handles the player formatting of thirst/hunger levels. Right now we</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">// have magic numbers all over the place. ;(</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a6bd7c8b57b582cbee241e6bbf8e51998">  161</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">int</span> <a class="code" href="npcmove_8cpp.html#a6bd7c8b57b582cbee241e6bbf8e51998">NPC_THIRST_CONSUME</a>  = 40;  <span class="comment">// &quot;Thirsty&quot;</span></div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a0dea205d5b8aa85ab213a0b84fa3a006">  162</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">int</span> <a class="code" href="npcmove_8cpp.html#a0dea205d5b8aa85ab213a0b84fa3a006">NPC_THIRST_COMPLAIN</a> = 80;  <span class="comment">// &quot;Very thirsty&quot;</span></div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a37e77cfc4ad1ad149440b37a4a9e1500">  163</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">int</span> <a class="code" href="npcmove_8cpp.html#a37e77cfc4ad1ad149440b37a4a9e1500">NPC_HUNGER_CONSUME</a>  = 80;  <span class="comment">// 50% of what&#39;s needed to refuse training.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ae2002588c2e33a355ee6f1416df681e3">  164</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">int</span> <a class="code" href="npcmove_8cpp.html#ae2002588c2e33a355ee6f1416df681e3">NPC_HUNGER_COMPLAIN</a> = 160; <span class="comment">// The level at which we refuse to do some tasks.</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160; </div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">  166</a></span>&#160;<span class="keyword">enum</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> : <span class="keywordtype">int</span> {</div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">  167</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> = 0,</div>
<div class="line"><a name="l00168"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">  168</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>,</div>
<div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a34e61bbbaf8abebf63326320fec60c53">  169</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a34e61bbbaf8abebf63326320fec60c53">npc_reload</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1c5faa755f1cd29189d4e164dd3b1411">npc_sleep</a>,</div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a82965fc7cec7bafbe6a94100f689895d">  170</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a82965fc7cec7bafbe6a94100f689895d">npc_pickup</a>,</div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a4c50de30d1fe74ad9f2f7146ef81ede1">  171</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af8a5950d177e7da5bb22362a7e8949c1">npc_heal</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ab3ea6db7edf0f1efbf6082d8b7307d15">npc_use_painkiller</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a4c50de30d1fe74ad9f2f7146ef81ede1">npc_drop_items</a>,</div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">  172</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">npc_flee</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1b0dd2cfef9c4f9a367079199c7c80af">npc_melee</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a48cceb4e0db33f4525fee6c3f7c7924d">npc_shoot</a>,</div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">  173</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a55a7ea511d5d1d406ea6edfb96a65c56">npc_look_for_player</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9c46449f66af0d972656ec500f4d39ba">npc_heal_player</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">npc_follow_embarked</a>,</div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a85155639ee95331052d51900b16fdbb1">  174</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a30c4f16c4a66425e87f3e462c987d762">npc_talk_to_player</a>, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a85155639ee95331052d51900b16fdbb1">npc_mug_player</a>,</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a320566dc8704d228e05b9fa1191726d8">  175</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a320566dc8704d228e05b9fa1191726d8">npc_goto_to_this_pos</a>,</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">  176</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">npc_goto_destination</a>,</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6afb1482ed3f94beb6473c2f9b3b8189">  177</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6afb1482ed3f94beb6473c2f9b3b8189">npc_avoid_friendly_fire</a>,</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6fd72bcdd3524d15de954838ceb03e5a">  178</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6fd72bcdd3524d15de954838ceb03e5a">npc_escape_explosion</a>,</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">  179</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>,</div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3a4fe08fa3d733f7956e1c5692e1a3da">  180</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3a4fe08fa3d733f7956e1c5692e1a3da">npc_reach_attack</a>,</div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ae7395a29bb423bfddfba92378abe9a27">  181</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ae7395a29bb423bfddfba92378abe9a27">npc_do_attack</a>,</div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ad178d28c383136b41476fe0df9c71306">  182</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ad178d28c383136b41476fe0df9c71306">npc_aim</a>,</div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5">  183</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5">npc_investigate_sound</a>,</div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">  184</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">npc_return_to_guard_pos</a>,</div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">  185</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a>,</div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a058b148b092d45266de475aa2281477b">  186</a></span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a058b148b092d45266de475aa2281477b">npc_worker_downtime</a>,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a06ebb628884ecce6136bb9a6040bab9b">num_npc_actions</a></div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a06ebb628884ecce6136bb9a6040bab9b">  188</a></span>&#160;};</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html">  190</a></span>&#160;<span class="keyword">namespace</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a21c4e6ec47c5c917485f57ab35c5f0b1">  192</a></span>&#160;<span class="keyword">const</span> std::vector&lt;bionic_id&gt; <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a21c4e6ec47c5c917485f57ab35c5f0b1">defense_cbms</a> = { {</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <a class="code" href="npcmove_8cpp.html#a99bde006d277d411e266b003163d9f05">bio_ads</a>,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <a class="code" href="npcmove_8cpp.html#aa420c555e4d3d6c14ef7fcc8c1ab76a7">bio_faraday</a>,</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <a class="code" href="npcmove_8cpp.html#a97652b813a5499a1076967dbc4bd892f">bio_heat_absorb</a>,</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <a class="code" href="npcmove_8cpp.html#af198a4e5b75aadbc020ee447fd31226b">bio_heatsink</a>,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        <a class="code" href="npcmove_8cpp.html#a765cb5e0b9669d9f0c218356ed53bfea">bio_ods</a>,</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <a class="code" href="npcmove_8cpp.html#a9719257cccee9b21df38a95f2ca195fa">bio_shock</a></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    }</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;};</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160; </div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a4ebf7d016fe3acf5365eb4bb84abf223">  202</a></span>&#160;<span class="keyword">const</span> std::vector&lt;bionic_id&gt; <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a4ebf7d016fe3acf5365eb4bb84abf223">health_cbms</a> = { {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <a class="code" href="npcmove_8cpp.html#a9c88573bcf0c9acc70c79864f6b0e433">bio_leukocyte</a>,</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <a class="code" href="npcmove_8cpp.html#ab79bc462345c02553b997c0ab7489bf2">bio_plutfilter</a></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;};</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">// lightning, laser, blade, claws in order of use priority</span></div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a8ac361f76a60d142bb729e731f1f99d7">  209</a></span>&#160;<span class="keyword">const</span> std::vector&lt;bionic_id&gt; <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a8ac361f76a60d142bb729e731f1f99d7">weapon_cbms</a> = { {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <a class="code" href="npcmove_8cpp.html#a47b7446e791f3b97d961376a99f71c5c">bio_chain_lightning</a>,</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <a class="code" href="npcmove_8cpp.html#a91c01a2c4b936068b288514db0a639b5">bio_laser</a>,</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <a class="code" href="npcmove_8cpp.html#a2ab46842d379637d4d5711e46f5333b6">bio_blade</a>,</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <a class="code" href="npcmove_8cpp.html#a9875fb4a0c27055032f55b2fb787a183">bio_claws</a></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    }</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;};</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160; </div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a14108754d46e7a886364e08c7817615b">  217</a></span>&#160;<span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a14108754d46e7a886364e08c7817615b">avoidance_vehicles_radius</a> = 5;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a00172ed0a10f7343e460c341ad4fe416">  219</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a00172ed0a10f7343e460c341ad4fe416">good_for_pickup</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it, <a class="code" href="classnpc.html">npc</a> &amp;who, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;there )</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">return</span> who.<a class="code" href="classnpc.html#a78aff0d002c14e7448e2db08f7be7afe">can_take_that</a>( it ) &amp;&amp;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;           who.<a class="code" href="classnpc.html#ad8d20228a9ce2ea0c6761c67f0478322">wants_take_that</a>( it ) &amp;&amp;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;           who.<a class="code" href="classnpc.html#ad744dea4eca4c935a873c22e427a7277">would_take_that</a>( it, there );</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;}</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;} <span class="comment">// namespace</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keyword">static</span> std::string <a class="code" href="npcmove_8cpp.html#a8d1c3c3d8e1c9281ac6f0a333487c414">npc_action_name</a>( <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609">print_action</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *prepend, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160; </div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="npcmove_8cpp.html#afbadedc2f23ae322e4a2e30157fd0585">compare_sound_alert</a>( <span class="keyword">const</span> <a class="code" href="structdangerous__sound.html">dangerous_sound</a> &amp;sound_a, <span class="keyword">const</span> <a class="code" href="structdangerous__sound.html">dangerous_sound</a> &amp;sound_b );</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#afbadedc2f23ae322e4a2e30157fd0585">  234</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="npcmove_8cpp.html#afbadedc2f23ae322e4a2e30157fd0585">compare_sound_alert</a>( <span class="keyword">const</span> <a class="code" href="structdangerous__sound.html">dangerous_sound</a> &amp;sound_a, <span class="keyword">const</span> <a class="code" href="structdangerous__sound.html">dangerous_sound</a> &amp;sound_b )</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span>( sound_a.<a class="code" href="structdangerous__sound.html#ab3d97dced497d2bda4238f5d388bfc6a">type</a> != sound_b.<a class="code" href="structdangerous__sound.html#ab3d97dced497d2bda4238f5d388bfc6a">type</a> ) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">return</span> sound_a.<a class="code" href="structdangerous__sound.html#ab3d97dced497d2bda4238f5d388bfc6a">type</a> &lt; sound_b.<a class="code" href="structdangerous__sound.html#ab3d97dced497d2bda4238f5d388bfc6a">type</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">return</span> sound_a.<a class="code" href="structdangerous__sound.html#a440dabb5a066d7ca8698a21d5f150565">volume</a> &lt; sound_b.<a class="code" href="structdangerous__sound.html#a440dabb5a066d7ca8698a21d5f150565">volume</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;}</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#acecb5c4379ee38c8382ddfa3c9a1a6d0">  242</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="npcmove_8cpp.html#acecb5c4379ee38c8382ddfa3c9a1a6d0">clear_shot_reach</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;from, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;to, <span class="keywordtype">bool</span> check_ally = <span class="keyword">true</span> )</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;{</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    std::vector&lt;tripoint&gt; path = <a class="code" href="coordinates_8h.html#a31847b31c6ef002e9d16afd7fd0005e3">line_to</a>( from, to );</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    path.pop_back();</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <a class="code" href="classcreature__tracker.html">creature_tracker</a> &amp;creatures = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>();</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p : path ) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="classCreature.html">Creature</a> *inter = creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( p );</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span>( check_ally &amp;&amp; inter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        }</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="omdata_8h.html#a34fa26d94d253aff79aacd4ffbc1505daf5e7a346d6681f66585d00619d9e1d65">impassable</a>( p ) ) {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;}</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160; </div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="classnpc.html#aefc6f0c35c8924b11f291d9daf0f230e">  260</a></span>&#160;<a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="classnpc.html#aefc6f0c35c8924b11f291d9daf0f230e">npc::good_escape_direction</a>( <span class="keywordtype">bool</span> include_pos )</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;{</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    <span class="comment">// if NPC is repositioning rather than fleeing, they do smarter things</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                   <span class="stringliteral">&quot;&lt;color_brown&gt;good_escape_direction&lt;/color&gt; activated by %s&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160; </div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="comment">// To do: Eventually careful_retreat should determine if NPC will go to previously identified</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="comment">// safe locations.  For now it just sends them to a retreat zone if one exists.</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordtype">bool</span> careful_retreat = <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">repositioning</a> || <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> == 0;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">if</span>( !careful_retreat ) {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        careful_retreat = <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &lt; 10 + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="classCharacter.html#a588d5cc1d729490552fe03b006685ae5">get_int</a>();</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        <span class="keywordflow">if</span>( !careful_retreat ) {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>, <span class="stringliteral">&quot;%s is panicking too much to use retreat zones and stuff.&quot;</span>,</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>, <span class="stringliteral">&quot;%s is running away but still being smart about it.&quot;</span>,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        }</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="comment">//if not, consider regrouping on the player if they&#39;re getting far away.</span></div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    <span class="comment">//in the future this should run to the strongest nearby ally, remembered in mem_combat or cached.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="keywordtype">bool</span> run_to_friend = <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">repositioning</a> || <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> == 0;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <span class="keywordflow">if</span>( !run_to_friend ) {</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        run_to_friend = <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &lt; 10 + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">op_of_u</a>.<a class="code" href="structnpc__opinion.html#a3dd84c1d61aba9d6486853542c43dd42">trust</a>;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() &amp;&amp; careful_retreat ) {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                       <span class="stringliteral">&quot;%s doesn&#39;t already have an escape path.  Checking for retreat zone.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <a class="code" href="classstring__id.html">zone_type_id</a> retreat_zone = <a class="code" href="npcmove_8cpp.html#abf2f82354556637a79e1feecad2969b9">zone_type_NPC_RETREAT</a>;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> abs_pos = <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keyword">const</span> <a class="code" href="classzone__manager.html">zone_manager</a> &amp;mgr = <a class="code" href="classzone__manager.html#a54609d51d21bd8f370ee8b59525eb750">zone_manager::get_manager</a>();</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        std::optional&lt;tripoint_abs_ms&gt; retreat_target = mgr.<a class="code" href="classzone__manager.html#aa2c34bee809fc023956ccdc3bc0febb9">get_nearest</a>( retreat_zone, abs_pos, 60,</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                <a class="code" href="classCharacter.html#a16c0c32345164bcdcfe6236977164fd8">fac_id</a> );</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="comment">// if there is a retreat zone in range, go there</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160; </div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="keywordflow">if</span>( retreat_target &amp;&amp; *retreat_target != abs_pos ) {</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s is &lt;/color&gt;&lt;color_brown&gt;repositioning&lt;/color&gt; to %i %i %i&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                           here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *retreat_target ).<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *retreat_target ).<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>,</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                           here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *retreat_target ).<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *retreat_target ) );</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0];</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s did not detect a zone to reposition to, or is too panicked.  Checking to see if there&#39;s an ally.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() &amp;&amp; run_to_friend &amp;&amp; <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;        <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        <span class="keywordtype">int</span> def_radius = <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5c981fdb3be5e8bd1ef605268999b8de">ally_rule::follow_close</a> ) ? <a class="code" href="classnpc.html#a91fd8991b5e867555b74fb3c48891335">follow_distance</a>() : 6;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">if</span>( dist &gt; def_radius ) {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s is repositioning closer to&lt;/color&gt; you&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> destination = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>().<a class="code" href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">pos_bub</a>();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordtype">int</span> loop_avoider = 0;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">while</span>( !<a class="code" href="classnpc.html#a074b34b0dee2182901293c937d523f04">can_move_to</a>( destination.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() ) &amp;&amp; loop_avoider &lt; 10 ) {</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                destination.<a class="code" href="classcoords_1_1coord__point__mut.html#a0fa1f1039d6d6f5b5f744a5d3d039a02">x</a>() += <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -2, 2 );</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                destination.<a class="code" href="classcoords_1_1coord__point__mut.html#a0e6b02267065e16149a37d98991f653e">y</a>() += <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -2, 2 );</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                loop_avoider += 1;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            }</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( destination.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() );</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span>( loop_avoider == 10 ) {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                               <span class="stringliteral">&quot;&lt;color_red&gt;%s had to break out of an infinite loop when looking for a good escape destination&lt;/color&gt;.  This might not be that big a deal but if you&#39;re seeing this a lot, there might be something wrong in good_escape_direction().&quot;</span>,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        }</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                       <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s couldn&#39;t find anywhere preset to reposition to.  Looking for a random location.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    }</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160; </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    std::vector&lt;tripoint&gt; candidates;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> rate_pt = [&amp;]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; pt, <span class="keyword">const</span> <span class="keywordtype">float</span> threat_val ) {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a074b34b0dee2182901293c937d523f04">can_move_to</a>( pt, !<a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5fa494c9a95b3ed02a550c0942ba972a">ally_rule::allow_bash</a> ) ) ) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                           <span class="stringliteral">&quot;&lt;color_dark_gray&gt;%s can&#39;t move to %i, %i, %i. Rate_pt returning absurdly high rating.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, pt.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, pt.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, pt.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a86688811514622ffd567dd7a15f31ebf">MAX_FLOAT</a>;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        }</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordtype">float</span> rating = threat_val;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;e : here.<a class="code" href="classmap.html#a395a729a4b954692cf08d13e1d32f73e">field_at</a>( pt ) ) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#af5c36ca5b43c92f6cb02afb52a448372">is_dangerous_field</a>( e.second ) ) {</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                <span class="comment">// Note, field danger should be rated more specifically than this,</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                <span class="comment">// to distinguish eg fire vs smoke. Probably needs to be handled by field code, not here.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                               <span class="stringliteral">&quot;&lt;color_dark_gray&gt;%s spotted field %s at %i, %i, %i; adding %f to rating&lt;/color&gt;&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                               e.second.name(), pt.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, pt.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, pt.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, e.second.get_field_intensity() );</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                rating += e.second.get_field_intensity();</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            }</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        <span class="keywordflow">return</span> rating;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    };</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160; </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    <span class="keywordtype">float</span> best_rating = include_pos ? rate_pt( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), 0.0f ) : FLT_MAX;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;    candidates.emplace_back( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160; </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;    std::map&lt;direction, float&gt; adj_map;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;    <span class="keywordtype">int</span> num_points_searched = 1;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> pt_dir : <a class="code" href="npc_8h.html#a39cae492faa89ce3a47d7990d249f5bc">npc_threat_dir</a> ) {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> pt = <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() + <a class="code" href="line_8cpp.html#a399f25250fad82fbc37b72a78dfafb43">displace_XY</a>( pt_dir );</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        <span class="keywordtype">float</span> cur_rating = rate_pt( pt, <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a87ae0d72618e5cfa212bab6722d1df45">threat_map</a>[ pt_dir ] );</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;        adj_map[pt_dir] = cur_rating;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keywordflow">if</span>( cur_rating == best_rating ) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s thinks &lt;/color&gt;&lt;color_light_blue&gt;%i, %i, %i&lt;/color&gt;&lt;color_light_gray&gt; is the best retreat spot they&#39;ve seen so far&lt;/color&gt;&lt;color_light_blue&gt; rated %1.2f&lt;/color&gt;&lt;color_light_gray&gt;after checking %i candidates&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, pt.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, pt.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, pt.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, best_rating, num_points_searched );</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            candidates.emplace_back( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() + <a class="code" href="line_8cpp.html#a399f25250fad82fbc37b72a78dfafb43">displace_XY</a>( pt_dir ) );</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cur_rating &lt; best_rating ) {</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 5 ) ) {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>,</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                               <span class="stringliteral">&quot;&lt;color_dark_gray&gt;%s just wants to let you know, esteemed debugger, that they&#39;re still checking escape points but haven&#39;t found any new good ones.  Checked %i.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, num_points_searched );</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            }</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;            candidates.clear();</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            candidates.emplace_back( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() + <a class="code" href="line_8cpp.html#a399f25250fad82fbc37b72a78dfafb43">displace_XY</a>( pt_dir ) );</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            best_rating = cur_rating;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;        }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        num_points_searched += 1;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    ( void )num_points_searched;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> redirect_goal = <a class="code" href="rng_8h.html#a12244355ee77108f1b08618e9962e4d1">random_entry</a>( candidates );</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a>, <span class="stringliteral">&quot;%s is repositioning to %i, %i, %i&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, redirect_goal.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>,</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                   redirect_goal.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, redirect_goal.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="keywordflow">return</span> redirect_goal;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;}</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160; </div>
<div class="line"><a name="l00395"></a><span class="lineno"><a class="line" href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">  395</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">npc::sees_dangerous_field</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p )<span class="keyword"> const</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classCreature.html#a6a4c43d66f5a8b50a879d78682b00976">is_dangerous_fields</a>( <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().field_at( p ) );</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;}</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">  400</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">npc::could_move_onto</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p )<span class="keyword"> const</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    <span class="keywordflow">if</span>( !here.<a class="code" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) ) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    }</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a33eb1760d53a4076bbf192bae1e4209f">move_in_vehicle</a>( <span class="keyword">const_cast&lt;</span><a class="code" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( <span class="keyword">this</span> ), p ) ) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    }</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160; </div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">sees_dangerous_field</a>( p ) ) {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    }</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160; </div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    <span class="keyword">const</span> <a class="code" href="classfield.html">field</a> fields_here = here.<a class="code" href="classmap.html#a395a729a4b954692cf08d13e1d32f73e">field_at</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;e : here.<a class="code" href="classmap.html#a395a729a4b954692cf08d13e1d32f73e">field_at</a>( p ) ) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCreature.html#af5c36ca5b43c92f6cb02afb52a448372">is_dangerous_field</a>( e.second ) ) {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        }</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> *entry_here = fields_here.<a class="code" href="classfield.html#ad45f87597ebb8629628d9f35c238947d">find_field</a>( e.first );</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">if</span>( entry_here == <span class="keyword">nullptr</span> || entry_here-&gt;get_field_intensity() &lt; e.second.get_field_intensity() ) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160; </div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;}</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160; </div>
<div class="line"><a name="l00429"></a><span class="lineno"><a class="line" href="classnpc.html#aa9fa90bedb1b262fe5d2e5832d6915f5">  429</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">npc::could_move_onto</a>( <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> &amp;p )<span class="keyword"> const</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">could_move_onto</a>( p.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() );</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;}</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno"><a class="line" href="classnpc.html#a39b2e456baccd5ed6941ca4a4027860e">  434</a></span>&#160;std::vector&lt;sphere&gt; <a class="code" href="classnpc.html#a39b2e456baccd5ed6941ca4a4027860e">npc::find_dangerous_explosives</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    std::vector&lt;sphere&gt; result;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> active_items = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a0acb4c11e2fd7a3dc7d2f7a8b52c1503">get_active_items_in_radius</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="game__constants_8h.html#a745392436b19cce3012d4d8dc0fe422c">MAX_VIEW_DISTANCE</a>,</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                              <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5a16ec845a09700f77aea693ee40434e73">special_item_type::explosive</a> );</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160; </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> &amp;elem : active_items ) {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keyword">const</span> <a class="code" href="structuse__function.html">use_function</a> *<a class="code" href="classCharacter.html#a1881ce22e9f108fea6ff32da4d4accc2">use</a> = elem-&gt;type-&gt;get_use( <span class="stringliteral">&quot;explosion&quot;</span> );</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160; </div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a1881ce22e9f108fea6ff32da4d4accc2">use</a> ) {</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;        }</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        <span class="keyword">const</span> <a class="code" href="classexplosion__iuse.html">explosion_iuse</a> *actor = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classexplosion__iuse.html">explosion_iuse</a> *<span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#a1881ce22e9f108fea6ff32da4d4accc2">use</a>-&gt;get_actor_ptr() );</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> safe_range = actor-&gt;<a class="code" href="classexplosion__iuse.html#acd5385d9ee934784e54f651f697ac53b">explosion</a>.<a class="code" href="structexplosion__data.html#a467512e7e34c64ddb98ec737368b81cb">safe_range</a>();</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), elem.position() ) &gt;= safe_range ) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <span class="keywordflow">continue</span>;   <span class="comment">// Far enough.</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        }</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160; </div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> turns_to_evacuate = 2 * safe_range / <a class="code" href="classnpc.html#a3053738f4a1e327292e1af7afcd34c9c">speed_rating</a>();</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160; </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="keywordflow">if</span>( elem-&gt;charges &gt; turns_to_evacuate ) {</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">continue</span>;   <span class="comment">// Consider only imminent dangers.</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        }</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160; </div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        result.emplace_back( elem.position(), safe_range );</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;}</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160; </div>
<div class="line"><a name="l00467"></a><span class="lineno"><a class="line" href="classnpc.html#adbdc73d345c21b11ce06ad0be4b126e8">  467</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classnpc.html#adbdc73d345c21b11ce06ad0be4b126e8">npc::evaluate_monster</a>( <span class="keyword">const</span> <a class="code" href="classmonster.html">monster</a> &amp;target, <span class="keywordtype">int</span> dist )<span class="keyword"> const</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> = target.<a class="code" href="classmonster.html#aa726a9074840d376b00a575d4079bcbc">speed_rating</a>();</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordtype">float</span> scaled_distance = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1.0f, dist * dist / ( <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> * 250.0f ) );</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordtype">float</span> hp_percent = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( target.<a class="code" href="classmonster.html#a2d0e466b9d25796cd99402ddd5d3ce20">get_hp</a>() ) / target.<a class="code" href="classmonster.html#a551f4a380282f8ec082c74f410c397de">get_hp_max</a>();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordtype">float</span> diff = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( target.<a class="code" href="classmonster.html#aa30f973bf524ba275ada847f6118b048">type</a>-&gt;<a class="code" href="structmtype.html#a7f92cbd89d3870833c9d5300acb325a1">difficulty</a> ), <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> );</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                   <span class="stringliteral">&quot;&lt;color_yellow&gt;evaluate_monster &lt;/color&gt;&lt;color_dark_gray&gt;%s thinks %s threat level is &lt;color_light_gray&gt;%1.2f&lt;/color&gt;&lt;color_dark_gray&gt; before considering situation.  Speed rating: %1.2f; dist: %i; scaled_distance: %1.0f; HP: %1.0f%%&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, target.<a class="code" href="classmonster.html#aa30f973bf524ba275ada847f6118b048">type</a>-&gt;<a class="code" href="structmtype.html#a9a8f4ead67d1836e3f4db624533af5aa">nname</a>(), diff, <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a>, dist, scaled_distance, hp_percent * 100 );</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="comment">// Note that the danger can pass below &quot;very low&quot; if the monster is weak and far away.</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    diff *= ( hp_percent * 0.5f + 0.5f ) / scaled_distance;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s puts final %s threat level at &lt;/color&gt;%1.2f&lt;color_light_gray&gt; after counting speed, distance, hp&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, target.<a class="code" href="classmonster.html#aa30f973bf524ba275ada847f6118b048">type</a>-&gt;<a class="code" href="structmtype.html#a9a8f4ead67d1836e3f4db624533af5aa">nname</a>(), diff );</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( diff, <a class="code" href="npc_8h.html#ae99b5e394b70686a4ee829b7b8bfb492">NPC_MONSTER_DANGER_MAX</a> );</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;}</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160; </div>
<div class="line"><a name="l00484"></a><span class="lineno"><a class="line" href="classnpc.html#ab22c3f4b5e0ddbf4311313caa003d9ec">  484</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classnpc.html#ab22c3f4b5e0ddbf4311313caa003d9ec">npc::evaluate_character</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;candidate, <span class="keywordtype">bool</span> my_gun, <span class="keywordtype">bool</span> enemy = <span class="keyword">true</span> )</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;{</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordtype">float</span> threat = 0.0f;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <span class="keywordtype">bool</span> candidate_gun = candidate.<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() &amp;&amp; candidate.<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>()-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>();</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;candidate_weap = candidate.<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() ? *candidate.<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() :</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                                 <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>();</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    <span class="keywordtype">double</span> candidate_weap_val = candidate.<a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a>( candidate_weap );</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <span class="keywordtype">float</span> candidate_health =  candidate.<a class="code" href="classCharacter.html#a4f949c2084af2abb310c92c08a8aa1cd">hp_percentage</a>() / 100.0f;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;    <span class="keywordtype">float</span> armour = <a class="code" href="classnpc.html#a1f96488976268ad1990ae03cf7b5fe95">estimate_armour</a>( candidate );</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0.25f, candidate.<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() / 100.0f );</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    <span class="keywordtype">bool</span> is_fleeing = candidate.<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> );</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keywordtype">int</span> perception_inverted = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( ( 20 - <a class="code" href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">get_per</a>() ), 0 );</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a> ) ) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordtype">int</span> bleed_intensity = 0;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classint__id.html">bodypart_id</a> &amp;<a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> : candidate.<a class="code" href="classCreature.html#a4537397ede1aea8ecec28183252aabe3">get_all_body_parts</a>() ) {</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keyword">const</span> <a class="code" href="classeffect.html">effect</a> &amp;bleediness = candidate.<a class="code" href="classCreature.html#aa8d3d8f5a3260c5b54e4973e957f356d">get_effect</a>( <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a>, <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> );</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keywordflow">if</span>( !bleediness.<a class="code" href="classeffect.html#a39ebd2ec5b2faacde7483e0c07240baa">is_null</a>() &amp;&amp; bleediness.<a class="code" href="classeffect.html#a68192c5a91cf7ad4618263ba3de8b802">get_intensity</a>() &gt; perception_inverted / 2 ) {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                <span class="comment">// unlike in evaluate self, NPCs can&#39;t notice bleeding in others unless it&#39;s pretty high.</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                bleed_intensity += bleediness.<a class="code" href="classeffect.html#a68192c5a91cf7ad4618263ba3de8b802">get_intensity</a>();</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;            }</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        candidate_health *= <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1.0f - bleed_intensity / 10.0f, 0.25f );</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                       <span class="stringliteral">&quot;&lt;color_red&gt;%s is bleeeeeeding&lt;/color&gt;, intensity %i&quot;</span>, candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>(), bleed_intensity );</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;    <span class="keywordflow">if</span>( !enemy ) {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;        <span class="keywordflow">if</span>( candidate_gun || ( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; candidate.<a class="code" href="classCreature.html#ac209d32cbfd3774af3d5c0500e2fae52">is_avatar</a>() ) ) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;            <span class="comment">// later we should evaluate if the NPC trusts the player enough to stick to them so reliably</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), candidate.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;            <span class="keywordflow">if</span>( dist &gt; <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a81a2b9ca2aaa184c61d0c005f079c758">formation_distance</a> ) {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a81a2b9ca2aaa184c61d0c005f079c758">formation_distance</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( dist, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a458f36d8f86be518856dfaf972acb8cf">engagement_distance</a> );</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;            }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="keywordflow">if</span>( !my_gun ) {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a>, 0.5f );</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    };</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    threat += my_gun &amp;&amp; enemy ? candidate.<a class="code" href="classCharacter.html#aff7c6ea07bde0a44d9d08b1bacde9064">get_dodge</a>() / 2.0f : candidate.<a class="code" href="classCharacter.html#aff7c6ea07bde0a44d9d08b1bacde9064">get_dodge</a>();</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    threat += armour;</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                   <span class="stringliteral">&quot;&lt;color_cyan&gt;evaluate_character &lt;/color&gt;&lt;color_light_gray&gt;%s assesses %s defense value as %1.2f.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), threat );</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160; </div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    <span class="keywordflow">if</span>( enemy &amp;&amp; candidate_gun &amp;&amp; !my_gun ) {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                       <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s has a gun and %s doesn&#39;t; %s adjusts threat accordingly.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                       candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>(), <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;        candidate_weap_val *= 1.5f;</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;    }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;    threat += candidate_weap_val;</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s assesses %s weapon value as %1.2f.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), candidate_weap_val );</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s assesses&lt;/color&gt; %s threat: %1.2f &lt;color_light_gray&gt;before personality and situation changes.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                   candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), threat );</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;    <span class="keywordflow">if</span>( enemy ) {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;        threat -= <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#aecf2fbbc5fcbda416d381dc0bde6e18c">aggression</a> );</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;        threat +=  <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> );</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    }</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160; </div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    threat *= <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a>;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s scales %s threat by %1.0f%% based on speed.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> * 100.0f );</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    threat *= candidate_health;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s scales %s threat by %1.0f%% based on remaining health.&lt;/color&gt;&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                   candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), candidate_health * 100.0f );</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160; </div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    <span class="keywordflow">if</span>( is_fleeing ) {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        threat *= 0.5f;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                       <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s scales %s threat by 50%% because they&#39;re running away.&lt;/color&gt;&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                       candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ) );</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    }</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s sets &lt;/color&gt;%s threat: %1.2f &lt;color_light_gray&gt;before perception randomization.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                   candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), threat );</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    <span class="comment">// the math for perception fuzz is this way to make it more human readable because I kept making silly errors.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;    <span class="comment">// I hope this helps you too. If not, well, sorry bud.</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;    <span class="comment">// Anyway the higher your perception gets the more accurate and predictable your rating is.</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;    <span class="comment">// this will become more valuable the more skilled we make NPCs at assessing enemies.</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;    <span class="comment">// At time of writing they&#39;re bad at it so this is mostly just me patting myself on the back for adding a cool looking feature.</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;    <span class="keywordtype">int</span> perception_factor = <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -10, 10 ) * perception_inverted;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s randomizes %s threat by %1.1f%% based on perception factor %i.&lt;/color&gt;  Final threat %1.2f&quot;</span>,</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), threat * perception_factor / 1000.0f, perception_factor,</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                   threat +  threat * perception_factor / 1000.0f );</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    threat += threat * perception_factor / 1000.0f;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s assesses &lt;/color&gt;%s final threat: %1.2f&quot;</span>,</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                   candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ),</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                   threat );</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( threat, <a class="code" href="npc_8h.html#ac7e18ce0c0dbb21cd2896172414785f2">NPC_CHARACTER_DANGER_MAX</a> );</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;}</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160; </div>
<div class="line"><a name="l00588"></a><span class="lineno"><a class="line" href="classnpc.html#ab44bba7e06bacb5074d0c2977244622b">  588</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classnpc.html#ab44bba7e06bacb5074d0c2977244622b">npc::evaluate_self</a>( <span class="keywordtype">bool</span> my_gun )</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;{</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    <span class="keywordtype">float</span> threat = 0.0f;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;my_weap_val = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#afce0cfddc9963d26debdc4b77eca431c">my_weapon_value</a>;</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    <span class="comment">// the worse pain the NPC is in, the more likely they are to overestimate the severity of their injuries.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;    <span class="comment">// the more perceptive they are, the more they&#39;re able to see how bad it really is.</span></div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">// Randomize it such that it becomes more swingy as their emotions and pain grow higher.</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordtype">float</span> pain_factor = <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0.0f,</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                             <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="classCreature.html#a71e8440dfb96a7a870c29e0472b7b85d">get_pain</a>() ) / <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">get_per</a>() ) );</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ada16ae9c1fb1fcb76abdcd95af5e13a3">my_health</a> = ( <a class="code" href="classCharacter.html#a4f949c2084af2abb310c92c08a8aa1cd">hp_percentage</a>() - pain_factor ) / 100.0f;</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;    <span class="keywordtype">float</span> armour = <a class="code" href="classnpc.html#a1f96488976268ad1990ae03cf7b5fe95">estimate_armour</a>( <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCharacter.html">Character</a> &amp;<span class="keyword">&gt;</span>( *<span class="keyword">this</span> ) );</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;    <span class="keywordtype">float</span> <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0.5f, <a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() / 100.0f );</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;    <span class="keywordflow">if</span>( my_gun ) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;        <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a>, 0.75f );</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    }</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a> ) ) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;        <span class="keywordtype">int</span> bleed_intensity = 0;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classint__id.html">bodypart_id</a> &amp;<a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> : <a class="code" href="classCreature.html#a4537397ede1aea8ecec28183252aabe3">get_all_body_parts</a>() ) {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <span class="keyword">const</span> <a class="code" href="classeffect.html">effect</a> &amp;bleediness = <a class="code" href="classCreature.html#aa8d3d8f5a3260c5b54e4973e957f356d">get_effect</a>( <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a>, <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> );</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">if</span>( !bleediness.<a class="code" href="classeffect.html#a39ebd2ec5b2faacde7483e0c07240baa">is_null</a>() ) {</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                bleed_intensity += bleediness.<a class="code" href="classeffect.html#a68192c5a91cf7ad4618263ba3de8b802">get_intensity</a>();</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ada16ae9c1fb1fcb76abdcd95af5e13a3">my_health</a> *= <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1.0f - bleed_intensity / 10.0f, 0.25f );</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                       <span class="stringliteral">&quot;&lt;color_red&gt;%s is bleeeeeeding&lt;/color&gt;, intensity %i&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, bleed_intensity );</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ada16ae9c1fb1fcb76abdcd95af5e13a3">my_health</a> &lt; 0.25f ) {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> += 1;</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;        }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160; </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    threat += <a class="code" href="classCharacter.html#aff7c6ea07bde0a44d9d08b1bacde9064">get_dodge</a>();</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    threat += armour;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_green&gt;evaluate_self &lt;/color&gt;&lt;color_light_gray&gt;%s assesses own defense value as %1.2f.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, threat );</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    threat += my_weap_val;</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s assesses own weapon value as %1.2f.&quot;</span>,</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, my_weap_val );</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160; </div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;    threat += <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#aecf2fbbc5fcbda416d381dc0bde6e18c">aggression</a> );</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s updates own threat by %i based on personality.&quot;</span>,</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#aecf2fbbc5fcbda416d381dc0bde6e18c">aggression</a> );</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160; </div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    threat *= <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s scales own threat by %1.0f%% based on speed.&quot;</span>,</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">speed</a> * 100.0f );</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    threat *= <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ada16ae9c1fb1fcb76abdcd95af5e13a3">my_health</a>;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s scales own threat by %1.0f%% based on remaining health (reduced by %1.2f%% due to pain).&lt;/color&gt;  Final value: %1.2f&quot;</span>,</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                   <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ada16ae9c1fb1fcb76abdcd95af5e13a3">my_health</a> * 100.0f, pain_factor, threat );</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;%s assesses own threat as %1.2f&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, threat );</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( threat, <a class="code" href="npc_8h.html#ac7e18ce0c0dbb21cd2896172414785f2">NPC_CHARACTER_DANGER_MAX</a> );</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;}</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160; </div>
<div class="line"><a name="l00649"></a><span class="lineno"><a class="line" href="classnpc.html#a1f96488976268ad1990ae03cf7b5fe95">  649</a></span>&#160;<span class="keywordtype">float</span> <a class="code" href="classnpc.html#a1f96488976268ad1990ae03cf7b5fe95">npc::estimate_armour</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;candidate )<span class="keyword"> const</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordtype">float</span> armour = 0.0f;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="keywordtype">int</span> armour_step;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="keywordtype">int</span> number_of_parts = 0;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classint__id.html">bodypart_id</a> part_id : candidate.<a class="code" href="classCreature.html#a4537397ede1aea8ecec28183252aabe3">get_all_body_parts</a>( <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea5d7454274f566bb1a128ed016e6bc787">get_body_part_flags::only_main</a> ) ) {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        armour_step = 0;</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        number_of_parts += 1;</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        armour_step += candidate.<a class="code" href="classCharacter.html#ab4adbfffca2784d18af7a0d3a4c05453">get_armor_type</a>( <a class="code" href="npcmove_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">damage_bash</a>, part_id );</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        armour_step += candidate.<a class="code" href="classCharacter.html#ab4adbfffca2784d18af7a0d3a4c05453">get_armor_type</a>( <a class="code" href="npcmove_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">damage_cut</a>, part_id );</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        armour_step += candidate.<a class="code" href="classCharacter.html#ab4adbfffca2784d18af7a0d3a4c05453">get_armor_type</a>( <a class="code" href="npcmove_8cpp.html#afdae56eafce50b1f873673574188aca8">damage_stab</a>, part_id );</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        armour_step += candidate.<a class="code" href="classCharacter.html#ab4adbfffca2784d18af7a0d3a4c05453">get_armor_type</a>( <a class="code" href="npcmove_8cpp.html#a35045bcfd0e1c55fb7e9b88d8e36a614">damage_bullet</a>, part_id );</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;                       <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s: %s armour value for %s rated as %i.&lt;/color&gt;&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                       candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), <a class="code" href="bodypart_8cpp.html#ac9aaf0eca53f33436ba15a5b29f68a16">body_part_name</a>( part_id ), armour_step );</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        <span class="keywordflow">if</span>( part_id == <a class="code" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;head&quot;</span> ) || part_id == <a class="code" href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a>( <span class="stringliteral">&quot;torso&quot;</span> ) ) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;            armour_step *= 4;</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;            number_of_parts += 3;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        <span class="comment">// obtain an average value of the 4 armour types we checked.</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;        armour += <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( armour_step ) / 4.0f;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;    armour /= number_of_parts;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s rates &lt;/color&gt;%s total armour value: %1.2f.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                   candidate.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), armour );</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;    <span class="comment">// this is a value we could easily cache.</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="comment">// I don&#39;t know how to do that, I&#39;m supposed to be a writer.</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <span class="keywordflow">return</span> armour;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;}</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a32365a2b41e9af647ec05fbdea50ba90">  682</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="npcmove_8cpp.html#a32365a2b41e9af647ec05fbdea50ba90">too_close</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;critter_pos, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;ally_pos, <span class="keyword">const</span> <span class="keywordtype">int</span> def_radius )</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;{</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( critter_pos, ally_pos ) &lt;= def_radius;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;}</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno"><a class="line" href="structnpc__short__term__cache.html#a7864f427ce6836bdcd50c19d4ae9da6d">  687</a></span>&#160;std::optional&lt;int&gt; <a class="code" href="structnpc__short__term__cache.html#a7864f427ce6836bdcd50c19d4ae9da6d">npc_short_term_cache::closest_enemy_to_friendly_distance</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;    <span class="keywordtype">int</span> distance = INT_MAX;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;buddy : <a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a> ) {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;        <span class="keywordflow">if</span>( buddy.expired() ) {</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        }</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;enemy : <a class="code" href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">hostile_guys</a> ) {</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            <span class="keywordflow">if</span>( enemy.expired() ) {</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;            }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            distance = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( distance, <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( buddy.lock()-&gt;pos(), enemy.lock()-&gt;pos() ) );</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    <span class="keywordflow">if</span>( distance == INT_MAX ) {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;    }</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;    <span class="keywordflow">return</span> distance;</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;}</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160; </div>
<div class="line"><a name="l00707"></a><span class="lineno"><a class="line" href="classnpc.html#a66fcb50d8997cc5410d66dbd9bc7c4df">  707</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a66fcb50d8997cc5410d66dbd9bc7c4df">npc::assess_danger</a>()</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;{</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;    <span class="keywordtype">float</span> highest_priority = 1.0f;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordtype">int</span> hostile_count = 0; <span class="comment">// for tallying nearby threatening enemies</span></div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    <span class="keywordtype">int</span> friendly_count = 1; <span class="comment">// count yourself as a friendly</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;    <span class="keywordtype">int</span> def_radius = <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5c981fdb3be5e8bd1ef605268999b8de">ally_rule::follow_close</a> ) ? <a class="code" href="classnpc.html#a91fd8991b5e867555b74fb3c48891335">follow_distance</a>() : 6;</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;    <span class="keywordtype">bool</span> npc_ranged = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() &amp;&amp; <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>()-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>();</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a08d40b6122ca1dcb1a96007b579b6826">confident_range_cache</a> ) {</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <a class="code" href="classnpc.html#a804d15a6005963a24df4434c8aa1b94e">invalidate_range_cache</a>();</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="comment">// Radius we can attack without moving</span></div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <span class="keywordtype">int</span> max_range = *<a class="code" href="classnpc.html#a08d40b6122ca1dcb1a96007b579b6826">confident_range_cache</a>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="comment">// Radius in which enemy threats are multiplied to avoid surrounding</span></div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordtype">int</span> preferred_medium_range = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( max_range, 8 );</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    preferred_medium_range = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( preferred_medium_range, 15 );</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="comment">// Radius in which enemy threats are hugely multiplied to encourage repositioning</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    <span class="keywordtype">int</span> preferred_close_range = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( max_range, 1 );</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;    preferred_close_range = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( preferred_close_range, preferred_medium_range / 2 );</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160; </div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordtype">bool</span> sees_player = <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> self_defense_only = <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a9eb4400a0210e0a41692a3c6635855f1">engagement</a> == <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa0e7cb16e5f3f61cb0c04b64d5cf5d7c8">combat_engagement::NO_MOVE</a> ||</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;                                   <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a9eb4400a0210e0a41692a3c6635855f1">engagement</a> == <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caab50339a10e1de285ac99d4c3990b8693">combat_engagement::NONE</a>;</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> no_fighting = <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7aa76dfd34a015e77b9101e83caf2babca">ally_rule::forbid_engage</a> );</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> must_retreat = <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5c981fdb3be5e8bd1ef605268999b8de">ally_rule::follow_close</a> ) &amp;&amp;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                              !<a class="code" href="npcmove_8cpp.html#a32365a2b41e9af647ec05fbdea50ba90">too_close</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="classnpc.html#a91fd8991b5e867555b74fb3c48891335">follow_distance</a>() ) &amp;&amp;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                              !<a class="code" href="classnpc.html#a983183e0a5423f3d339b1ef8e07e7d2d">is_guarding</a>();</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a9eb4400a0210e0a41692a3c6635855f1">engagement</a> == <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caabb0dbce1d639f9d5573a041e92d732d0">combat_engagement::FREE_FIRE</a> ) {</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            def_radius = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 6, max_range );</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( self_defense_only ) {</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            def_radius = max_range;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( no_fighting ) {</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            def_radius = 1;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a458f36d8f86be518856dfaf972acb8cf">engagement_distance</a> = def_radius;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> ok_by_rules = [max_range, def_radius, <span class="keyword">this</span>, &amp;player_character]( <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> &amp; <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>,</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    <span class="keywordtype">int</span> dist, <span class="keywordtype">int</span> scaled_dist ) {</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="comment">// If we&#39;re forbidden to attack, no need to check engagement rules</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7aa76dfd34a015e77b9101e83caf2babca">ally_rule::forbid_engage</a> ) ) {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        }</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <span class="keywordflow">switch</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a9eb4400a0210e0a41692a3c6635855f1">engagement</a> ) {</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caab50339a10e1de285ac99d4c3990b8693">combat_engagement::NONE</a>:</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa7286293c9125ac7d7bace94c190bc16d">combat_engagement::CLOSE</a>:</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                <span class="comment">// Either close to player or close enough that we can reach it and close to us</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                <span class="keywordflow">return</span> ( dist &lt;= max_range &amp;&amp; scaled_dist &lt;= def_radius * 0.5 ) ||</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                       <a class="code" href="npcmove_8cpp.html#a32365a2b41e9af647ec05fbdea50ba90">too_close</a>( <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.pos(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), def_radius );</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa32c7d8943bec86a6d7d5e03598670ca8">combat_engagement::WEAK</a>:</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_hp() &lt;= <a class="code" href="classnpc.html#a0764f3bbdc903b94bf57fdc2b75cd3e9">average_damage_dealt</a>();</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa4e5e3542d523b7fb9c61887d5bb7d642">combat_engagement::HIT</a>:</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.has_effect( <a class="code" href="npcmove_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a> );</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa0e7cb16e5f3f61cb0c04b64d5cf5d7c8">combat_engagement::NO_MOVE</a>:</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caabb0dbce1d639f9d5573a041e92d732d0">combat_engagement::FREE_FIRE</a>:</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                <span class="keywordflow">return</span> dist &lt;= max_range;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa5fb1f955b45e38e31789286a1790398d">combat_engagement::ALL</a>:</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;    };</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;    std::map&lt;direction, float&gt; cur_threat_map;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;    <span class="comment">// start with a decayed version of last turn&#39;s map</span></div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> threat_dir : <a class="code" href="npc_8h.html#a39cae492faa89ce3a47d7990d249f5bc">npc_threat_dir</a> ) {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        cur_threat_map[ threat_dir ] = 0.25f * <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a87ae0d72618e5cfa212bab6722d1df45">threat_map</a>[ threat_dir ];</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;    <span class="comment">// cache string_id -&gt; int_id conversion before hot loop</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;    <span class="keyword">const</span> <a class="code" href="classint__id.html">field_type_id</a> <a class="code" href="field__type_8cpp.html#a0090428c1f6724209c133c6b04b037cd">fd_fire</a> = <a class="code" href="field__type_8cpp.html#a0090428c1f6724209c133c6b04b037cd">::fd_fire</a>;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;    <span class="comment">// first, check if we&#39;re about to be consumed by fire</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;    <span class="comment">// `map::get_field` uses `field_cache`, so in general case (no fire) it provides an early exit</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;pt : here.<a class="code" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), 6 ) ) {</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        <span class="keywordflow">if</span>( pt == <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() || !here.<a class="code" href="classmap.html#a30cfefdb115c16c5e1af6cc99f94bbbd">get_field</a>( pt, <a class="code" href="field__type_8cpp.html#a0090428c1f6724209c133c6b04b037cd">fd_fire</a> ) ||</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            here.<a class="code" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af750a4c95295d69ca74da7e774111bfb">ter_furn_flag::TFLAG_FIRE_CONTAINER</a>,  pt ) ) {</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;        }</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;        <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), pt );</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        cur_threat_map[<a class="code" href="coordinates_8h.html#a70d5706d5a84c7c1953498fa0c651b3e">direction_from</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), pt )] += 2.0f * ( <a class="code" href="npc_8h.html#ae99b5e394b70686a4ee829b7b8bfb492">NPC_MONSTER_DANGER_MAX</a> - dist );</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        <span class="keywordflow">if</span>( dist &lt; 3 &amp;&amp; !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a> ) ) {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;            <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;fire_bad&quot;</span>, 1_minutes );</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            <a class="code" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a>, 5_turns );</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160; </div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <span class="comment">// find our Character friends and enemies</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> clairvoyant = <a class="code" href="classCharacter.html#a637b69da1eaea75f12d248d14c939703">clairvoyance</a>();</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classnpc.html">npc</a> &amp;guy : <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;all_npcs() ) {</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        <span class="keywordflow">if</span>( &amp;guy == <span class="keyword">this</span> ) {</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;        <span class="keywordflow">if</span>( !clairvoyant &amp;&amp; !here.<a class="code" href="classmap.html#a5b4d4347883c3f0f622b2a0d9ca65b93">has_potential_los</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), guy.pos() ) ) {</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;        }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160; </div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5f6abf15a7e7de731322b31ece25d127">has_faction_relationship</a>( guy, <a class="code" href="namespacenpc__factions.html#af09ec48d0dc133795062d1424c486686a9d921e2d3b4862cddd420c437da1434e">npc_factions::watch_your_back</a> ) ) {</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( guy ) );</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a06abd7ca2094ae40ba3aa9dbd53311e4">attitude_to</a>( guy ) != <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217a31ba17aa58cdb681423f07ca21a6efc7">Attitude::NEUTRAL</a> &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( guy.pos() ) ) {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">hostile_guys</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( guy ) );</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        }</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;    }</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a8726121e70cd1ce0d351a926de30fcc1">is_friendly</a>( player_character ) &amp;&amp; sees_player ) {</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( player_character ) );</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( sees_player &amp;&amp; <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character ) ) {</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="comment">// Unlike allies, hostile npcs should not see invisible players</span></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">hostile_guys</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( player_character ) );</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    }</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160; </div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classmonster.html">monster</a> &amp;critter : <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;all_monsters() ) {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">if</span>( !clairvoyant &amp;&amp; !here.<a class="code" href="classmap.html#a5b4d4347883c3f0f622b2a0d9ca65b93">has_potential_los</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), critter.pos() ) ) {</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;        <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217">Creature::Attitude</a> att = critter.attitude_to( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;        <span class="keywordflow">if</span>( att == <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217af6a34a956d1ce0a552bf4731b9f9d9c0">Attitude::FRIENDLY</a> ) {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( critter ) );</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;            friendly_count += 1;</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        }</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">if</span>( att != <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747">Attitude::HOSTILE</a> &amp;&amp; ( critter.friendly || !<a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ) ) {</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa9c845dc2b489b53e1b4bd5121fb99c7">neutral_guys</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( critter ) );</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( critter ) ) {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        }</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">hostile_guys</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( critter ) );</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        <span class="comment">// warn and consider the odds for distant enemies</span></div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), critter.pos() );</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;        <span class="keywordtype">float</span> critter_threat = <a class="code" href="classnpc.html#adbdc73d345c21b11ce06ad0be4b126e8">evaluate_monster</a>( critter, dist );</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        <span class="comment">// ignore targets behind glass even if we can see them</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="npcmove_8cpp.html#acecb5c4379ee38c8382ddfa3c9a1a6d0">clear_shot_reach</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), critter.pos(), <span class="keyword">false</span> ) ) {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() || !critter.friendly ) {</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;                <span class="comment">// still warn about enemies behind impassable glass walls, but not as often.</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                               <span class="stringliteral">&quot;%s ignored %s because there&#39;s an obstacle in between.  Might warn about it.&quot;</span>,</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, critter.type-&gt;nname() );</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                <span class="keywordflow">if</span>( critter_threat &gt; 2 * ( 8.0f + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, 5 ) ) ) {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                    <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;monster&quot;</span>, 10_minutes, critter.type-&gt;nname(), dist, critter.pos() );</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;                               <span class="stringliteral">&quot;%s ignored %s because there&#39;s an obstacle in between, and it&#39;s not worth warning about.&quot;</span>,</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, critter.type-&gt;nname() );</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;            }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        }</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() || !critter.friendly ) {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> += critter_threat;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="keywordflow">if</span>( critter_threat &gt; ( 8.0f + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, 5 ) ) ) {</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;                <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;monster&quot;</span>, 10_minutes, critter.type-&gt;nname(), dist, critter.pos() );</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keywordflow">if</span>( dist &lt; preferred_medium_range ) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                hostile_count += 1;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                               <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s added %s to nearby hostile count.  Total: %i&lt;/color&gt;&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                               critter.type-&gt;nname(), hostile_count );</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            <span class="keywordflow">if</span>( dist &lt;= preferred_close_range ) {</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a> += 1;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;                               <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s added %s to swarm count.  Total: %i&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, critter.type-&gt;nname(), <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a> );</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            }</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        }</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        <span class="keywordflow">if</span>( must_retreat || no_fighting ) {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160; </div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>,</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                       <span class="stringliteral">&quot;%s assessed threat of critter %s as %1.2f.&quot;</span>,</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, critter.type-&gt;nname(), critter_threat );</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a30e9e46d0c2222553b591a4f5ed1a3ad">total_danger</a> += critter_threat;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        <span class="keywordtype">float</span> scaled_distance = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1.0f, dist / critter.speed_rating() );</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160; </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        <span class="comment">// don&#39;t ignore monsters that are too close or too close to an ally if we can move</span></div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;        <span class="keywordtype">bool</span> is_too_close = dist &lt;= def_radius;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;guy : <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a> ) {</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;            <span class="keywordflow">if</span>( is_too_close || self_defense_only ) {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            }</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            <span class="comment">// HACK: Bit of a dirty hack - sometimes shared_from, returns nullptr or bad weak_ptr for</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            <span class="comment">// friendly NPC when the NPC is riding a creature - I don&#39;t know why.</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;            <span class="comment">// so this skips the bad weak_ptrs, but this doesn&#39;t functionally change the AI Priority</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            <span class="comment">// because the horse the NPC is riding is still in the ai_cache.friends vector,</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="comment">// so either one would count as a friendly for this purpose.</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            <span class="keywordflow">if</span>( guy.lock() ) {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                is_too_close |= <a class="code" href="npcmove_8cpp.html#a32365a2b41e9af647ec05fbdea50ba90">too_close</a>( critter.pos(), guy.lock()-&gt;pos(), def_radius );</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            }</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <span class="comment">// ignore distant monsters that our rules prevent us from attacking</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">if</span>( !is_too_close &amp;&amp; <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; !ok_by_rules( critter, dist, scaled_distance ) ) {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        }</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="comment">// prioritize the biggest, nearest threats, or the biggest threats that are threatening</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="comment">// us or an ally</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;        <span class="keywordtype">float</span> priority = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( critter_threat - 2.0f * ( scaled_distance - 1.0f ),</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                                   is_too_close ? critter_threat : 0.0f );</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        cur_threat_map[<a class="code" href="coordinates_8h.html#a70d5706d5a84c7c1953498fa0c651b3e">direction_from</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), critter.pos() )] += priority;</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">if</span>( priority &gt; highest_priority ) {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            highest_priority = priority;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">target</a> = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( critter );</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">danger</a> = critter_threat;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        }</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;    }</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160; </div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> == 0.0 &amp;&amp; <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">hostile_guys</a>.empty() ) {</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &gt; 0 ) {</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> -= 1;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af43fa626222f6d28f052da61973043b3">danger_assessment</a> = <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>;</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    }</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160; </div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <span class="comment">// Warn about sufficiently risky nearby hostiles</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> handle_hostile = [&amp;]( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp; foe, <span class="keywordtype">float</span> foe_threat,</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;    <span class="keyword">const</span> std::string &amp; bogey, <span class="keyword">const</span> std::string &amp; warning ) {</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;        <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), foe.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;        <span class="comment">// ignore targets behind glass even if we can see them</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="npcmove_8cpp.html#acecb5c4379ee38c8382ddfa3c9a1a6d0">clear_shot_reach</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), foe.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="keyword">false</span> ) ) {</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;            <span class="comment">// still warn about enemies behind impassable glass walls, but not as often.</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            <span class="comment">// since NPC threats have a higher chance of ignoring soft obstacles, we&#39;ll ignore them here.</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            <span class="keywordflow">if</span>( foe_threat &gt; 2 * ( 8.0f + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, 5 ) ) ) {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;monster&quot;</span>, 10_minutes, bogey, dist, foe.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>, <span class="stringliteral">&quot;%s ignored %s because there&#39;s an obstacle in between.&quot;</span>,</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, bogey );</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        }</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;        <span class="keywordflow">if</span>( foe_threat &gt; ( 8.0f + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> + <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, 5 ) ) ) {</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;monster&quot;</span>, 10_minutes, bogey, dist, foe.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keywordtype">int</span> scaled_distance = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1, ( 100 * dist ) / foe.<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a30e9e46d0c2222553b591a4f5ed1a3ad">total_danger</a> += foe_threat / scaled_distance;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        <span class="keywordflow">if</span>( must_retreat || no_fighting ) {</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;            <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;        }</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;        <span class="keywordtype">bool</span> is_too_close = dist &lt;= def_radius;</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;guy : <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a> ) {</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;            <span class="keywordflow">if</span>( self_defense_only ) {</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            }</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            is_too_close |= <a class="code" href="npcmove_8cpp.html#a32365a2b41e9af647ec05fbdea50ba90">too_close</a>( foe.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), guy.lock()-&gt;pos(), def_radius );</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            <span class="keywordflow">if</span>( is_too_close ) {</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;        }</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160; </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() || is_too_close || ok_by_rules( foe, dist, scaled_distance ) ) {</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <span class="keywordtype">float</span> priority = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( foe_threat - 2.0f * ( scaled_distance - 1 ),</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                       is_too_close ? <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( foe_threat, <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> ) :</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                                       0.0f );</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            cur_threat_map[<a class="code" href="coordinates_8h.html#a70d5706d5a84c7c1953498fa0c651b3e">direction_from</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), foe.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() )] += priority;</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;            <span class="keywordflow">if</span>( priority &gt; highest_priority ) {</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( warning, 1_minutes );</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;                highest_priority = priority;</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">danger</a> = foe_threat;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">target</a> = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( foe );</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            }</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;        }</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                       <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s assessed threat of enemy %s as %1.2f.  With distance vs speed ratio %i, final relative threat is &lt;/color&gt;&lt;color_red&gt;%1.2f&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, bogey, foe_threat, scaled_distance, foe_threat / scaled_distance );</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;        <span class="keywordflow">return</span> foe_threat;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;    };</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160; </div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160; </div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;guy : <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">hostile_guys</a> ) {</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <a class="code" href="classCharacter.html">Character</a> *foe = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classCharacter.html">Character</a> *<span class="keyword">&gt;</span>( guy.lock().get() );</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <span class="keywordflow">if</span>( foe &amp;&amp; foe-&gt;<a class="code" href="classCharacter.html#a8f914d66d3d996a1356a31caf1d44c13">is_npc</a>() ) {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> += handle_hostile( *foe, <a class="code" href="classnpc.html#ab22c3f4b5e0ddbf4311313caa003d9ec">evaluate_character</a>( *foe, npc_ranged ),</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                                       <a class="code" href="translations_8h.html#a0b3ab525ec6b450b2487e7644255fa7c">translate_marker</a>( <span class="stringliteral">&quot;bandit&quot;</span> ),</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                       <span class="stringliteral">&quot;kill_npc&quot;</span> );</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        }</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;    }</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                   <span class="stringliteral">&quot;Before checking allies+player, %s assesses danger level as &lt;color_light_red&gt;%1.2f&lt;/color&gt;.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                   <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> );</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast&lt;Creature&gt;</a> &amp;guy : <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a> ) {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;        <span class="keywordflow">if</span>( !( guy.lock() &amp;&amp; guy.lock()-&gt;is_npc() ) ) {</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        <span class="keywordtype">float</span> guy_threat = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( <a class="code" href="classnpc.html#ab22c3f4b5e0ddbf4311313caa003d9ec">evaluate_character</a>( <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCharacter.html">Character</a> &amp;<span class="keyword">&gt;</span>( *guy.lock() ),</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                                     npc_ranged, <span class="keyword">false</span> ), <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> );</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> += guy_threat * 0.5f;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                       <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s assessed friendly %s at threat level &lt;/color&gt;&lt;color_light_blue&gt;%1.2f.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, guy.lock()-&gt;disp_name(), guy_threat );</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;    }</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;                   <span class="stringliteral">&quot;Total of &lt;color_green&gt;%s NPC ally threat&lt;/color&gt;: &lt;color_light_green&gt;%1.2f&lt;/color&gt;.&quot;</span>,</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> );</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160; </div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;    <span class="keywordflow">if</span>( sees_player ) {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;        <span class="comment">// Mod for the player&#39;s danger level, weight it higher if player is very close</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;        <span class="comment">// When the player is almost adjacent, it can exceed max danger ratings, so the</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        <span class="comment">// NPC will try hard not to break and run while in formation.</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="comment">// This code should eventually remove the &#39;player&#39; special case and be applied to</span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;        <span class="comment">// whoever the NPC perceives as their closest leader.</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        <span class="keywordtype">float</span> player_diff = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( <a class="code" href="classnpc.html#ab22c3f4b5e0ddbf4311313caa003d9ec">evaluate_character</a>( player_character, npc_ranged, <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ),</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;                                      <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> );</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ) {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s identified player as an&lt;/color&gt; &lt;color_red&gt;enemy&lt;/color&gt; &lt;color_light_gray&gt;of threat level %1.2f&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, player_diff );</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> += handle_hostile( player_character, player_diff,</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                                       <a class="code" href="translations_8h.html#a0b3ab525ec6b450b2487e7644255fa7c">translate_marker</a>( <span class="stringliteral">&quot;maniac&quot;</span> ),</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                                       <span class="stringliteral">&quot;kill_player&quot;</span> );</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a8726121e70cd1ce0d351a926de30fcc1">is_friendly</a>( player_character ) ) {</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s identified player as a &lt;/color&gt;&lt;color_green&gt;friend&lt;/color&gt;&lt;color_light_gray&gt; of threat level %1.2f (ily babe)&quot;</span>,</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, player_diff );</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;            <span class="keywordflow">if</span>( dist &lt;= 3 ) {</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                player_diff = player_diff * ( 4 - dist ) / 2;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a> /= ( 4 - dist );</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> += player_diff;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                               <span class="stringliteral">&quot;&lt;color_green&gt;Player is %i tiles from %s.&lt;/color&gt;&lt;color_light_gray&gt;  Adding &lt;/color&gt;&lt;color_light_green&gt;%1.2f to ally strength&lt;/color&gt;&lt;color_light_gray&gt; and bolstering morale.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                               dist, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                               player_diff );</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                <span class="comment">// don&#39;t try to fall back with your ranged weapon if you&#39;re in formation with the player.</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &gt; 0 &amp;&amp; <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( dist ) ) {</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> -= 1;</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                }</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                friendly_count += 4 - dist; <span class="comment">// when close to the player, weight enemy groups less.</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                               <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s sees friendly player,&lt;/color&gt; &lt;color_light_green&gt;adding %1.2f&lt;/color&gt;&lt;color_light_gray&gt; to ally strength.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, player_diff * 0.5f );</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> += player_diff * 0.5f;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;            }</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a>.emplace_back( <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( player_character ) );</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;        }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;    }</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                   <span class="stringliteral">&quot;&lt;color_light_blue&gt;After checking player&lt;/color&gt;&lt;color_light_gray&gt;, %s assesses enemy level as &lt;/color&gt;&lt;color_yellow&gt;%1.2f&lt;/color&gt;&lt;color_light_gray&gt;, ally level at &lt;/color&gt;&lt;color_light_green&gt;%1.2f&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> );</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160; </div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    <span class="comment">// gotta rename cowardice modifier now.</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    <span class="comment">// This bit scales the assessments of enemies and allies so that the NPC weights their own skills a little higher.</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    <span class="comment">// It&#39;s likely to get deprecated in a while?</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> *= <a class="code" href="npc_8h.html#a6d922675388ced5c1cbddc237cc9e909">NPC_COWARDICE_MODIFIER</a>;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;    <span class="comment">//Figure our own health more heavily here, because it doens&#39;t matter how tough our friends are if we&#39;re dying.</span></div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> *= <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ada16ae9c1fb1fcb76abdcd95af5e13a3">my_health</a> * <a class="code" href="npc_8h.html#a6d922675388ced5c1cbddc237cc9e909">NPC_COWARDICE_MODIFIER</a>;</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160; </div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="comment">// Swarm assessment.  Do a flat scale up your assessment if you&#39;re outnumbered.</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="comment">// Hostile_count counts enemies within a range of 8 who exceed the NPC&#39;s bravery, mitigated</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="comment">// how much pain they&#39;re currently experiencing. This means a very brave NPC might ignore</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    <span class="comment">// large crowds of minor creatures, until they start getting hurt.</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    <span class="keywordflow">if</span>( hostile_count &gt; friendly_count ) {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> *= <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( hostile_count / <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( friendly_count ), 1.0f );</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                       <span class="stringliteral">&quot;Crowd adjustment: &lt;color_light_gray&gt;%s set danger level to &lt;/color&gt;%1.2f&lt;color_light_gray&gt; after counting &lt;/color&gt;&lt;color_yellow&gt;%i major hostiles&lt;/color&gt;&lt;color_light_gray&gt; vs &lt;/color&gt;&lt;color_light_green&gt;%i friendlies.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>, hostile_count, friendly_count );</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;    }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160; </div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> ) &amp;&amp; !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a> ) ) {</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;        <span class="keywordtype">float</span> my_diff = <a class="code" href="classnpc.html#ab44bba7e06bacb5074d0c2977244622b">evaluate_self</a>( npc_ranged ) * 0.5f;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                       <span class="stringliteral">&quot;%s assesses own final strength as %1.2f.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, my_diff );</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> += my_diff;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                       <span class="stringliteral">&quot;%s rates total &lt;color_yellow&gt;enemy strength %1.2f&lt;/color&gt;, &lt;color_light_green&gt;ally strength %1.2f&lt;/color&gt;.&quot;</span>,</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> );</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;Enemy Danger: %1f, Ally Strength: %2f.&quot;</span>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>,</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                       <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> );</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    }</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="comment">// update the threat cache</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; 8; i++ ) {</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;        <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> threat_dir = <a class="code" href="npc_8h.html#a39cae492faa89ce3a47d7990d249f5bc">npc_threat_dir</a>[i];</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;        <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> dir_right = <a class="code" href="npc_8h.html#a39cae492faa89ce3a47d7990d249f5bc">npc_threat_dir</a>[( i + 1 ) % 8];</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;        <a class="code" href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a> dir_left = <a class="code" href="npc_8h.html#a39cae492faa89ce3a47d7990d249f5bc">npc_threat_dir</a>[( i + 7 ) % 8 ];</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a87ae0d72618e5cfa212bab6722d1df45">threat_map</a>[threat_dir] = cur_threat_map[threat_dir] + 0.1f *</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                                          ( cur_threat_map[dir_right] + cur_threat_map[dir_left] );</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> &lt;= 2.0f ) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af43fa626222f6d28f052da61973043b3">danger_assessment</a> = -10.0f + 5.0f *</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                                     <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>; <span class="comment">// Low danger if no monsters around</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af43fa626222f6d28f052da61973043b3">danger_assessment</a> = <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>;</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    }</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;}</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"><a class="line" href="classnpc.html#a3740f4479ecfacc0afa8c938ba1ffcd7"> 1101</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a3740f4479ecfacc0afa8c938ba1ffcd7">npc::act_on_danger_assessment</a>()</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;{</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;    <span class="keywordtype">bool</span> npc_ranged = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() &amp;&amp; <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>()-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>();</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;    <span class="keywordtype">bool</span> failed_reposition = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> ) ) {</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;        <span class="comment">// this check runs each turn that the NPC is repositioning and assesses if the situation is getting any better.</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;        <span class="comment">// The longer they try to move without improving, the more likely they become to stop and stand their ground.</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> melee_reposition_fail = !npc_ranged &amp;&amp;</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                                           <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72b701249a501577ea69e5f9ede00642">assessment_before_repos</a> + <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, 5 ) &lt;= <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a>;</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> range_reposition_fail = npc_ranged &amp;&amp;</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                                           <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72b701249a501577ea69e5f9ede00642">assessment_before_repos</a> * <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a> + <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0,</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                                                   5 ) &lt;= <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> * <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a>;</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        <span class="keywordflow">if</span>( melee_reposition_fail || range_reposition_fail ) {</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_red&gt;%s tried to reposition last turn, and the situation has not improved.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            failed_reposition = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">failing_to_reposition</a> += 1;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_green&gt;%s tried to reposition last turn, and it worked out!&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">failing_to_reposition</a> = 0;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;        }</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;    }</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> ) &amp;&amp; !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a> ) ) {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72b701249a501577ea69e5f9ede00642">assessment_before_repos</a> = <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">std::round</a>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> );</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> &lt; <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> ) {</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;            <span class="comment">// Each time NPC decides to run away, their panic increases, which increases likelihood</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;            <span class="comment">// and duration of running away.</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;            <span class="comment">// if they run to a more advantageous position, they&#39;ll reassess and rally.</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;            <a class="code" href="classtime__duration.html">time_duration</a> run_away_for = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 2_turns + 1_turns * <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a>, 20_turns );</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160; </div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae1e5a82ac8cb44fbad27d315a73f1acb">reposition_countdown</a> &lt;= 0 ) {</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                               <span class="stringliteral">&quot;%s decides to reposition.  Has not yet decided to flee.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">repositioning</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                <a class="code" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a>, run_away_for );</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>, <span class="stringliteral">&quot;%s still wants to reposition, but they just tried.&quot;</span>,</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;            }</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> *= ( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> / ( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> + 0.5f ) );</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> += <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>(</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                                    <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 1, 3 ) + ( <a class="code" href="classCreature.html#a71e8440dfb96a7a870c29e0472b7b85d">get_pain</a>() / 5 ) - <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a>, 1 );</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> - <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> &gt;= <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">failing_to_reposition</a> ) {</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                <span class="comment">// NPC hasn&#39;t yet failed to get away</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>, <span class="stringliteral">&quot;%s upgrades reposition to flat out retreat.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">repositioning</a> = <span class="keyword">false</span>; <span class="comment">// we&#39;re not just moving, we&#39;re running.</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;run_away&quot;</span>, run_away_for );</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &gt; 5 &amp;&amp; <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                    <span class="comment">// consider warning player about panic</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                    <span class="keywordtype">int</span> panic_alert = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) - player_character.<a class="code" href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">get_per</a>();</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> - <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> &gt; panic_alert ) {</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                        <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 4 ) &amp;&amp; <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &lt; 10 + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> ) {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s is starting to panic a bit.&quot;</span> ), <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &gt;= 10 + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> ) {</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;                            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s is panicking!&quot;</span> ), <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;                        }</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;                    }</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;                }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;            }</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( failed_reposition ||</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;                   ( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> &lt; <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> * <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a> ) ) {</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;                           <span class="stringliteral">&quot;&lt;color_light_gray&gt;%s considers &lt;/color&gt;repositioning&lt;color_light_gray&gt; from swarming enemies.&lt;/color&gt;&quot;</span>,</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;            <span class="keywordflow">if</span>( failed_reposition ) {</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>, <span class="stringliteral">&quot;%s failed repositioning, trying again.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">failing_to_reposition</a>++;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;                <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>,</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;                               <span class="stringliteral">&quot;%s decided to reposition/kite due to %i nearby enemies.&quot;</span>,</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                               <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a> );</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;            }</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">repositioning</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;            <span class="comment">// you chose not to run, but there are enough of them coming in that you should probably back away a bit.</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160; </div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            <a class="code" href="classtime__duration.html">time_duration</a> run_away_for = 2_turns;</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;            <a class="code" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a>, run_away_for );</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            <span class="comment">// Things seem to be going okay, reset/reduce &quot;worry&quot; memories.</span></div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> &gt; 0 ) {</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> -= 1;</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;            }</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">failing_to_reposition</a> = 0;</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;        }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> );</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>, <span class="stringliteral">&quot;%s &lt;color_magenta&gt;panic level&lt;/color&gt; is up to %i.&quot;</span>,</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                   <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> );</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">failing_to_reposition</a> &gt; 2 &amp;&amp; <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> ) &amp;&amp;</div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;        !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a> ) ) {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;        <span class="comment">// NPC is fleeing, but hasn&#39;t been able to reposition safely.</span></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;        <span class="comment">// Consider cancelling fleeing.</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;        <span class="comment">// Note that panic will still increment prior to this, and a truly panicked NPC will not stand and fight for any reason.</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">panic</a> - <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> &lt; <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">failing_to_reposition</a> ) {</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a>, <span class="stringliteral">&quot;%s decided running away was futile.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae1e5a82ac8cb44fbad27d315a73f1acb">reposition_countdown</a> = 4;</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <a class="code" href="classCreature.html#a1c6d98c5a339561c989ba3e1ca34eeb8">remove_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> );</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;            <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;        }</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    }</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;}</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160; </div>
<div class="line"><a name="l01210"></a><span class="lineno"><a class="line" href="classnpc.html#aa8fd6069a77516d0fec45248f9069345"> 1210</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#aa8fd6069a77516d0fec45248f9069345">npc::is_safe</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a30e9e46d0c2222553b591a4f5ed1a3ad">total_danger</a> &lt;= 0;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;}</div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01215"></a><span class="lineno"><a class="line" href="classnpc.html#a01b95be72400ef6e5b659c34f634bcfd"> 1215</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a01b95be72400ef6e5b659c34f634bcfd">npc::regen_ai_cache</a>()</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;{</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <span class="keyword">auto</span> i = std::begin( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a> );</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    <a class="code" href="classcreature__tracker.html">creature_tracker</a> &amp;creatures = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>();</div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code" href="npcmove_8cpp.html#ae392542982be57abf21e9253ea942d4e">trait_RETURN_TO_START_POS</a> ) ) {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> ) {</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> = <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;        }</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    }</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <span class="keywordflow">while</span>( i != <a class="code" href="namespacekeycode.html#a16ca776f0df120afb4f1b16a92e2d7f7aa6efe66b8fc51ca203d5f0015d983eac">std::end</a>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a> ) ) {</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( i-&gt;abs_pos ) ) ) {</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;            <span class="comment">// if they were responding to a call for guards because of thievery</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;            <a class="code" href="classnpc.html">npc</a> *<span class="keyword">const</span> sound_source = creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>&lt;<a class="code" href="classnpc.html">npc</a>&gt;( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( i-&gt;abs_pos ) );</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;            <span class="keywordflow">if</span>( sound_source ) {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#af8ad769685d160f275ead29362360de1">my_fac</a> == sound_source-&gt;<a class="code" href="classCharacter.html#af8ad769685d160f275ead29362360de1">my_fac</a> &amp;&amp; sound_source-&gt;<a class="code" href="classnpc.html#ac4e1ed70f31d88db8ea95fadad468784">known_stolen_item</a> ) {</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                    sound_source-&gt;<a class="code" href="classnpc.html#ac4e1ed70f31d88db8ea95fadad468784">known_stolen_item</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                    <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a9ccd3ddb03edb6e10f0987b46ffbcc53">NPCATT_RECOVER_GOODS</a> );</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;            }</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            i = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.erase( i );</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.size() == 1 ) {</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;            }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;            ++i;</div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        }</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;    }</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;    <span class="keywordtype">float</span> old_assessment = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af43fa626222f6d28f052da61973043b3">danger_assessment</a>;</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a>.clear();</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">hostile_guys</a>.clear();</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa9c845dc2b489b53e1b4bd5121fb99c7">neutral_guys</a>.clear();</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">target</a> = <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a>();</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa0a891ed2c8f48d72ddb341986bd3463">ally</a> = <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a>();</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a>.<a class="code" href="structhealing__options.html#a8c7e48cc7294f8a08563eeb4874c070e">clear_all</a>();</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">danger</a> = 0.0f;</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a30e9e46d0c2222553b591a4f5ed1a3ad">total_danger</a> = 0.0f;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;    <a class="code" href="classitem.html">item</a> &amp;<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() ? *<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() : <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>();</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#afce0cfddc9963d26debdc4b77eca431c">my_weapon_value</a> = <a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a>( <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> );</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0f00a09e500a57a83a2eb5a92b79626a">dangerous_explosives</a> = <a class="code" href="classnpc.html#a39b2e456baccd5ed6941ca4a4027860e">find_dangerous_explosives</a>();</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a81a2b9ca2aaa184c61d0c005f079c758">formation_distance</a> = -1;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">assess_enemy</a> = 0.0f;</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">assess_ally</a> = 0.0f;</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;    <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">swarm_count</a> = 0;</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae1e5a82ac8cb44fbad27d315a73f1acb">reposition_countdown</a> &gt; 0 ) {</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae1e5a82ac8cb44fbad27d315a73f1acb">reposition_countdown</a> --;</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;    }</div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">repositioning</a> &amp;&amp; !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> ) &amp;&amp;</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;        !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a> ) ) {</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;        <span class="comment">// if NPC no longer has the run away effect and isn&#39;t fleeing in panic,</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;        <span class="comment">// they can stop moving away.</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">repositioning</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;        <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#ae1e5a82ac8cb44fbad27d315a73f1acb">reposition_countdown</a> = 1;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    }</div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;    <a class="code" href="classnpc.html#a66fcb50d8997cc5410d66dbd9bc7c4df">assess_danger</a>();</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <span class="keywordflow">if</span>( old_assessment &gt; <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> &amp;&amp; <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af43fa626222f6d28f052da61973043b3">danger_assessment</a> &lt;= 0 ) {</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;        <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;relax&quot;</span>, 30_minutes );</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( old_assessment &lt;= 0.0f &amp;&amp; ai_cache.danger_assessment &gt; <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> ) {</div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;        <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;general_danger&quot;</span> );</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    }</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <span class="comment">// Non-allied NPCs with a completed mission should move to the player</span></div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; !<a class="code" href="classnpc.html#ab1230a6bd26c235c1732e7e5dce365c2">is_stationary</a>( <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;        <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;        <span class="keywordflow">for</span>( ::<a class="code" href="classmission.html">mission</a> *miss : <a class="code" href="classnpc.html#a8b8977c621cdf1a6a4cdcc79225eb8b2">chatbin</a>.<a class="code" href="structdialogue__chatbin.html#af0da224eb6a3c51fae658ca0cf031f4a">missions_assigned</a> ) {</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            <span class="keywordflow">if</span>( miss-&gt;<a class="code" href="classmission.html#ac276c5e4ecbe985340656c2183e73b8e">is_complete</a>( <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() ) ) {</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;                <span class="comment">// unless the player found an item and already told the NPC he wanted to keep it</span></div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                <span class="keyword">const</span> <a class="code" href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085">mission_goal</a> &amp;mgoal = miss-&gt;<a class="code" href="classmission.html#af99364a9afac4abce5af8a056835f95d">get_type</a>().<a class="code" href="structmission__type.html#a8872c9cf3e3a3dd838448f3cd91ce4d8">goal</a>;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;                <span class="keywordflow">if</span>( ( mgoal == <a class="code" href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085a7ce044681892644558e23ee2ee225791">MGOAL_FIND_ITEM</a> || mgoal == <a class="code" href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085aa317d885583c2e6e132dd509fd1d8710">MGOAL_FIND_ANY_ITEM</a> ||</div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;                      mgoal == <a class="code" href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085a2a71a02961479f56ca9a897ed726e759">MGOAL_FIND_ITEM_GROUP</a> ) &amp;&amp;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;                    <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a04a78b20202d905c65011e5f8b51db43">effect_npc_player_still_looking</a> ) ) {</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;                }</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>() != player_character.<a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>() ) {</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;                    <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = player_character.<a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;                }</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;                <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a436461a7ac1efa5ec5f2d53ab20d2b67">NPCATT_TALK</a> );</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;            }</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;        }</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    }</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;}</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160; </div>
<div class="line"><a name="l01301"></a><span class="lineno"><a class="line" href="classnpc.html#a2ebcfb2511df0644de3d422dcb50d71b"> 1301</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a2ebcfb2511df0644de3d422dcb50d71b">npc::move</a>()</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;{</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    <span class="comment">// don&#39;t just return from this function without doing something</span></div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="comment">// that will eventually subtract moves, or change the NPC to a different type of action.</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="comment">// because this will result in an infinite loop</span></div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a133e55cc6929aff6e04ecd1f8720d279">NPCATT_FLEE</a> ) {</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a> );  <span class="comment">// Only run for so many hours</span></div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a> &amp;&amp; !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#afdcaa355e9fb31990b6222e12cc0416a">effect_npc_flee_player</a> ) ) {</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a54aaedf3b06b118cd4d2ca5f63c8695b">NPCATT_NULL</a> );</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    }</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <a class="code" href="classnpc.html#a01b95be72400ef6e5b659c34f634bcfd">regen_ai_cache</a>();</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    <span class="comment">// NPCs under operation should just stay still</span></div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#a955b947f2ca18118b44d3e44aa72b66e">id</a>() == <a class="code" href="npcmove_8cpp.html#a63e5739b23bda74126ceb8fbb66e502b">ACT_OPERATION</a> || <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#a955b947f2ca18118b44d3e44aa72b66e">id</a>() == <a class="code" href="npcmove_8cpp.html#a86707315539643dbc391ad64dfbc2765">ACT_SPELLCASTING</a> ) {</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;        <a class="code" href="classnpc.html#a647e4cf025498dc0798f5fb0d80f3b3a">execute_action</a>( <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a> );</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    }</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <a class="code" href="classnpc.html#a3740f4479ecfacc0afa8c938ba1ffcd7">act_on_danger_assessment</a>();</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160; </div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>();</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string no_target_str = <span class="stringliteral">&quot;none&quot;</span>;</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> *target = <a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">current_target</a>();</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    <span class="keyword">const</span> std::string &amp;target_name = target != <span class="keyword">nullptr</span> ? target-&gt;<a class="code" href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">disp_name</a>() : no_target_str;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a08d40b6122ca1dcb1a96007b579b6826">confident_range_cache</a> ) {</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;        <a class="code" href="classnpc.html#a804d15a6005963a24df4434c8aa1b94e">invalidate_range_cache</a>();</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;    }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;NPC %s: target = %s, danger = %.1f, range = %d&quot;</span>,</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;                   <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), target_name, <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">danger</a>, *<a class="code" href="classnpc.html#a08d40b6122ca1dcb1a96007b579b6826">confident_range_cache</a> );</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    <span class="comment">//faction opinion determines if it should consider you hostile</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() &amp;&amp; <a class="code" href="classnpc.html#adc0b90f197e58b09eb6eb92132d432f0">guaranteed_hostile</a>() &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character ) ) {</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            <a class="code" href="classnpc.html#a85d4c148bce6c6d7300f5f139be4b0e9">mutiny</a>();</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        }</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;NPC %s turning hostile because is guaranteed_hostile()&quot;</span>,</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                       <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">op_of_u</a>.<a class="code" href="structnpc__opinion.html#ac3e3687fbefeca03878ed52f641d4bf7">fear</a> &gt; 10 + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#aecf2fbbc5fcbda416d381dc0bde6e18c">aggression</a> + <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> ) {</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;            <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a> );    <span class="comment">// We don&#39;t want to take u on!</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a59e2eeab0c7bf7336d7c5fea3a870d2a">NPCATT_KILL</a> );    <span class="comment">// Yeah, we think we could take you!</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;        }</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;    }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160; </div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;    <span class="comment">/* This bypasses the logic to determine the npc action, but this all needs to be rewritten</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">     * anyway.</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">     * NPC won&#39;t avoid dangerous terrain while accompanying the player inside a vehicle to keep</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">     * them from inadvertently getting themselves run over and/or cause vehicle related errors.</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">     * NPCs flee from uncontained fires within 3 tiles</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> &amp;&amp; ( <a class="code" href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">sees_dangerous_field</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) || <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a> ) ) ) {</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">sees_dangerous_field</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;        }</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;        <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> escape_dir = <a class="code" href="classnpc.html#aefc6f0c35c8924b11f291d9daf0f230e">good_escape_direction</a>( <a class="code" href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">sees_dangerous_field</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) );</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;        <span class="keywordflow">if</span>( escape_dir != <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) {</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;            <a class="code" href="classnpc.html#ac17b98393632654d6724c71251bbdadf">move_to</a>( escape_dir );</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        }</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    }</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160; </div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <span class="comment">// TODO: Place player-aiding actions here, with a weight</span></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160; </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="comment">/* NPCs are fairly suicidal so at this point we will do a quick check to see if</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;<span class="comment">     * something nasty is going to happen.</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160; </div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() &amp;&amp; <a class="code" href="classnpc.html#a295b6e064a8ef2defd64eb8f9774ba64">vehicle_danger</a>( <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a14108754d46e7a886364e08c7817615b">avoidance_vehicles_radius</a> ) &gt; 0 ) {</div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="comment">// TODO: Think about how this actually needs to work, for now assume flee from player</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">target</a> = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( player_character );</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    }</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160; </div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0f00a09e500a57a83a2eb5a92b79626a">dangerous_explosives</a>.empty() ) {</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6fd72bcdd3524d15de954838ceb03e5a">npc_escape_explosion</a>;</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( target == &amp;player_character &amp;&amp; <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a> ) ||</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;               <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a> ) ) {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#a6dd57d8c350fc1aff1a66012d7eaeed8">method_of_fleeing</a>();</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a2dde49329eef942ec57d25db274942c0">effect_asthma</a> ) &amp;&amp; ( <a class="code" href="classCharacter.html#aa33f9870c95a95d8a46423c9d6477d99">has_charges</a>( <a class="code" href="npcmove_8cpp.html#a4df4d1902dc88952a51b05cf60c02753">itype_inhaler</a>, 1 ) ||</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;               <a class="code" href="classCharacter.html#aa33f9870c95a95d8a46423c9d6477d99">has_charges</a>( <a class="code" href="npcmove_8cpp.html#a44adef81192d43188ce1a50f4b41bb3b">itype_oxygen_tank</a>, 1 ) ||</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;               <a class="code" href="classCharacter.html#aa33f9870c95a95d8a46423c9d6477d99">has_charges</a>( <a class="code" href="npcmove_8cpp.html#a529eaf0b3181b88487e110193c6d9986">itype_smoxygen_tank</a>, 1 ) ) ) {</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af8a5950d177e7da5bb22362a7e8949c1">npc_heal</a>;</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( target != <span class="keyword">nullptr</span> &amp;&amp; <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">danger</a> &gt; 0 ) {</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#aff6a15f0eccd4e9dcc7bbb28034058c3">method_of_attack</a>();</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.empty() &amp;&amp; !<a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() ) {</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> cur_s_abs_pos = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa6b8e0edc5a63b7a63c28c7b1e15478c">s_abs_pos</a>;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> ) {</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> = <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.size() &gt; 1 ) {</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;            std::sort( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.begin(), <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.end(),</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;                       <a class="code" href="npcmove_8cpp.html#afbadedc2f23ae322e4a2e30157fd0585">compare_sound_alert</a> );</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.size() &gt; 10 ) {</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.resize( 10 );</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            }</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code" href="npcmove_8cpp.html#adf56eab61890bbb283d4dbd7d26dde16">trait_IGNORE_SOUND</a> ) ) { <span class="comment">//Do not investigate sounds - clear sound alerts as below</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.clear();</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">npc_return_to_guard_pos</a>;</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5">npc_investigate_sound</a>;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        }</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.front().abs_pos != cur_s_abs_pos ) {</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0c8464dc785d8b0b9ebea26e1904ad04">stuck</a> = 0;</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa6b8e0edc5a63b7a63c28c7b1e15478c">s_abs_pos</a> = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.front().abs_pos;</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0c8464dc785d8b0b9ebea26e1904ad04">stuck</a> &gt; 10 ) {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0c8464dc785d8b0b9ebea26e1904ad04">stuck</a> = 0;</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.size() == 1 ) {</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.clear();</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">npc_return_to_guard_pos</a>;</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa6b8e0edc5a63b7a63c28c7b1e15478c">s_abs_pos</a> = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.at( 1 ).abs_pos;</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            }</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        }</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5">npc_investigate_sound</a> ) {</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;NPC %s: investigating sound at x(%d) y(%d)&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(),</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                           <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa6b8e0edc5a63b7a63c28c7b1e15478c">s_abs_pos</a>.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa6b8e0edc5a63b7a63c28c7b1e15478c">s_abs_pos</a>.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> );</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        }</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="comment">// No present danger</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        <a class="code" href="classnpc.html#a2b5862e4eb0c9d1b8b4fc6bc93f7aca0">cleanup_on_no_danger</a>();</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#ad19cf8c5a4e78a6e5f36b0674a812e97">address_needs</a>();</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        <a class="code" href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609">print_action</a>( <span class="stringliteral">&quot;address_needs %s&quot;</span>, <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160; </div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> ) {</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#a650bd06d1fc1709728d11d30684580af">address_player</a>();</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;            <a class="code" href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609">print_action</a>( <span class="stringliteral">&quot;address_player %s&quot;</span>, <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        }</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> &amp;&amp; <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.empty() &amp;&amp; <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> ) {</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;            <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> return_guard_pos = *<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a>;</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;NPC %s: returning to guard spot at x(%d) y(%d)&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(),</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;                           return_guard_pos.<a class="code" href="classcoords_1_1coord__point__mut.html#a0fa1f1039d6d6f5b5f744a5d3d039a02">x</a>(), return_guard_pos.<a class="code" href="classcoords_1_1coord__point__mut.html#a0e6b02267065e16149a37d98991f653e">y</a>() );</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">npc_return_to_guard_pos</a>;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        }</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160; </div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> &amp;&amp; <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() &amp;&amp; <a class="code" href="classnpc.html#a279682d01e74e6dbe6ef590047fd3d94">goto_to_this_pos</a> ) {</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a320566dc8704d228e05b9fa1191726d8">npc_goto_to_this_pos</a>;</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    }</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160; </div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;    <span class="comment">// check if in vehicle before doing any other follow activities</span></div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> &amp;&amp; <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() &amp;&amp; player_character.<a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> &amp;&amp;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        !<a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">npc_follow_embarked</a>;</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    }</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160; </div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> &amp;&amp; <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() &amp;&amp; <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5c981fdb3be5e8bd1ef605268999b8de">ally_rule::follow_close</a> ) &amp;&amp;</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &gt; <a class="code" href="classnpc.html#a91fd8991b5e867555b74fb3c48891335">follow_distance</a>() &amp;&amp; !( player_character.<a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> &amp;&amp;</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                <a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) ) {</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a>;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;    }</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> &amp;&amp; <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4ae5449845013a531dc5def34dce450be9">NPCATT_ACTIVITY</a> ) {</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#af9a9d879469286e1da635f69bc39c736">has_stashed_activity</a>() ) {</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a2b38269bfb5ffc4edef08f904bd487f6">check_outbounds_activity</a>( <a class="code" href="classCharacter.html#a5815e4a8e87aa5ac0faf6a045bdaf4c8">get_stashed_activity</a>(), <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;                <a class="code" href="classCharacter.html#a37cbf03be0b64ebb45c3eb5cdb6a3b18">assign_stashed_activity</a>();</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;                <span class="comment">// wait a turn, because next turn, the object of our activity</span></div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;                <span class="comment">// may have been loaded in.</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;                <a class="code" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;            }</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;        }</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;        std::vector&lt;tripoint_bub_ms&gt; activity_route = <a class="code" href="classCharacter.html#a05af3f6fab8229b6c4439481421e80b6">get_auto_move_route</a>();</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;        <span class="keywordflow">if</span>( !activity_route.empty() &amp;&amp; !<a class="code" href="classCharacter.html#a73e94730498f4353bf773eba0c3dd69a">has_destination_activity</a>() ) {</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;            <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> final_destination;</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a3e8d89aafa00fbeae676c54433ee6d75">destination_point</a> ) {</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;                final_destination = here.<a class="code" href="classmap.html#a1cc29653b8305e7192311c05a0bd4c99">bub_from_abs</a>( *<a class="code" href="classCharacter.html#a3e8d89aafa00fbeae676c54433ee6d75">destination_point</a> );</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;                final_destination = activity_route.back();</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;            }</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;            <span class="comment">// TODO: fix point types</span></div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( final_destination.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() );</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;            }</div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        }</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a73e94730498f4353bf773eba0c3dd69a">has_destination_activity</a>() ) {</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;            <a class="code" href="classCharacter.html#a8a65544960c46310fe2d2ed12f52dc10">start_destination_activity</a>();</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a>;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#aaf3e6613525deaf4d7799df3da648089">has_player_activity</a>() ) {</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a>;</div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        }</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;    }</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> ) {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;        <span class="comment">// an interrupted activity can cause this situation. stops allied NPCs zooming off</span></div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;        <span class="comment">// like random NPCs</span></div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4ae5449845013a531dc5def34dce450be9">NPCATT_ACTIVITY</a> &amp;&amp; !<a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a> ) {</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;            <a class="code" href="classnpc.html#aefeae3d14dd64533e5bff412e280c2e8">revert_after_activity</a>();</div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a325fff8094f3e9ce2ba6970f969ada3f">is_ally</a>( player_character ) &amp;&amp; !<a class="code" href="classnpc.html#a36732f064214ecc3943cacea307f2597">assigned_camp</a> ) {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;                <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> = <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4aee568a181e2bf1f4ef5122e0674b162d">NPCATT_FOLLOW</a>;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;                <a class="code" href="classmission.html">mission</a> = <a class="code" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6da6255603e60fdb2f2d52b8b2ce4000f87">NPC_MISSION_NULL</a>;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;            }</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        }</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a36732f064214ecc3943cacea307f2597">assigned_camp</a> &amp;&amp; <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> != <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4ae5449845013a531dc5def34dce450be9">NPCATT_ACTIVITY</a> ) {</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#abb973d85b8141f14a41d43171eb32353">has_job</a>() &amp;&amp; <a class="code" href="namespacecalendar.html#a356df28513f4d655ae35c312ab6e7d55">calendar::once_every</a>( 10_minutes ) &amp;&amp; <a class="code" href="classnpc.html#a0c12ca9af78ebc18189992cc866f5ddc">find_job_to_perform</a>() ) {</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a>;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a058b148b092d45266de475aa2281477b">npc_worker_downtime</a>;</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;            }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab1230a6bd26c235c1732e7e5dce365c2">is_stationary</a>( <span class="keyword">true</span> ) &amp;&amp; !<a class="code" href="classnpc.html#a36732f064214ecc3943cacea307f2597">assigned_camp</a> ) {</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            <span class="comment">// if we&#39;re in a vehicle, stay in the vehicle</span></div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;                <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>;</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;                <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;                <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> == <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>() ?  <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a> : <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">npc_goto_destination</a>;</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;            }</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a9ca344b214e47beec525f78ebc83dc64">has_new_items</a> &amp;&amp; <a class="code" href="classnpc.html#aafe8341e41f59321adba206531c6b862">scan_new_items</a>() ) {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> ) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;            <a class="code" href="classnpc.html#a5a4638fb5090eb6a0042c8f41430bc3a">find_item</a>();</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;            <a class="code" href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609">print_action</a>( <span class="stringliteral">&quot;find_item %s&quot;</span>, <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a36732f064214ecc3943cacea307f2597">assigned_camp</a> ) {</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;            <span class="comment">// this should be covered above, but justincase to stop them zooming away.</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>;</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        }</div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160; </div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <span class="comment">// check if in vehicle before rushing off to fetch things</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() &amp;&amp; player_character.<a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">npc_follow_embarked</a>;</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;            <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> ) {</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;            <span class="comment">// Set to true if find_item() found something</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a82965fc7cec7bafbe6a94100f689895d">npc_pickup</a>;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#afb23922118c6110a011990778c940ba9">is_following</a>() ) {</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;            <span class="comment">// No items, so follow the player?</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a>;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;        }</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;        <span class="comment">// Friendly NPCs who are followers/ doing tasks for the player should never get here.</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        <span class="comment">// This will revert them to a dynamic NPC state.</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> ) {</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;            <span class="comment">// Do our long-term action</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;            <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#a72a5010d44054d2ba97f29b5226d3b7c">long_term_goal_action</a>();</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;            <a class="code" href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609">print_action</a>( <span class="stringliteral">&quot;long_term_goal_action %s&quot;</span>, <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;        }</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    }</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <span class="comment">/* Sometimes we&#39;ll be following the player at this point, but close enough that</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;<span class="comment">     * &quot;following&quot; means standing still.  If that&#39;s the case, if there are any</span></div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;<span class="comment">     * monsters around, we should attack them after all!</span></div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;<span class="comment">     *</span></div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;<span class="comment">     * If we are following a embarked player and we are in a vehicle then shoot anyway</span></div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;<span class="comment">     * as we are most likely riding shotgun</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">danger</a> &gt; 0 &amp;&amp; target != <span class="keyword">nullptr</span> &amp;&amp;</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        (</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            ( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">npc_follow_embarked</a> &amp;&amp; <a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) ||</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            ( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a> &amp;&amp;</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;              ( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &lt;= <a class="code" href="classnpc.html#a91fd8991b5e867555b74fb3c48891335">follow_distance</a>() ||</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;                <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() != player_character.<a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() ) )</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;        ) ) {</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;        <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#aff6a15f0eccd4e9dcc7bbb28034058c3">method_of_attack</a>();</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;    }</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160; </div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;%s chose action %s.&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), <a class="code" href="npcmove_8cpp.html#a8d1c3c3d8e1c9281ac6f0a333487c414">npc_action_name</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) );</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;    <a class="code" href="classnpc.html#a647e4cf025498dc0798f5fb0d80f3b3a">execute_action</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;}</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160; </div>
<div class="line"><a name="l01565"></a><span class="lineno"><a class="line" href="classnpc.html#a647e4cf025498dc0798f5fb0d80f3b3a"> 1565</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a647e4cf025498dc0798f5fb0d80f3b3a">npc::execute_action</a>( <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> )</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;{</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="keywordtype">int</span> oldmoves = <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> tar = <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *cur = <a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">current_target</a>();</div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">npc_flee</a> ) {</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;        tar = <a class="code" href="classnpc.html#aefc6f0c35c8924b11f291d9daf0f230e">good_escape_direction</a>( <span class="keyword">false</span> );</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( cur != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        tar = cur-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    }</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;<span class="comment">      debugmsg(&quot;%s ran execute_action() with target = %d! Action %s&quot;,</span></div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;<span class="comment">               name, target, npc_action_name(action));</span></div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160; </div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;    <span class="keywordflow">switch</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) {</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ae7395a29bb423bfddfba92378abe9a27">npc_do_attack</a>:</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7cd98325c23b7af1df26919a92c30446">current_attack</a>-&gt;use( *<span class="keyword">this</span>, <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a866155d086fdd4bcd7803377b34a37d2">current_attack_evaluation</a>.<a class="code" href="classnpc__attack__rating.html#a5edbe25131a7337a3738bd24cd113f5b">target</a>() );</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7cd98325c23b7af1df26919a92c30446">current_attack</a>.reset();</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a866155d086fdd4bcd7803377b34a37d2">current_attack_evaluation</a> = <a class="code" href="classnpc__attack__rating.html">npc_attack_rating</a>{};</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>:</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a058b148b092d45266de475aa2281477b">npc_worker_downtime</a>:</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;            <a class="code" href="classnpc.html#a71c2e08d14b32913076f198a293adea1">worker_downtime</a>();</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a34e61bbbaf8abebf63326320fec60c53">npc_reload</a>: {</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() ) {</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;NPC tried to reload without weapon&quot;</span> );</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;            }</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;            <a class="code" href="classnpc.html#a7760d95b7aab094c750965eaa7d77071">do_reload</a>( <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() );</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        }</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160; </div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5">npc_investigate_sound</a>: {</div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;            <a class="code" href="structtripoint.html">tripoint</a> cur_pos = <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa6b8e0edc5a63b7a63c28c7b1e15478c">s_abs_pos</a> ) );</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;            <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() == cur_pos ) {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0c8464dc785d8b0b9ebea26e1904ad04">stuck</a> += 1;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;            }</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;        }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160; </div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">npc_return_to_guard_pos</a>: {</div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;            <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> local_guard_pos = here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> );</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( local_guard_pos );</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() == local_guard_pos || <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> = std::nullopt;</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;                <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            }</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        }</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160; </div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1c5faa755f1cd29189d4e164dd3b1411">npc_sleep</a>: {</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            <span class="comment">// TODO: Allow stims when not too tired</span></div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            <span class="comment">// Find a nice spot to sleep</span></div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> best_spot = <a class="code" href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">pos_bub</a>();</div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            <span class="keywordtype">int</span> best_sleepy = <a class="code" href="classnpc.html#aa672dcdbbd6dd9bbd53f12261d9fb8d2">evaluate_sleep_spot</a>( best_spot );</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> &amp;p : <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( <a class="code" href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">pos_bub</a>(), <a class="code" href="clzones_8h.html#a68d414e1c79f68a26edabb0ee1433e4b">ACTIVITY_SEARCH_DISTANCE</a> ) ) {</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">could_move_onto</a>( p ) || !<a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;is_empty( p ) ) {</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;                }</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160; </div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                <span class="comment">// For non-mutants, very_comfortable-1 is the expected value of an ideal normal bed.</span></div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;                <span class="keywordflow">if</span>( best_sleepy &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#aaf1c149989ac933ff6b094384f4a5462a2d02b60eaa3c25912ee2e3ba0b669068">comfort_level::very_comfortable</a> ) - 1 ) {</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">int</span> sleepy = <a class="code" href="classnpc.html#aa672dcdbbd6dd9bbd53f12261d9fb8d2">evaluate_sleep_spot</a>( p );</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;                    <span class="keywordflow">if</span>( sleepy &gt; best_sleepy ) {</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                        best_sleepy = sleepy;</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                        best_spot = p;</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                    }</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            }</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() ) {</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( <span class="stringliteral">&quot;napping&quot;</span>, 30_minutes, <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_warn_sleep.translated() );</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;            }</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( best_spot );</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            <span class="comment">// TODO: Handle empty path better</span></div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <span class="keywordflow">if</span>( best_spot == <a class="code" href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">pos_bub</a>() || <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ac95fd54d69ea350ea463a719fa7f3550">effect_lying_down</a> ) ) {</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                    <a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">activate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a978adf30232e0bcf1b9d38a73b8dd30e">bio_soporific</a> );</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                    <a class="code" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code" href="npcmove_8cpp.html#ac95fd54d69ea350ea463a719fa7f3550">effect_lying_down</a>, 30_minutes, <span class="keyword">false</span>, 1 );</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                    <span class="keywordflow">if</span>( !player_character.<a class="code" href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">in_sleep_state</a>() ) {</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                        <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( *<span class="keyword">this</span>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s lies down to sleep.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                    }</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;                }</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;            }</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        }</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160; </div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a82965fc7cec7bafbe6a94100f689895d">npc_pickup</a>:</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;            <a class="code" href="classnpc.html#af9ea7f0462d56a586115b26fefaee170">pick_up_item</a>();</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160; </div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af8a5950d177e7da5bb22362a7e8949c1">npc_heal</a>:</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;            <a class="code" href="classnpc.html#acf0a5cd5f49a663e11d1631812ff1496">heal_self</a>();</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160; </div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ab3ea6db7edf0f1efbf6082d8b7307d15">npc_use_painkiller</a>:</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;            <a class="code" href="classnpc.html#ab207c63e57697f76b910b49d38034294">use_painkiller</a>();</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160; </div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a4c50de30d1fe74ad9f2f7146ef81ede1">npc_drop_items</a>:</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;            <span class="comment">/* NPCs can&#39;t choose this action anymore, but at least it works */</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;            <a class="code" href="classCharacter.html#aa342bc315f7b61074f2ac81217a2a0f5">drop_invalid_inventory</a>();</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            <span class="comment">/* drop_items is still broken</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;<span class="comment">             * drop_items( weight_carried() - weight_capacity(),</span></div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="comment">             *             volume_carried() - volume_capacity() );</span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160; </div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">npc_flee</a>:</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;                <a class="code" href="classnpc.html#ac17b98393632654d6724c71251bbdadf">move_to</a>( tar );</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;            }</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3a4fe08fa3d733f7956e1c5692e1a3da">npc_reach_attack</a>:</div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a03d847cc01fcfd290871893e9418d2f0">can_use_offensive_cbm</a>() ) {</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;                <a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">activate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a4424b509877ff458aa661c2b49a99dda">bio_hydraulics</a> );</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;            }</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;            <a class="code" href="classCharacter.html#a408e887059da5e9a0b1bfd7672ff392d">reach_attack</a>( tar );</div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1b0dd2cfef9c4f9a367079199c7c80af">npc_melee</a>:</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( tar );</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.size() &gt; 1 ) {</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.size() == 1 ) {</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;                <span class="keywordflow">if</span>( cur != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a03d847cc01fcfd290871893e9418d2f0">can_use_offensive_cbm</a>() ) {</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                        <a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">activate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a4424b509877ff458aa661c2b49a99dda">bio_hydraulics</a> );</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                    }</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;                    <a class="code" href="classCharacter.html#a22c61a1b7ab6ae71a3cac5f92bca2fd5">melee_attack</a>( *cur, <span class="keyword">true</span> );</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;                }</div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                <a class="code" href="classnpc.html#abfc3752f6d8399151f22e5514a37c479">look_for_player</a>( player_character );</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;            }</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160; </div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ad178d28c383136b41476fe0df9c71306">npc_aim</a>:</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;            <a class="code" href="classnpc.html#a8659ec918e22207511ebed3a20afb844">aim</a>( <a class="code" href="structTarget__attributes.html">Target_attributes</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), tar ) );</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160; </div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a48cceb4e0db33f4525fee6c3f7c7924d">npc_shoot</a>: {</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() ) {</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;NPC tried to shoot without weapon&quot;</span> );</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;            }</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;            <a class="code" href="classgun__mode.html">gun_mode</a> mode = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>()-&gt;<a class="code" href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">gun_current_mode</a>();</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;            <span class="keywordflow">if</span>( !mode ) {</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;NPC tried to shoot without valid mode&quot;</span> );</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            }</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            <a class="code" href="classnpc.html#a8659ec918e22207511ebed3a20afb844">aim</a>( <a class="code" href="structTarget__attributes.html">Target_attributes</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), tar ) );</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                <a class="code" href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">pretend_fire</a>( <span class="keyword">this</span>, mode.<a class="code" href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">qty</a>, *mode );</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;                <a class="code" href="classCharacter.html#a9f90838e7733c76ae2b1eaa7b9e418cb">fire_gun</a>( tar, mode.<a class="code" href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">qty</a>, *mode );</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;                <span class="comment">// &quot;discard&quot; the fake bio weapon after shooting it</span></div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a878f2d584f508107d1f0ba5599de7fa4">is_using_bionic_weapon</a>() ) {</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                    <a class="code" href="classnpc.html#ade7870077fa0ae24205d631e9abb60a7">discharge_cbm_weapon</a>();</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                }</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;            }</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160; </div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a55a7ea511d5d1d406ea6edfb96a65c56">npc_look_for_player</a>:</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a740bf52a4bcfa3308abb1d236685bbbb">saw_player_recently</a>() &amp;&amp; <a class="code" href="classnpc.html#ac99cedf0bd0394229090e4ea85f10f2a">last_player_seen_pos</a> &amp;&amp;</div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;                <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classnpc.html#ac99cedf0bd0394229090e4ea85f10f2a">last_player_seen_pos</a> ) ) ) {</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;                <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classnpc.html#ac99cedf0bd0394229090e4ea85f10f2a">last_player_seen_pos</a> ) );</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                <a class="code" href="classnpc.html#abfc3752f6d8399151f22e5514a37c479">look_for_player</a>( player_character );</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160; </div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9c46449f66af0d972656ec500f4d39ba">npc_heal_player</a>: {</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;            <a class="code" href="classCharacter.html">Character</a> *patient = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classCharacter.html">Character</a> *<span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#a3a138724d95b7991fb0bea8f2c719439">current_ally</a>() );</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;            <span class="keywordflow">if</span>( patient ) {</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( patient-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.size() == 1 ) { <span class="comment">// We&#39;re adjacent to u, and thus can heal u</span></div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                    <a class="code" href="classnpc.html#a6616407de598de3d0afaa5230c8448d8">heal_player</a>( *patient );</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                    std::string talktag = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a94fa63d2a10b2d35d08b067777fc4df0">snip_heal_player</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                    <a class="code" href="npc_8h.html#aee50a2d29c2194e6df726113b025e55b">parse_tags</a>( talktag, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>(), *<span class="keyword">this</span> );</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                    <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( talktag, patient-&gt;<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() ) );</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                    <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;                    <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;                }</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;            }</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;        }</div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a>:</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ||</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;                ( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.size() ) &lt;= <a class="code" href="classnpc.html#a91fd8991b5e867555b74fb3c48891335">follow_distance</a>() &amp;&amp;</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160;                  player_character.<a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() == <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() ) ) {</div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;                <span class="comment">// We&#39;re close enough to u.</span></div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;            }</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;            <span class="comment">// TODO: Make it only happen when it&#39;s safe</span></div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;            <a class="code" href="classnpc.html#a305f1416efd6a05654042edb9d23f2da">complain</a>();</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160; </div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">npc_follow_embarked</a>: {</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;            <span class="keyword">const</span> <a class="code" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;            <span class="keywordflow">if</span>( !vp ) {</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Following an embarked player with no vehicle at their location?&quot;</span> );</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;                <span class="comment">// TODO: change to wait? - for now pause</span></div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;            }</div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;            <a class="code" href="classvehicle.html">vehicle</a> *<span class="keyword">const</span> veh = &amp;vp-&gt;vehicle();</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160; </div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;            <span class="comment">// Try to find the last destination</span></div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;            <span class="comment">// This is mount point, not actual position</span></div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            <a class="code" href="structpoint.html">point</a> last_dest( INT_MIN, INT_MIN );</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() &amp;&amp; <a class="code" href="vpart__position_8h.html#a8da46e924794d004c9899494ecd600c5">veh_pointer_or_null</a>( here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.size() - 1] ) ) == veh ) {</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;                last_dest = vp-&gt;mount();</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;            }</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160; </div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;            <span class="comment">// Prioritize last found path, then seats</span></div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            <span class="comment">// Don&#39;t change spots if ours is nice</span></div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            <span class="keywordtype">int</span> my_spot = -1;</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            std::vector&lt;std::pair&lt;int, int&gt; &gt; seats;</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classvpart__reference.html">vpart_reference</a> &amp;vp : veh-&gt;<a class="code" href="classvehicle.html#a1b64eabc86039e338bf054c96f5a26ff">get_avail_parts</a>( <a class="code" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307eaebc2a9d9402e04973e4ee469daddeda5">VPFLAG_BOARDABLE</a> ) ) {</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;                <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> *passenger = veh-&gt;<a class="code" href="classvehicle.html#aadd0f7f40c702af8d849d8e3dc8939ca">get_passenger</a>( vp.part_index() );</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;                <span class="keywordflow">if</span>( passenger != <span class="keyword">this</span> &amp;&amp; passenger != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;                }</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;                <span class="comment">// A seat is available if we can move there and it&#39;s either unassigned or assigned to us</span></div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;                <span class="keyword">auto</span> available_seat = [&amp;]( <span class="keyword">const</span> <a class="code" href="structvehicle__part.html">vehicle_part</a> &amp; pt ) {</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;                    <a class="code" href="structtripoint.html">tripoint</a> target = veh-&gt;<a class="code" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( pt );</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;                    <span class="keywordflow">if</span>( !pt.is_seat() ) {</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;                    }</div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;                    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">could_move_onto</a>( target ) ) {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;                    }</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classnpc.html">npc</a> *who = pt.crew();</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                    <span class="keywordflow">return</span> !who || who-&gt;<a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() == <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>();</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                };</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160; </div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                <span class="keyword">const</span> <a class="code" href="structvehicle__part.html">vehicle_part</a> &amp;pt = vp.part();</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160; </div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                <span class="keywordtype">int</span> priority = 0;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160; </div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;                <span class="keywordflow">if</span>( vp.mount() == last_dest ) {</div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;                    <span class="comment">// Shares mount point with last known path</span></div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                    <span class="comment">// We probably wanted to go there in the last turn</span></div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                    priority = 4;</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160; </div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( available_seat( pt ) ) {</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                    <span class="comment">// Assuming player &quot;owns&quot; a sensible vehicle seats should be in good spots to occupy</span></div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                    <span class="comment">// Prefer our assigned seat if we have one</span></div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                    <span class="keyword">const</span> <a class="code" href="classnpc.html">npc</a> *who = pt.<a class="code" href="structvehicle__part.html#acb5dce028b917a59941ed0f4cb0a4491">crew</a>();</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                    priority = who &amp;&amp; who-&gt;<a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() == <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() ? 3 : 2;</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160; </div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( vp.is_inside() ) {</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                    priority = 1;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                }</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160; </div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                <span class="keywordflow">if</span>( passenger == <span class="keyword">this</span> ) {</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                    my_spot = priority;</div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                }</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160; </div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                seats.emplace_back( priority, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( vp.part_index() ) );</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;            }</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160; </div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;            <span class="keywordflow">if</span>( my_spot &gt;= 3 ) {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                <span class="comment">// We won&#39;t get any better, so don&#39;t try</span></div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;            }</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160; </div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;            std::sort( seats.begin(), seats.end(),</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;            []( <span class="keyword">const</span> std::pair&lt;int, int&gt; &amp;l, <span class="keyword">const</span> std::pair&lt;int, int&gt; &amp;r ) {</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                return l.first &gt; r.first;</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;            } );</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160; </div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;            <span class="keywordflow">if</span>( seats.empty() ) {</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                <span class="comment">// TODO: be angry at player, switch to wait or leave - for now pause</span></div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;            }</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160; </div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;            <span class="comment">// Only check few best seats - pathfinding can get expensive</span></div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">size_t</span> try_max = std::min&lt;size_t&gt;( 4, seats.size() );</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; try_max; i++ ) {</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                <span class="keywordflow">if</span>( seats[i].first &lt;= my_spot ) {</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                    <span class="comment">// We have a nicer spot than this</span></div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                    <span class="comment">// Note: this will make NPCs steal player&#39;s seat...</span></div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                }</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160; </div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> cur_part = seats[i].second;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160; </div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                <a class="code" href="structtripoint.html">tripoint</a> pp = veh-&gt;<a class="code" href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">global_part_pos3</a>( cur_part );</div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( pp, <span class="keyword">true</span> );</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                    <span class="comment">// All is fine</span></div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                    <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                }</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;            }</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160; </div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;            <span class="comment">// TODO: Check the rest</span></div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;        }</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160; </div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a30c4f16c4a66425e87f3e462c987d762">npc_talk_to_player</a>:</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;            <a class="code" href="avatar_8h.html#a7fe2c1a3376948380f856732d4f34c5c">get_avatar</a>().<a class="code" href="classavatar.html#a2d69f2df17dc25330b825a2e6a1aa93b">talk_to</a>( <a class="code" href="avatar_8cpp.html#a75dcf1534079311161f26d7250306379">get_talker_for</a>( <span class="keyword">this</span> ) );</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;            <a class="code" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160; </div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a85155639ee95331052d51900b16fdbb1">npc_mug_player</a>:</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;            <a class="code" href="classnpc.html#aae5cd15ba8200d25c2a5f5e398af76b8">mug_player</a>( player_character );</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160; </div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a320566dc8704d228e05b9fa1191726d8">npc_goto_to_this_pos</a>: {</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().getlocal( *<a class="code" href="classnpc.html#a279682d01e74e6dbe6ef590047fd3d94">goto_to_this_pos</a> ) );</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;            <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160; </div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>() == *<a class="code" href="classnpc.html#a279682d01e74e6dbe6ef590047fd3d94">goto_to_this_pos</a> ) {</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                <a class="code" href="classnpc.html#a279682d01e74e6dbe6ef590047fd3d94">goto_to_this_pos</a> = std::nullopt;</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;            }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        }</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160; </div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">npc_goto_destination</a>:</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;            <a class="code" href="classnpc.html#a95d1b3db80157a00032df4c4918606f0">go_to_omt_destination</a>();</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01912"></a><span class="lineno"> 1912</span>&#160; </div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6afb1482ed3f94beb6473c2f9b3b8189">npc_avoid_friendly_fire</a>:</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;            <a class="code" href="classnpc.html#a4fea1fd042a9225b685b012eec8697ba">avoid_friendly_fire</a>();</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160; </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6fd72bcdd3524d15de954838ceb03e5a">npc_escape_explosion</a>:</div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;            <a class="code" href="classnpc.html#a5b4cef057ec82989f71d88b4529d3359">escape_explosion</a>();</div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160; </div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a>:</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;            <a class="code" href="classnpc.html#aaca9337f2ca21164cfe32e6097995255">do_player_activity</a>();</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160; </div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>:</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;            <a class="code" href="classnpc.html#a305f1416efd6a05654042edb9d23f2da">complain</a>();</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160; </div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>:</div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;%s skips turn (noop)&quot;</span>, <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160; </div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;            <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Unknown NPC action (%d)&quot;</span>, <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;    }</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160; </div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;    <span class="keywordflow">if</span>( oldmoves == <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> ) {</div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;NPC didn&#39;t use its moves.  Action %s (%d).&quot;</span>,</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;                       <a class="code" href="npcmove_8cpp.html#a8d1c3c3d8e1c9281ac6f0a333487c414">npc_action_name</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ), <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;    }</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;}</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160; </div>
<div class="line"><a name="l01944"></a><span class="lineno"><a class="line" href="classnpc.html#ad55732037ca207be54cc34ef3f74e893"> 1944</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#ad55732037ca207be54cc34ef3f74e893">npc::witness_thievery</a>( <a class="code" href="classitem.html">item</a> *it )</div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;{</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    <a class="code" href="classnpc.html#ac4e1ed70f31d88db8ea95fadad468784">known_stolen_item</a> = it;</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;    <span class="comment">// Shopkeep is behind glass</span></div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a2d47ff8926fed9a85d1168e7e514f871">myclass</a> == <a class="code" href="npcmove_8cpp.html#aad2dc5891bcab35900a7abbe32f8f257">NC_EVAC_SHOPKEEP</a> ) {</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    }</div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a9ccd3ddb03edb6e10f0987b46ffbcc53">NPCATT_RECOVER_GOODS</a> );</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;}</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160; </div>
<div class="line"><a name="l01954"></a><span class="lineno"><a class="line" href="classnpc.html#a6dd57d8c350fc1aff1a66012d7eaeed8"> 1954</a></span>&#160;<a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="classnpc.html#a6dd57d8c350fc1aff1a66012d7eaeed8">npc::method_of_fleeing</a>()</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;{</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    }</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">npc_flee</a>;</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;}</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160; </div>
<div class="line"><a name="l01962"></a><span class="lineno"><a class="line" href="classnpc.html#aff6a15f0eccd4e9dcc7bbb28034058c3"> 1962</a></span>&#160;<a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="classnpc.html#aff6a15f0eccd4e9dcc7bbb28034058c3">npc::method_of_attack</a>()</div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;{</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *critter = <a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">current_target</a>();</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;    <span class="keywordflow">if</span>( critter == <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        <span class="comment">// This function shouldn&#39;t be called...</span></div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Ran npc::method_of_attack without a target!&quot;</span> );</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>;</div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    }</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160; </div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;    <span class="comment">// if there&#39;s enough of a threat to be here, power up the combat CBMs and any combat items.</span></div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;    <a class="code" href="classnpc.html#a7293d62130bbac9ea2c90d461d478ca2">prepare_for_combat</a>();</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160; </div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <a class="code" href="classnpc.html#afb6788e7afa0689bb84fe0216c6b4663">evaluate_best_attack</a>( critter );</div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160; </div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;    std::optional&lt;int&gt; potential = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a866155d086fdd4bcd7803377b34a37d2">current_attack_evaluation</a>.<a class="code" href="classnpc__attack__rating.html#a97f49e57c67623b107e7781f1ff31c24">value</a>();</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;    <span class="keywordflow">if</span>( potential &amp;&amp; *potential &gt; 0 ) {</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ae7395a29bb423bfddfba92378abe9a27">npc_do_attack</a>;</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::debug_filter::DF_NPC</a>, <span class="stringliteral">&quot;%s can&#39;t figure out what to do&quot;</span>, <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;    }</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;}</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160; </div>
<div class="line"><a name="l01985"></a><span class="lineno"><a class="line" href="classnpc.html#afb6788e7afa0689bb84fe0216c6b4663"> 1985</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#afb6788e7afa0689bb84fe0216c6b4663">npc::evaluate_best_attack</a>( <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> *target )</div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;{</div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    std::shared_ptr&lt;npc_attack&gt; best_attack;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;    <a class="code" href="classnpc__attack__rating.html">npc_attack_rating</a> best_evaluated_attack;</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a> = [&amp;best_attack, &amp;best_evaluated_attack, <span class="keyword">this</span>, &amp;target]</div>
<div class="line"><a name="l01990"></a><span class="lineno"> 1990</span>&#160;    ( <span class="keyword">const</span> std::shared_ptr&lt;npc_attack&gt; &amp;potential_attack ) {</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;        <span class="keyword">const</span> <a class="code" href="classnpc__attack__rating.html">npc_attack_rating</a> evaluated = potential_attack-&gt;evaluate( *<span class="keyword">this</span>, target );</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;        <span class="keywordflow">if</span>( evaluated &gt; best_evaluated_attack ) {</div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;            best_attack = potential_attack;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;            best_evaluated_attack = evaluated;</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;        }</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;    };</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160; </div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;    <span class="comment">// punching things is always available</span></div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160;    <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>( std::make_shared&lt;npc_attack_melee&gt;( <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>() ) );</div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;    <a class="code" href="classCharacter.html#a64c7f6bc50109cd6e720c3c9bd4fc544">visit_items</a>( [&amp;<a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>, <span class="keyword">this</span>]( <a class="code" href="classitem.html">item</a> * it, <a class="code" href="classitem.html">item</a> * ) {</div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        <span class="comment">// you can theoretically melee with anything.</span></div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>( std::make_shared&lt;npc_attack_melee&gt;( *it ) );</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a81864eee5b75943bd4222b696117a52a">is_wielding</a>( *it ) || !it-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a936d1c7b90d01c5d07e69d0628c81235">flag_NO_UNWIELD</a> ) ) {</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>( std::make_shared&lt;npc_attack_throw&gt;( *it ) );</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;        }</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;        <span class="keywordflow">if</span>( !it-&gt;<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#afa43bb71000c037c9918d907fdacf0b5">use_methods</a>.empty() ) {</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;            <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>( std::make_shared&lt;npc_attack_activate_item&gt;( *it ) );</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        }</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5be11a9176c3d5056b833343103f70f4">ally_rule::use_guns</a> ) ) {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const gun_mode_id, gun_mode&gt; &amp;mode : it-&gt;<a class="code" href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">gun_all_modes</a>() ) {</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;                <span class="keywordflow">if</span>( !( mode.second.melee() || mode.second.flags.count( <span class="stringliteral">&quot;NPC_AVOID&quot;</span> ) ||</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;                       !<a class="code" href="classCharacter.html#a4eddeb86babf626e7869882079b40651">can_use</a>( *mode.second.target ) ||</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;                       ( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">ally_rule::use_silent</a> ) &amp;&amp; <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp;</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;                         !mode.second-&gt;is_silent() ) ) ) {</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160;                    <span class="keywordflow">if</span>( it-&gt;<a class="code" href="classitem.html#a31950d1e38829eb4c5794ffbe4e7d604">shots_remaining</a>( <span class="keyword">this</span> ) &gt; 0 || <a class="code" href="classnpc.html#a1730187ef8f8a6123602a9a8101985ce">can_reload_current</a>() ) {</div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;                        <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>( std::make_shared&lt;npc_attack_gun&gt;( *it, mode.second ) );</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;                        <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>( std::make_shared&lt;npc_attack_melee&gt;( *it ) );</div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;                    }</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;                }</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;            }</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        }</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea47559fb833ff58321570e5e877b467f6">VisitResponse::NEXT</a>;</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;    } );</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#af2ff32cce5f17bcf04be958121abe524">magic</a>-&gt;spells().empty() ) {</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <a class="code" href="classCharacter.html#af2ff32cce5f17bcf04be958121abe524">magic</a>-&gt;clear_opens_spellbook_data();</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        <a class="code" href="event__bus_8h.html#a4f760194b9225ccf92a1419748def636">get_event_bus</a>().<a class="code" href="classevent__bus.html#ab753616a3a663185377ac52560068194">send</a>&lt;<a class="code" href="event_8h.html#a333a7721472705fe444b24f107f9a731aa09554a2a78fb217500c6366b202ed82">event_type::opens_spellbook</a>&gt;( <a class="code" href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">getID</a>() );</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        <a class="code" href="classCharacter.html#af2ff32cce5f17bcf04be958121abe524">magic</a>-&gt;evaluate_opens_spellbook_data();</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160;    }</div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">spell_id</a> &amp;sp : <a class="code" href="classCharacter.html#af2ff32cce5f17bcf04be958121abe524">magic</a>-&gt;spells() ) {</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160;        <a class="code" href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">compare</a>( std::make_shared&lt;npc_attack_spell&gt;( sp ) );</div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;    }</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160; </div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7cd98325c23b7af1df26919a92c30446">current_attack</a> = best_attack;</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a866155d086fdd4bcd7803377b34a37d2">current_attack_evaluation</a> = best_evaluated_attack;</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;}</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160; </div>
<div class="line"><a name="l02038"></a><span class="lineno"><a class="line" href="classnpc.html#ad19cf8c5a4e78a6e5f36b0674a812e97"> 2038</a></span>&#160;<a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="classnpc.html#ad19cf8c5a4e78a6e5f36b0674a812e97">npc::address_needs</a>()</div>
<div class="line"><a name="l02039"></a><span class="lineno"> 2039</span>&#160;{</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#ad19cf8c5a4e78a6e5f36b0674a812e97">address_needs</a>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">danger</a> );</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;}</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160; </div>
<div class="line"><a name="l02043"></a><span class="lineno"><a class="line" href="classnpc.html#aa672dcdbbd6dd9bbd53f12261d9fb8d2"> 2043</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classnpc.html#aa672dcdbbd6dd9bbd53f12261d9fb8d2">npc::evaluate_sleep_spot</a>( <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> p )</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;{</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;    <span class="comment">// Base evaluation is based on ability to actually fall sleep there</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;    <span class="keywordtype">int</span> sleep_eval = <a class="code" href="classCharacter.html#ab65baa23495a79929ae62fd7ad1cd524">sleep_spot</a>( p );</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;    <span class="comment">// Only evaluate further if the possible bed isn&#39;t already considered very comfortable.</span></div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    <span class="comment">// This opt-out is necessary to allow mutant NPCs to find desired non-bed sleeping spaces</span></div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keywordflow">if</span>( sleep_eval &lt; <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#aaf1c149989ac933ff6b094384f4a5462a2d02b60eaa3c25912ee2e3ba0b669068">comfort_level::very_comfortable</a> ) - 1 ) {</div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::temperature_delta</a> ideal_bed_value = 2_C_delta;</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::temperature_delta</a> sleep_spot_value = <a class="code" href="classCharacter.html#ab6979ac863e9720c526acc08c3065a56">floor_bedding_warmth</a>( p.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() );</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        <span class="keywordflow">if</span>( sleep_spot_value &lt; ideal_bed_value ) {</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="keywordtype">double</span> bed_similarity = sleep_spot_value / ideal_bed_value;</div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;            <span class="comment">// bed_similarity^2, exponentially diminishing the value of non-bed sleeping spots the more not-bed-like they are</span></div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;            sleep_eval *= pow( bed_similarity, 2 );</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;        }</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;    }</div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;    <span class="keywordflow">return</span> sleep_eval;</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;}</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160; </div>
<div class="line"><a name="l02061"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#aa597fc724fe51584e998a3e4fbfaa2bc"> 2061</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="npcmove_8cpp.html#aa597fc724fe51584e998a3e4fbfaa2bc">wants_to_reload</a>( <span class="keyword">const</span> <a class="code" href="classnpc.html">npc</a> &amp;guy, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;candidate )</div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;{</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;    <span class="keywordflow">if</span>( !candidate.<a class="code" href="classitem.html#a84cbca948718b41241902acce542f352">is_reloadable</a>() ) {</div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;        <span class="keywordflow">if</span>( !candidate.<a class="code" href="classitem.html#adce43f2490a85e2dc212a26ce5ded4fc">is_magazine</a>() || !candidate.<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s considered reloading %s, but decided it was silly.&quot;</span>,</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;                           guy.<a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, candidate.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;                           <span class="stringliteral">&quot;%s considered reloading %s, but feels it is inappropriate.&quot;</span>, guy.<a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, candidate.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;        }</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160; </div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;    }</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160; </div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;    <span class="keywordflow">if</span>( !guy.<a class="code" href="classCharacter.html#a43b143f2db40723fbedb92899ac58601">can_reload</a>( candidate ) ) {</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s doesn&#39;t think they can reload %s.&quot;</span>, guy.<a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;                       candidate.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;    }</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160; </div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> required = candidate.<a class="code" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>();</div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;    <span class="comment">// TODO: Add bandolier check here, once they can be reloaded</span></div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;    <span class="keywordflow">if</span>( required &lt; 1 &amp;&amp; !candidate.<a class="code" href="classitem.html#adce43f2490a85e2dc212a26ce5ded4fc">is_magazine</a>() ) {</div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s couldn&#39;t find requirements to reload %s.&quot;</span>, guy.<a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                       candidate.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;    }</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s might try reloading %s.&quot;</span>, guy.<a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;                   candidate.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;}</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160; </div>
<div class="line"><a name="l02093"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#abb15a2e894a280b84a6cb51ea9761fa6"> 2093</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="npcmove_8cpp.html#abb15a2e894a280b84a6cb51ea9761fa6">wants_to_reload_with</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;weap, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;ammo )</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;{</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;    <span class="keywordflow">return</span> !ammo.<a class="code" href="classitem.html#adce43f2490a85e2dc212a26ce5ded4fc">is_magazine</a>() || ammo.<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>() &gt; weap.<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>();</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;}</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160; </div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;<span class="comment">// todo: make visit_items use item_locations and remove this</span></div>
<div class="line"><a name="l02099"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a451b6bd6a61cf87421914613a235d819"> 2099</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="npcmove_8cpp.html#a451b6bd6a61cf87421914613a235d819">form_loc_recursive</a>( <a class="code" href="classCharacter.html">Character</a> *<a class="code" href="classnpc.html">npc</a>, <a class="code" href="classitem.html">item</a> *node, <a class="code" href="classitem.html">item</a> *parent )</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;{</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160;    <span class="keywordflow">if</span>( parent ) {</div>
<div class="line"><a name="l02102"></a><span class="lineno"> 2102</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classitem__location.html">item_location</a>( <a class="code" href="npcmove_8cpp.html#a451b6bd6a61cf87421914613a235d819">form_loc_recursive</a>( <a class="code" href="classnpc.html">npc</a>, parent, <a class="code" href="classnpc.html">npc</a>-&gt;<a class="code" href="classvisitable.html#a31e8c573cb6e4870cc005915efc103b3">find_parent</a>( *parent ) ), node );</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;    }</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160; </div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classitem__location.html">item_location</a>( *<a class="code" href="classnpc.html">npc</a>, node );</div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;}</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160; </div>
<div class="line"><a name="l02108"></a><span class="lineno"><a class="line" href="classnpc.html#a1de32e84a90fa7bb60848c013eb95586"> 2108</a></span>&#160;<a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classnpc.html#a1de32e84a90fa7bb60848c013eb95586">npc::find_reloadable</a>()</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;{</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;    <span class="keyword">auto</span> cached_value = <a class="code" href="classCharacter.html#a28028d965c0eaed38c5e132f52bf41cf">cached_info</a>.find( <span class="stringliteral">&quot;reloadables&quot;</span> );</div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;    <span class="keywordflow">if</span>( cached_value != <a class="code" href="classCharacter.html#a28028d965c0eaed38c5e132f52bf41cf">cached_info</a>.end() ) {</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classitem__location.html">item_location</a>();</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;    }</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;    <span class="comment">// Check wielded gun, non-wielded guns, mags and tools</span></div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;    <span class="comment">// TODO: Build a proper gun-&gt;mag-&gt;ammo DAG (Directed Acyclic Graph)</span></div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;    <span class="comment">// to avoid checking same properties over and over</span></div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;    <span class="comment">// TODO: Make this understand bandoliers, pouches etc.</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;    <span class="comment">// TODO: Cache items checked for reloading to avoid re-checking same items every turn</span></div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;    <span class="comment">// TODO: Make it understand smaller and bigger magazines</span></div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;    <a class="code" href="classitem__location.html">item_location</a> reloadable;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;    <a class="code" href="classCharacter.html#a64c7f6bc50109cd6e720c3c9bd4fc544">visit_items</a>( [<span class="keyword">this</span>, &amp;reloadable]( <a class="code" href="classitem.html">item</a> * node, <a class="code" href="classitem.html">item</a> * parent ) {</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="npcmove_8cpp.html#aa597fc724fe51584e998a3e4fbfaa2bc">wants_to_reload</a>( *<span class="keyword">this</span>, *node ) ) {</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea47559fb833ff58321570e5e877b467f6">VisitResponse::NEXT</a>;</div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;        }</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160; </div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;        <a class="code" href="classitem__location.html">item_location</a> node_loc = <a class="code" href="npcmove_8cpp.html#a451b6bd6a61cf87421914613a235d819">form_loc_recursive</a>( <span class="keyword">this</span>, node, parent );</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160; </div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160;        <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> it_loc = <a class="code" href="classnpc.html#a1af5092f25a6cfeaff67584bb53cc17b">select_ammo</a>( node_loc ).<a class="code" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>;</div>
<div class="line"><a name="l02129"></a><span class="lineno"> 2129</span>&#160;        <span class="keywordflow">if</span>( it_loc &amp;&amp; <a class="code" href="npcmove_8cpp.html#abb15a2e894a280b84a6cb51ea9761fa6">wants_to_reload_with</a>( *node, *it_loc ) ) {</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;            reloadable = node_loc;</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s has decided to reload %s!&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, node-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea8d12a2ca7e5a64036d7251a3eda51a38">VisitResponse::ABORT</a>;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160;        }</div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160; </div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea47559fb833ff58321570e5e877b467f6">VisitResponse::NEXT</a>;</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;    } );</div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160; </div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;    <span class="keywordflow">if</span>( reloadable ) {</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;        <span class="keywordflow">return</span> reloadable;</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    }</div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160; </div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;    <a class="code" href="classCharacter.html#a28028d965c0eaed38c5e132f52bf41cf">cached_info</a>.emplace( <span class="stringliteral">&quot;reloadables&quot;</span>, 0.0 );</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classitem__location.html">item_location</a>();</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;}</div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160; </div>
<div class="line"><a name="l02146"></a><span class="lineno"><a class="line" href="classnpc.html#a1730187ef8f8a6123602a9a8101985ce"> 2146</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a1730187ef8f8a6123602a9a8101985ce">npc::can_reload_current</a>()</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;{</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>();</div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> || !<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() || !<a class="code" href="npcmove_8cpp.html#aa597fc724fe51584e998a3e4fbfaa2bc">wants_to_reload</a>( *<span class="keyword">this</span>, *<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> ) ) {</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;    }</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160; </div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#aa3708f97cac2aed72689434f292168c5">find_usable_ammo</a>( <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> ) );</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;}</div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160; </div>
<div class="line"><a name="l02156"></a><span class="lineno"><a class="line" href="classnpc.html#aa3708f97cac2aed72689434f292168c5"> 2156</a></span>&#160;<a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classnpc.html#aa3708f97cac2aed72689434f292168c5">npc::find_usable_ammo</a>( <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> &amp;weap )</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;{</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a43b143f2db40723fbedb92899ac58601">can_reload</a>( *weap ) ) {</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classitem__location.html">item_location</a>();</div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;    }</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160; </div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;    <a class="code" href="classitem__location.html">item_location</a> loc = <a class="code" href="classnpc.html#a1af5092f25a6cfeaff67584bb53cc17b">select_ammo</a>( weap ).<a class="code" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;    <span class="keywordflow">if</span>( !loc || !<a class="code" href="npcmove_8cpp.html#abb15a2e894a280b84a6cb51ea9761fa6">wants_to_reload_with</a>( *weap, *loc ) ) {</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classitem__location.html">item_location</a>();</div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;    }</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160; </div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;    <span class="keywordflow">return</span> loc;</div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;}</div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160; </div>
<div class="line"><a name="l02170"></a><span class="lineno"><a class="line" href="classnpc.html#ab49bccd70ba23c086be9367c6e2d385b"> 2170</a></span>&#160;<a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classnpc.html#aa3708f97cac2aed72689434f292168c5">npc::find_usable_ammo</a>( <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> &amp;weap )<span class="keyword"> const</span></div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">const_cast&lt;</span><a class="code" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( this )-&gt;<a class="code" href="classnpc.html#aa3708f97cac2aed72689434f292168c5">find_usable_ammo</a>( weap );</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;}</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160; </div>
<div class="line"><a name="l02175"></a><span class="lineno"><a class="line" href="classnpc.html#a1af5092f25a6cfeaff67584bb53cc17b"> 2175</a></span>&#160;<a class="code" href="classitem_1_1reload__option.html">item::reload_option</a> <a class="code" href="classnpc.html#a1af5092f25a6cfeaff67584bb53cc17b">npc::select_ammo</a>( <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> &amp;base, <span class="keywordtype">bool</span>, <span class="keywordtype">bool</span> empty )</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;{</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    <span class="keywordflow">if</span>( !base ) {</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classitem_1_1reload__option.html">item::reload_option</a>();</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;    }</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160; </div>
<div class="line"><a name="l02181"></a><span class="lineno"> 2181</span>&#160;    std::vector&lt;item::reload_option&gt; ammo_list;</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;    <a class="code" href="classCharacter.html#a68aa2ae54953a601b5dc27ec7c380b53">list_ammo</a>( base, ammo_list, empty );</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160; </div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="keywordflow">if</span>( ammo_list.empty() ) {</div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classitem_1_1reload__option.html">item::reload_option</a>();</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    }</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160; </div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;    <span class="comment">// sort in order of move cost (ascending), then remaining ammo (descending) with empty magazines always last</span></div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;    std::stable_sort( ammo_list.begin(), ammo_list.end(), []( <span class="keyword">const</span> <a class="code" href="classitem_1_1reload__option.html">item::reload_option</a> &amp; lhs,</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem_1_1reload__option.html">item::reload_option</a> &amp; rhs ) {</div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;        if( lhs.ammo-&gt;ammo_remaining() == 0 || rhs.ammo-&gt;ammo_remaining() == 0 ) {</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;            return ( lhs.ammo-&gt;ammo_remaining() != 0 ) &gt; ( rhs.ammo-&gt;ammo_remaining() != 0 );</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160;        }</div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160; </div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;        <span class="keywordflow">if</span>( lhs.<a class="code" href="classitem_1_1reload__option.html#ab7102268fec39b1a9104321e4f2c98f5">moves</a>() != rhs.<a class="code" href="classitem_1_1reload__option.html#ab7102268fec39b1a9104321e4f2c98f5">moves</a>() ) {</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;            return lhs.moves() &lt; rhs.moves();</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;        }</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160; </div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160;        <span class="keywordflow">return</span> lhs.<a class="code" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>-&gt;<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>() &gt; rhs.<a class="code" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>-&gt;<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>();</div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;    } );</div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160; </div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;    <span class="keywordflow">if</span>( ammo_list[0].ammo.get_item()-&gt;ammo_remaining() &gt; 0 ) {</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;        <span class="keywordflow">return</span> ammo_list[0];</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classitem_1_1reload__option.html">item::reload_option</a>();</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    }</div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;}</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160; </div>
<div class="line"><a name="l02209"></a><span class="lineno"><a class="line" href="classnpc.html#ab9b160de34864006d1cb44ec76802f56"> 2209</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#ab9b160de34864006d1cb44ec76802f56">npc::activate_combat_cbms</a>()</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;{</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;cbm_id : <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a21c4e6ec47c5c917485f57ab35c5f0b1">defense_cbms</a> ) {</div>
<div class="line"><a name="l02212"></a><span class="lineno"> 2212</span>&#160;        <a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">activate_bionic_by_id</a>( cbm_id );</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;    }</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a03d847cc01fcfd290871893e9418d2f0">can_use_offensive_cbm</a>() ) {</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;cbm_id : <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a8ac361f76a60d142bb729e731f1f99d7">weapon_cbms</a> ) {</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;            <a class="code" href="classnpc.html#a12f0365c5c7c143d560cdea7f741aba7">check_or_use_weapon_cbm</a>( cbm_id );</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;        }</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;    }</div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;}</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160; </div>
<div class="line"><a name="l02221"></a><span class="lineno"><a class="line" href="classnpc.html#a559ec32dce9038a1859990813f857bf3"> 2221</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a559ec32dce9038a1859990813f857bf3">npc::deactivate_combat_cbms</a>()</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;{</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;cbm_id : <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a21c4e6ec47c5c917485f57ab35c5f0b1">defense_cbms</a> ) {</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">deactivate_bionic_by_id</a>( cbm_id );</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    }</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;    <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">deactivate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a4424b509877ff458aa661c2b49a99dda">bio_hydraulics</a> );</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;cbm_id : <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a8ac361f76a60d142bb729e731f1f99d7">weapon_cbms</a> ) {</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;        <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">deactivate_bionic_by_id</a>( cbm_id );</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    }</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;    <a class="code" href="classnpc.html#a0c523bd03d1dac96dc9ff4597b0e8bdf">deactivate_or_discharge_bionic_weapon</a>();</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <a class="code" href="classCharacter.html#ae7a24870910dfafa681280d9e76e36dd">weapon_bionic_uid</a> = 0;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;}</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160; </div>
<div class="line"><a name="l02234"></a><span class="lineno"><a class="line" href="classnpc.html#a00c66c9875847030710d6c619a178168"> 2234</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">npc::activate_bionic_by_id</a>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;cbm_id, <span class="keywordtype">bool</span> eff_only )</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;{</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structbionic.html">bionic</a> &amp;i : *<a class="code" href="classCharacter.html#a388bca3ef975bd265c67df45bb280bee">my_bionics</a> ) {</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;        <span class="keywordflow">if</span>( i.id == cbm_id ) {</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;            <span class="keywordflow">if</span>( !i.powered ) {</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="classCharacter.html#ae33ef4afcc2718785f970888d6f70116">activate_bionic</a>( i, eff_only );</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;            }</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        }</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;    }</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;}</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160; </div>
<div class="line"><a name="l02248"></a><span class="lineno"><a class="line" href="classnpc.html#af7d0521a7bfc228b3ae5949d9fbb3294"> 2248</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#af7d0521a7bfc228b3ae5949d9fbb3294">npc::use_bionic_by_id</a>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;cbm_id, <span class="keywordtype">bool</span> eff_only )</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;{</div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structbionic.html">bionic</a> &amp;i : *<a class="code" href="classCharacter.html#a388bca3ef975bd265c67df45bb280bee">my_bionics</a> ) {</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;        <span class="keywordflow">if</span>( i.id == cbm_id ) {</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;            <span class="keywordflow">if</span>( !i.powered ) {</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="classCharacter.html#ae33ef4afcc2718785f970888d6f70116">activate_bionic</a>( i, eff_only );</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;            }</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;    }</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;}</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160; </div>
<div class="line"><a name="l02262"></a><span class="lineno"><a class="line" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94"> 2262</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">npc::deactivate_bionic_by_id</a>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;cbm_id, <span class="keywordtype">bool</span> eff_only )</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;{</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structbionic.html">bionic</a> &amp;i : *<a class="code" href="classCharacter.html#a388bca3ef975bd265c67df45bb280bee">my_bionics</a> ) {</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        <span class="keywordflow">if</span>( i.id == cbm_id ) {</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;            <span class="keywordflow">if</span>( i.powered ) {</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="classCharacter.html#ae0f7eba286e1cd07e6a3be58443aaca3">deactivate_bionic</a>( i, eff_only );</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;            }</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;        }</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;    }</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;}</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160; </div>
<div class="line"><a name="l02276"></a><span class="lineno"><a class="line" href="classnpc.html#a49c7b6c2988b72d3122895b76952e0ac"> 2276</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a49c7b6c2988b72d3122895b76952e0ac">npc::wants_to_recharge_cbm</a>()</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;{</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;    <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::energy</a> curr_power =  <a class="code" href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">get_power_level</a>();</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> allowed_ratio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a88a0a6bc06d6962a9c35277e6c5e0b76">cbm_recharge</a> ) / 100.0f;</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;    <span class="keyword">const</span> <a class="code" href="classunits_1_1quantity.html">units::energy</a> max_pow_allowed = <a class="code" href="classCharacter.html#ac3e27cd8b8fe445e06e6d20d0eb82aff">get_max_power_level</a>() * allowed_ratio;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160; </div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    <span class="keywordflow">if</span>( curr_power &lt; max_pow_allowed ) {</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;bid : <a class="code" href="classCharacter.html#a2b208d2f40f1ae46337013f16c4a30a3">get_fueled_bionics</a>() ) {</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( bid ) ) {</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;            }</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;        }</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classCharacter.html#a2b208d2f40f1ae46337013f16c4a30a3">get_fueled_bionics</a>().empty(); <span class="comment">//NPC might have power CBM that doesn&#39;t use the json fuel_opts entry</span></div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;    }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;}</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160; </div>
<div class="line"><a name="l02293"></a><span class="lineno"><a class="line" href="classnpc.html#a03d847cc01fcfd290871893e9418d2f0"> 2293</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a03d847cc01fcfd290871893e9418d2f0">npc::can_use_offensive_cbm</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> allowed_ratio = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#af7f57605c02d48aba09224adee9d260f">cbm_reserve</a> ) / 100.0f;</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">get_power_level</a>() &gt; <a class="code" href="classCharacter.html#ac3e27cd8b8fe445e06e6d20d0eb82aff">get_max_power_level</a>() * allowed_ratio;</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;}</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160; </div>
<div class="line"><a name="l02299"></a><span class="lineno"><a class="line" href="classnpc.html#aa6481cdc3b95b8a3836ab98f2446fc81"> 2299</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#aa6481cdc3b95b8a3836ab98f2446fc81">npc::recharge_cbm</a>()</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;{</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;    <span class="comment">// non-allied NPCs don&#39;t consume resources to recharge</span></div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;        <a class="code" href="classCharacter.html#a17446e14fd6046648a505c4aaec3d976">mod_power_level</a>( <a class="code" href="classCharacter.html#ac3e27cd8b8fe445e06e6d20d0eb82aff">get_max_power_level</a>() );</div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;    }</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160; </div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classstring__id.html">bionic_id</a> &amp;bid : <a class="code" href="classCharacter.html#a2b208d2f40f1ae46337013f16c4a30a3">get_fueled_bionics</a>() ) {</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#af9c7419575e23d52745c94009929fafb">has_active_bionic</a>( bid ) ) {</div>
<div class="line"><a name="l02309"></a><span class="lineno"> 2309</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;        }</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160; </div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#ac154c2ae0d5b2bb879e46d730ce47bc8">get_bionic_fuels</a>( bid ).empty() ) {</div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;            <a class="code" href="classnpc.html#af7d0521a7bfc228b3ae5949d9fbb3294">use_bionic_by_id</a>( bid );</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        }</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;    }</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160; </div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;}</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160; </div>
<div class="line"><a name="l02321"></a><span class="lineno"><a class="line" href="classoutfit.html#a7512427da57f04dabd96aa8f94c8c597"> 2321</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classoutfit.html#a7512427da57f04dabd96aa8f94c8c597">outfit::activate_combat_items</a>( <a class="code" href="classnpc.html">npc</a> &amp;guy )</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;{</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> &amp;candidate : <a class="code" href="classoutfit.html#ace7613f56f5afd81a6d043691cd8b887">worn</a> ) {</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;        <span class="keywordflow">if</span>( candidate.has_flag( <a class="code" href="flag_8cpp.html#a6be4f10366075d46b3240b6b098456a6">flag_COMBAT_TOGGLEABLE</a> ) &amp;&amp; candidate.is_transformable() &amp;&amp;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            !candidate.active ) {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160; </div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;            <span class="keyword">const</span> <a class="code" href="classiuse__transform.html">iuse_transform</a> *<a class="code" href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">transform</a> = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classiuse__transform.html">iuse_transform</a> *<span class="keyword">&gt;</span></div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                                              ( candidate.type-&gt;get_use( <span class="stringliteral">&quot;transform&quot;</span> )-&gt;get_actor_ptr() );</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160; </div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;            <span class="comment">// Due to how UPS works, there can be no charges_needed for UPS items.</span></div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;            <span class="comment">// Energy consumption is thus not checked at activation.</span></div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;            <span class="comment">// To prevent &quot;flickering&quot;, this is a hard check for UPS charges &gt; 0.</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">transform</a>-&gt;target-&gt;has_flag( <a class="code" href="flag_8cpp.html#a3e2d3cbf6b78ce65033d1f9cbf1f59bf">flag_USE_UPS</a> ) &amp;&amp; guy.<a class="code" href="classCharacter.html#a581c2e6646bc18796f26d3c18e38120a">available_ups</a>() == 0_kJ ) {</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;            }</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">transform</a>-&gt;can_use( guy, candidate, <a class="code" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> ).success() ) {</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                <a class="code" href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">transform</a>-&gt;use( &amp;guy, candidate, <a class="code" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> );</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                guy.<a class="code" href="classnpc.html#a2f119a95de9c88dabad376d9b65dd4e6">add_msg_if_npc</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt; activates their %s.&quot;</span> ), candidate.display_name() );</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;            }</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;        }</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    }</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;}</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160; </div>
<div class="line"><a name="l02344"></a><span class="lineno"><a class="line" href="classnpc.html#a10b9a47610d02f871beea8ad74a29e5b"> 2344</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a10b9a47610d02f871beea8ad74a29e5b">npc::activate_combat_items</a>()</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;{</div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <a class="code" href="classCharacter.html#a46302dc71cfc84856e8af85ddb61c7e1">worn</a>.<a class="code" href="classoutfit.html#a7512427da57f04dabd96aa8f94c8c597">activate_combat_items</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;}</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160; </div>
<div class="line"><a name="l02349"></a><span class="lineno"><a class="line" href="classoutfit.html#aa1958f2ad820d0945ffb677c930e5259"> 2349</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classoutfit.html#aa1958f2ad820d0945ffb677c930e5259">outfit::deactivate_combat_items</a>( <a class="code" href="classnpc.html">npc</a> &amp;guy )</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;{</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> &amp;candidate : <a class="code" href="classoutfit.html#ace7613f56f5afd81a6d043691cd8b887">worn</a> ) {</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;        <span class="keywordflow">if</span>( candidate.has_flag( <a class="code" href="flag_8cpp.html#a6be4f10366075d46b3240b6b098456a6">flag_COMBAT_TOGGLEABLE</a> ) &amp;&amp; candidate.is_transformable() &amp;&amp;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;            candidate.active ) {</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;            <span class="keyword">const</span> <a class="code" href="classiuse__transform.html">iuse_transform</a> *<a class="code" href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">transform</a> = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classiuse__transform.html">iuse_transform</a> *<span class="keyword">&gt;</span></div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                                              ( candidate.type-&gt;get_use( <span class="stringliteral">&quot;transform&quot;</span> )-&gt;get_actor_ptr() );</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">transform</a>-&gt;can_use( guy, candidate, <a class="code" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> ).success() ) {</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                <a class="code" href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">transform</a>-&gt;use( &amp;guy, candidate, <a class="code" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a> );</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                guy.<a class="code" href="classnpc.html#a2f119a95de9c88dabad376d9b65dd4e6">add_msg_if_npc</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;&lt;npcname&gt; deactivates their %s.&quot;</span> ), candidate.display_name() );</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;            }</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;        }</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;    }</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;}</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160; </div>
<div class="line"><a name="l02364"></a><span class="lineno"><a class="line" href="classnpc.html#a7ec5e20c68a58cbae52c51de36e2a539"> 2364</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a7ec5e20c68a58cbae52c51de36e2a539">npc::deactivate_combat_items</a>()</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;{</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    <a class="code" href="classCharacter.html#a46302dc71cfc84856e8af85ddb61c7e1">worn</a>.<a class="code" href="classoutfit.html#aa1958f2ad820d0945ffb677c930e5259">deactivate_combat_items</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;}</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160; </div>
<div class="line"><a name="l02369"></a><span class="lineno"><a class="line" href="classnpc.html#a7293d62130bbac9ea2c90d461d478ca2"> 2369</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a7293d62130bbac9ea2c90d461d478ca2">npc::prepare_for_combat</a>()</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;{</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;    <a class="code" href="classnpc.html#ab9b160de34864006d1cb44ec76802f56">activate_combat_cbms</a>();</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;    <a class="code" href="classnpc.html#a10b9a47610d02f871beea8ad74a29e5b">activate_combat_items</a>();</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;}</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160; </div>
<div class="line"><a name="l02375"></a><span class="lineno"><a class="line" href="classnpc.html#a2b5862e4eb0c9d1b8b4fc6bc93f7aca0"> 2375</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a2b5862e4eb0c9d1b8b4fc6bc93f7aca0">npc::cleanup_on_no_danger</a>()</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;{</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    <a class="code" href="classnpc.html#a559ec32dce9038a1859990813f857bf3">deactivate_combat_cbms</a>();</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;    <a class="code" href="classnpc.html#a7ec5e20c68a58cbae52c51de36e2a539">deactivate_combat_items</a>();</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;}</div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160; </div>
<div class="line"><a name="l02381"></a><span class="lineno"><a class="line" href="classnpc.html#ab985d46b3b8f2b52f7625109f100a1ab"> 2381</a></span>&#160;<a class="code" href="structhealing__options.html">healing_options</a> <a class="code" href="classnpc.html#ab985d46b3b8f2b52f7625109f100a1ab">npc::patient_assessment</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;<a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a> )</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;{</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;    <a class="code" href="structhealing__options.html">healing_options</a> try_to_fix;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;    try_to_fix.<a class="code" href="structhealing__options.html#a8c7e48cc7294f8a08563eeb4874c070e">clear_all</a>();</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160; </div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classint__id.html">bodypart_id</a> part_id : <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_all_body_parts( <a class="code" href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea5d7454274f566bb1a128ed016e6bc787">get_body_part_flags::only_main</a> ) ) {</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.has_effect( <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a>, part_id ) ) {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;            try_to_fix.<a class="code" href="structhealing__options.html#a46674f47eb19395e6d4e233e5f8f304c">bleed</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;        }</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.has_effect( <a class="code" href="npcmove_8cpp.html#a39b21fc30fecd7d4fb15047600d03522">effect_bite</a>, part_id ) ) {</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;            try_to_fix.<a class="code" href="structhealing__options.html#a94bfb3b1a00e7d4f63e2a685bf0b3da5">bite</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;        }</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.has_effect( <a class="code" href="npcmove_8cpp.html#a1de43fa1f6d16ce87ab7a3a49e47c463">effect_infected</a>, part_id ) ) {</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;            try_to_fix.<a class="code" href="structhealing__options.html#a7c1818fa5ab0f75183dccc0ce48dd117">infect</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;        }</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160; </div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;        <span class="keywordtype">int</span> part_threshold = 75;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;        <span class="keywordflow">if</span>( part_id.id() == <a class="code" href="bodypart_8cpp.html#ade2e301ed150ac0191c87e8fb19420c1">body_part_head</a> ) {</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;            part_threshold += 20;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( part_id.id() == <a class="code" href="bodypart_8cpp.html#aa1af101175ef4c9194f748dd67829fa9">body_part_torso</a> ) {</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;            part_threshold += 10;</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;        }</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;        part_threshold = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( 80, part_threshold );</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;        part_threshold = part_threshold * <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_part_hp_max( part_id ) / 100;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160; </div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.get_part_hp_cur( part_id ) &lt;= part_threshold ) {</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.has_effect( <a class="code" href="npcmove_8cpp.html#a7c2a13f94c0d13712af84b23f13e788f">effect_bandaged</a>, part_id ) ) {</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                try_to_fix.<a class="code" href="structhealing__options.html#a26f5297ad886d8fd7a3388d62ad2b600">bandage</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;            }</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a>.has_effect( <a class="code" href="npcmove_8cpp.html#adcc47d614ba63ddb056307153d5ac06c">effect_disinfected</a>, part_id ) ) {</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                try_to_fix.<a class="code" href="structhealing__options.html#aa6fb391cad922eb6b5f564f48e0506de">disinfect</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;            }</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;        }</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;    }</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;    <span class="keywordflow">return</span> try_to_fix;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;}</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160; </div>
<div class="line"><a name="l02418"></a><span class="lineno"><a class="line" href="classnpc.html#a5a702d562166a296ce034e4f8b657114"> 2418</a></span>&#160;<a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="classnpc.html#ad19cf8c5a4e78a6e5f36b0674a812e97">npc::address_needs</a>( <span class="keywordtype">float</span> danger )</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;{</div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;    <span class="comment">// rng because NPCs are not meant to be hypervigilant hawks that notice everything</span></div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;    <span class="comment">// and swing into action with alarming alacrity.</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;    <span class="comment">// no sometimes they are just looking the other way, sometimes they hestitate.</span></div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;    <span class="comment">// ( also we can get huge performance boosts )</span></div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) ) {</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;        <a class="code" href="structhealing__options.html">healing_options</a> try_to_fix_me = <a class="code" href="classnpc.html#ab985d46b3b8f2b52f7625109f100a1ab">patient_assessment</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;        <span class="keywordflow">if</span>( try_to_fix_me.<a class="code" href="structhealing__options.html#aee8b9e7a1512020403904793b2a5634f">any_true</a>() ) {</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#af7d0521a7bfc228b3ae5949d9fbb3294">use_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a3bfe78dbc0d8cfc6819f0f24c7729adc">bio_nanobots</a> ) ) {</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a> = <a class="code" href="classnpc.html#ac9750804446346082e700070b59cb663">has_healing_options</a>( try_to_fix_me );</div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a>.<a class="code" href="structhealing__options.html#aee8b9e7a1512020403904793b2a5634f">any_true</a>() ) {</div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                    <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af8a5950d177e7da5bb22362a7e8949c1">npc_heal</a>;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                }</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;            }</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;            <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">deactivate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a3bfe78dbc0d8cfc6819f0f24c7729adc">bio_nanobots</a> );</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;        }</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;        <span class="keywordflow">if</span>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">get_skill_level</a>( <a class="code" href="npcmove_8cpp.html#aaf598d0fedebd89ec20f768da3b5fd8a">skill_firstaid</a> ) ) &gt; 0 ) {</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160;                <a class="code" href="structhealing__options.html">healing_options</a> try_to_fix_other = <a class="code" href="classnpc.html#ab985d46b3b8f2b52f7625109f100a1ab">patient_assessment</a>( player_character );</div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                <span class="keywordflow">if</span>( try_to_fix_other.<a class="code" href="structhealing__options.html#aee8b9e7a1512020403904793b2a5634f">any_true</a>() ) {</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a> = <a class="code" href="classnpc.html#ac9750804446346082e700070b59cb663">has_healing_options</a>( try_to_fix_other );</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a>.<a class="code" href="structhealing__options.html#aee8b9e7a1512020403904793b2a5634f">any_true</a>() ) {</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa0a891ed2c8f48d72ddb341986bd3463">ally</a> = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( player_character );</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9c46449f66af0d972656ec500f4d39ba">npc_heal_player</a>;</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                    }</div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                }</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;            }</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classnpc.html">npc</a> &amp;guy : <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;all_npcs() ) {</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                <span class="keywordflow">if</span>( &amp;guy == <span class="keyword">this</span> || !guy.is_ally( *<span class="keyword">this</span> ) || guy.posz() != <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() || !<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( guy ) ) {</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                }</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                <a class="code" href="structhealing__options.html">healing_options</a> try_to_fix_other = <a class="code" href="classnpc.html#ab985d46b3b8f2b52f7625109f100a1ab">patient_assessment</a>( guy );</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                <span class="keywordflow">if</span>( try_to_fix_other.<a class="code" href="structhealing__options.html#aee8b9e7a1512020403904793b2a5634f">any_true</a>() ) {</div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a> = <a class="code" href="classnpc.html#ac9750804446346082e700070b59cb663">has_healing_options</a>( try_to_fix_other );</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a>.<a class="code" href="structhealing__options.html#aee8b9e7a1512020403904793b2a5634f">any_true</a>() ) {</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                        <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa0a891ed2c8f48d72ddb341986bd3463">ally</a> = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( guy );</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9c46449f66af0d972656ec500f4d39ba">npc_heal_player</a>;</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                    }</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                }</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;            }</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;        }</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;    }</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160; </div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) ) {</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a68de7da109abd90b4f2210057c982fe0">get_perceived_pain</a>() &gt;= 15 ) {</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">activate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a15450ecf5b34a615affe959125bf1626">bio_painkiller</a> ) &amp;&amp; <a class="code" href="classnpc.html#a3c14cd2fb4cf34bfe59c9d1fbe8646dc">has_painkiller</a>() &amp;&amp; !<a class="code" href="classnpc.html#a5f1c46d11b9e4115e7a5c8c9ddfa6aa4">took_painkiller</a>() ) {</div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ab3ea6db7edf0f1efbf6082d8b7307d15">npc_use_painkiller</a>;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;            }</div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;            <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">deactivate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a15450ecf5b34a615affe959125bf1626">bio_painkiller</a> );</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;        }</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;    }</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160; </div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) &amp;&amp; <a class="code" href="classnpc.html#a1730187ef8f8a6123602a9a8101985ce">can_reload_current</a>() ) {</div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a34e61bbbaf8abebf63326320fec60c53">npc_reload</a>;</div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;    }</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160; </div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) ) {</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s decided to look into reloading items.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;        <a class="code" href="classitem__location.html">item_location</a> reloadable = <a class="code" href="classnpc.html#a1de32e84a90fa7bb60848c013eb95586">find_reloadable</a>();</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;        <span class="keywordflow">if</span>( reloadable ) {</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;            <a class="code" href="classnpc.html#a7760d95b7aab094c750965eaa7d77071">do_reload</a>( reloadable );</div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;        }</div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;    }</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160; </div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;    <span class="comment">// Extreme thirst or hunger, bypass safety check.</span></div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a8c0812cf2b1dae1461ff50f9a019796e">get_thirst</a>() &gt; 80 ||</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;        <a class="code" href="classCharacter.html#a824a60fef8920f38a6f1e1b35bea4879">get_stored_kcal</a>() + <a class="code" href="classCharacter.html#aa4ecfee35839a07be48afccbe582023e">stomach</a>.<a class="code" href="classstomach__contents.html#aa5cf12fa92df9630e78c4cf5af74d616">get_calories</a>() &lt; <a class="code" href="classCharacter.html#aaa88cf522afdfdc90edcbd9fdefca47d">get_healthy_kcal</a>() * 0.75 ) {</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a67e45227dd3808fd25f73ed0a93020ac">consume_food_from_camp</a>() ) {</div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;        }</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a3dbcb192e2e0e10b54eb324a07afe040">consume_food</a>() ) {</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;        }</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;    }</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;    <span class="comment">//Hallucinations have a chance of disappearing each turn</span></div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() &amp;&amp; <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 25 ) ) {</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;        <a class="code" href="classnpc.html#afe871b5bf2a092bf7600c686cc5a0eca">die</a>( <span class="keyword">nullptr</span> );</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;    }</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160; </div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;    <span class="keywordflow">if</span>( danger &gt; <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> ) {</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;    }</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160; </div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) &amp;&amp; ( <a class="code" href="classnpc.html#a8c0812cf2b1dae1461ff50f9a019796e">get_thirst</a>() &gt; <a class="code" href="npcmove_8cpp.html#a6bd7c8b57b582cbee241e6bbf8e51998">NPC_THIRST_CONSUME</a> ||</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                         <a class="code" href="classCharacter.html#ab937dd4b9a2cf84fb446d0da98a62365">get_hunger</a>() &gt; <a class="code" href="npcmove_8cpp.html#a37e77cfc4ad1ad149440b37a4a9e1500">NPC_HUNGER_CONSUME</a> ) ) {</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a67e45227dd3808fd25f73ed0a93020ac">consume_food_from_camp</a>() ) {</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;        }</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a3dbcb192e2e0e10b54eb324a07afe040">consume_food</a>() ) {</div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;        }</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;    }</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160; </div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) &amp;&amp; <a class="code" href="classnpc.html#a49c7b6c2988b72d3122895b76952e0ac">wants_to_recharge_cbm</a>() &amp;&amp; <a class="code" href="classnpc.html#aa6481cdc3b95b8a3836ab98f2446fc81">recharge_cbm</a>() ) {</div>
<div class="line"><a name="l02517"></a><span class="lineno"> 2517</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;    }</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160; </div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a44f84e85868e3dbe33073a94c51c1e7c">can_do_pulp</a>() ) {</div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a> ) {</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;            <a class="code" href="classCharacter.html#af7d50915d362a56eeff40bc6b392326d">assign_activity</a>( <a class="code" href="npcmove_8cpp.html#aa93f72dcd6663590417f2f8fd001d032">ACT_PULP</a>, <a class="code" href="namespacecalendar.html#a00a46407cfaf938c78b9e3ae7bbc763f">calendar::INDEFINITELY_LONG</a>, 0 );</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;            <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#ace15a2f5a970ee2cdb53e5ded21d08a2">placement</a> = *<a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a>;</div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        }</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a>;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a86d59c5c838a35d11b42bd615f36d022">find_corpse_to_pulp</a>() ) {</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;    }</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160; </div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) &amp;&amp; <a class="code" href="classnpc.html#aaf81f803ffb0e285d1af4c5b5de6c7d5">adjust_worn</a>() ) {</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;    }</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160; </div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> could_sleep = [&amp;]() {</div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        <span class="keywordflow">if</span>( danger &lt;= 0.01 ) {</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a241e50ee41a2a2b54f1c1329cb60a174">get_sleepiness</a>() &gt;= <a class="code" href="character_8h.html#a28256deb3e43854efdc7035ae555212ba18eb54216d0a6c8fcfcc347228e1d8d3">sleepiness_levels::TIRED</a> ) {</div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;            }</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() &amp;&amp; player_character.<a class="code" href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">in_sleep_state</a>() &amp;&amp;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;                <a class="code" href="classCharacter.html#a241e50ee41a2a2b54f1c1329cb60a174">get_sleepiness</a>() &gt; ( <a class="code" href="character_8h.html#a28256deb3e43854efdc7035ae555212ba18eb54216d0a6c8fcfcc347228e1d8d3">sleepiness_levels::TIRED</a> / 2 ) ) {</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;            }</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160;        }</div>
<div class="line"><a name="l02545"></a><span class="lineno"> 2545</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;    };</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    <span class="comment">// TODO: More risky attempts at sleep when exhausted</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    <span class="keywordflow">if</span>( could_sleep() ) {</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;            <span class="comment">// TODO: Make tired NPCs handle sleep offscreen</span></div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;            <a class="code" href="classCharacter.html#a30213377669d5f9a8288b1123e849205">set_sleepiness</a>( 0 );</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        }</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160; </div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7acd5a026299ddf6f44abcae44c3c7838d">ally_rule::allow_sleep</a> ) ||</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;            <a class="code" href="classCharacter.html#a241e50ee41a2a2b54f1c1329cb60a174">get_sleepiness</a>() &gt; <a class="code" href="character_8h.html#a28256deb3e43854efdc7035ae555212baa82737450ee7c37246cff4af1541525d">sleepiness_levels::MASSIVE_SLEEPINESS</a> ) {</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1c5faa755f1cd29189d4e164dd3b1411">npc_sleep</a>;</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;        }</div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;        <span class="keywordflow">if</span>( player_character.<a class="code" href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">in_sleep_state</a>() ) {</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;            <span class="comment">// TODO: &quot;Guard me while I sleep&quot; command</span></div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1c5faa755f1cd29189d4e164dd3b1411">npc_sleep</a>;</div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        }</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160;    }</div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;    <span class="comment">// TODO: Mutation &amp; trait related needs</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;    <span class="comment">// e.g. finding glasses; getting out of sunlight if we&#39;re an albino; etc.</span></div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160; </div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;}</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160; </div>
<div class="line"><a name="l02570"></a><span class="lineno"><a class="line" href="classnpc.html#a650bd06d1fc1709728d11d30684580af"> 2570</a></span>&#160;<a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="classnpc.html#a650bd06d1fc1709728d11d30684580af">npc::address_player</a>()</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;{</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;    <span class="keywordflow">if</span>( ( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a436461a7ac1efa5ec5f2d53ab20d2b67">NPCATT_TALK</a> || <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a9ccd3ddb03edb6e10f0987b46ffbcc53">NPCATT_RECOVER_GOODS</a> ) &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character ) ) {</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;        <span class="keywordflow">if</span>( player_character.<a class="code" href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">in_sleep_state</a>() ) {</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            <span class="comment">// Leave sleeping characters alone.</span></div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;        }</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &lt;= 6 ) {</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a30c4f16c4a66425e87f3e462c987d762">npc_talk_to_player</a>;    <span class="comment">// Close enough to talk to you</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 10 ) ) {</div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;                <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_lets_talk.translated() );</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            }</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a>;</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;        }</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;    }</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160; </div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4bbe4dbeb972f2da0fcbba0a74cde9df">NPCATT_MUG</a> &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character ) ) {</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) ) {</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;            <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_mug_dontmove.translated() );</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;        }</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a85155639ee95331052d51900b16fdbb1">npc_mug_player</a>;</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;    }</div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160; </div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4a9fa01afc4dc893941ef6a0639dd159">NPCATT_WAIT_FOR_LEAVE</a> ) {</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;        <a class="code" href="classnpc.html#a0e89849551a6cea0a80ab0d882d871c7">patience</a>--;</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a0e89849551a6cea0a80ab0d882d871c7">patience</a> &lt;= 0 ) {</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;            <a class="code" href="classnpc.html#a0e89849551a6cea0a80ab0d882d871c7">patience</a> = 0;</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;            <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a59e2eeab0c7bf7336d7c5fea3a870d2a">NPCATT_KILL</a> );</div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>;</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        }</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;    }</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160; </div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a> ) {</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">npc_flee</a>;</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;    }</div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160; </div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4a0667c489303f36ce9c33ace51e05e1">NPCATT_LEAD</a> ) {</div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &gt;= 12 || !<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character ) ) {</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;            <span class="keywordtype">int</span> intense = <a class="code" href="classCreature.html#a9689d4816bc2d1204c53c114190fde50">get_effect_int</a>( <a class="code" href="npcmove_8cpp.html#ac9543c508e08b7d10d19ecb5f80e1b1c">effect_catch_up</a> );</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;            <span class="keywordflow">if</span>( intense &lt; 10 ) {</div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_keep_up.translated() );</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                <a class="code" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code" href="npcmove_8cpp.html#ac9543c508e08b7d10d19ecb5f80e1b1c">effect_catch_up</a>, 5_turns );</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>;</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;                <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_im_leaving_you.translated() );</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a54aaedf3b06b118cd4d2ca5f63c8695b">NPCATT_NULL</a> );</div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>;</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;            }</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#accabb5b29880e5391317d3abc7ecf569">has_omt_destination</a>() ) {</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">npc_goto_destination</a>;</div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// At goal. Now, waiting on nearby player</span></div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>;</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;        }</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;    }</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;}</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160; </div>
<div class="line"><a name="l02630"></a><span class="lineno"><a class="line" href="classnpc.html#a72a5010d44054d2ba97f29b5226d3b7c"> 2630</a></span>&#160;<a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="classnpc.html#a72a5010d44054d2ba97f29b5226d3b7c">npc::long_term_goal_action</a>()</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;{</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;long_term_goal_action()&quot;</span> );</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160; </div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classmission.html">mission</a> == <a class="code" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6dac33d9490a5bc6bebca7f66a94524600c">NPC_MISSION_SHOPKEEP</a> || <a class="code" href="classmission.html">mission</a> == <a class="code" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6da2b39325e56b1d6ac9e564b19554b1427">NPC_MISSION_SHELTER</a> || ( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp;</div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;            <a class="code" href="classmission.html">mission</a> != <a class="code" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6daf5b83209bc53322e7a58eecfb974a4ce">NPC_MISSION_TRAVELLING</a> ) ) {</div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>;    <span class="comment">// Shopkeepers just stay put.</span></div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;    }</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160; </div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#accabb5b29880e5391317d3abc7ecf569">has_omt_destination</a>() ) {</div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;        <a class="code" href="classnpc.html#a19117ee6b30948e7c6512eadb719e1cc">set_omt_destination</a>();</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;    }</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160; </div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#accabb5b29880e5391317d3abc7ecf569">has_omt_destination</a>() ) {</div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classmission.html">mission</a> != <a class="code" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6daf5b83209bc53322e7a58eecfb974a4ce">NPC_MISSION_TRAVELLING</a> ) {</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;            <a class="code" href="classnpc.html#af5d3062f499ce1874b1ec47f3fa7bf4e">set_mission</a>( <a class="code" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6daf5b83209bc53322e7a58eecfb974a4ce">NPC_MISSION_TRAVELLING</a> );</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;            <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> );</div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;        }</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">npc_goto_destination</a>;</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;    }</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160; </div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>;</div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;}</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160; </div>
<div class="line"><a name="l02654"></a><span class="lineno"><a class="line" href="classnpc.html#a037349e70b7f5c207424db299ac6d5af"> 2654</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classnpc.html#a037349e70b7f5c207424db299ac6d5af">npc::confidence_mult</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;        <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;    }</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160; </div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;    <span class="keywordflow">switch</span>( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a092cd660168a4b1b14529db075e29ea0">aim</a> ) {</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8a6713ee5d6a814f247d20060e75e92c3c">aim_rule::WHEN_CONVENIENT</a>:</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a86a36265d6d5b5c34e93087c963a2376">emergency</a>() ? 1.5f : 1.0f;</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8ad911f54dde5284c4fd43c76c678b8b92">aim_rule::SPRAY</a>:</div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;            <span class="keywordflow">return</span> 2.0f;</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8af6cdc115da7ee195766ffc5b7bddd823">aim_rule::PRECISE</a>:</div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a86a36265d6d5b5c34e93087c963a2376">emergency</a>() ? 1.0f : 0.75f;</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8a8643d6bba01bb025d7510abe977fb486">aim_rule::STRICTLY_PRECISE</a>:</div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;            <span class="keywordflow">return</span> 0.5f;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;    }</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160; </div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160;    <span class="keywordflow">return</span> 1.0f;</div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;}</div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160; </div>
<div class="line"><a name="l02674"></a><span class="lineno"><a class="line" href="classnpc.html#a6c629f03474e0723da4dfa19d8e08bda"> 2674</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classnpc.html#a6c629f03474e0723da4dfa19d8e08bda">npc::confident_shoot_range</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it, <span class="keywordtype">int</span> recoil )<span class="keyword"> const</span></div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;    <span class="keywordtype">int</span> res = 0;</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;    <span class="keywordflow">if</span>( !it.<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;    }</div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160; </div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;m : it.<a class="code" href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">gun_all_modes</a>() ) {</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;        res = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( res, <a class="code" href="classnpc.html#a82c1e391aa196be38ec7ddd7d66bab8d">confident_gun_mode_range</a>( m.second, <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> ) );</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;    }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160;    <span class="keywordflow">return</span> res;</div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;}</div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160; </div>
<div class="line"><a name="l02687"></a><span class="lineno"><a class="line" href="classnpc.html#a82c1e391aa196be38ec7ddd7d66bab8d"> 2687</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classnpc.html#a82c1e391aa196be38ec7ddd7d66bab8d">npc::confident_gun_mode_range</a>( <span class="keyword">const</span> <a class="code" href="classgun__mode.html">gun_mode</a> &amp;gun, <span class="keywordtype">int</span> at_recoil )<span class="keyword"> const</span></div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a> || <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.melee() ) {</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;    }</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160; </div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;    <span class="comment">// Same calculation as in @ref item::info</span></div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;    <span class="comment">// TODO: Extract into common method</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;    <span class="keywordtype">double</span> max_dispersion = <a class="code" href="classCharacter.html#a05331bfbde3df1348a870d987597d29a">get_weapon_dispersion</a>( *( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.target ) ).<a class="code" href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">max</a>() + at_recoil;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;    <span class="keywordtype">double</span> even_chance_range = <a class="code" href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">range_with_even_chance_of_good_hit</a>( max_dispersion );</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;    <span class="keywordtype">double</span> confident_range = even_chance_range * <a class="code" href="classnpc.html#a037349e70b7f5c207424db299ac6d5af">confidence_mult</a>();</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;confident_gun (%s&lt;=%.2f) at %.1f&quot;</span>, <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.tname(), confident_range,</div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;                   max_dispersion );</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;    <span class="keywordflow">return</span> std::max&lt;int&gt;( confident_range, 1 );</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;}</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160; </div>
<div class="line"><a name="l02703"></a><span class="lineno"><a class="line" href="classnpc.html#a7126a9df203ace036c3fa22b1c775d7e"> 2703</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="classnpc.html#a7126a9df203ace036c3fa22b1c775d7e">npc::confident_throw_range</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;thrown, <a class="code" href="classCreature.html">Creature</a> *target )<span class="keyword"> const</span></div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;    <span class="keywordtype">double</span> average_dispersion = <a class="code" href="classCharacter.html#a6853521cfe7399330d90c08271e003b4">throwing_dispersion</a>( thrown, target ) / 2.0;</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160;    <span class="keywordtype">double</span> even_chance_range = ( target == <span class="keyword">nullptr</span> ? 0.5 : target-&gt;<a class="code" href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">ranged_target_size</a>() ) /</div>
<div class="line"><a name="l02707"></a><span class="lineno"> 2707</span>&#160;                               average_dispersion;</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;    <span class="keywordtype">double</span> confident_range = even_chance_range * <a class="code" href="classnpc.html#a037349e70b7f5c207424db299ac6d5af">confidence_mult</a>();</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;confident_throw_range == %d&quot;</span>,</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( confident_range ) );</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( confident_range );</div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;}</div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160; </div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;<span class="comment">// Index defaults to -1, i.e., wielded weapon</span></div>
<div class="line"><a name="l02715"></a><span class="lineno"><a class="line" href="classnpc.html#a3899b6eecb74b6b011eba7082685e968"> 2715</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a3899b6eecb74b6b011eba7082685e968">npc::wont_hit_friend</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;tar, <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it, <span class="keywordtype">bool</span> throwing )<span class="keyword"> const</span></div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;    <span class="comment">// TODO: Get actual dispersion instead of extracting it (badly) from confident range</span></div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    <span class="keywordtype">int</span> confident = throwing ?</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;                    <a class="code" href="classnpc.html#a7126a9df203ace036c3fa22b1c775d7e">confident_throw_range</a>( it, <span class="keyword">nullptr</span> ) :</div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;                    <a class="code" href="classnpc.html#a6c629f03474e0723da4dfa19d8e08bda">confident_shoot_range</a>( it, <a class="code" href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">recoil_total</a>() );</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;    <span class="comment">// if there is no confidence at using weapon, it&#39;s not used at range</span></div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160;    <span class="comment">// zero confidence leads to divide by zero otherwise</span></div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;    <span class="keywordflow">if</span>( confident &lt; 1 ) {</div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;    }</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160; </div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), tar ) == 1 ) {</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;    <span class="comment">// If we&#39;re *really* sure that our aim is dead-on</span></div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;    }</div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160; </div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;    <a class="code" href="classunits_1_1quantity.html">units::angle</a> target_angle = <a class="code" href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), tar );</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160; </div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;    <span class="comment">// TODO: Base on dispersion</span></div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;    <a class="code" href="classunits_1_1quantity.html">units::angle</a> safe_angle = 30_degrees;</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160; </div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;fr : <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a> ) {</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;        <span class="keyword">const</span> <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> ally_p = fr.lock();</div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;        <span class="keywordflow">if</span>( !ally_p ) {</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;        }</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;        <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> &amp;<a class="code" href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a2ad733df56aaafa5650bafc9c98c6ffb">ally</a> = *ally_p;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160; </div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;        <span class="comment">// TODO: Extract common functions with turret target selection</span></div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;        <a class="code" href="classunits_1_1quantity.html">units::angle</a> safe_angle_ally = safe_angle;</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;        <span class="keywordtype">int</span> ally_dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a2ad733df56aaafa5650bafc9c98c6ffb">ally</a>.pos() );</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;        <span class="keywordflow">if</span>( ally_dist &lt; 3 ) {</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;            safe_angle_ally += ( 3 - ally_dist ) * 30_degrees;</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;        }</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160; </div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;        <a class="code" href="classunits_1_1quantity.html">units::angle</a> ally_angle = <a class="code" href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a2ad733df56aaafa5650bafc9c98c6ffb">ally</a>.pos() );</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;        <a class="code" href="classunits_1_1quantity.html">units::angle</a> angle_diff = <a class="code" href="namespaceunits.html#a86330975eec4fe39c48b40e85afe151b">units::fabs</a>( ally_angle - target_angle );</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;        angle_diff = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( 360_degrees - angle_diff, angle_diff );</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;        <span class="keywordflow">if</span>( angle_diff &lt; safe_angle_ally ) {</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;            <span class="comment">// TODO: Disable NPC whining is it&#39;s other NPC who prevents aiming</span></div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;        }</div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;    }</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160; </div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;}</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160; </div>
<div class="line"><a name="l02762"></a><span class="lineno"><a class="line" href="classnpc.html#add86c8a6ccc62fd3efa2377ffa00fc15"> 2762</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#add86c8a6ccc62fd3efa2377ffa00fc15">npc::enough_time_to_reload</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;gun )<span class="keyword"> const</span></div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    <span class="keywordtype">int</span> rltime = <a class="code" href="classCharacter.html#a57755c95d5b0189de2858f4ea2637b87">item_reload_cost</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>, <a class="code" href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a447b7147e84be512208dcc0995d67ebc">item</a>( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_default() ),</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160;                                   <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_capacity(</div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;                                       <a class="code" href="item__factory_8cpp.html#a62fc9d4e4ca8f0e62b4556f5f65b666c">item_controller</a>-&gt;find_template( <a class="code" href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">gun</a>.ammo_default() )-&gt;ammo-&gt;type ) );</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> turns_til_reloaded = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>( rltime ) / <a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>();</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160; </div>
<div class="line"><a name="l02769"></a><span class="lineno"> 2769</span>&#160;    <span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> *target = <a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">current_target</a>();</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;    <span class="keywordflow">if</span>( target == <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s can&#39;t see anyone around: great time to reload.&quot;</span>,</div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;    }</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160; </div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> distance = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), target-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> target_speed = target-&gt;<a class="code" href="classCreature.html#a23ca807a88c3b940eb5b68461849b7df">speed_rating</a>();</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">float</span> turns_til_reached = distance / target_speed;</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160;    <span class="keywordflow">if</span>( target-&gt;<a class="code" href="classCreature.html#ac209d32cbfd3774af3d5c0500e2fae52">is_avatar</a>() || target-&gt;<a class="code" href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">is_npc</a>() ) {</div>
<div class="line"><a name="l02780"></a><span class="lineno"> 2780</span>&#160;        <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;foe = <span class="keyword">dynamic_cast&lt;</span><span class="keyword">const </span><a class="code" href="classCharacter.html">Character</a> &amp;<span class="keyword">&gt;</span>( *target );</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;        <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = foe.<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>();</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;        <span class="comment">// TODO: Allow reloading if the player has a low accuracy gun</span></div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( foe ) &amp;&amp; <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> &amp;&amp; <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() &amp;&amp; rltime &gt; 200 &amp;&amp;</div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;            <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>-&gt;<a class="code" href="classitem.html#a77cad1ee17273a24e50fe42e03eea269">gun_range</a>( <span class="keyword">true</span> ) &gt; distance + turns_til_reloaded / target_speed ) {</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;            <span class="comment">// Don&#39;t take longer than 2 turns if player has a gun</span></div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s is shy about reloading with &amp;s standing right there.&quot;</span>,</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;                           <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>, foe.<a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;        }</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    }</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160; </div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    <span class="comment">// TODO: Handle monsters with ranged attacks and players with CBMs</span></div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s turns to reload: %i./nTurns til reached: %i.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>,</div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;                   <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( turns_til_reloaded ), <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( turns_til_reached ) );</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;    <span class="keywordflow">return</span> turns_til_reloaded &lt; turns_til_reached;</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160;}</div>
<div class="line"><a name="l02797"></a><span class="lineno"> 2797</span>&#160; </div>
<div class="line"><a name="l02798"></a><span class="lineno"><a class="line" href="classnpc.html#a8659ec918e22207511ebed3a20afb844"> 2798</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a8659ec918e22207511ebed3a20afb844">npc::aim</a>( <span class="keyword">const</span> <a class="code" href="structTarget__attributes.html">Target_attributes</a> &amp;target_attributes )</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;{</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>();</div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    <span class="keywordtype">double</span> aim_amount = <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> ? <a class="code" href="classCharacter.html#a6243be833eae8764b8dc841fb05cf867">aim_per_move</a>( *<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>, <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> ) : 0.0;</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="keyword">const</span> <a class="code" href="structaim__mods__cache.html">aim_mods_cache</a> aim_cache = <a class="code" href="classCharacter.html#aa58280d717f23351fb1cdc6f7a83047f">gen_aim_mods_cache</a>( *<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> );</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    <span class="keywordflow">while</span>( aim_amount &gt; 0 &amp;&amp; <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> &gt; 0 &amp;&amp; <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> &gt; 0 ) {</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;        <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>--;</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;        <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> -= aim_amount;</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;        <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0.0, <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> );</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;        aim_amount = <a class="code" href="classCharacter.html#a6243be833eae8764b8dc841fb05cf867">aim_per_move</a>( *<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a>, <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a>, target_attributes, { std::ref( aim_cache ) } );</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;    }</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;}</div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160; </div>
<div class="line"><a name="l02811"></a><span class="lineno"><a class="line" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373"> 2811</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">npc::update_path</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p, <span class="keyword">const</span> <span class="keywordtype">bool</span> no_bashing, <span class="keywordtype">bool</span> <a class="code" href="creature_8h.html#a4b73e33b57ae387dc418906492d5f998">force</a> )</div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;{</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;    <span class="keywordflow">if</span>( p == <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) {</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    }</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160; </div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    <span class="keywordflow">while</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() &amp;&amp; <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0] == <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) {</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.erase( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.begin() );</div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;    }</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160; </div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;        <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;<a class="code" href="achievement_8cpp.html#a89b60f534d269451d6fdb9be657dcb09a98bd1c45684cf587ac2347a92dd7bb51">last</a> = <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.size() - 1];</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="achievement_8cpp.html#a89b60f534d269451d6fdb9be657dcb09a98bd1c45684cf587ac2347a92dd7bb51">last</a> == p &amp;&amp; ( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0].z != <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() || <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0], <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &lt;= 1 ) ) {</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160;            <span class="comment">// Our path already leads to that point, no need to recalculate</span></div>
<div class="line"><a name="l02826"></a><span class="lineno"> 2826</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02827"></a><span class="lineno"> 2827</span>&#160;        }</div>
<div class="line"><a name="l02828"></a><span class="lineno"> 2828</span>&#160;    }</div>
<div class="line"><a name="l02829"></a><span class="lineno"> 2829</span>&#160; </div>
<div class="line"><a name="l02830"></a><span class="lineno"> 2830</span>&#160;    std::vector&lt;tripoint&gt; new_path = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">route</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p, <a class="code" href="classnpc.html#ab117ea356d49855e02448774397d23b9">get_pathfinding_settings</a>( no_bashing ),</div>
<div class="line"><a name="l02831"></a><span class="lineno"> 2831</span>&#160;                                     <a class="code" href="classnpc.html#acb437607e20194f9d5b94c95b860b744">get_path_avoid</a>() );</div>
<div class="line"><a name="l02832"></a><span class="lineno"> 2832</span>&#160;    <span class="keywordflow">if</span>( new_path.empty() ) {</div>
<div class="line"><a name="l02833"></a><span class="lineno"> 2833</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.empty() ) {</div>
<div class="line"><a name="l02834"></a><span class="lineno"> 2834</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.erase( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">sound_alerts</a>.begin() );</div>
<div class="line"><a name="l02835"></a><span class="lineno"> 2835</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;failed to path to sound alert %d,%d,%d-&gt;%d,%d,%d&quot;</span>,</div>
<div class="line"><a name="l02836"></a><span class="lineno"> 2836</span>&#160;                           <a class="code" href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">posx</a>(), <a class="code" href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">posy</a>(), <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>(), p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l02837"></a><span class="lineno"> 2837</span>&#160;        }</div>
<div class="line"><a name="l02838"></a><span class="lineno"> 2838</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;Failed to path %d,%d,%d-&gt;%d,%d,%d&quot;</span>,</div>
<div class="line"><a name="l02839"></a><span class="lineno"> 2839</span>&#160;                       <a class="code" href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">posx</a>(), <a class="code" href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">posy</a>(), <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>(), p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l02840"></a><span class="lineno"> 2840</span>&#160;    }</div>
<div class="line"><a name="l02841"></a><span class="lineno"> 2841</span>&#160; </div>
<div class="line"><a name="l02842"></a><span class="lineno"> 2842</span>&#160;    <span class="keywordflow">while</span>( !new_path.empty() &amp;&amp; new_path[0] == <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) {</div>
<div class="line"><a name="l02843"></a><span class="lineno"> 2843</span>&#160;        new_path.erase( new_path.begin() );</div>
<div class="line"><a name="l02844"></a><span class="lineno"> 2844</span>&#160;    }</div>
<div class="line"><a name="l02845"></a><span class="lineno"> 2845</span>&#160; </div>
<div class="line"><a name="l02846"></a><span class="lineno"> 2846</span>&#160;    <span class="keywordflow">if</span>( !new_path.empty() || <a class="code" href="creature_8h.html#a4b73e33b57ae387dc418906492d5f998">force</a> ) {</div>
<div class="line"><a name="l02847"></a><span class="lineno"> 2847</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a> = std::move( new_path );</div>
<div class="line"><a name="l02848"></a><span class="lineno"> 2848</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l02849"></a><span class="lineno"> 2849</span>&#160;    }</div>
<div class="line"><a name="l02850"></a><span class="lineno"> 2850</span>&#160; </div>
<div class="line"><a name="l02851"></a><span class="lineno"> 2851</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l02852"></a><span class="lineno"> 2852</span>&#160;}</div>
<div class="line"><a name="l02853"></a><span class="lineno"> 2853</span>&#160; </div>
<div class="line"><a name="l02854"></a><span class="lineno"><a class="line" href="classnpc.html#a38ec197c8f87003e2bce7fc45ddc57e3"> 2854</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">npc::update_path</a>( <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> &amp;p, <span class="keyword">const</span> <span class="keywordtype">bool</span> no_bashing, <span class="keywordtype">bool</span> <a class="code" href="creature_8h.html#a4b73e33b57ae387dc418906492d5f998">force</a> )</div>
<div class="line"><a name="l02855"></a><span class="lineno"> 2855</span>&#160;{</div>
<div class="line"><a name="l02856"></a><span class="lineno"> 2856</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( p.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>(), no_bashing, <a class="code" href="creature_8h.html#a4b73e33b57ae387dc418906492d5f998">force</a> );</div>
<div class="line"><a name="l02857"></a><span class="lineno"> 2857</span>&#160;}</div>
<div class="line"><a name="l02858"></a><span class="lineno"> 2858</span>&#160; </div>
<div class="line"><a name="l02859"></a><span class="lineno"><a class="line" href="classnpc.html#ad2e3df76c8b9cf5027ac0c6a6ed2109f"> 2859</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#ad2e3df76c8b9cf5027ac0c6a6ed2109f">npc::set_guard_pos</a>( <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> &amp;p )</div>
<div class="line"><a name="l02860"></a><span class="lineno"> 2860</span>&#160;{</div>
<div class="line"><a name="l02861"></a><span class="lineno"> 2861</span>&#160;    <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> = p;</div>
<div class="line"><a name="l02862"></a><span class="lineno"> 2862</span>&#160;}</div>
<div class="line"><a name="l02863"></a><span class="lineno"> 2863</span>&#160; </div>
<div class="line"><a name="l02864"></a><span class="lineno"><a class="line" href="classnpc.html#a9617195bc7f6266927e51fb823f40c3c"> 2864</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a9617195bc7f6266927e51fb823f40c3c">npc::can_open_door</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p, <span class="keyword">const</span> <span class="keywordtype">bool</span> inside )<span class="keyword"> const</span></div>
<div class="line"><a name="l02865"></a><span class="lineno"> 2865</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02866"></a><span class="lineno"> 2866</span>&#160;    <span class="keywordflow">return</span> !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() &amp;&amp; !<a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7ab68510088c71b865b342aa91d94ac960">ally_rule::avoid_doors</a> ) &amp;&amp;</div>
<div class="line"><a name="l02867"></a><span class="lineno"> 2867</span>&#160;           <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a9ac1c68c3941554a86bff27bf1ce2389">open_door</a>( *<span class="keyword">this</span>, p, inside, <span class="keyword">true</span> );</div>
<div class="line"><a name="l02868"></a><span class="lineno"> 2868</span>&#160;}</div>
<div class="line"><a name="l02869"></a><span class="lineno"> 2869</span>&#160; </div>
<div class="line"><a name="l02870"></a><span class="lineno"><a class="line" href="classnpc.html#a074b34b0dee2182901293c937d523f04"> 2870</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a074b34b0dee2182901293c937d523f04">npc::can_move_to</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p, <span class="keywordtype">bool</span> no_bashing )<span class="keyword"> const</span></div>
<div class="line"><a name="l02871"></a><span class="lineno"> 2871</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l02872"></a><span class="lineno"> 2872</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l02873"></a><span class="lineno"> 2873</span>&#160; </div>
<div class="line"><a name="l02874"></a><span class="lineno"> 2874</span>&#160;    <span class="comment">// Allow moving into any bashable spots, but penalize them during pathing</span></div>
<div class="line"><a name="l02875"></a><span class="lineno"> 2875</span>&#160;    <span class="comment">// Doors are not passable for hallucinations</span></div>
<div class="line"><a name="l02876"></a><span class="lineno"> 2876</span>&#160;    <span class="keywordflow">return</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p ) &lt;= 1 &amp;&amp; here.<a class="code" href="classmap.html#a78e0a35a5041e0daf6e7a2a4ec522014">has_floor_or_water</a>( p ) &amp;&amp; !<a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;is_dangerous_tile( p ) &amp;&amp;</div>
<div class="line"><a name="l02877"></a><span class="lineno"> 2877</span>&#160;            ( here.<a class="code" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) || ( <a class="code" href="classnpc.html#a9617195bc7f6266927e51fb823f40c3c">can_open_door</a>( p, !here.<a class="code" href="classmap.html#a3bc75c8b706a54c1575b4460b2f363b1">is_outside</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) &amp;&amp; !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) ||</div>
<div class="line"><a name="l02878"></a><span class="lineno"> 2878</span>&#160;              ( !no_bashing &amp;&amp; here.<a class="code" href="classmap.html#a6c9fdb474119bafd75efa7c12e0bec1a">bash_rating</a>( <a class="code" href="classnpc.html#a60031636b41769c87690d2fc6aae59eb">smash_ability</a>(), p ) &gt; 0 ) )</div>
<div class="line"><a name="l02879"></a><span class="lineno"> 2879</span>&#160;          );</div>
<div class="line"><a name="l02880"></a><span class="lineno"> 2880</span>&#160;}</div>
<div class="line"><a name="l02881"></a><span class="lineno"> 2881</span>&#160; </div>
<div class="line"><a name="l02882"></a><span class="lineno"><a class="line" href="classnpc.html#ac17b98393632654d6724c71251bbdadf"> 2882</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#ac17b98393632654d6724c71251bbdadf">npc::move_to</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;pt, <span class="keywordtype">bool</span> no_bashing, std::set&lt;tripoint&gt; *nomove )</div>
<div class="line"><a name="l02883"></a><span class="lineno"> 2883</span>&#160;{</div>
<div class="line"><a name="l02884"></a><span class="lineno"> 2884</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> p = pt;</div>
<div class="line"><a name="l02885"></a><span class="lineno"> 2885</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l02886"></a><span class="lineno"> 2886</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">sees_dangerous_field</a>( p )</div>
<div class="line"><a name="l02887"></a><span class="lineno"> 2887</span>&#160;        || ( nomove != <span class="keyword">nullptr</span> &amp;&amp; nomove-&gt;find( p ) != nomove-&gt;end() ) ) {</div>
<div class="line"><a name="l02888"></a><span class="lineno"> 2888</span>&#160;        <span class="comment">// Move to a neighbor field instead, if possible.</span></div>
<div class="line"><a name="l02889"></a><span class="lineno"> 2889</span>&#160;        <span class="comment">// Maybe this code already exists somewhere?</span></div>
<div class="line"><a name="l02890"></a><span class="lineno"> 2890</span>&#160;        <span class="keyword">auto</span> other_points = here.<a class="code" href="classmap.html#a04983d87d4316ae7adc5e1d52220dd90">get_dir_circle</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p );</div>
<div class="line"><a name="l02891"></a><span class="lineno"> 2891</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;ot : other_points ) {</div>
<div class="line"><a name="l02892"></a><span class="lineno"> 2892</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">could_move_onto</a>( ot )</div>
<div class="line"><a name="l02893"></a><span class="lineno"> 2893</span>&#160;                &amp;&amp; ( nomove == <span class="keyword">nullptr</span> || nomove-&gt;find( ot ) == nomove-&gt;end() ) ) {</div>
<div class="line"><a name="l02894"></a><span class="lineno"> 2894</span>&#160; </div>
<div class="line"><a name="l02895"></a><span class="lineno"> 2895</span>&#160;                p = ot;</div>
<div class="line"><a name="l02896"></a><span class="lineno"> 2896</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02897"></a><span class="lineno"> 2897</span>&#160;            }</div>
<div class="line"><a name="l02898"></a><span class="lineno"> 2898</span>&#160;        }</div>
<div class="line"><a name="l02899"></a><span class="lineno"> 2899</span>&#160;    }</div>
<div class="line"><a name="l02900"></a><span class="lineno"> 2900</span>&#160; </div>
<div class="line"><a name="l02901"></a><span class="lineno"> 2901</span>&#160;    <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( p ).<a class="code" href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">part_with_feature</a>( <a class="code" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea563fb2626cff0acc6c8273fef3e3a8d0">VPFLAG_CARGO</a>, <span class="keyword">true</span> ) &amp;&amp; !<a class="code" href="classCharacter.html#a33eb1760d53a4076bbf192bae1e4209f">move_in_vehicle</a>( <span class="keyword">this</span>, p ) ) {</div>
<div class="line"><a name="l02902"></a><span class="lineno"> 2902</span>&#160;        <span class="keyword">auto</span> other_points = here.<a class="code" href="classmap.html#a04983d87d4316ae7adc5e1d52220dd90">get_dir_circle</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p );</div>
<div class="line"><a name="l02903"></a><span class="lineno"> 2903</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;ot : other_points ) {</div>
<div class="line"><a name="l02904"></a><span class="lineno"> 2904</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">could_move_onto</a>( ot ) &amp;&amp; ( nomove == <span class="keyword">nullptr</span> || nomove-&gt;find( ot ) == nomove-&gt;end() ) ) {</div>
<div class="line"><a name="l02905"></a><span class="lineno"> 2905</span>&#160;                p = ot;</div>
<div class="line"><a name="l02906"></a><span class="lineno"> 2906</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l02907"></a><span class="lineno"> 2907</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02908"></a><span class="lineno"> 2908</span>&#160;                <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l02909"></a><span class="lineno"> 2909</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l02910"></a><span class="lineno"> 2910</span>&#160;                <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02911"></a><span class="lineno"> 2911</span>&#160;            }</div>
<div class="line"><a name="l02912"></a><span class="lineno"> 2912</span>&#160;        }</div>
<div class="line"><a name="l02913"></a><span class="lineno"> 2913</span>&#160;    }</div>
<div class="line"><a name="l02914"></a><span class="lineno"> 2914</span>&#160; </div>
<div class="line"><a name="l02915"></a><span class="lineno"> 2915</span>&#160;    <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a name="l02916"></a><span class="lineno"> 2916</span>&#160; </div>
<div class="line"><a name="l02917"></a><span class="lineno"> 2917</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">effect_stunned</a> ) || <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#adcaf70773541073a0d4cdfce4b857bf7">effect_psi_stunned</a> ) ) {</div>
<div class="line"><a name="l02918"></a><span class="lineno"> 2918</span>&#160;        p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> = <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( <a class="code" href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">posx</a>() - 1, <a class="code" href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">posx</a>() + 1 );</div>
<div class="line"><a name="l02919"></a><span class="lineno"> 2919</span>&#160;        p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> = <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( <a class="code" href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">posy</a>() - 1, <a class="code" href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">posy</a>() + 1 );</div>
<div class="line"><a name="l02920"></a><span class="lineno"> 2920</span>&#160;        p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> = <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>();</div>
<div class="line"><a name="l02921"></a><span class="lineno"> 2921</span>&#160;    }</div>
<div class="line"><a name="l02922"></a><span class="lineno"> 2922</span>&#160; </div>
<div class="line"><a name="l02923"></a><span class="lineno"> 2923</span>&#160;    <span class="comment">// nomove is used to resolve recursive invocation, so reset destination no</span></div>
<div class="line"><a name="l02924"></a><span class="lineno"> 2924</span>&#160;    <span class="comment">// matter it was changed by stunned effect or not.</span></div>
<div class="line"><a name="l02925"></a><span class="lineno"> 2925</span>&#160;    <span class="keywordflow">if</span>( nomove != <span class="keyword">nullptr</span> &amp;&amp; nomove-&gt;find( p ) != nomove-&gt;end() ) {</div>
<div class="line"><a name="l02926"></a><span class="lineno"> 2926</span>&#160;        p = <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l02927"></a><span class="lineno"> 2927</span>&#160;    }</div>
<div class="line"><a name="l02928"></a><span class="lineno"> 2928</span>&#160; </div>
<div class="line"><a name="l02929"></a><span class="lineno"> 2929</span>&#160;    <span class="comment">// &quot;Long steps&quot; are allowed when crossing z-levels</span></div>
<div class="line"><a name="l02930"></a><span class="lineno"> 2930</span>&#160;    <span class="comment">// Stairs teleport the player too</span></div>
<div class="line"><a name="l02931"></a><span class="lineno"> 2931</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p ) &gt; 1 &amp;&amp; p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() ) {</div>
<div class="line"><a name="l02932"></a><span class="lineno"> 2932</span>&#160;        <span class="comment">// On the same level? Not so much. Something weird happened</span></div>
<div class="line"><a name="l02933"></a><span class="lineno"> 2933</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l02934"></a><span class="lineno"> 2934</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l02935"></a><span class="lineno"> 2935</span>&#160;    }</div>
<div class="line"><a name="l02936"></a><span class="lineno"> 2936</span>&#160;    <a class="code" href="classcreature__tracker.html">creature_tracker</a> &amp;creatures = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>();</div>
<div class="line"><a name="l02937"></a><span class="lineno"> 2937</span>&#160;    <span class="keywordtype">bool</span> attacking = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02938"></a><span class="lineno"> 2938</span>&#160;    <span class="keywordflow">if</span>( creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>&lt;<a class="code" href="classmonster.html">monster</a>&gt;( p ) ) {</div>
<div class="line"><a name="l02939"></a><span class="lineno"> 2939</span>&#160;        attacking = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02940"></a><span class="lineno"> 2940</span>&#160;    }</div>
<div class="line"><a name="l02941"></a><span class="lineno"> 2941</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a37772343c5d5a20510bafe1890a5a839">move_effects</a>( attacking ) ) {</div>
<div class="line"><a name="l02942"></a><span class="lineno"> 2942</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l02943"></a><span class="lineno"> 2943</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02944"></a><span class="lineno"> 2944</span>&#160;    }</div>
<div class="line"><a name="l02945"></a><span class="lineno"> 2945</span>&#160; </div>
<div class="line"><a name="l02946"></a><span class="lineno"> 2946</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *critter = creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( p );</div>
<div class="line"><a name="l02947"></a><span class="lineno"> 2947</span>&#160;    <span class="keywordflow">if</span>( critter != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l02948"></a><span class="lineno"> 2948</span>&#160;        <span class="keywordflow">if</span>( critter == <span class="keyword">this</span> ) { <span class="comment">// We&#39;re just pausing!</span></div>
<div class="line"><a name="l02949"></a><span class="lineno"> 2949</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l02950"></a><span class="lineno"> 2950</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02951"></a><span class="lineno"> 2951</span>&#160;        }</div>
<div class="line"><a name="l02952"></a><span class="lineno"> 2952</span>&#160;        <span class="keyword">const</span> <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217">Creature::Attitude</a> att = <a class="code" href="classnpc.html#a06abd7ca2094ae40ba3aa9dbd53311e4">attitude_to</a>( *critter );</div>
<div class="line"><a name="l02953"></a><span class="lineno"> 2953</span>&#160;        <span class="keywordflow">if</span>( att == <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747">Attitude::HOSTILE</a> ) {</div>
<div class="line"><a name="l02954"></a><span class="lineno"> 2954</span>&#160;            <span class="keywordflow">if</span>( !no_bashing ) {</div>
<div class="line"><a name="l02955"></a><span class="lineno"> 2955</span>&#160;                <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;cant_flee&quot;</span>, 5_turns + <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, 5 ) * 1_turns );</div>
<div class="line"><a name="l02956"></a><span class="lineno"> 2956</span>&#160;                <a class="code" href="classCharacter.html#a22c61a1b7ab6ae71a3cac5f92bca2fd5">melee_attack</a>( *critter, <span class="keyword">true</span> );</div>
<div class="line"><a name="l02957"></a><span class="lineno"> 2957</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02958"></a><span class="lineno"> 2958</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l02959"></a><span class="lineno"> 2959</span>&#160;            }</div>
<div class="line"><a name="l02960"></a><span class="lineno"> 2960</span>&#160; </div>
<div class="line"><a name="l02961"></a><span class="lineno"> 2961</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02962"></a><span class="lineno"> 2962</span>&#160;        }</div>
<div class="line"><a name="l02963"></a><span class="lineno"> 2963</span>&#160; </div>
<div class="line"><a name="l02964"></a><span class="lineno"> 2964</span>&#160;        <span class="keywordflow">if</span>( critter-&gt;<a class="code" href="classCreature.html#ac209d32cbfd3774af3d5c0500e2fae52">is_avatar</a>() ) {</div>
<div class="line"><a name="l02965"></a><span class="lineno"> 2965</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *critter ) ) {</div>
<div class="line"><a name="l02966"></a><span class="lineno"> 2966</span>&#160;                <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_let_me_pass.translated() );</div>
<div class="line"><a name="l02967"></a><span class="lineno"> 2967</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02968"></a><span class="lineno"> 2968</span>&#160;                <a class="code" href="classCreature.html#a6410520bceb652ba361502f404fc1005">stumble_invis</a>( *critter );</div>
<div class="line"><a name="l02969"></a><span class="lineno"> 2969</span>&#160;            }</div>
<div class="line"><a name="l02970"></a><span class="lineno"> 2970</span>&#160;        }</div>
<div class="line"><a name="l02971"></a><span class="lineno"> 2971</span>&#160; </div>
<div class="line"><a name="l02972"></a><span class="lineno"> 2972</span>&#160;        <span class="comment">// Let NPCs push each other when non-hostile</span></div>
<div class="line"><a name="l02973"></a><span class="lineno"> 2973</span>&#160;        <span class="comment">// TODO: Have them attack each other when hostile</span></div>
<div class="line"><a name="l02974"></a><span class="lineno"> 2974</span>&#160;        <a class="code" href="classnpc.html">npc</a> *np = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="classnpc.html">npc</a> *<span class="keyword">&gt;</span>( critter );</div>
<div class="line"><a name="l02975"></a><span class="lineno"> 2975</span>&#160;        <span class="keywordflow">if</span>( np != <span class="keyword">nullptr</span> &amp;&amp; !np-&gt;<a class="code" href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">in_sleep_state</a>() ) {</div>
<div class="line"><a name="l02976"></a><span class="lineno"> 2976</span>&#160;            std::unique_ptr&lt;std::set&lt;tripoint&gt;&gt; newnomove;</div>
<div class="line"><a name="l02977"></a><span class="lineno"> 2977</span>&#160;            std::set&lt;tripoint&gt; *realnomove;</div>
<div class="line"><a name="l02978"></a><span class="lineno"> 2978</span>&#160;            <span class="keywordflow">if</span>( nomove != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l02979"></a><span class="lineno"> 2979</span>&#160;                realnomove = nomove;</div>
<div class="line"><a name="l02980"></a><span class="lineno"> 2980</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02981"></a><span class="lineno"> 2981</span>&#160;                <span class="comment">// create the no-move list</span></div>
<div class="line"><a name="l02982"></a><span class="lineno"> 2982</span>&#160;                newnomove = std::make_unique&lt;std::set&lt;tripoint&gt;&gt;();</div>
<div class="line"><a name="l02983"></a><span class="lineno"> 2983</span>&#160;                realnomove = newnomove.get();</div>
<div class="line"><a name="l02984"></a><span class="lineno"> 2984</span>&#160;            }</div>
<div class="line"><a name="l02985"></a><span class="lineno"> 2985</span>&#160;            <span class="comment">// other npcs should not try to move into this npc anymore,</span></div>
<div class="line"><a name="l02986"></a><span class="lineno"> 2986</span>&#160;            <span class="comment">// so infinite loop can be avoided.</span></div>
<div class="line"><a name="l02987"></a><span class="lineno"> 2987</span>&#160;            realnomove-&gt;insert( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l02988"></a><span class="lineno"> 2988</span>&#160;            <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_let_me_pass.translated() );</div>
<div class="line"><a name="l02989"></a><span class="lineno"> 2989</span>&#160;            np-&gt;<a class="code" href="classnpc.html#abdbbb214958165a75a2e0b7a4ae2187f">move_away_from</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="keyword">true</span>, realnomove );</div>
<div class="line"><a name="l02990"></a><span class="lineno"> 2990</span>&#160;            <span class="comment">// if we moved NPC, readjust their path, so NPCs don&#39;t jostle each other out of their activity paths.</span></div>
<div class="line"><a name="l02991"></a><span class="lineno"> 2991</span>&#160;            <span class="keywordflow">if</span>( np-&gt;<a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4ae5449845013a531dc5def34dce450be9">NPCATT_ACTIVITY</a> ) {</div>
<div class="line"><a name="l02992"></a><span class="lineno"> 2992</span>&#160;                std::vector&lt;tripoint_bub_ms&gt; activity_route = np-&gt;<a class="code" href="classCharacter.html#a05af3f6fab8229b6c4439481421e80b6">get_auto_move_route</a>();</div>
<div class="line"><a name="l02993"></a><span class="lineno"> 2993</span>&#160;                <span class="keywordflow">if</span>( !activity_route.empty() &amp;&amp; !np-&gt;<a class="code" href="classCharacter.html#a73e94730498f4353bf773eba0c3dd69a">has_destination_activity</a>() ) {</div>
<div class="line"><a name="l02994"></a><span class="lineno"> 2994</span>&#160;                    <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> final_destination;</div>
<div class="line"><a name="l02995"></a><span class="lineno"> 2995</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a3e8d89aafa00fbeae676c54433ee6d75">destination_point</a> ) {</div>
<div class="line"><a name="l02996"></a><span class="lineno"> 2996</span>&#160;                        final_destination = here.<a class="code" href="classmap.html#a1cc29653b8305e7192311c05a0bd4c99">bub_from_abs</a>( *<a class="code" href="classCharacter.html#a3e8d89aafa00fbeae676c54433ee6d75">destination_point</a> );</div>
<div class="line"><a name="l02997"></a><span class="lineno"> 2997</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l02998"></a><span class="lineno"> 2998</span>&#160;                        final_destination = activity_route.back();</div>
<div class="line"><a name="l02999"></a><span class="lineno"> 2999</span>&#160;                    }</div>
<div class="line"><a name="l03000"></a><span class="lineno"> 3000</span>&#160;                    <span class="comment">// TODO: fix point types</span></div>
<div class="line"><a name="l03001"></a><span class="lineno"> 3001</span>&#160;                    np-&gt;<a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( final_destination.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() );</div>
<div class="line"><a name="l03002"></a><span class="lineno"> 3002</span>&#160;                }</div>
<div class="line"><a name="l03003"></a><span class="lineno"> 3003</span>&#160;            }</div>
<div class="line"><a name="l03004"></a><span class="lineno"> 3004</span>&#160;        }</div>
<div class="line"><a name="l03005"></a><span class="lineno"> 3005</span>&#160; </div>
<div class="line"><a name="l03006"></a><span class="lineno"> 3006</span>&#160;        <span class="keywordflow">if</span>( critter-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() == p ) {</div>
<div class="line"><a name="l03007"></a><span class="lineno"> 3007</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03008"></a><span class="lineno"> 3008</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03009"></a><span class="lineno"> 3009</span>&#160;        }</div>
<div class="line"><a name="l03010"></a><span class="lineno"> 3010</span>&#160;    }</div>
<div class="line"><a name="l03011"></a><span class="lineno"> 3011</span>&#160; </div>
<div class="line"><a name="l03012"></a><span class="lineno"> 3012</span>&#160;    <span class="comment">// Boarding moving vehicles is fine, unboarding isn&#39;t</span></div>
<div class="line"><a name="l03013"></a><span class="lineno"> 3013</span>&#160;    <span class="keywordtype">bool</span> moved = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03014"></a><span class="lineno"> 3014</span>&#160;    <span class="keywordflow">if</span>( <span class="keyword">const</span> <a class="code" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l03015"></a><span class="lineno"> 3015</span>&#160;        <span class="keyword">const</span> <a class="code" href="classoptional__vpart__position.html">optional_vpart_position</a> ovp = here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( p );</div>
<div class="line"><a name="l03016"></a><span class="lineno"> 3016</span>&#160;        <span class="keywordflow">if</span>( vp-&gt;vehicle().is_moving() &amp;&amp;</div>
<div class="line"><a name="l03017"></a><span class="lineno"> 3017</span>&#160;            ( <a class="code" href="vpart__position_8h.html#a8da46e924794d004c9899494ecd600c5">veh_pointer_or_null</a>( ovp ) != <a class="code" href="vpart__position_8h.html#a8da46e924794d004c9899494ecd600c5">veh_pointer_or_null</a>( vp ) ||</div>
<div class="line"><a name="l03018"></a><span class="lineno"> 3018</span>&#160;              !ovp.<a class="code" href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">part_with_feature</a>( <a class="code" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307eaebc2a9d9402e04973e4ee469daddeda5">VPFLAG_BOARDABLE</a>, <span class="keyword">true</span> ) ) ) {</div>
<div class="line"><a name="l03019"></a><span class="lineno"> 3019</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03020"></a><span class="lineno"> 3020</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03021"></a><span class="lineno"> 3021</span>&#160;        }</div>
<div class="line"><a name="l03022"></a><span class="lineno"> 3022</span>&#160;    }</div>
<div class="line"><a name="l03023"></a><span class="lineno"> 3023</span>&#160; </div>
<div class="line"><a name="l03024"></a><span class="lineno"> 3024</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l03025"></a><span class="lineno"> 3025</span>&#160;    <span class="keywordflow">if</span>( p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> != <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() ) {</div>
<div class="line"><a name="l03026"></a><span class="lineno"> 3026</span>&#160;        <span class="comment">// Z-level move</span></div>
<div class="line"><a name="l03027"></a><span class="lineno"> 3027</span>&#160;        <span class="comment">// For now just teleport to the destination</span></div>
<div class="line"><a name="l03028"></a><span class="lineno"> 3028</span>&#160;        <span class="comment">// TODO: Make it properly find the tile to move to</span></div>
<div class="line"><a name="l03029"></a><span class="lineno"> 3029</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a name="l03030"></a><span class="lineno"> 3030</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03031"></a><span class="lineno"> 3031</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03032"></a><span class="lineno"> 3032</span>&#160;        }</div>
<div class="line"><a name="l03033"></a><span class="lineno"> 3033</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l03034"></a><span class="lineno"> 3034</span>&#160;        moved = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03035"></a><span class="lineno"> 3035</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ad6fd62a9ed571c6bf17d577118be3c5a">effect_stumbled_into_invisible</a> ) &amp;&amp;</div>
<div class="line"><a name="l03036"></a><span class="lineno"> 3036</span>&#160;               here.<a class="code" href="classmap.html#aa69021d452dbc555723d55d7c9fe98ef">has_field_at</a>( p, <a class="code" href="npcmove_8cpp.html#a31e2ef0b23e31f445746b9eaabbeb600">field_fd_last_known</a> ) &amp;&amp; !<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( player_character ) &amp;&amp;</div>
<div class="line"><a name="l03037"></a><span class="lineno"> 3037</span>&#160;               <a class="code" href="classnpc.html#a06abd7ca2094ae40ba3aa9dbd53311e4">attitude_to</a>( player_character ) == <a class="code" href="classCreature.html#a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747">Attitude::HOSTILE</a> ) {</div>
<div class="line"><a name="l03038"></a><span class="lineno"> 3038</span>&#160;        <a class="code" href="classCreature.html#a3e322a5b9e8f42f840ddffa01ec2787f">attack_air</a>( p );</div>
<div class="line"><a name="l03039"></a><span class="lineno"> 3039</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03040"></a><span class="lineno"> 3040</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) &amp;&amp; !here.<a class="code" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac862a199df92b3793a8ce4cf5b039d20">ter_furn_flag::TFLAG_DOOR</a>, p ) ) {</div>
<div class="line"><a name="l03041"></a><span class="lineno"> 3041</span>&#160;        <span class="keywordtype">bool</span> diag = <a class="code" href="line_8cpp.html#a40b9d88f6d95e646490329d0071ec931">trigdist</a> &amp;&amp; <a class="code" href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">posx</a>() != p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> &amp;&amp; <a class="code" href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">posy</a>() != p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>;</div>
<div class="line"><a name="l03042"></a><span class="lineno"> 3042</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a name="l03043"></a><span class="lineno"> 3043</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> base_moves = <a class="code" href="classCharacter.html#a85e40d1109c07460a6e03ff0421c7e2d">run_cost</a>( here.<a class="code" href="classmap.html#a728d97469f08da32ae2108d30d2a51ca">combined_movecost</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p ),</div>
<div class="line"><a name="l03044"></a><span class="lineno"> 3044</span>&#160;                                                diag ) * 100.0 / <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;get_speed();</div>
<div class="line"><a name="l03045"></a><span class="lineno"> 3045</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">double</span> encumb_moves = <a class="code" href="classCharacter.html#a264388843c2319708b9f727da5d15a81">get_weight</a>() / 4800.0_gram;</div>
<div class="line"><a name="l03046"></a><span class="lineno"> 3046</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="math__parser__func_8h.html#ac9196b0cf8d9dd209db9fc00a69a55f6">std::ceil</a>( base_moves + encumb_moves ) ) );</div>
<div class="line"><a name="l03047"></a><span class="lineno"> 3047</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;has_flag( <a class="code" href="mtype_8cpp.html#a1ce59be15eeebc2aa195dc5a5cf38358">mon_flag_RIDEABLE_MECH</a> ) ) {</div>
<div class="line"><a name="l03048"></a><span class="lineno"> 3048</span>&#160;                <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;use_mech_power( 1_kJ );</div>
<div class="line"><a name="l03049"></a><span class="lineno"> 3049</span>&#160;            }</div>
<div class="line"><a name="l03050"></a><span class="lineno"> 3050</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03051"></a><span class="lineno"> 3051</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#a85e40d1109c07460a6e03ff0421c7e2d">run_cost</a>( here.<a class="code" href="classmap.html#a728d97469f08da32ae2108d30d2a51ca">combined_movecost</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p ), diag ) );</div>
<div class="line"><a name="l03052"></a><span class="lineno"> 3052</span>&#160;        }</div>
<div class="line"><a name="l03053"></a><span class="lineno"> 3053</span>&#160;        moved = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03054"></a><span class="lineno"> 3054</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a9ac1c68c3941554a86bff27bf1ce2389">open_door</a>( *<span class="keyword">this</span>, p, !here.<a class="code" href="classmap.html#a3bc75c8b706a54c1575b4460b2f363b1">is_outside</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ), <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l03055"></a><span class="lineno"> 3055</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) { <span class="comment">// hallucinations don&#39;t open doors</span></div>
<div class="line"><a name="l03056"></a><span class="lineno"> 3056</span>&#160;            here.<a class="code" href="classmap.html#a9ac1c68c3941554a86bff27bf1ce2389">open_door</a>( *<span class="keyword">this</span>, p, !here.<a class="code" href="classmap.html#a3bc75c8b706a54c1575b4460b2f363b1">is_outside</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) );</div>
<div class="line"><a name="l03057"></a><span class="lineno"> 3057</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l03058"></a><span class="lineno"> 3058</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// hallucinations teleport through doors</span></div>
<div class="line"><a name="l03059"></a><span class="lineno"> 3059</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l03060"></a><span class="lineno"> 3060</span>&#160;            moved = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03061"></a><span class="lineno"> 3061</span>&#160;        }</div>
<div class="line"><a name="l03062"></a><span class="lineno"> 3062</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="namespacedoors.html#a7e98fe762c930a47288a073dc9792264">doors::can_unlock_door</a>( here, *<span class="keyword">this</span>, <a class="code" href="coordinates_8h.html#a38e880e550bb0688dea9353138da8683">tripoint_bub_ms</a>( pt ) ) ) {</div>
<div class="line"><a name="l03063"></a><span class="lineno"> 3063</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l03064"></a><span class="lineno"> 3064</span>&#160;            <a class="code" href="namespacedoors.html#ac942d0e590fade74ac316bd18fae5357">doors::unlock_door</a>( here, *<span class="keyword">this</span>, <a class="code" href="coordinates_8h.html#a38e880e550bb0688dea9353138da8683">tripoint_bub_ms</a>( pt ) );</div>
<div class="line"><a name="l03065"></a><span class="lineno"> 3065</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03066"></a><span class="lineno"> 3066</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l03067"></a><span class="lineno"> 3067</span>&#160;            moved = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03068"></a><span class="lineno"> 3068</span>&#160;        }</div>
<div class="line"><a name="l03069"></a><span class="lineno"> 3069</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>() &gt; 1 &amp;&amp; here.<a class="code" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac0ec7541a0f28e104d9c691936512481">ter_furn_flag::TFLAG_CLIMBABLE</a>, p ) ) {<span class="comment"></span></div>
<div class="line"><a name="l03070"></a><span class="lineno"> 3070</span>&#160;<span class="comment">        ///\EFFECT_DEX_NPC increases chance to climb CLIMBABLE furniture or terrain</span></div>
<div class="line"><a name="l03071"></a><span class="lineno"> 3071</span>&#160;<span class="comment"></span>        <span class="keywordtype">int</span> climb = <a class="code" href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">get_dex</a>();</div>
<div class="line"><a name="l03072"></a><span class="lineno"> 3072</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( climb ) ) {</div>
<div class="line"><a name="l03073"></a><span class="lineno"> 3073</span>&#160;            <a class="code" href="classnpc.html#a2f119a95de9c88dabad376d9b65dd4e6">add_msg_if_npc</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s tries to climb the %2$s but slips.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(),</div>
<div class="line"><a name="l03074"></a><span class="lineno"> 3074</span>&#160;                            here.<a class="code" href="classmap.html#a51e32639c8df0c90e0743f929bcf2111">tername</a>( p ) );</div>
<div class="line"><a name="l03075"></a><span class="lineno"> 3075</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() * 4 );</div>
<div class="line"><a name="l03076"></a><span class="lineno"> 3076</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03077"></a><span class="lineno"> 3077</span>&#160;            <a class="code" href="classnpc.html#a2f119a95de9c88dabad376d9b65dd4e6">add_msg_if_npc</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s climbs over the %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), here.<a class="code" href="classmap.html#a51e32639c8df0c90e0743f929bcf2111">tername</a>( p ) );</div>
<div class="line"><a name="l03078"></a><span class="lineno"> 3078</span>&#160;            <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( ( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() * 5 ) - ( <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, climb ) * 20 ) );</div>
<div class="line"><a name="l03079"></a><span class="lineno"> 3079</span>&#160;            moved = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03080"></a><span class="lineno"> 3080</span>&#160;        }</div>
<div class="line"><a name="l03081"></a><span class="lineno"> 3081</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !no_bashing &amp;&amp; <a class="code" href="classnpc.html#a60031636b41769c87690d2fc6aae59eb">smash_ability</a>() &gt; 0 &amp;&amp; here.<a class="code" href="classmap.html#a670590e1c5a25d81f56def7c89dbde95">is_bashable</a>( p ) &amp;&amp;</div>
<div class="line"><a name="l03082"></a><span class="lineno"> 3082</span>&#160;               here.<a class="code" href="classmap.html#a6c9fdb474119bafd75efa7c12e0bec1a">bash_rating</a>( <a class="code" href="classnpc.html#a60031636b41769c87690d2fc6aae59eb">smash_ability</a>(), p ) &gt; 0 ) {</div>
<div class="line"><a name="l03083"></a><span class="lineno"> 3083</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() * 0.8 );</div>
<div class="line"><a name="l03084"></a><span class="lineno"> 3084</span>&#160;        here.<a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a>( p, <a class="code" href="classnpc.html#a60031636b41769c87690d2fc6aae59eb">smash_ability</a>() );</div>
<div class="line"><a name="l03085"></a><span class="lineno"> 3085</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03086"></a><span class="lineno"> 3086</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4bbe4dbeb972f2da0fcbba0a74cde9df">NPCATT_MUG</a> ||</div>
<div class="line"><a name="l03087"></a><span class="lineno"> 3087</span>&#160;            <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a59e2eeab0c7bf7336d7c5fea3a870d2a">NPCATT_KILL</a> ||</div>
<div class="line"><a name="l03088"></a><span class="lineno"> 3088</span>&#160;            <a class="code" href="classnpc.html#a5dc98048130339546b98fdace437f983">attitude</a> == <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4a9fa01afc4dc893941ef6a0639dd159">NPCATT_WAIT_FOR_LEAVE</a> ) {</div>
<div class="line"><a name="l03089"></a><span class="lineno"> 3089</span>&#160;            <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a> );</div>
<div class="line"><a name="l03090"></a><span class="lineno"> 3090</span>&#160;        }</div>
<div class="line"><a name="l03091"></a><span class="lineno"> 3091</span>&#160; </div>
<div class="line"><a name="l03092"></a><span class="lineno"> 3092</span>&#160;        <a class="code" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a name="l03093"></a><span class="lineno"> 3093</span>&#160;    }</div>
<div class="line"><a name="l03094"></a><span class="lineno"> 3094</span>&#160; </div>
<div class="line"><a name="l03095"></a><span class="lineno"> 3095</span>&#160;    <span class="keywordflow">if</span>( moved ) {</div>
<div class="line"><a name="l03096"></a><span class="lineno"> 3096</span>&#160;        <a class="code" href="classCharacter.html#a338396f1ca421f7f2284aec2eabf88fb">make_footstep_noise</a>();</div>
<div class="line"><a name="l03097"></a><span class="lineno"> 3097</span>&#160;        <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> old_pos = <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l03098"></a><span class="lineno"> 3098</span>&#160;        <a class="code" href="classCreature.html#ac16dcdb688f6f47c594c98c83528a670">setpos</a>( p );</div>
<div class="line"><a name="l03099"></a><span class="lineno"> 3099</span>&#160;        <span class="keywordflow">if</span>( old_pos.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> - p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> &lt; 0 ) {</div>
<div class="line"><a name="l03100"></a><span class="lineno"> 3100</span>&#160;            <a class="code" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code" href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a21507b40c80068eda19865706fdc2403">FacingDirection::RIGHT</a>;</div>
<div class="line"><a name="l03101"></a><span class="lineno"> 3101</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03102"></a><span class="lineno"> 3102</span>&#160;            <a class="code" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a> = <a class="code" href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a684d325a7303f52e64011467ff5c5758">FacingDirection::LEFT</a>;</div>
<div class="line"><a name="l03103"></a><span class="lineno"> 3103</span>&#160;        }</div>
<div class="line"><a name="l03104"></a><span class="lineno"> 3104</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a name="l03105"></a><span class="lineno"> 3105</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;pos() != <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) {</div>
<div class="line"><a name="l03106"></a><span class="lineno"> 3106</span>&#160;                <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;setpos( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l03107"></a><span class="lineno"> 3107</span>&#160;                <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;facing = <a class="code" href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">facing</a>;</div>
<div class="line"><a name="l03108"></a><span class="lineno"> 3108</span>&#160;                <a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a>-&gt;process_triggers();</div>
<div class="line"><a name="l03109"></a><span class="lineno"> 3109</span>&#160;                here.<a class="code" href="classmap.html#a780bfbdc19649391081c1ad6e0e4aa81">creature_in_field</a>( *<a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a> );</div>
<div class="line"><a name="l03110"></a><span class="lineno"> 3110</span>&#160;                here.<a class="code" href="classmap.html#ae0dae45aeed1b7221d318c0a36abca5b">creature_on_trap</a>( *<a class="code" href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">mounted_creature</a> );</div>
<div class="line"><a name="l03111"></a><span class="lineno"> 3111</span>&#160;            }</div>
<div class="line"><a name="l03112"></a><span class="lineno"> 3112</span>&#160;        }</div>
<div class="line"><a name="l03113"></a><span class="lineno"> 3113</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a03729ff11aa021aad1751ad38ed85c81">ter_furn_flag::TFLAG_UNSTABLE</a>, <a class="code" href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">pos_bub</a>() ) &amp;&amp;</div>
<div class="line"><a name="l03114"></a><span class="lineno"> 3114</span>&#160;            !here.<a class="code" href="classmap.html#a5ee9fe3a08892870a0574b8e1ab4e6b0">has_vehicle_floor</a>( <a class="code" href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">pos_bub</a>() ) ) {</div>
<div class="line"><a name="l03115"></a><span class="lineno"> 3115</span>&#160;            <a class="code" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code" href="npcmove_8cpp.html#aa3320a370fe1f7f1cf6e14918ca20358">effect_bouldering</a>, 1_turns, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03116"></a><span class="lineno"> 3116</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#aa3320a370fe1f7f1cf6e14918ca20358">effect_bouldering</a> ) ) {</div>
<div class="line"><a name="l03117"></a><span class="lineno"> 3117</span>&#160;            <a class="code" href="classCreature.html#a1c6d98c5a339561c989ba3e1ca34eeb8">remove_effect</a>( <a class="code" href="npcmove_8cpp.html#aa3320a370fe1f7f1cf6e14918ca20358">effect_bouldering</a> );</div>
<div class="line"><a name="l03118"></a><span class="lineno"> 3118</span>&#160;        }</div>
<div class="line"><a name="l03119"></a><span class="lineno"> 3119</span>&#160; </div>
<div class="line"><a name="l03120"></a><span class="lineno"> 3120</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a516c0764134cc86b57297811520395f7">has_flag_ter_or_furn</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a069663dd0b045b0a7e5268c906c5790f">ter_furn_flag::TFLAG_NO_SIGHT</a>, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l03121"></a><span class="lineno"> 3121</span>&#160;            <a class="code" href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">add_effect</a>( <a class="code" href="npcmove_8cpp.html#af079f6d5681dabcbc1c4ee804c0ba556">effect_no_sight</a>, 1_turns, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03122"></a><span class="lineno"> 3122</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#af079f6d5681dabcbc1c4ee804c0ba556">effect_no_sight</a> ) ) {</div>
<div class="line"><a name="l03123"></a><span class="lineno"> 3123</span>&#160;            <a class="code" href="classCreature.html#a1c6d98c5a339561c989ba3e1ca34eeb8">remove_effect</a>( <a class="code" href="npcmove_8cpp.html#af079f6d5681dabcbc1c4ee804c0ba556">effect_no_sight</a> );</div>
<div class="line"><a name="l03124"></a><span class="lineno"> 3124</span>&#160;        }</div>
<div class="line"><a name="l03125"></a><span class="lineno"> 3125</span>&#160; </div>
<div class="line"><a name="l03126"></a><span class="lineno"> 3126</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> ) {</div>
<div class="line"><a name="l03127"></a><span class="lineno"> 3127</span>&#160;            here.<a class="code" href="classmap.html#a53d95390d133477f8b4a1ce76482750b">unboard_vehicle</a>( old_pos );</div>
<div class="line"><a name="l03128"></a><span class="lineno"> 3128</span>&#160;        }</div>
<div class="line"><a name="l03129"></a><span class="lineno"> 3129</span>&#160; </div>
<div class="line"><a name="l03130"></a><span class="lineno"> 3130</span>&#160;        <span class="comment">// Close doors behind self (if you can)</span></div>
<div class="line"><a name="l03131"></a><span class="lineno"> 3131</span>&#160;        <span class="keywordflow">if</span>( ( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a2dd1371f733f6bdb649c8d8a9a901a4d">ally_rule::close_doors</a> ) &amp;&amp; <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) &amp;&amp; !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l03132"></a><span class="lineno"> 3132</span>&#160;            <a class="code" href="namespacedoors.html#ad946fe0ed45565925e0a6c168ba12596">doors::close_door</a>( here, *<span class="keyword">this</span>, <a class="code" href="coordinates_8h.html#a38e880e550bb0688dea9353138da8683">tripoint_bub_ms</a>( old_pos ) );</div>
<div class="line"><a name="l03133"></a><span class="lineno"> 3133</span>&#160;        }</div>
<div class="line"><a name="l03134"></a><span class="lineno"> 3134</span>&#160;        <span class="comment">// Lock doors as well</span></div>
<div class="line"><a name="l03135"></a><span class="lineno"> 3135</span>&#160;        <span class="keywordflow">if</span>( ( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7ac8ea8849c8659b30517754be9a99c2d9">ally_rule::lock_doors</a> ) &amp;&amp; <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) &amp;&amp; !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l03136"></a><span class="lineno"> 3136</span>&#160;            <a class="code" href="namespacedoors.html#ae7c1bfb249698cfb947810fb98b62f1e">doors::lock_door</a>( here, *<span class="keyword">this</span>, <a class="code" href="coordinates_8h.html#a38e880e550bb0688dea9353138da8683">tripoint_bub_ms</a>( old_pos ) );</div>
<div class="line"><a name="l03137"></a><span class="lineno"> 3137</span>&#160;        }</div>
<div class="line"><a name="l03138"></a><span class="lineno"> 3138</span>&#160; </div>
<div class="line"><a name="l03139"></a><span class="lineno"> 3139</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( p ).<a class="code" href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">part_with_feature</a>( <a class="code" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307eaebc2a9d9402e04973e4ee469daddeda5">VPFLAG_BOARDABLE</a>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l03140"></a><span class="lineno"> 3140</span>&#160;            here.<a class="code" href="classmap.html#ae9e52026d9d68ff5e7fe85c6f8963421">board_vehicle</a>( p, <span class="keyword">this</span> );</div>
<div class="line"><a name="l03141"></a><span class="lineno"> 3141</span>&#160;        }</div>
<div class="line"><a name="l03142"></a><span class="lineno"> 3142</span>&#160;        here.<a class="code" href="classmap.html#ae0dae45aeed1b7221d318c0a36abca5b">creature_on_trap</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l03143"></a><span class="lineno"> 3143</span>&#160;        here.<a class="code" href="classmap.html#a780bfbdc19649391081c1ad6e0e4aa81">creature_in_field</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l03144"></a><span class="lineno"> 3144</span>&#160;    }</div>
<div class="line"><a name="l03145"></a><span class="lineno"> 3145</span>&#160;}</div>
<div class="line"><a name="l03146"></a><span class="lineno"> 3146</span>&#160; </div>
<div class="line"><a name="l03147"></a><span class="lineno"> 3147</span>&#160; </div>
<div class="line"><a name="l03148"></a><span class="lineno"><a class="line" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c"> 3148</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">npc::move_to_next</a>()</div>
<div class="line"><a name="l03149"></a><span class="lineno"> 3149</span>&#160;{</div>
<div class="line"><a name="l03150"></a><span class="lineno"> 3150</span>&#160;    <span class="keywordflow">while</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() &amp;&amp; <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() == <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0] ) {</div>
<div class="line"><a name="l03151"></a><span class="lineno"> 3151</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.erase( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.begin() );</div>
<div class="line"><a name="l03152"></a><span class="lineno"> 3152</span>&#160;    }</div>
<div class="line"><a name="l03153"></a><span class="lineno"> 3153</span>&#160; </div>
<div class="line"><a name="l03154"></a><span class="lineno"> 3154</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l03155"></a><span class="lineno"> 3155</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;npc::move_to_next() called with an empty path or path &quot;</span></div>
<div class="line"><a name="l03156"></a><span class="lineno"> 3156</span>&#160;                       <span class="stringliteral">&quot;containing only current position&quot;</span> );</div>
<div class="line"><a name="l03157"></a><span class="lineno"> 3157</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03158"></a><span class="lineno"> 3158</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03159"></a><span class="lineno"> 3159</span>&#160;    }</div>
<div class="line"><a name="l03160"></a><span class="lineno"> 3160</span>&#160; </div>
<div class="line"><a name="l03161"></a><span class="lineno"> 3161</span>&#160;    <a class="code" href="classnpc.html#ac17b98393632654d6724c71251bbdadf">move_to</a>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0] );</div>
<div class="line"><a name="l03162"></a><span class="lineno"> 3162</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() &amp;&amp; <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() == <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0] ) { <span class="comment">// Move was successful</span></div>
<div class="line"><a name="l03163"></a><span class="lineno"> 3163</span>&#160;        <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.erase( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.begin() );</div>
<div class="line"><a name="l03164"></a><span class="lineno"> 3164</span>&#160;    }</div>
<div class="line"><a name="l03165"></a><span class="lineno"> 3165</span>&#160;}</div>
<div class="line"><a name="l03166"></a><span class="lineno"> 3166</span>&#160; </div>
<div class="line"><a name="l03167"></a><span class="lineno"><a class="line" href="classnpc.html#a4fea1fd042a9225b685b012eec8697ba"> 3167</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a4fea1fd042a9225b685b012eec8697ba">npc::avoid_friendly_fire</a>()</div>
<div class="line"><a name="l03168"></a><span class="lineno"> 3168</span>&#160;{</div>
<div class="line"><a name="l03169"></a><span class="lineno"> 3169</span>&#160;    <span class="comment">// TODO: To parameter</span></div>
<div class="line"><a name="l03170"></a><span class="lineno"> 3170</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> tar = <a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">current_target</a>()-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l03171"></a><span class="lineno"> 3171</span>&#160;    <span class="comment">// Calculate center of weight of friends and move away from that</span></div>
<div class="line"><a name="l03172"></a><span class="lineno"> 3172</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>;</div>
<div class="line"><a name="l03173"></a><span class="lineno"> 3173</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;fr : <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a> ) {</div>
<div class="line"><a name="l03174"></a><span class="lineno"> 3174</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;Creature&gt;</a> fr_p = fr.lock() ) {</div>
<div class="line"><a name="l03175"></a><span class="lineno"> 3175</span>&#160;            <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a> += fr_p-&gt;pos();</div>
<div class="line"><a name="l03176"></a><span class="lineno"> 3176</span>&#160;        }</div>
<div class="line"><a name="l03177"></a><span class="lineno"> 3177</span>&#160;    }</div>
<div class="line"><a name="l03178"></a><span class="lineno"> 3178</span>&#160; </div>
<div class="line"><a name="l03179"></a><span class="lineno"> 3179</span>&#160;    <span class="keywordtype">float</span> friend_count = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">friends</a>.size();</div>
<div class="line"><a name="l03180"></a><span class="lineno"> 3180</span>&#160;    <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.x = <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">std::round</a>( <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.x / friend_count );</div>
<div class="line"><a name="l03181"></a><span class="lineno"> 3181</span>&#160;    <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.y = <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">std::round</a>( <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.y / friend_count );</div>
<div class="line"><a name="l03182"></a><span class="lineno"> 3182</span>&#160;    <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z = <a class="code" href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">std::round</a>( <a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>.z / friend_count );</div>
<div class="line"><a name="l03183"></a><span class="lineno"> 3183</span>&#160; </div>
<div class="line"><a name="l03184"></a><span class="lineno"> 3184</span>&#160;    std::vector&lt;tripoint&gt; candidates = <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), 1 );</div>
<div class="line"><a name="l03185"></a><span class="lineno"> 3185</span>&#160;    candidates.erase( candidates.begin() );</div>
<div class="line"><a name="l03186"></a><span class="lineno"> 3186</span>&#160;    std::sort( candidates.begin(), candidates.end(),</div>
<div class="line"><a name="l03187"></a><span class="lineno"> 3187</span>&#160;    [&amp;tar, &amp;<a class="code" href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">center</a>]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; l, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; r ) {</div>
<div class="line"><a name="l03188"></a><span class="lineno"> 3188</span>&#160;        return ( rl_dist( l, tar ) - rl_dist( l, center ) ) &lt;</div>
<div class="line"><a name="l03189"></a><span class="lineno"> 3189</span>&#160;               ( rl_dist( r, tar ) - rl_dist( r, center ) );</div>
<div class="line"><a name="l03190"></a><span class="lineno"> 3190</span>&#160;    } );</div>
<div class="line"><a name="l03191"></a><span class="lineno"> 3191</span>&#160; </div>
<div class="line"><a name="l03192"></a><span class="lineno"> 3192</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;pt : candidates ) {</div>
<div class="line"><a name="l03193"></a><span class="lineno"> 3193</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a074b34b0dee2182901293c937d523f04">can_move_to</a>( pt ) ) {</div>
<div class="line"><a name="l03194"></a><span class="lineno"> 3194</span>&#160;            <a class="code" href="classnpc.html#ac17b98393632654d6724c71251bbdadf">move_to</a>( pt );</div>
<div class="line"><a name="l03195"></a><span class="lineno"> 3195</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03196"></a><span class="lineno"> 3196</span>&#160;        }</div>
<div class="line"><a name="l03197"></a><span class="lineno"> 3197</span>&#160;    }</div>
<div class="line"><a name="l03198"></a><span class="lineno"> 3198</span>&#160; </div>
<div class="line"><a name="l03199"></a><span class="lineno"> 3199</span>&#160;    <span class="comment">/* If we&#39;re still in the function at this point, maneuvering can&#39;t help us. So,</span></div>
<div class="line"><a name="l03200"></a><span class="lineno"> 3200</span>&#160;<span class="comment">     * might as well address some needs.</span></div>
<div class="line"><a name="l03201"></a><span class="lineno"> 3201</span>&#160;<span class="comment">     * We pass a &lt;danger&gt; value of NPC_DANGER_VERY_LOW + 1 so that we won&#39;t start</span></div>
<div class="line"><a name="l03202"></a><span class="lineno"> 3202</span>&#160;<span class="comment">     * eating food (or, god help us, sleeping).</span></div>
<div class="line"><a name="l03203"></a><span class="lineno"> 3203</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l03204"></a><span class="lineno"> 3204</span>&#160;    <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> = <a class="code" href="classnpc.html#ad19cf8c5a4e78a6e5f36b0674a812e97">address_needs</a>( <a class="code" href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a> + 1 );</div>
<div class="line"><a name="l03205"></a><span class="lineno"> 3205</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> == <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> ) {</div>
<div class="line"><a name="l03206"></a><span class="lineno"> 3206</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03207"></a><span class="lineno"> 3207</span>&#160;    }</div>
<div class="line"><a name="l03208"></a><span class="lineno"> 3208</span>&#160;    <a class="code" href="classnpc.html#a647e4cf025498dc0798f5fb0d80f3b3a">execute_action</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> );</div>
<div class="line"><a name="l03209"></a><span class="lineno"> 3209</span>&#160;}</div>
<div class="line"><a name="l03210"></a><span class="lineno"> 3210</span>&#160; </div>
<div class="line"><a name="l03211"></a><span class="lineno"><a class="line" href="classnpc.html#a5b4cef057ec82989f71d88b4529d3359"> 3211</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a5b4cef057ec82989f71d88b4529d3359">npc::escape_explosion</a>()</div>
<div class="line"><a name="l03212"></a><span class="lineno"> 3212</span>&#160;{</div>
<div class="line"><a name="l03213"></a><span class="lineno"> 3213</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0f00a09e500a57a83a2eb5a92b79626a">dangerous_explosives</a>.empty() ) {</div>
<div class="line"><a name="l03214"></a><span class="lineno"> 3214</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03215"></a><span class="lineno"> 3215</span>&#160;    }</div>
<div class="line"><a name="l03216"></a><span class="lineno"> 3216</span>&#160; </div>
<div class="line"><a name="l03217"></a><span class="lineno"> 3217</span>&#160;    <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;explosion&quot;</span>, 1_minutes );</div>
<div class="line"><a name="l03218"></a><span class="lineno"> 3218</span>&#160; </div>
<div class="line"><a name="l03219"></a><span class="lineno"> 3219</span>&#160;    <a class="code" href="classnpc.html#abdbbb214958165a75a2e0b7a4ae2187f">move_away_from</a>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a0f00a09e500a57a83a2eb5a92b79626a">dangerous_explosives</a>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03220"></a><span class="lineno"> 3220</span>&#160;}</div>
<div class="line"><a name="l03221"></a><span class="lineno"> 3221</span>&#160; </div>
<div class="line"><a name="l03222"></a><span class="lineno"><a class="line" href="classnpc.html#abdbbb214958165a75a2e0b7a4ae2187f"> 3222</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#abdbbb214958165a75a2e0b7a4ae2187f">npc::move_away_from</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;pt, <span class="keywordtype">bool</span> no_bash_atk, std::set&lt;tripoint&gt; *nomove )</div>
<div class="line"><a name="l03223"></a><span class="lineno"> 3223</span>&#160;{</div>
<div class="line"><a name="l03224"></a><span class="lineno"> 3224</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> best_pos = <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l03225"></a><span class="lineno"> 3225</span>&#160;    <span class="keywordtype">int</span> best = -1;</div>
<div class="line"><a name="l03226"></a><span class="lineno"> 3226</span>&#160;    <span class="keywordtype">int</span> chance = 2;</div>
<div class="line"><a name="l03227"></a><span class="lineno"> 3227</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03228"></a><span class="lineno"> 3228</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p : here.<a class="code" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), 1 ) ) {</div>
<div class="line"><a name="l03229"></a><span class="lineno"> 3229</span>&#160;        <span class="keywordflow">if</span>( nomove != <span class="keyword">nullptr</span> &amp;&amp; nomove-&gt;find( p ) != nomove-&gt;end() ) {</div>
<div class="line"><a name="l03230"></a><span class="lineno"> 3230</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03231"></a><span class="lineno"> 3231</span>&#160;        }</div>
<div class="line"><a name="l03232"></a><span class="lineno"> 3232</span>&#160; </div>
<div class="line"><a name="l03233"></a><span class="lineno"> 3233</span>&#160;        <span class="keywordflow">if</span>( p == <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) {</div>
<div class="line"><a name="l03234"></a><span class="lineno"> 3234</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03235"></a><span class="lineno"> 3235</span>&#160;        }</div>
<div class="line"><a name="l03236"></a><span class="lineno"> 3236</span>&#160; </div>
<div class="line"><a name="l03237"></a><span class="lineno"> 3237</span>&#160;        <span class="keywordflow">if</span>( p == <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>().<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) {</div>
<div class="line"><a name="l03238"></a><span class="lineno"> 3238</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03239"></a><span class="lineno"> 3239</span>&#160;        }</div>
<div class="line"><a name="l03240"></a><span class="lineno"> 3240</span>&#160; </div>
<div class="line"><a name="l03241"></a><span class="lineno"> 3241</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> cost = here.<a class="code" href="classmap.html#a728d97469f08da32ae2108d30d2a51ca">combined_movecost</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), p );</div>
<div class="line"><a name="l03242"></a><span class="lineno"> 3242</span>&#160;        <span class="keywordflow">if</span>( cost &lt;= 0 ) {</div>
<div class="line"><a name="l03243"></a><span class="lineno"> 3243</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03244"></a><span class="lineno"> 3244</span>&#160;        }</div>
<div class="line"><a name="l03245"></a><span class="lineno"> 3245</span>&#160; </div>
<div class="line"><a name="l03246"></a><span class="lineno"> 3246</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> dst = <a class="code" href="math__parser__func_8h.html#a24f6ac6e06720c7cdf972a6083847132">std::abs</a>( p.x - pt.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> ) + <a class="code" href="math__parser__func_8h.html#a24f6ac6e06720c7cdf972a6083847132">std::abs</a>( p.y - pt.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> ) + <a class="code" href="math__parser__func_8h.html#a24f6ac6e06720c7cdf972a6083847132">std::abs</a>( p.z - pt.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l03247"></a><span class="lineno"> 3247</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> val = dst * 1000 / cost;</div>
<div class="line"><a name="l03248"></a><span class="lineno"> 3248</span>&#160;        <span class="keywordflow">if</span>( val &gt; best &amp;&amp; <a class="code" href="classnpc.html#a074b34b0dee2182901293c937d523f04">can_move_to</a>( p, no_bash_atk ) ) {</div>
<div class="line"><a name="l03249"></a><span class="lineno"> 3249</span>&#160;            best_pos = p;</div>
<div class="line"><a name="l03250"></a><span class="lineno"> 3250</span>&#160;            best = val;</div>
<div class="line"><a name="l03251"></a><span class="lineno"> 3251</span>&#160;            chance = 2;</div>
<div class="line"><a name="l03252"></a><span class="lineno"> 3252</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( ( val == best &amp;&amp; <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( chance ) ) &amp;&amp; <a class="code" href="classnpc.html#a074b34b0dee2182901293c937d523f04">can_move_to</a>( p, no_bash_atk ) ) {</div>
<div class="line"><a name="l03253"></a><span class="lineno"> 3253</span>&#160;            best_pos = p;</div>
<div class="line"><a name="l03254"></a><span class="lineno"> 3254</span>&#160;            best = val;</div>
<div class="line"><a name="l03255"></a><span class="lineno"> 3255</span>&#160;            chance++;</div>
<div class="line"><a name="l03256"></a><span class="lineno"> 3256</span>&#160;        }</div>
<div class="line"><a name="l03257"></a><span class="lineno"> 3257</span>&#160;    }</div>
<div class="line"><a name="l03258"></a><span class="lineno"> 3258</span>&#160; </div>
<div class="line"><a name="l03259"></a><span class="lineno"> 3259</span>&#160;    <a class="code" href="classnpc.html#ac17b98393632654d6724c71251bbdadf">move_to</a>( best_pos, no_bash_atk, nomove );</div>
<div class="line"><a name="l03260"></a><span class="lineno"> 3260</span>&#160;}</div>
<div class="line"><a name="l03261"></a><span class="lineno"> 3261</span>&#160; </div>
<div class="line"><a name="l03262"></a><span class="lineno"><a class="line" href="classnpc.html#a0c12ca9af78ebc18189992cc866f5ddc"> 3262</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a0c12ca9af78ebc18189992cc866f5ddc">npc::find_job_to_perform</a>()</div>
<div class="line"><a name="l03263"></a><span class="lineno"> 3263</span>&#160;{</div>
<div class="line"><a name="l03264"></a><span class="lineno"> 3264</span>&#160;    <span class="comment">// cleanup history</span></div>
<div class="line"><a name="l03265"></a><span class="lineno"> 3265</span>&#160;    <span class="keyword">auto</span> fetch_itr = <a class="code" href="classnpc.html#abb6a5aefceeaa114ad6099c4b37060af">job</a>.<a class="code" href="classjob__data.html#a74adef0b6a154ba1114e84e70fc93872">fetch_history</a>.begin();</div>
<div class="line"><a name="l03266"></a><span class="lineno"> 3266</span>&#160;    <span class="keywordflow">while</span>( fetch_itr != <a class="code" href="classnpc.html#abb6a5aefceeaa114ad6099c4b37060af">job</a>.<a class="code" href="classjob__data.html#a74adef0b6a154ba1114e84e70fc93872">fetch_history</a>.end() ) {</div>
<div class="line"><a name="l03267"></a><span class="lineno"> 3267</span>&#160;        <span class="keywordflow">if</span>( fetch_itr-&gt;second != <a class="code" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a> ) {</div>
<div class="line"><a name="l03268"></a><span class="lineno"> 3268</span>&#160;            fetch_itr = <a class="code" href="classnpc.html#abb6a5aefceeaa114ad6099c4b37060af">job</a>.<a class="code" href="classjob__data.html#a74adef0b6a154ba1114e84e70fc93872">fetch_history</a>.erase( fetch_itr );</div>
<div class="line"><a name="l03269"></a><span class="lineno"> 3269</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03270"></a><span class="lineno"> 3270</span>&#160;            fetch_itr++;</div>
<div class="line"><a name="l03271"></a><span class="lineno"> 3271</span>&#160;        }</div>
<div class="line"><a name="l03272"></a><span class="lineno"> 3272</span>&#160;    }</div>
<div class="line"><a name="l03273"></a><span class="lineno"> 3273</span>&#160; </div>
<div class="line"><a name="l03274"></a><span class="lineno"> 3274</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classstring__id.html">activity_id</a> &amp;elem : <a class="code" href="classnpc.html#abb6a5aefceeaa114ad6099c4b37060af">job</a>.<a class="code" href="classjob__data.html#a3268948e4e306da36705f0666f5741da">get_prioritised_vector</a>() ) {</div>
<div class="line"><a name="l03275"></a><span class="lineno"> 3275</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#abb6a5aefceeaa114ad6099c4b37060af">job</a>.<a class="code" href="classjob__data.html#a9a088b1ef414b06de0184794f89df640">get_priority_of_job</a>( elem ) == 0 ) {</div>
<div class="line"><a name="l03276"></a><span class="lineno"> 3276</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03277"></a><span class="lineno"> 3277</span>&#160;        }</div>
<div class="line"><a name="l03278"></a><span class="lineno"> 3278</span>&#160;        <a class="code" href="classplayer__activity.html">player_activity</a> scan_act = <a class="code" href="classplayer__activity.html">player_activity</a>( elem );</div>
<div class="line"><a name="l03279"></a><span class="lineno"> 3279</span>&#160;        <span class="keywordflow">if</span>( elem == <a class="code" href="npcmove_8cpp.html#a0313dde9b91b312463fd84bf985b42a6">ACT_MOVE_LOOT</a> ) {</div>
<div class="line"><a name="l03280"></a><span class="lineno"> 3280</span>&#160;            <a class="code" href="classCharacter.html#af7d50915d362a56eeff40bc6b392326d">assign_activity</a>( elem );</div>
<div class="line"><a name="l03281"></a><span class="lineno"> 3281</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="activity__handlers_8h.html#a92427c4a20720f251807f7e70db0640b">generic_multi_activity_handler</a>( scan_act, *this-&gt;<a class="code" href="classCharacter.html#a01a7950e28e24252e372d7e74078e12f">as_character</a>(), <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l03282"></a><span class="lineno"> 3282</span>&#160;            <a class="code" href="classCharacter.html#af7d50915d362a56eeff40bc6b392326d">assign_activity</a>( elem );</div>
<div class="line"><a name="l03283"></a><span class="lineno"> 3283</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03284"></a><span class="lineno"> 3284</span>&#160;        }</div>
<div class="line"><a name="l03285"></a><span class="lineno"> 3285</span>&#160;    }</div>
<div class="line"><a name="l03286"></a><span class="lineno"> 3286</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03287"></a><span class="lineno"> 3287</span>&#160;}</div>
<div class="line"><a name="l03288"></a><span class="lineno"> 3288</span>&#160; </div>
<div class="line"><a name="l03289"></a><span class="lineno"><a class="line" href="classnpc.html#a71c2e08d14b32913076f198a293adea1"> 3289</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a71c2e08d14b32913076f198a293adea1">npc::worker_downtime</a>()</div>
<div class="line"><a name="l03290"></a><span class="lineno"> 3290</span>&#160;{</div>
<div class="line"><a name="l03291"></a><span class="lineno"> 3291</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03292"></a><span class="lineno"> 3292</span>&#160;    <a class="code" href="classcreature__tracker.html">creature_tracker</a> &amp;creatures = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>();</div>
<div class="line"><a name="l03293"></a><span class="lineno"> 3293</span>&#160;    <span class="comment">// are we already in a chair</span></div>
<div class="line"><a name="l03294"></a><span class="lineno"> 3294</span>&#160;    <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">has_flag_furn</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a014099fdb4e616450d942532bf1953ae">ter_furn_flag::TFLAG_CAN_SIT</a>, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l03295"></a><span class="lineno"> 3295</span>&#160;        <span class="comment">// just chill here</span></div>
<div class="line"><a name="l03296"></a><span class="lineno"> 3296</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03297"></a><span class="lineno"> 3297</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03298"></a><span class="lineno"> 3298</span>&#160;    }</div>
<div class="line"><a name="l03299"></a><span class="lineno"> 3299</span>&#160;    <span class="comment">//  already know of a chair, go there - if there isn&#39;t already another creature there.</span></div>
<div class="line"><a name="l03300"></a><span class="lineno"> 3300</span>&#160;    <span class="comment">//  this is a bit of behind the scene omniscience for the npc, since ideally the npc</span></div>
<div class="line"><a name="l03301"></a><span class="lineno"> 3301</span>&#160;    <span class="comment">//  should walk to the chair and then change their destination due to the seat being taken.</span></div>
<div class="line"><a name="l03302"></a><span class="lineno"> 3302</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> local_chair_pos = <a class="code" href="classnpc.html#a5f5e60265406a2edb65327e360406b37">chair_pos</a> ? here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classnpc.html#a5f5e60265406a2edb65327e360406b37">chair_pos</a> ) : <a class="code" href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a>;</div>
<div class="line"><a name="l03303"></a><span class="lineno"> 3303</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5f5e60265406a2edb65327e360406b37">chair_pos</a> &amp;&amp; !creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( local_chair_pos ) ) {</div>
<div class="line"><a name="l03304"></a><span class="lineno"> 3304</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">has_flag_furn</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a014099fdb4e616450d942532bf1953ae">ter_furn_flag::TFLAG_CAN_SIT</a>, local_chair_pos ) ) {</div>
<div class="line"><a name="l03305"></a><span class="lineno"> 3305</span>&#160;            <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( local_chair_pos );</div>
<div class="line"><a name="l03306"></a><span class="lineno"> 3306</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>() == *<a class="code" href="classnpc.html#a5f5e60265406a2edb65327e360406b37">chair_pos</a> || <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l03307"></a><span class="lineno"> 3307</span>&#160;                <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03308"></a><span class="lineno"> 3308</span>&#160;                <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l03309"></a><span class="lineno"> 3309</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03310"></a><span class="lineno"> 3310</span>&#160;                <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l03311"></a><span class="lineno"> 3311</span>&#160;            }</div>
<div class="line"><a name="l03312"></a><span class="lineno"> 3312</span>&#160;            <a class="code" href="classnpc.html#aec0e31c7784e3b54f820dddf440e04fc">wander_pos</a> = std::nullopt;</div>
<div class="line"><a name="l03313"></a><span class="lineno"> 3313</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03314"></a><span class="lineno"> 3314</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03315"></a><span class="lineno"> 3315</span>&#160;            <a class="code" href="classnpc.html#a5f5e60265406a2edb65327e360406b37">chair_pos</a> = std::nullopt;</div>
<div class="line"><a name="l03316"></a><span class="lineno"> 3316</span>&#160;        }</div>
<div class="line"><a name="l03317"></a><span class="lineno"> 3317</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03318"></a><span class="lineno"> 3318</span>&#160;        <span class="comment">// find a chair</span></div>
<div class="line"><a name="l03319"></a><span class="lineno"> 3319</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">is_mounted</a>() ) {</div>
<div class="line"><a name="l03320"></a><span class="lineno"> 3320</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;elem : here.<a class="code" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), 30 ) ) {</div>
<div class="line"><a name="l03321"></a><span class="lineno"> 3321</span>&#160;                <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">has_flag_furn</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a014099fdb4e616450d942532bf1953ae">ter_furn_flag::TFLAG_CAN_SIT</a>, elem ) &amp;&amp; !creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( elem ) &amp;&amp;</div>
<div class="line"><a name="l03322"></a><span class="lineno"> 3322</span>&#160;                    <a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">could_move_onto</a>( elem ) &amp;&amp;</div>
<div class="line"><a name="l03323"></a><span class="lineno"> 3323</span>&#160;                    here.<a class="code" href="classmap.html#a1e5a0861247defbe414be8cc65475a17">point_within_camp</a>( here.<a class="code" href="classmap.html#a501f3a1d449ac022f1b36b99da653e94">getabs</a>( elem ) ) ) {</div>
<div class="line"><a name="l03324"></a><span class="lineno"> 3324</span>&#160;                    <span class="comment">// this one will do</span></div>
<div class="line"><a name="l03325"></a><span class="lineno"> 3325</span>&#160;                    <a class="code" href="classnpc.html#a5f5e60265406a2edb65327e360406b37">chair_pos</a> = here.<a class="code" href="classmap.html#ac868b594b36b6b9bbcb130650fd4f61f">getglobal</a>( elem );</div>
<div class="line"><a name="l03326"></a><span class="lineno"> 3326</span>&#160;                    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03327"></a><span class="lineno"> 3327</span>&#160;                }</div>
<div class="line"><a name="l03328"></a><span class="lineno"> 3328</span>&#160;            }</div>
<div class="line"><a name="l03329"></a><span class="lineno"> 3329</span>&#160;        }</div>
<div class="line"><a name="l03330"></a><span class="lineno"> 3330</span>&#160;    }</div>
<div class="line"><a name="l03331"></a><span class="lineno"> 3331</span>&#160;    <span class="comment">// we got here if there are no chairs available.</span></div>
<div class="line"><a name="l03332"></a><span class="lineno"> 3332</span>&#160;    <span class="comment">// wander back to near the bulletin board of the camp.</span></div>
<div class="line"><a name="l03333"></a><span class="lineno"> 3333</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#aec0e31c7784e3b54f820dddf440e04fc">wander_pos</a> ) {</div>
<div class="line"><a name="l03334"></a><span class="lineno"> 3334</span>&#160;        <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classnpc.html#aec0e31c7784e3b54f820dddf440e04fc">wander_pos</a> ) );</div>
<div class="line"><a name="l03335"></a><span class="lineno"> 3335</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>() == *<a class="code" href="classnpc.html#aec0e31c7784e3b54f820dddf440e04fc">wander_pos</a> || <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l03336"></a><span class="lineno"> 3336</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03337"></a><span class="lineno"> 3337</span>&#160;            <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l03338"></a><span class="lineno"> 3338</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 30 ) ) {</div>
<div class="line"><a name="l03339"></a><span class="lineno"> 3339</span>&#160;                <a class="code" href="classnpc.html#aec0e31c7784e3b54f820dddf440e04fc">wander_pos</a> = std::nullopt;</div>
<div class="line"><a name="l03340"></a><span class="lineno"> 3340</span>&#160;            }</div>
<div class="line"><a name="l03341"></a><span class="lineno"> 3341</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03342"></a><span class="lineno"> 3342</span>&#160;            <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l03343"></a><span class="lineno"> 3343</span>&#160;        }</div>
<div class="line"><a name="l03344"></a><span class="lineno"> 3344</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03345"></a><span class="lineno"> 3345</span>&#160;    }</div>
<div class="line"><a name="l03346"></a><span class="lineno"> 3346</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a36732f064214ecc3943cacea307f2597">assigned_camp</a> ) {</div>
<div class="line"><a name="l03347"></a><span class="lineno"> 3347</span>&#160;        std::optional&lt;basecamp *&gt; bcp = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#afb50d2d30ce283fbd3ee8773fde98676">find_camp</a>( ( *assigned_camp ).xy() );</div>
<div class="line"><a name="l03348"></a><span class="lineno"> 3348</span>&#160;        <span class="keywordflow">if</span>( !bcp ) {</div>
<div class="line"><a name="l03349"></a><span class="lineno"> 3349</span>&#160;            <a class="code" href="classnpc.html#a36732f064214ecc3943cacea307f2597">assigned_camp</a> = std::nullopt;</div>
<div class="line"><a name="l03350"></a><span class="lineno"> 3350</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03351"></a><span class="lineno"> 3351</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03352"></a><span class="lineno"> 3352</span>&#160;        }</div>
<div class="line"><a name="l03353"></a><span class="lineno"> 3353</span>&#160;        <a class="code" href="classbasecamp.html">basecamp</a> *temp_camp = *bcp;</div>
<div class="line"><a name="l03354"></a><span class="lineno"> 3354</span>&#160;        std::vector&lt;tripoint&gt; pts;</div>
<div class="line"><a name="l03355"></a><span class="lineno"> 3355</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;elem : here.<a class="code" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( temp_camp-&gt;<a class="code" href="classbasecamp.html#ab11f768b4bb03073257d817875de4178">get_bb_pos</a>() ),</div>
<div class="line"><a name="l03356"></a><span class="lineno"> 3356</span>&#160;                10 ) ) {</div>
<div class="line"><a name="l03357"></a><span class="lineno"> 3357</span>&#160;            <span class="keywordflow">if</span>( creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>( elem ) || !<a class="code" href="classnpc.html#aae2234e886f871aad230f1ed37bed033">could_move_onto</a>( elem ) ||</div>
<div class="line"><a name="l03358"></a><span class="lineno"> 3358</span>&#160;                here.<a class="code" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac6e19e1c41724be67b2bff2870539ca1">ter_furn_flag::TFLAG_DEEP_WATER</a>, elem ) ||</div>
<div class="line"><a name="l03359"></a><span class="lineno"> 3359</span>&#160;                !here.<a class="code" href="classmap.html#a78e0a35a5041e0daf6e7a2a4ec522014">has_floor_or_water</a>( elem ) || <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;is_dangerous_tile( elem ) ) {</div>
<div class="line"><a name="l03360"></a><span class="lineno"> 3360</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03361"></a><span class="lineno"> 3361</span>&#160;            }</div>
<div class="line"><a name="l03362"></a><span class="lineno"> 3362</span>&#160;            pts.push_back( elem );</div>
<div class="line"><a name="l03363"></a><span class="lineno"> 3363</span>&#160;        }</div>
<div class="line"><a name="l03364"></a><span class="lineno"> 3364</span>&#160;        <span class="keywordflow">if</span>( !pts.empty() ) {</div>
<div class="line"><a name="l03365"></a><span class="lineno"> 3365</span>&#160;            <a class="code" href="classnpc.html#aec0e31c7784e3b54f820dddf440e04fc">wander_pos</a> = here.<a class="code" href="classmap.html#ac868b594b36b6b9bbcb130650fd4f61f">getglobal</a>( <a class="code" href="rng_8h.html#a12244355ee77108f1b08618e9962e4d1">random_entry</a>( pts ) );</div>
<div class="line"><a name="l03366"></a><span class="lineno"> 3366</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03367"></a><span class="lineno"> 3367</span>&#160;        }</div>
<div class="line"><a name="l03368"></a><span class="lineno"> 3368</span>&#160;    }</div>
<div class="line"><a name="l03369"></a><span class="lineno"> 3369</span>&#160;    <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03370"></a><span class="lineno"> 3370</span>&#160;}</div>
<div class="line"><a name="l03371"></a><span class="lineno"> 3371</span>&#160; </div>
<div class="line"><a name="l03372"></a><span class="lineno"><a class="line" href="classnpc.html#aa66ea634e85fda5b9964025922499524"> 3372</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">npc::move_pause</a>()</div>
<div class="line"><a name="l03373"></a><span class="lineno"> 3373</span>&#160; </div>
<div class="line"><a name="l03374"></a><span class="lineno"> 3374</span>&#160;{</div>
<div class="line"><a name="l03375"></a><span class="lineno"> 3375</span>&#160;    <span class="comment">// make sure we&#39;re using the best weapon</span></div>
<div class="line"><a name="l03376"></a><span class="lineno"> 3376</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="namespacecalendar.html#a356df28513f4d655ae35c312ab6e7d55">calendar::once_every</a>( 1_hours ) ) {</div>
<div class="line"><a name="l03377"></a><span class="lineno"> 3377</span>&#160;        <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">deactivate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#a978adf30232e0bcf1b9d38a73b8dd30e">bio_soporific</a> );</div>
<div class="line"><a name="l03378"></a><span class="lineno"> 3378</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">bionic_id</a> &amp;bio_id : <a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a4ebf7d016fe3acf5365eb4bb84abf223">health_cbms</a> ) {</div>
<div class="line"><a name="l03379"></a><span class="lineno"> 3379</span>&#160;            <a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">activate_bionic_by_id</a>( bio_id );</div>
<div class="line"><a name="l03380"></a><span class="lineno"> 3380</span>&#160;        }</div>
<div class="line"><a name="l03381"></a><span class="lineno"> 3381</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a803f433a7a6b27fc761a5780db7d6b52">wield_better_weapon</a>() ) {</div>
<div class="line"><a name="l03382"></a><span class="lineno"> 3382</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03383"></a><span class="lineno"> 3383</span>&#160;        }</div>
<div class="line"><a name="l03384"></a><span class="lineno"> 3384</span>&#160;    }</div>
<div class="line"><a name="l03385"></a><span class="lineno"> 3385</span>&#160;    <span class="comment">// NPCs currently always aim when using a gun, even with no target</span></div>
<div class="line"><a name="l03386"></a><span class="lineno"> 3386</span>&#160;    <span class="comment">// This simulates them aiming at stuff just at the edge of their range</span></div>
<div class="line"><a name="l03387"></a><span class="lineno"> 3387</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() || !<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>()-&gt;is_gun() ) {</div>
<div class="line"><a name="l03388"></a><span class="lineno"> 3388</span>&#160;        <a class="code" href="classCharacter.html#a1012850d13ca8a58bcf82aa75b3a55d1">pause</a>();</div>
<div class="line"><a name="l03389"></a><span class="lineno"> 3389</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03390"></a><span class="lineno"> 3390</span>&#160;    }</div>
<div class="line"><a name="l03391"></a><span class="lineno"> 3391</span>&#160; </div>
<div class="line"><a name="l03392"></a><span class="lineno"> 3392</span>&#160;    <span class="comment">// Stop, drop, and roll</span></div>
<div class="line"><a name="l03393"></a><span class="lineno"> 3393</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#afcfa82c36c0dc2d76cd19d622c2b6ab4">effect_onfire</a> ) ) {</div>
<div class="line"><a name="l03394"></a><span class="lineno"> 3394</span>&#160;        <a class="code" href="classCharacter.html#a1012850d13ca8a58bcf82aa75b3a55d1">pause</a>();</div>
<div class="line"><a name="l03395"></a><span class="lineno"> 3395</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03396"></a><span class="lineno"> 3396</span>&#160;        <a class="code" href="classnpc.html#a8659ec918e22207511ebed3a20afb844">aim</a>( <a class="code" href="structTarget__attributes.html">Target_attributes</a>() );</div>
<div class="line"><a name="l03397"></a><span class="lineno"> 3397</span>&#160;        <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>, 0 );</div>
<div class="line"><a name="l03398"></a><span class="lineno"> 3398</span>&#160;    }</div>
<div class="line"><a name="l03399"></a><span class="lineno"> 3399</span>&#160;}</div>
<div class="line"><a name="l03400"></a><span class="lineno"> 3400</span>&#160; </div>
<div class="line"><a name="l03401"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a17d3c36ed4f9d4a8ffbd459b7c51e0c3"> 3401</a></span>&#160;<span class="keyword">static</span> std::optional&lt;tripoint&gt; <a class="code" href="npcmove_8cpp.html#a17d3c36ed4f9d4a8ffbd459b7c51e0c3">nearest_passable</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;closest_to )</div>
<div class="line"><a name="l03402"></a><span class="lineno"> 3402</span>&#160;{</div>
<div class="line"><a name="l03403"></a><span class="lineno"> 3403</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03404"></a><span class="lineno"> 3404</span>&#160;    <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( p ) ) {</div>
<div class="line"><a name="l03405"></a><span class="lineno"> 3405</span>&#160;        <span class="keywordflow">return</span> p;</div>
<div class="line"><a name="l03406"></a><span class="lineno"> 3406</span>&#160;    }</div>
<div class="line"><a name="l03407"></a><span class="lineno"> 3407</span>&#160; </div>
<div class="line"><a name="l03408"></a><span class="lineno"> 3408</span>&#160;    <span class="comment">// We need to path to adjacent tile, not the exact one</span></div>
<div class="line"><a name="l03409"></a><span class="lineno"> 3409</span>&#160;    <span class="comment">// Let&#39;s pick the closest one to us that is passable</span></div>
<div class="line"><a name="l03410"></a><span class="lineno"> 3410</span>&#160;    std::vector&lt;tripoint&gt; candidates = <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( p, 1 );</div>
<div class="line"><a name="l03411"></a><span class="lineno"> 3411</span>&#160;    std::sort( candidates.begin(), candidates.end(), [ closest_to ]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; l,</div>
<div class="line"><a name="l03412"></a><span class="lineno"> 3412</span>&#160;    <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; r ) {</div>
<div class="line"><a name="l03413"></a><span class="lineno"> 3413</span>&#160;        return rl_dist( closest_to, l ) &lt; rl_dist( closest_to, r );</div>
<div class="line"><a name="l03414"></a><span class="lineno"> 3414</span>&#160;    } );</div>
<div class="line"><a name="l03415"></a><span class="lineno"> 3415</span>&#160;    <span class="keyword">auto</span> iter = std::find_if( candidates.begin(), candidates.end(), [&amp;here]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; pt ) {</div>
<div class="line"><a name="l03416"></a><span class="lineno"> 3416</span>&#160;        return here.passable( pt );</div>
<div class="line"><a name="l03417"></a><span class="lineno"> 3417</span>&#160;    } );</div>
<div class="line"><a name="l03418"></a><span class="lineno"> 3418</span>&#160;    <span class="keywordflow">if</span>( iter != candidates.end() ) {</div>
<div class="line"><a name="l03419"></a><span class="lineno"> 3419</span>&#160;        <span class="keywordflow">return</span> *iter;</div>
<div class="line"><a name="l03420"></a><span class="lineno"> 3420</span>&#160;    }</div>
<div class="line"><a name="l03421"></a><span class="lineno"> 3421</span>&#160; </div>
<div class="line"><a name="l03422"></a><span class="lineno"> 3422</span>&#160;    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><a name="l03423"></a><span class="lineno"> 3423</span>&#160;}</div>
<div class="line"><a name="l03424"></a><span class="lineno"> 3424</span>&#160; </div>
<div class="line"><a name="l03425"></a><span class="lineno"><a class="line" href="classnpc.html#ad3f239018aa58471ef9a94a17c874562"> 3425</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#abdbbb214958165a75a2e0b7a4ae2187f">npc::move_away_from</a>( <span class="keyword">const</span> std::vector&lt;sphere&gt; &amp;spheres, <span class="keywordtype">bool</span> no_bashing )</div>
<div class="line"><a name="l03426"></a><span class="lineno"> 3426</span>&#160;{</div>
<div class="line"><a name="l03427"></a><span class="lineno"> 3427</span>&#160;    <span class="keywordflow">if</span>( spheres.empty() ) {</div>
<div class="line"><a name="l03428"></a><span class="lineno"> 3428</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03429"></a><span class="lineno"> 3429</span>&#160;    }</div>
<div class="line"><a name="l03430"></a><span class="lineno"> 3430</span>&#160; </div>
<div class="line"><a name="l03431"></a><span class="lineno"> 3431</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> minp( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l03432"></a><span class="lineno"> 3432</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> maxp( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l03433"></a><span class="lineno"> 3433</span>&#160; </div>
<div class="line"><a name="l03434"></a><span class="lineno"> 3434</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structsphere.html">sphere</a> &amp;elem : spheres ) {</div>
<div class="line"><a name="l03435"></a><span class="lineno"> 3435</span>&#160;        minp.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( minp.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, elem.center.x - elem.radius );</div>
<div class="line"><a name="l03436"></a><span class="lineno"> 3436</span>&#160;        minp.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( minp.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, elem.center.y - elem.radius );</div>
<div class="line"><a name="l03437"></a><span class="lineno"> 3437</span>&#160;        maxp.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( maxp.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, elem.center.x + elem.radius );</div>
<div class="line"><a name="l03438"></a><span class="lineno"> 3438</span>&#160;        maxp.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( maxp.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, elem.center.y + elem.radius );</div>
<div class="line"><a name="l03439"></a><span class="lineno"> 3439</span>&#160;    }</div>
<div class="line"><a name="l03440"></a><span class="lineno"> 3440</span>&#160; </div>
<div class="line"><a name="l03441"></a><span class="lineno"> 3441</span>&#160;    <span class="keyword">const</span> <a class="code" href="classtripoint__range.html">tripoint_range&lt;tripoint&gt;</a> range( minp, maxp );</div>
<div class="line"><a name="l03442"></a><span class="lineno"> 3442</span>&#160; </div>
<div class="line"><a name="l03443"></a><span class="lineno"> 3443</span>&#160;    std::vector&lt;tripoint&gt; escape_points;</div>
<div class="line"><a name="l03444"></a><span class="lineno"> 3444</span>&#160; </div>
<div class="line"><a name="l03445"></a><span class="lineno"> 3445</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03446"></a><span class="lineno"> 3446</span>&#160;    std::copy_if( range.<a class="code" href="classtripoint__range.html#a274b89cce25f62a34d8733e1dbb3047a">begin</a>(), range.<a class="code" href="classtripoint__range.html#a848309777e9c64307a96530bbc87541f">end</a>(), std::back_inserter( escape_points ),</div>
<div class="line"><a name="l03447"></a><span class="lineno"> 3447</span>&#160;    [&amp;here]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; elem ) {</div>
<div class="line"><a name="l03448"></a><span class="lineno"> 3448</span>&#160;        return here.passable( elem ) &amp;&amp; here.has_floor_or_water( elem );</div>
<div class="line"><a name="l03449"></a><span class="lineno"> 3449</span>&#160;    } );</div>
<div class="line"><a name="l03450"></a><span class="lineno"> 3450</span>&#160; </div>
<div class="line"><a name="l03451"></a><span class="lineno"> 3451</span>&#160;    <a class="code" href="namespacecata.html#a3d88c70a7080cf9c6f03411f0b13c8cf">cata::sort_by_rating</a>( escape_points.begin(), escape_points.end(), [&amp;]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; elem ) {</div>
<div class="line"><a name="l03452"></a><span class="lineno"> 3452</span>&#160;        const int danger = std::accumulate( spheres.begin(), spheres.end(), 0,</div>
<div class="line"><a name="l03453"></a><span class="lineno"> 3453</span>&#160;        [&amp;]( const int sum, const sphere &amp; s ) {</div>
<div class="line"><a name="l03454"></a><span class="lineno"> 3454</span>&#160;            return sum + std::max( s.radius - rl_dist( elem, s.center ), 0 );</div>
<div class="line"><a name="l03455"></a><span class="lineno"> 3455</span>&#160;        } );</div>
<div class="line"><a name="l03456"></a><span class="lineno"> 3456</span>&#160; </div>
<div class="line"><a name="l03457"></a><span class="lineno"> 3457</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> distance = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), elem );</div>
<div class="line"><a name="l03458"></a><span class="lineno"> 3458</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">move_cost</a> = here.<a class="code" href="classmap.html#abe9e7b93cf8ee15c370ad55c3138c4f6">move_cost</a>( elem );</div>
<div class="line"><a name="l03459"></a><span class="lineno"> 3459</span>&#160; </div>
<div class="line"><a name="l03460"></a><span class="lineno"> 3460</span>&#160;        <span class="keywordflow">return</span> std::make_tuple( danger, distance, <a class="code" href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">move_cost</a> );</div>
<div class="line"><a name="l03461"></a><span class="lineno"> 3461</span>&#160;    } );</div>
<div class="line"><a name="l03462"></a><span class="lineno"> 3462</span>&#160; </div>
<div class="line"><a name="l03463"></a><span class="lineno"> 3463</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;elem : escape_points ) {</div>
<div class="line"><a name="l03464"></a><span class="lineno"> 3464</span>&#160;        update_path( elem, no_bashing );</div>
<div class="line"><a name="l03465"></a><span class="lineno"> 3465</span>&#160; </div>
<div class="line"><a name="l03466"></a><span class="lineno"> 3466</span>&#160;        <span class="keywordflow">if</span>( elem == <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a>() || !path.empty() ) {</div>
<div class="line"><a name="l03467"></a><span class="lineno"> 3467</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03468"></a><span class="lineno"> 3468</span>&#160;        }</div>
<div class="line"><a name="l03469"></a><span class="lineno"> 3469</span>&#160;    }</div>
<div class="line"><a name="l03470"></a><span class="lineno"> 3470</span>&#160; </div>
<div class="line"><a name="l03471"></a><span class="lineno"> 3471</span>&#160;    <span class="keywordflow">if</span>( !path.empty() ) {</div>
<div class="line"><a name="l03472"></a><span class="lineno"> 3472</span>&#160;        move_to_next();</div>
<div class="line"><a name="l03473"></a><span class="lineno"> 3473</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03474"></a><span class="lineno"> 3474</span>&#160;        move_pause();</div>
<div class="line"><a name="l03475"></a><span class="lineno"> 3475</span>&#160;    }</div>
<div class="line"><a name="l03476"></a><span class="lineno"> 3476</span>&#160;}</div>
<div class="line"><a name="l03477"></a><span class="lineno"> 3477</span>&#160; </div>
<div class="line"><a name="l03478"></a><span class="lineno"><a class="line" href="classnpc.html#ae29d9e9d3d4be388beb789d8019d03ce"> 3478</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#ae29d9e9d3d4be388beb789d8019d03ce">npc::see_item_say_smth</a>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">itype_id</a> &amp;<span class="keywordtype">object</span>, <span class="keyword">const</span> std::string &amp;smth )</div>
<div class="line"><a name="l03479"></a><span class="lineno"> 3479</span>&#160;{</div>
<div class="line"><a name="l03480"></a><span class="lineno"> 3480</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03481"></a><span class="lineno"> 3481</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p : <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), 6 ) ) {</div>
<div class="line"><a name="l03482"></a><span class="lineno"> 3482</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a5b666218957f159f8af59e98644c7183">sees_some_items</a>( p, *<span class="keyword">this</span> ) &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( p ) ) {</div>
<div class="line"><a name="l03483"></a><span class="lineno"> 3483</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it : here.<a class="code" href="classmap.html#a5130a127601b67e569eaef37a1a88610">i_at</a>( p ) ) {</div>
<div class="line"><a name="l03484"></a><span class="lineno"> 3484</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 100 ) &amp;&amp; ( it.typeId() == <span class="keywordtype">object</span> ) ) {</div>
<div class="line"><a name="l03485"></a><span class="lineno"> 3485</span>&#160;                    <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( smth );</div>
<div class="line"><a name="l03486"></a><span class="lineno"> 3486</span>&#160;                }</div>
<div class="line"><a name="l03487"></a><span class="lineno"> 3487</span>&#160;            }</div>
<div class="line"><a name="l03488"></a><span class="lineno"> 3488</span>&#160;        }</div>
<div class="line"><a name="l03489"></a><span class="lineno"> 3489</span>&#160;    }</div>
<div class="line"><a name="l03490"></a><span class="lineno"> 3490</span>&#160;}</div>
<div class="line"><a name="l03491"></a><span class="lineno"> 3491</span>&#160; </div>
<div class="line"><a name="l03492"></a><span class="lineno"><a class="line" href="classnpc.html#a5a4638fb5090eb6a0042c8f41430bc3a"> 3492</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a5a4638fb5090eb6a0042c8f41430bc3a">npc::find_item</a>()</div>
<div class="line"><a name="l03493"></a><span class="lineno"> 3493</span>&#160;{</div>
<div class="line"><a name="l03494"></a><span class="lineno"> 3494</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l03495"></a><span class="lineno"> 3495</span>&#160;        <a class="code" href="classnpc.html#ae29d9e9d3d4be388beb789d8019d03ce">see_item_say_smth</a>( <a class="code" href="npcmove_8cpp.html#a45f8e2064814b10b3c8d0c5de0995db4">itype_thorazine</a>, <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_no_to_thorazine.translated() );</div>
<div class="line"><a name="l03496"></a><span class="lineno"> 3496</span>&#160;        <a class="code" href="classnpc.html#ae29d9e9d3d4be388beb789d8019d03ce">see_item_say_smth</a>( <a class="code" href="npcmove_8cpp.html#a3bad9376f4cd7fb97bfad7d8dfef4301">itype_lsd</a>, <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_yes_to_lsd.translated() );</div>
<div class="line"><a name="l03497"></a><span class="lineno"> 3497</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03498"></a><span class="lineno"> 3498</span>&#160;    }</div>
<div class="line"><a name="l03499"></a><span class="lineno"> 3499</span>&#160; </div>
<div class="line"><a name="l03500"></a><span class="lineno"> 3500</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; !<a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7af71fc2d2d65b8777b95ddca9f1656de5">ally_rule::allow_pick_up</a> ) ) {</div>
<div class="line"><a name="l03501"></a><span class="lineno"> 3501</span>&#160;        <span class="comment">// Grabbing stuff not allowed by our &quot;owner&quot;</span></div>
<div class="line"><a name="l03502"></a><span class="lineno"> 3502</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l03503"></a><span class="lineno"> 3503</span>&#160;                       <span class="stringliteral">&quot;%s considered picking something up but player said not to.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l03504"></a><span class="lineno"> 3504</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03505"></a><span class="lineno"> 3505</span>&#160;    }</div>
<div class="line"><a name="l03506"></a><span class="lineno"> 3506</span>&#160; </div>
<div class="line"><a name="l03507"></a><span class="lineno"> 3507</span>&#160;    <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03508"></a><span class="lineno"> 3508</span>&#160;    <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03509"></a><span class="lineno"> 3509</span>&#160;    <span class="keywordtype">int</span> best_value = <a class="code" href="classnpc.html#ad43e6fde3fbc21def53e20b418b616e7">minimum_item_value</a>();</div>
<div class="line"><a name="l03510"></a><span class="lineno"> 3510</span>&#160;    <span class="comment">// Not perfect, but has to mirror pickup code</span></div>
<div class="line"><a name="l03511"></a><span class="lineno"> 3511</span>&#160;    <a class="code" href="classunits_1_1quantity.html">units::volume</a> volume_allowed = <a class="code" href="classCharacter.html#a4f0f412e4bec8d107de42bd34f1fa441">volume_capacity</a>() - <a class="code" href="classCharacter.html#ab3a5a1cd76002a3e9903b7e09b77bb3f">volume_carried</a>();</div>
<div class="line"><a name="l03512"></a><span class="lineno"> 3512</span>&#160;    <a class="code" href="classunits_1_1quantity.html">units::mass</a>   weight_allowed = <a class="code" href="classCharacter.html#a0bdec852c8280a1cb4bb5e45e14057b5">weight_capacity</a>() - <a class="code" href="classCharacter.html#a5929e955c11ee6c749447472df7c774d">weight_carried</a>();</div>
<div class="line"><a name="l03513"></a><span class="lineno"> 3513</span>&#160;    <span class="comment">// For some reason range limiting by vision doesn&#39;t work properly</span></div>
<div class="line"><a name="l03514"></a><span class="lineno"> 3514</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> range = 6;</div>
<div class="line"><a name="l03515"></a><span class="lineno"> 3515</span>&#160;    <span class="comment">//int range = sight_range( g-&gt;light_level( posz() ) );</span></div>
<div class="line"><a name="l03516"></a><span class="lineno"> 3516</span>&#160;    <span class="comment">//range = std::max( 1, std::min( 12, range ) );</span></div>
<div class="line"><a name="l03517"></a><span class="lineno"> 3517</span>&#160; </div>
<div class="line"><a name="l03518"></a><span class="lineno"> 3518</span>&#160;    <span class="keywordflow">if</span>( volume_allowed &lt;= 0_ml || weight_allowed &lt;= 0_gram ) {</div>
<div class="line"><a name="l03519"></a><span class="lineno"> 3519</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s considered picking something up, but no storage left.&quot;</span>,</div>
<div class="line"><a name="l03520"></a><span class="lineno"> 3520</span>&#160;                       <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l03521"></a><span class="lineno"> 3521</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03522"></a><span class="lineno"> 3522</span>&#160;    }</div>
<div class="line"><a name="l03523"></a><span class="lineno"> 3523</span>&#160; </div>
<div class="line"><a name="l03524"></a><span class="lineno"> 3524</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> consider_item =</div>
<div class="line"><a name="l03525"></a><span class="lineno"> 3525</span>&#160;        [&amp;best_value, <span class="keyword">this</span>]</div>
<div class="line"><a name="l03526"></a><span class="lineno"> 3526</span>&#160;    ( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp; it, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a name="l03527"></a><span class="lineno"> 3527</span>&#160;        <span class="keywordflow">if</span>( ::<a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a00172ed0a10f7343e460c341ad4fe416">good_for_pickup</a>( it, *<span class="keyword">this</span>, p ) ) {</div>
<div class="line"><a name="l03528"></a><span class="lineno"> 3528</span>&#160;            <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> = p;</div>
<div class="line"><a name="l03529"></a><span class="lineno"> 3529</span>&#160;            best_value = <a class="code" href="classnpc.html#ac52afe116abbbd44057f2da774cef3b5">has_item_whitelist</a>() ? 1000 : <a class="code" href="classnpc.html#a29fad2798be32c49e72523a6cab2b7f9">value</a>( it );</div>
<div class="line"><a name="l03530"></a><span class="lineno"> 3530</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03531"></a><span class="lineno"> 3531</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03532"></a><span class="lineno"> 3532</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03533"></a><span class="lineno"> 3533</span>&#160;        }</div>
<div class="line"><a name="l03534"></a><span class="lineno"> 3534</span>&#160;    };</div>
<div class="line"><a name="l03535"></a><span class="lineno"> 3535</span>&#160; </div>
<div class="line"><a name="l03536"></a><span class="lineno"> 3536</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03537"></a><span class="lineno"> 3537</span>&#160;    <span class="comment">// Harvest item doesn&#39;t exist, so we&#39;ll be checking by its name</span></div>
<div class="line"><a name="l03538"></a><span class="lineno"> 3538</span>&#160;    std::string wanted_name;</div>
<div class="line"><a name="l03539"></a><span class="lineno"> 3539</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> consider_terrain =</div>
<div class="line"><a name="l03540"></a><span class="lineno"> 3540</span>&#160;    [ <span class="keyword">this</span>, volume_allowed, &amp;wanted_name, &amp;here ]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a name="l03541"></a><span class="lineno"> 3541</span>&#160;        <span class="comment">// We only want to pick plants when there are no items to pick</span></div>
<div class="line"><a name="l03542"></a><span class="lineno"> 3542</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ac52afe116abbbd44057f2da774cef3b5">has_item_whitelist</a>() || <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a>.<a class="code" href="classitem__location.html#a350bb267073f30205f780b394324a32c">get_item</a>() != <span class="keyword">nullptr</span> || !wanted_name.<a class="code" href="classitem.html#ae05d298b2cf91e4c12d5beca5f38c67f">empty</a>() ||</div>
<div class="line"><a name="l03543"></a><span class="lineno"> 3543</span>&#160;            volume_allowed &lt; 250_ml ) {</div>
<div class="line"><a name="l03544"></a><span class="lineno"> 3544</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03545"></a><span class="lineno"> 3545</span>&#160;        }</div>
<div class="line"><a name="l03546"></a><span class="lineno"> 3546</span>&#160; </div>
<div class="line"><a name="l03547"></a><span class="lineno"> 3547</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> &amp;<a class="code" href="faction__camp_8h.html#ab6b01bd98db40fc2331dc0bc2ae73d61a430e39cf0eec69892a0fdb6b0dc4aa70">harvest</a> = here.<a class="code" href="classmap.html#ac9d96deaafa7d74a897a9e5ca1c1f928">get_harvest_names</a>( p );</div>
<div class="line"><a name="l03548"></a><span class="lineno"> 3548</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <span class="keyword">auto</span> &amp;entry : <a class="code" href="faction__camp_8h.html#ab6b01bd98db40fc2331dc0bc2ae73d61a430e39cf0eec69892a0fdb6b0dc4aa70">harvest</a> ) {</div>
<div class="line"><a name="l03549"></a><span class="lineno"> 3549</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a6ffa08f6503465b7fe5ec70ab3180b92">item_name_whitelisted</a>( entry ) ) {</div>
<div class="line"><a name="l03550"></a><span class="lineno"> 3550</span>&#160;                wanted_name = entry;</div>
<div class="line"><a name="l03551"></a><span class="lineno"> 3551</span>&#160;                <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> = p;</div>
<div class="line"><a name="l03552"></a><span class="lineno"> 3552</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03553"></a><span class="lineno"> 3553</span>&#160;            }</div>
<div class="line"><a name="l03554"></a><span class="lineno"> 3554</span>&#160;        }</div>
<div class="line"><a name="l03555"></a><span class="lineno"> 3555</span>&#160;    };</div>
<div class="line"><a name="l03556"></a><span class="lineno"> 3556</span>&#160; </div>
<div class="line"><a name="l03557"></a><span class="lineno"> 3557</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p : <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), range ) ) {</div>
<div class="line"><a name="l03558"></a><span class="lineno"> 3558</span>&#160;        <span class="comment">// TODO: Make this sight check not overdraw nearby tiles</span></div>
<div class="line"><a name="l03559"></a><span class="lineno"> 3559</span>&#160;        <span class="comment">// TODO: Optimize that zone check</span></div>
<div class="line"><a name="l03560"></a><span class="lineno"> 3560</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;check_zone( <a class="code" href="npcmove_8cpp.html#a47a308d1260b0a61e3ac9f492d1159ca">zone_type_NO_NPC_PICKUP</a>, p ) ) {</div>
<div class="line"><a name="l03561"></a><span class="lineno"> 3561</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l03562"></a><span class="lineno"> 3562</span>&#160;                           <span class="stringliteral">&quot;%s didn&#39;t pick up an item because it&#39;s in a no-pickup zone.&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l03563"></a><span class="lineno"> 3563</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03564"></a><span class="lineno"> 3564</span>&#160;        }</div>
<div class="line"><a name="l03565"></a><span class="lineno"> 3565</span>&#160; </div>
<div class="line"><a name="l03566"></a><span class="lineno"> 3566</span>&#160;        <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> abs_p = <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>().<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() - <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() + p;</div>
<div class="line"><a name="l03567"></a><span class="lineno"> 3567</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> prev_num_items = <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aac51460e7bb6bc9c44bb79e9954d460c">searched_tiles</a>.<a class="code" href="classlru__cache.html#a1b5e943a1577d9ff732a63c130c58a45">get</a>( abs_p, -1 );</div>
<div class="line"><a name="l03568"></a><span class="lineno"> 3568</span>&#160;        <span class="comment">// Prefetch the number of items present so we can bail out if we already checked here.</span></div>
<div class="line"><a name="l03569"></a><span class="lineno"> 3569</span>&#160;        <a class="code" href="classmap__stack.html">map_stack</a> m_stack = here.<a class="code" href="classmap.html#a5130a127601b67e569eaef37a1a88610">i_at</a>( p );</div>
<div class="line"><a name="l03570"></a><span class="lineno"> 3570</span>&#160;        <span class="keywordtype">int</span> num_items = m_stack.<a class="code" href="classitem__stack.html#a09718022e82be5bc5dd6d84463521751">size</a>();</div>
<div class="line"><a name="l03571"></a><span class="lineno"> 3571</span>&#160;        <span class="keyword">const</span> <a class="code" href="classoptional__vpart__position.html">optional_vpart_position</a> vp = here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( p );</div>
<div class="line"><a name="l03572"></a><span class="lineno"> 3572</span>&#160;        <span class="keywordflow">if</span>( vp ) {</div>
<div class="line"><a name="l03573"></a><span class="lineno"> 3573</span>&#160;            <span class="keywordflow">if</span>( <span class="keyword">const</span> std::optional&lt;vpart_reference&gt; vp_cargo = vp.<a class="code" href="classoptional__vpart__position.html#acf1ddbf380ff79f8fd707a0453b1608b">cargo</a>() ) {</div>
<div class="line"><a name="l03574"></a><span class="lineno"> 3574</span>&#160;                num_items += vp_cargo-&gt;items().size();</div>
<div class="line"><a name="l03575"></a><span class="lineno"> 3575</span>&#160;            }</div>
<div class="line"><a name="l03576"></a><span class="lineno"> 3576</span>&#160;        }</div>
<div class="line"><a name="l03577"></a><span class="lineno"> 3577</span>&#160;        <span class="keywordflow">if</span>( prev_num_items == num_items ) {</div>
<div class="line"><a name="l03578"></a><span class="lineno"> 3578</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03579"></a><span class="lineno"> 3579</span>&#160;        }</div>
<div class="line"><a name="l03580"></a><span class="lineno"> 3580</span>&#160;        <span class="keyword">auto</span> cache_tile = [<span class="keyword">this</span>, &amp;abs_p, num_items]() {</div>
<div class="line"><a name="l03581"></a><span class="lineno"> 3581</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a>.<a class="code" href="classitem__location.html#a350bb267073f30205f780b394324a32c">get_item</a>() == nullptr ) {</div>
<div class="line"><a name="l03582"></a><span class="lineno"> 3582</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aac51460e7bb6bc9c44bb79e9954d460c">searched_tiles</a>.<a class="code" href="classlru__cache.html#a0039118ed2fb526c6a9ae9e3a51f75ae">insert</a>( 1000, abs_p, num_items );</div>
<div class="line"><a name="l03583"></a><span class="lineno"> 3583</span>&#160;            }</div>
<div class="line"><a name="l03584"></a><span class="lineno"> 3584</span>&#160;        };</div>
<div class="line"><a name="l03585"></a><span class="lineno"> 3585</span>&#160;        <span class="keywordtype">bool</span> can_see = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03586"></a><span class="lineno"> 3586</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a5b666218957f159f8af59e98644c7183">sees_some_items</a>( p, *<span class="keyword">this</span> ) &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( p ) ) {</div>
<div class="line"><a name="l03587"></a><span class="lineno"> 3587</span>&#160;            can_see = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03588"></a><span class="lineno"> 3588</span>&#160;            <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> &amp;it : m_stack ) {</div>
<div class="line"><a name="l03589"></a><span class="lineno"> 3589</span>&#160;                <span class="keywordflow">if</span>( consider_item( it, p ) ) {</div>
<div class="line"><a name="l03590"></a><span class="lineno"> 3590</span>&#160;                    <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = <a class="code" href="classitem__location.html">item_location</a>{ <a class="code" href="classmap__cursor.html">map_cursor</a>{p}, &amp;it };</div>
<div class="line"><a name="l03591"></a><span class="lineno"> 3591</span>&#160;                }</div>
<div class="line"><a name="l03592"></a><span class="lineno"> 3592</span>&#160;            }</div>
<div class="line"><a name="l03593"></a><span class="lineno"> 3593</span>&#160;        }</div>
<div class="line"><a name="l03594"></a><span class="lineno"> 3594</span>&#160; </div>
<div class="line"><a name="l03595"></a><span class="lineno"> 3595</span>&#160;        <span class="comment">// Not cached because it gets checked once and isn&#39;t expected to change.</span></div>
<div class="line"><a name="l03596"></a><span class="lineno"> 3596</span>&#160;        <span class="keywordflow">if</span>( can_see || <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( p ) ) {</div>
<div class="line"><a name="l03597"></a><span class="lineno"> 3597</span>&#160;            can_see = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03598"></a><span class="lineno"> 3598</span>&#160;            consider_terrain( p );</div>
<div class="line"><a name="l03599"></a><span class="lineno"> 3599</span>&#160;        }</div>
<div class="line"><a name="l03600"></a><span class="lineno"> 3600</span>&#160; </div>
<div class="line"><a name="l03601"></a><span class="lineno"> 3601</span>&#160;        <span class="keywordflow">if</span>( !vp || vp-&gt;vehicle().is_moving() || !( can_see || <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( p ) ) ) {</div>
<div class="line"><a name="l03602"></a><span class="lineno"> 3602</span>&#160;            cache_tile();</div>
<div class="line"><a name="l03603"></a><span class="lineno"> 3603</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03604"></a><span class="lineno"> 3604</span>&#160;        }</div>
<div class="line"><a name="l03605"></a><span class="lineno"> 3605</span>&#160;        <span class="keyword">const</span> std::optional&lt;vpart_reference&gt; cargo = vp.<a class="code" href="classoptional__vpart__position.html#acf1ddbf380ff79f8fd707a0453b1608b">cargo</a>();</div>
<div class="line"><a name="l03606"></a><span class="lineno"> 3606</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> std::string locked_string( <span class="stringliteral">&quot;LOCKED&quot;</span> );</div>
<div class="line"><a name="l03607"></a><span class="lineno"> 3607</span>&#160;        <span class="comment">// TODO: Let player know what parts are safe from NPC thieves</span></div>
<div class="line"><a name="l03608"></a><span class="lineno"> 3608</span>&#160;        <span class="keywordflow">if</span>( !cargo || cargo-&gt;has_feature( locked_string ) ) {</div>
<div class="line"><a name="l03609"></a><span class="lineno"> 3609</span>&#160;            cache_tile();</div>
<div class="line"><a name="l03610"></a><span class="lineno"> 3610</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03611"></a><span class="lineno"> 3611</span>&#160;        }</div>
<div class="line"><a name="l03612"></a><span class="lineno"> 3612</span>&#160; </div>
<div class="line"><a name="l03613"></a><span class="lineno"> 3613</span>&#160;        <span class="keyword">static</span> <span class="keyword">const</span> std::string cargo_locking_string( <span class="stringliteral">&quot;CARGO_LOCKING&quot;</span> );</div>
<div class="line"><a name="l03614"></a><span class="lineno"> 3614</span>&#160;        <span class="keywordflow">if</span>( vp.<a class="code" href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">part_with_feature</a>( cargo_locking_string, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l03615"></a><span class="lineno"> 3615</span>&#160;            cache_tile();</div>
<div class="line"><a name="l03616"></a><span class="lineno"> 3616</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03617"></a><span class="lineno"> 3617</span>&#160;        }</div>
<div class="line"><a name="l03618"></a><span class="lineno"> 3618</span>&#160; </div>
<div class="line"><a name="l03619"></a><span class="lineno"> 3619</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> &amp;it : cargo-&gt;items() ) {</div>
<div class="line"><a name="l03620"></a><span class="lineno"> 3620</span>&#160;            <span class="keywordflow">if</span>( consider_item( it, p ) ) {</div>
<div class="line"><a name="l03621"></a><span class="lineno"> 3621</span>&#160;                <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {  <a class="code" href="classvehicle__cursor.html">vehicle_cursor</a>{ cargo-&gt;vehicle(), <span class="keyword">static_cast&lt;</span>ptrdiff_t<span class="keyword">&gt;</span>( cargo-&gt;part_index() ) }, &amp;it };</div>
<div class="line"><a name="l03622"></a><span class="lineno"> 3622</span>&#160;            }</div>
<div class="line"><a name="l03623"></a><span class="lineno"> 3623</span>&#160;        }</div>
<div class="line"><a name="l03624"></a><span class="lineno"> 3624</span>&#160;        cache_tile();</div>
<div class="line"><a name="l03625"></a><span class="lineno"> 3625</span>&#160;    }</div>
<div class="line"><a name="l03626"></a><span class="lineno"> 3626</span>&#160; </div>
<div class="line"><a name="l03627"></a><span class="lineno"> 3627</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a>.<a class="code" href="classitem__location.html#a350bb267073f30205f780b394324a32c">get_item</a>() != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l03628"></a><span class="lineno"> 3628</span>&#160;        wanted_name = <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a>-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>();</div>
<div class="line"><a name="l03629"></a><span class="lineno"> 3629</span>&#160;    }</div>
<div class="line"><a name="l03630"></a><span class="lineno"> 3630</span>&#160; </div>
<div class="line"><a name="l03631"></a><span class="lineno"> 3631</span>&#160;    <span class="keywordflow">if</span>( wanted_name.empty() ) {</div>
<div class="line"><a name="l03632"></a><span class="lineno"> 3632</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03633"></a><span class="lineno"> 3633</span>&#160;    }</div>
<div class="line"><a name="l03634"></a><span class="lineno"> 3634</span>&#160; </div>
<div class="line"><a name="l03635"></a><span class="lineno"> 3635</span>&#160;    <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03636"></a><span class="lineno"> 3636</span>&#160; </div>
<div class="line"><a name="l03637"></a><span class="lineno"> 3637</span>&#160;    <span class="comment">// TODO: Move that check above, make it multi-target pathing and use it</span></div>
<div class="line"><a name="l03638"></a><span class="lineno"> 3638</span>&#160;    <span class="comment">// to limit tiles available for choice of items</span></div>
<div class="line"><a name="l03639"></a><span class="lineno"> 3639</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> dist_to_item = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a>, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l03640"></a><span class="lineno"> 3640</span>&#160;    <span class="keywordflow">if</span>( <span class="keyword">const</span> std::optional&lt;tripoint&gt; dest = <a class="code" href="npcmove_8cpp.html#a17d3c36ed4f9d4a8ffbd459b7c51e0c3">nearest_passable</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a>, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l03641"></a><span class="lineno"> 3641</span>&#160;        <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( *dest );</div>
<div class="line"><a name="l03642"></a><span class="lineno"> 3642</span>&#160;    }</div>
<div class="line"><a name="l03643"></a><span class="lineno"> 3643</span>&#160; </div>
<div class="line"><a name="l03644"></a><span class="lineno"> 3644</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() &amp;&amp; dist_to_item &gt; 1 ) {</div>
<div class="line"><a name="l03645"></a><span class="lineno"> 3645</span>&#160;        <span class="comment">// Item not reachable, let&#39;s just totally give up for now</span></div>
<div class="line"><a name="l03646"></a><span class="lineno"> 3646</span>&#160;        <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03647"></a><span class="lineno"> 3647</span>&#160;        <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03648"></a><span class="lineno"> 3648</span>&#160;    }</div>
<div class="line"><a name="l03649"></a><span class="lineno"> 3649</span>&#160; </div>
<div class="line"><a name="l03650"></a><span class="lineno"> 3650</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> &amp;&amp; <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a>, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &gt; 1 &amp;&amp; <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() ) {</div>
<div class="line"><a name="l03651"></a><span class="lineno"> 3651</span>&#160;        <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;Hold on, I want to pick up that %s.&quot;</span> ), wanted_name );</div>
<div class="line"><a name="l03652"></a><span class="lineno"> 3652</span>&#160;    }</div>
<div class="line"><a name="l03653"></a><span class="lineno"> 3653</span>&#160;}</div>
<div class="line"><a name="l03654"></a><span class="lineno"> 3654</span>&#160; </div>
<div class="line"><a name="l03655"></a><span class="lineno"><a class="line" href="classnpc.html#af9ea7f0462d56a586115b26fefaee170"> 3655</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#af9ea7f0462d56a586115b26fefaee170">npc::pick_up_item</a>()</div>
<div class="line"><a name="l03656"></a><span class="lineno"> 3656</span>&#160;{</div>
<div class="line"><a name="l03657"></a><span class="lineno"> 3657</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l03658"></a><span class="lineno"> 3658</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03659"></a><span class="lineno"> 3659</span>&#160;    }</div>
<div class="line"><a name="l03660"></a><span class="lineno"> 3660</span>&#160; </div>
<div class="line"><a name="l03661"></a><span class="lineno"> 3661</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7af71fc2d2d65b8777b95ddca9f1656de5">ally_rule::allow_pick_up</a> ) &amp;&amp; <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l03662"></a><span class="lineno"> 3662</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;%s::pick_up_item(); Canceling on player&#39;s request&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l03663"></a><span class="lineno"> 3663</span>&#160;        <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03664"></a><span class="lineno"> 3664</span>&#160;        <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03665"></a><span class="lineno"> 3665</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -1 );</div>
<div class="line"><a name="l03666"></a><span class="lineno"> 3666</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03667"></a><span class="lineno"> 3667</span>&#160;    }</div>
<div class="line"><a name="l03668"></a><span class="lineno"> 3668</span>&#160; </div>
<div class="line"><a name="l03669"></a><span class="lineno"> 3669</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03670"></a><span class="lineno"> 3670</span>&#160;    <span class="keyword">const</span> std::optional&lt;vpart_reference&gt; vp = here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> ).<a class="code" href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">part_with_feature</a>(</div>
<div class="line"><a name="l03671"></a><span class="lineno"> 3671</span>&#160;                <a class="code" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea563fb2626cff0acc6c8273fef3e3a8d0">VPFLAG_CARGO</a>, <span class="keyword">false</span> );</div>
<div class="line"><a name="l03672"></a><span class="lineno"> 3672</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> has_cargo = vp &amp;&amp; !vp-&gt;has_feature( <span class="stringliteral">&quot;LOCKED&quot;</span> );</div>
<div class="line"><a name="l03673"></a><span class="lineno"> 3673</span>&#160; </div>
<div class="line"><a name="l03674"></a><span class="lineno"> 3674</span>&#160;    <span class="keywordflow">if</span>( ( !here.<a class="code" href="classmap.html#aa904e9f61ca568d8ed985cf22193b8ed">has_items</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> ) &amp;&amp; !has_cargo &amp;&amp;</div>
<div class="line"><a name="l03675"></a><span class="lineno"> 3675</span>&#160;          !here.<a class="code" href="classmap.html#a19208d20803ab7c5da1073e17da18bd1">is_harvestable</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> ) &amp;&amp; <a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> ) ) ||</div>
<div class="line"><a name="l03676"></a><span class="lineno"> 3676</span>&#160;        ( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;check_zone( <a class="code" href="npcmove_8cpp.html#a47a308d1260b0a61e3ac9f492d1159ca">zone_type_NO_NPC_PICKUP</a>, <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> ) ) ) {</div>
<div class="line"><a name="l03677"></a><span class="lineno"> 3677</span>&#160;        <span class="comment">// Items we wanted no longer exist and we can see it</span></div>
<div class="line"><a name="l03678"></a><span class="lineno"> 3678</span>&#160;        <span class="comment">// Or player who is leading us doesn&#39;t want us to pick it up</span></div>
<div class="line"><a name="l03679"></a><span class="lineno"> 3679</span>&#160;        <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03680"></a><span class="lineno"> 3680</span>&#160;        <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03681"></a><span class="lineno"> 3681</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03682"></a><span class="lineno"> 3682</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;Canceling pickup - no items or new zone&quot;</span> );</div>
<div class="line"><a name="l03683"></a><span class="lineno"> 3683</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03684"></a><span class="lineno"> 3684</span>&#160;    }</div>
<div class="line"><a name="l03685"></a><span class="lineno"> 3685</span>&#160; </div>
<div class="line"><a name="l03686"></a><span class="lineno"> 3686</span>&#160;    <span class="comment">// Check: Is the item owned? Has the situation changed since we last moved? Am &#39;I&#39; now</span></div>
<div class="line"><a name="l03687"></a><span class="lineno"> 3687</span>&#160;    <span class="comment">// standing in front of the shopkeeper/player that I am about to steal from?</span></div>
<div class="line"><a name="l03688"></a><span class="lineno"> 3688</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> ) {</div>
<div class="line"><a name="l03689"></a><span class="lineno"> 3689</span>&#160;        <span class="keywordflow">if</span>( !::<a class="code" href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a00172ed0a10f7343e460c341ad4fe416">good_for_pickup</a>( *<a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a>, *<span class="keyword">this</span>, <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> ) ) {</div>
<div class="line"><a name="l03690"></a><span class="lineno"> 3690</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l03691"></a><span class="lineno"> 3691</span>&#160;                           <span class="stringliteral">&quot;%s canceling pickup - situation changed since they decided to take item&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l03692"></a><span class="lineno"> 3692</span>&#160;            <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03693"></a><span class="lineno"> 3693</span>&#160;            <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03694"></a><span class="lineno"> 3694</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03695"></a><span class="lineno"> 3695</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03696"></a><span class="lineno"> 3696</span>&#160;        }</div>
<div class="line"><a name="l03697"></a><span class="lineno"> 3697</span>&#160;    }</div>
<div class="line"><a name="l03698"></a><span class="lineno"> 3698</span>&#160; </div>
<div class="line"><a name="l03699"></a><span class="lineno"> 3699</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;%s::pick_up_item(); [ % d, % d, % d] =&gt; [ % d, % d, % d]&quot;</span>,</div>
<div class="line"><a name="l03700"></a><span class="lineno"> 3700</span>&#160;                   <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(),</div>
<div class="line"><a name="l03701"></a><span class="lineno"> 3701</span>&#160;                   <a class="code" href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">posx</a>(), <a class="code" href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">posy</a>(), <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>(), <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a>.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a>.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a>.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l03702"></a><span class="lineno"> 3702</span>&#160;    <span class="keywordflow">if</span>( <span class="keyword">const</span> std::optional&lt;tripoint&gt; dest = <a class="code" href="npcmove_8cpp.html#a17d3c36ed4f9d4a8ffbd459b7c51e0c3">nearest_passable</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a>, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) ) {</div>
<div class="line"><a name="l03703"></a><span class="lineno"> 3703</span>&#160;        <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( *dest );</div>
<div class="line"><a name="l03704"></a><span class="lineno"> 3704</span>&#160;    }</div>
<div class="line"><a name="l03705"></a><span class="lineno"> 3705</span>&#160; </div>
<div class="line"><a name="l03706"></a><span class="lineno"> 3706</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> dist_to_pickup = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> );</div>
<div class="line"><a name="l03707"></a><span class="lineno"> 3707</span>&#160;    <span class="keywordflow">if</span>( dist_to_pickup &gt; 1 &amp;&amp; !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l03708"></a><span class="lineno"> 3708</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;Moving; [%d, %d, %d] =&gt; [%d, %d, %d]&quot;</span>,</div>
<div class="line"><a name="l03709"></a><span class="lineno"> 3709</span>&#160;                       <a class="code" href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">posx</a>(), <a class="code" href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">posy</a>(), <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>(), <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0].x, <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0].y, <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>[0].z );</div>
<div class="line"><a name="l03710"></a><span class="lineno"> 3710</span>&#160; </div>
<div class="line"><a name="l03711"></a><span class="lineno"> 3711</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l03712"></a><span class="lineno"> 3712</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03713"></a><span class="lineno"> 3713</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( dist_to_pickup &gt; 1 &amp;&amp; <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l03714"></a><span class="lineno"> 3714</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;Can&#39;t find path&quot;</span> );</div>
<div class="line"><a name="l03715"></a><span class="lineno"> 3715</span>&#160;        <span class="comment">// This can happen, always do something</span></div>
<div class="line"><a name="l03716"></a><span class="lineno"> 3716</span>&#160;        <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03717"></a><span class="lineno"> 3717</span>&#160;        <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03718"></a><span class="lineno"> 3718</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l03719"></a><span class="lineno"> 3719</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03720"></a><span class="lineno"> 3720</span>&#160;    }</div>
<div class="line"><a name="l03721"></a><span class="lineno"> 3721</span>&#160; </div>
<div class="line"><a name="l03722"></a><span class="lineno"> 3722</span>&#160;    <span class="comment">// We&#39;re adjacent to the item; grab it!</span></div>
<div class="line"><a name="l03723"></a><span class="lineno"> 3723</span>&#160; </div>
<div class="line"><a name="l03724"></a><span class="lineno"> 3724</span>&#160;    <span class="keyword">auto</span> picked_up = <a class="code" href="classnpc.html#ae2697d29c28de70968b3aacccbfb824f">pick_up_item_map</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> );</div>
<div class="line"><a name="l03725"></a><span class="lineno"> 3725</span>&#160;    <span class="keywordflow">if</span>( picked_up.empty() &amp;&amp; has_cargo ) {</div>
<div class="line"><a name="l03726"></a><span class="lineno"> 3726</span>&#160;        picked_up = <a class="code" href="classnpc.html#aed2e9afbb2e71854fdb5c2df9a59dd5c">pick_up_item_vehicle</a>( vp-&gt;vehicle(), vp-&gt;part_index() );</div>
<div class="line"><a name="l03727"></a><span class="lineno"> 3727</span>&#160;    }</div>
<div class="line"><a name="l03728"></a><span class="lineno"> 3728</span>&#160; </div>
<div class="line"><a name="l03729"></a><span class="lineno"> 3729</span>&#160;    <span class="keywordflow">if</span>( picked_up.empty() ) {</div>
<div class="line"><a name="l03730"></a><span class="lineno"> 3730</span>&#160;        <span class="comment">// Last chance: plant harvest</span></div>
<div class="line"><a name="l03731"></a><span class="lineno"> 3731</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a19208d20803ab7c5da1073e17da18bd1">is_harvestable</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> ) ) {</div>
<div class="line"><a name="l03732"></a><span class="lineno"> 3732</span>&#160;            here.<a class="code" href="classmap.html#ad5ce012d209eb449670565155ec30f4b">examine</a>( *<span class="keyword">this</span>, <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> );</div>
<div class="line"><a name="l03733"></a><span class="lineno"> 3733</span>&#160;            <span class="comment">// Note: we didn&#39;t actually pick up anything, just spawned items</span></div>
<div class="line"><a name="l03734"></a><span class="lineno"> 3734</span>&#160;            <span class="comment">// but we want the item picker to find new items</span></div>
<div class="line"><a name="l03735"></a><span class="lineno"> 3735</span>&#160;            <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03736"></a><span class="lineno"> 3736</span>&#160;            <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03737"></a><span class="lineno"> 3737</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l03738"></a><span class="lineno"> 3738</span>&#160;        }</div>
<div class="line"><a name="l03739"></a><span class="lineno"> 3739</span>&#160;    }</div>
<div class="line"><a name="l03740"></a><span class="lineno"> 3740</span>&#160;    <a class="code" href="classviewer.html">viewer</a> &amp;player_view = <a class="code" href="game_8cpp.html#ab5c977b7e81348725fb7bf09fc64ed95">get_player_view</a>();</div>
<div class="line"><a name="l03741"></a><span class="lineno"> 3741</span>&#160;    <span class="comment">// Describe the pickup to the player</span></div>
<div class="line"><a name="l03742"></a><span class="lineno"> 3742</span>&#160;    <span class="keywordtype">bool</span> u_see = player_view.<a class="code" href="classviewer.html#a204fe140cdc73d2452fa9a390a32ba29">sees</a>( *<span class="keyword">this</span> ) || player_view.<a class="code" href="classviewer.html#a204fe140cdc73d2452fa9a390a32ba29">sees</a>( <a class="code" href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">wanted_item_pos</a> );</div>
<div class="line"><a name="l03743"></a><span class="lineno"> 3743</span>&#160;    <span class="keywordflow">if</span>( u_see ) {</div>
<div class="line"><a name="l03744"></a><span class="lineno"> 3744</span>&#160;        <span class="keywordflow">if</span>( picked_up.size() == 1 ) {</div>
<div class="line"><a name="l03745"></a><span class="lineno"> 3745</span>&#160;            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s picks up a %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), picked_up.front().tname() );</div>
<div class="line"><a name="l03746"></a><span class="lineno"> 3746</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( picked_up.size() == 2 ) {</div>
<div class="line"><a name="l03747"></a><span class="lineno"> 3747</span>&#160;            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s picks up a %2$s and a %3$s.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), picked_up.front().tname(),</div>
<div class="line"><a name="l03748"></a><span class="lineno"> 3748</span>&#160;                     picked_up.back().tname() );</div>
<div class="line"><a name="l03749"></a><span class="lineno"> 3749</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( picked_up.size() &gt; 2 ) {</div>
<div class="line"><a name="l03750"></a><span class="lineno"> 3750</span>&#160;            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s picks up several items.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l03751"></a><span class="lineno"> 3751</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03752"></a><span class="lineno"> 3752</span>&#160;            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s looks around nervously, as if searching for something.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l03753"></a><span class="lineno"> 3753</span>&#160;        }</div>
<div class="line"><a name="l03754"></a><span class="lineno"> 3754</span>&#160;    }</div>
<div class="line"><a name="l03755"></a><span class="lineno"> 3755</span>&#160; </div>
<div class="line"><a name="l03756"></a><span class="lineno"> 3756</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> &amp;it : picked_up ) {</div>
<div class="line"><a name="l03757"></a><span class="lineno"> 3757</span>&#160;        <span class="keywordtype">int</span> itval = <a class="code" href="classnpc.html#a29fad2798be32c49e72523a6cab2b7f9">value</a>( it );</div>
<div class="line"><a name="l03758"></a><span class="lineno"> 3758</span>&#160;        <span class="keywordflow">if</span>( itval &lt; <a class="code" href="classnpc.html#a0d2cf37dce89d7725da7dd6633b05974">worst_item_value</a> ) {</div>
<div class="line"><a name="l03759"></a><span class="lineno"> 3759</span>&#160;            <a class="code" href="classnpc.html#a0d2cf37dce89d7725da7dd6633b05974">worst_item_value</a> = itval;</div>
<div class="line"><a name="l03760"></a><span class="lineno"> 3760</span>&#160;        }</div>
<div class="line"><a name="l03761"></a><span class="lineno"> 3761</span>&#160;        <a class="code" href="classCharacter.html#af04d061e415da9cb6f1fc234b04f3dfb">i_add</a>( it );</div>
<div class="line"><a name="l03762"></a><span class="lineno"> 3762</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l03763"></a><span class="lineno"> 3763</span>&#160;    }</div>
<div class="line"><a name="l03764"></a><span class="lineno"> 3764</span>&#160; </div>
<div class="line"><a name="l03765"></a><span class="lineno"> 3765</span>&#160;    <a class="code" href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">fetching_item</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03766"></a><span class="lineno"> 3766</span>&#160;    <a class="code" href="classnpc.html#a7aa9c62909265efef5877730958edacb">wanted_item</a> = {};</div>
<div class="line"><a name="l03767"></a><span class="lineno"> 3767</span>&#160;    <a class="code" href="classnpc.html#a9ca344b214e47beec525f78ebc83dc64">has_new_items</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03768"></a><span class="lineno"> 3768</span>&#160;}</div>
<div class="line"><a name="l03769"></a><span class="lineno"> 3769</span>&#160; </div>
<div class="line"><a name="l03770"></a><span class="lineno"> 3770</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><a name="l03771"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a7997463407ad7a54a4e46c55e1d11e23"> 3771</a></span>&#160;std::list&lt;item&gt; <a class="code" href="npcmove_8cpp.html#a7997463407ad7a54a4e46c55e1d11e23">npc_pickup_from_stack</a>( <a class="code" href="classnpc.html">npc</a> &amp;who, T &amp;items )</div>
<div class="line"><a name="l03772"></a><span class="lineno"> 3772</span>&#160;{</div>
<div class="line"><a name="l03773"></a><span class="lineno"> 3773</span>&#160;    std::list&lt;item&gt; picked_up;</div>
<div class="line"><a name="l03774"></a><span class="lineno"> 3774</span>&#160; </div>
<div class="line"><a name="l03775"></a><span class="lineno"> 3775</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">auto</span> iter = items.begin(); iter != items.end(); ) {</div>
<div class="line"><a name="l03776"></a><span class="lineno"> 3776</span>&#160;        <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it = *iter;</div>
<div class="line"><a name="l03777"></a><span class="lineno"> 3777</span>&#160;        <span class="keywordflow">if</span>( who.<a class="code" href="classnpc.html#a78aff0d002c14e7448e2db08f7be7afe">can_take_that</a>( it ) &amp;&amp; who.<a class="code" href="classnpc.html#ad8d20228a9ce2ea0c6761c67f0478322">wants_take_that</a>( it ) ) {</div>
<div class="line"><a name="l03778"></a><span class="lineno"> 3778</span>&#160;            picked_up.push_back( it );</div>
<div class="line"><a name="l03779"></a><span class="lineno"> 3779</span>&#160;            iter = items.erase( iter );</div>
<div class="line"><a name="l03780"></a><span class="lineno"> 3780</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l03781"></a><span class="lineno"> 3781</span>&#160;            ++iter;</div>
<div class="line"><a name="l03782"></a><span class="lineno"> 3782</span>&#160;        }</div>
<div class="line"><a name="l03783"></a><span class="lineno"> 3783</span>&#160;    }</div>
<div class="line"><a name="l03784"></a><span class="lineno"> 3784</span>&#160; </div>
<div class="line"><a name="l03785"></a><span class="lineno"> 3785</span>&#160;    <span class="keywordflow">return</span> picked_up;</div>
<div class="line"><a name="l03786"></a><span class="lineno"> 3786</span>&#160;}</div>
<div class="line"><a name="l03787"></a><span class="lineno"> 3787</span>&#160; </div>
<div class="line"><a name="l03788"></a><span class="lineno"><a class="line" href="classnpc.html#a78aff0d002c14e7448e2db08f7be7afe"> 3788</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a78aff0d002c14e7448e2db08f7be7afe">npc::can_take_that</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it )</div>
<div class="line"><a name="l03789"></a><span class="lineno"> 3789</span>&#160;{</div>
<div class="line"><a name="l03790"></a><span class="lineno"> 3790</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="item_8h.html#a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8">good</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03791"></a><span class="lineno"> 3791</span>&#160; </div>
<div class="line"><a name="l03792"></a><span class="lineno"> 3792</span>&#160;    <span class="keyword">auto</span> weight_allowed = <a class="code" href="classCharacter.html#a0bdec852c8280a1cb4bb5e45e14057b5">weight_capacity</a>() - <a class="code" href="classCharacter.html#a5929e955c11ee6c749447472df7c774d">weight_carried</a>();</div>
<div class="line"><a name="l03793"></a><span class="lineno"> 3793</span>&#160; </div>
<div class="line"><a name="l03794"></a><span class="lineno"> 3794</span>&#160;    <span class="keywordflow">if</span>( !it.<a class="code" href="classitem.html#af486ddb23bd7e254cc07ef3ba1ba846d">made_of_from_type</a>( <a class="code" href="enums_8h.html#ade8f325e8cc8463cef8f944f3209d0e5a5918e24870f0ea98b9978dae8a69c533">phase_id::LIQUID</a> ) &amp;&amp; ( it.<a class="code" href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">weight</a>() &lt;= weight_allowed ) &amp;&amp;</div>
<div class="line"><a name="l03795"></a><span class="lineno"> 3795</span>&#160;        <a class="code" href="classCharacter.html#a03a17861579bf099c665ca234cd2a3b5">can_stash</a>( it ) ) {</div>
<div class="line"><a name="l03796"></a><span class="lineno"> 3796</span>&#160;        <a class="code" href="item_8h.html#a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8">good</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03797"></a><span class="lineno"> 3797</span>&#160;    }</div>
<div class="line"><a name="l03798"></a><span class="lineno"> 3798</span>&#160; </div>
<div class="line"><a name="l03799"></a><span class="lineno"> 3799</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="item_8h.html#a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8">good</a>;</div>
<div class="line"><a name="l03800"></a><span class="lineno"> 3800</span>&#160;}</div>
<div class="line"><a name="l03801"></a><span class="lineno"> 3801</span>&#160; </div>
<div class="line"><a name="l03802"></a><span class="lineno"><a class="line" href="classnpc.html#ad8d20228a9ce2ea0c6761c67f0478322"> 3802</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#ad8d20228a9ce2ea0c6761c67f0478322">npc::wants_take_that</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it )</div>
<div class="line"><a name="l03803"></a><span class="lineno"> 3803</span>&#160;{</div>
<div class="line"><a name="l03804"></a><span class="lineno"> 3804</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="item_8h.html#a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8">good</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03805"></a><span class="lineno"> 3805</span>&#160;    <span class="keywordtype">int</span> min_value = <a class="code" href="classnpc.html#ad43e6fde3fbc21def53e20b418b616e7">minimum_item_value</a>();</div>
<div class="line"><a name="l03806"></a><span class="lineno"> 3806</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> whitelisting = <a class="code" href="classnpc.html#ac52afe116abbbd44057f2da774cef3b5">has_item_whitelist</a>();</div>
<div class="line"><a name="l03807"></a><span class="lineno"> 3807</span>&#160; </div>
<div class="line"><a name="l03808"></a><span class="lineno"> 3808</span>&#160;    <a class="code" href="classitem.html">item</a> &amp;weap = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() ? *<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() : <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>();</div>
<div class="line"><a name="l03809"></a><span class="lineno"> 3809</span>&#160;    <span class="keywordflow">if</span>( ( ( !whitelisting &amp;&amp; <a class="code" href="classnpc.html#a29fad2798be32c49e72523a6cab2b7f9">value</a>( it ) &gt; min_value ) || <a class="code" href="classnpc.html#a073590db1d48bcb4b2f5e6e432f9d560">item_whitelisted</a>( it ) ) ||</div>
<div class="line"><a name="l03810"></a><span class="lineno"> 3810</span>&#160;        <a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a>( it ) &gt; <a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a>( weap ) ) {</div>
<div class="line"><a name="l03811"></a><span class="lineno"> 3811</span>&#160;        <a class="code" href="item_8h.html#a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8">good</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03812"></a><span class="lineno"> 3812</span>&#160;    }</div>
<div class="line"><a name="l03813"></a><span class="lineno"> 3813</span>&#160; </div>
<div class="line"><a name="l03814"></a><span class="lineno"> 3814</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="item_8h.html#a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8">good</a>;</div>
<div class="line"><a name="l03815"></a><span class="lineno"> 3815</span>&#160;}</div>
<div class="line"><a name="l03816"></a><span class="lineno"> 3816</span>&#160; </div>
<div class="line"><a name="l03817"></a><span class="lineno"><a class="line" href="classnpc.html#ad744dea4eca4c935a873c22e427a7277"> 3817</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#ad744dea4eca4c935a873c22e427a7277">npc::would_take_that</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p )</div>
<div class="line"><a name="l03818"></a><span class="lineno"> 3818</span>&#160;{</div>
<div class="line"><a name="l03819"></a><span class="lineno"> 3819</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> is_stealing = !it.<a class="code" href="classitem.html#a0b35b9066ad71987b77727af45d96059">is_owned_by</a>( *<span class="keyword">this</span>, <span class="keyword">true</span> );</div>
<div class="line"><a name="l03820"></a><span class="lineno"> 3820</span>&#160;    <span class="keywordflow">if</span>( !is_stealing ) {</div>
<div class="line"><a name="l03821"></a><span class="lineno"> 3821</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03822"></a><span class="lineno"> 3822</span>&#160;    }</div>
<div class="line"><a name="l03823"></a><span class="lineno"> 3823</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;<a class="code" href="craft__command_8h.html#a78e9fef1fc6aaee4239b8fa5cc3cd21fa912af0dff974604f1321254ca8ff38b6">player</a> = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l03824"></a><span class="lineno"> 3824</span>&#160;    <span class="comment">// Actual numeric relations are only relative to player faction</span></div>
<div class="line"><a name="l03825"></a><span class="lineno"> 3825</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a0b35b9066ad71987b77727af45d96059">is_owned_by</a>( <a class="code" href="craft__command_8h.html#a78e9fef1fc6aaee4239b8fa5cc3cd21fa912af0dff974604f1321254ca8ff38b6">player</a> ) ) {</div>
<div class="line"><a name="l03826"></a><span class="lineno"> 3826</span>&#160;        <span class="keywordtype">bool</span> would_always_steal = <span class="keyword">false</span>;</div>
<div class="line"><a name="l03827"></a><span class="lineno"> 3827</span>&#160;        <span class="keywordtype">int</span> stealing_threshold = 10;</div>
<div class="line"><a name="l03828"></a><span class="lineno"> 3828</span>&#160;        <span class="comment">// Trust = less likely to steal. Distrust? more likely!</span></div>
<div class="line"><a name="l03829"></a><span class="lineno"> 3829</span>&#160;        stealing_threshold += ( <a class="code" href="classnpc.html#a9ebaf7c38b4eb34255acc88302011ce0">get_faction</a>()-&gt;<a class="code" href="classfaction__template.html#a7c6bf7af56797169006e95328f81a1fd">trusts_u</a> / 5 );</div>
<div class="line"><a name="l03830"></a><span class="lineno"> 3830</span>&#160;        <span class="comment">// We&#39;ve already decided we want the item. So the primary motivator for stealing is aggression, not hoarding.</span></div>
<div class="line"><a name="l03831"></a><span class="lineno"> 3831</span>&#160;        stealing_threshold -= <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#aecf2fbbc5fcbda416d381dc0bde6e18c">aggression</a>;</div>
<div class="line"><a name="l03832"></a><span class="lineno"> 3832</span>&#160;        stealing_threshold -= <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#ad2ed57eaba1c878112ed7575bc6ebfbb">collector</a> / 3 );</div>
<div class="line"><a name="l03833"></a><span class="lineno"> 3833</span>&#160;        <span class="keywordflow">if</span>( stealing_threshold &lt; 0 ) {</div>
<div class="line"><a name="l03834"></a><span class="lineno"> 3834</span>&#160;            would_always_steal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03835"></a><span class="lineno"> 3835</span>&#160;        }</div>
<div class="line"><a name="l03836"></a><span class="lineno"> 3836</span>&#160;        <span class="comment">// Anyone willing to kill you no longer cares for your property rights</span></div>
<div class="line"><a name="l03837"></a><span class="lineno"> 3837</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5f6abf15a7e7de731322b31ece25d127">has_faction_relationship</a>( <a class="code" href="craft__command_8h.html#a78e9fef1fc6aaee4239b8fa5cc3cd21fa912af0dff974604f1321254ca8ff38b6">player</a>, <a class="code" href="namespacenpc__factions.html#af09ec48d0dc133795062d1424c486686ae2297e55866b5d8e47bfee136604c485">npc_factions::kill_on_sight</a> ) ) {</div>
<div class="line"><a name="l03838"></a><span class="lineno"> 3838</span>&#160;            would_always_steal = <span class="keyword">true</span>;</div>
<div class="line"><a name="l03839"></a><span class="lineno"> 3839</span>&#160;        }</div>
<div class="line"><a name="l03840"></a><span class="lineno"> 3840</span>&#160;        <span class="keywordflow">if</span>( would_always_steal ) {</div>
<div class="line"><a name="l03841"></a><span class="lineno"> 3841</span>&#160;            <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>, <span class="stringliteral">&quot;%s attempting to steal %s (owned by player).&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(),</div>
<div class="line"><a name="l03842"></a><span class="lineno"> 3842</span>&#160;                           it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l03843"></a><span class="lineno"> 3843</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03844"></a><span class="lineno"> 3844</span>&#160;        }</div>
<div class="line"><a name="l03845"></a><span class="lineno"> 3845</span>&#160; </div>
<div class="line"><a name="l03846"></a><span class="lineno"> 3846</span>&#160;        <span class="comment">/*Handle player and follower vision*/</span></div>
<div class="line"><a name="l03847"></a><span class="lineno"> 3847</span>&#160;        <a class="code" href="classviewer.html">viewer</a> &amp;player_view = <a class="code" href="game_8cpp.html#ab5c977b7e81348725fb7bf09fc64ed95">get_player_view</a>();</div>
<div class="line"><a name="l03848"></a><span class="lineno"> 3848</span>&#160;        <span class="keywordflow">if</span>( player_view.<a class="code" href="classviewer.html#a204fe140cdc73d2452fa9a390a32ba29">sees</a>( this-&gt;pos() ) || player_view.<a class="code" href="classviewer.html#a204fe140cdc73d2452fa9a390a32ba29">sees</a>( p ) ) {</div>
<div class="line"><a name="l03849"></a><span class="lineno"> 3849</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03850"></a><span class="lineno"> 3850</span>&#160;        }</div>
<div class="line"><a name="l03851"></a><span class="lineno"> 3851</span>&#160;        std::vector&lt;npc *&gt; followers;</div>
<div class="line"><a name="l03852"></a><span class="lineno"> 3852</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classcharacter__id.html">character_id</a> &amp;elem : <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;get_follower_list() ) {</div>
<div class="line"><a name="l03853"></a><span class="lineno"> 3853</span>&#160;            <a class="code" href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast&lt;npc&gt;</a> npc_to_get = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#abe3397983bdf2419ede84ee43bdf587f">find_npc</a>( elem );</div>
<div class="line"><a name="l03854"></a><span class="lineno"> 3854</span>&#160;            <span class="keywordflow">if</span>( !npc_to_get ) {</div>
<div class="line"><a name="l03855"></a><span class="lineno"> 3855</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l03856"></a><span class="lineno"> 3856</span>&#160;            }</div>
<div class="line"><a name="l03857"></a><span class="lineno"> 3857</span>&#160;            <a class="code" href="classnpc.html">npc</a> *npc_to_add = npc_to_get.get();</div>
<div class="line"><a name="l03858"></a><span class="lineno"> 3858</span>&#160;            followers.push_back( npc_to_add );</div>
<div class="line"><a name="l03859"></a><span class="lineno"> 3859</span>&#160;        }</div>
<div class="line"><a name="l03860"></a><span class="lineno"> 3860</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classnpc.html">npc</a> *&amp;elem : followers ) {</div>
<div class="line"><a name="l03861"></a><span class="lineno"> 3861</span>&#160;            <span class="keywordflow">if</span>( elem-&gt;sees( this-&gt;pos() ) || elem-&gt;sees( p ) ) {</div>
<div class="line"><a name="l03862"></a><span class="lineno"> 3862</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03863"></a><span class="lineno"> 3863</span>&#160;            }</div>
<div class="line"><a name="l03864"></a><span class="lineno"> 3864</span>&#160;        }</div>
<div class="line"><a name="l03865"></a><span class="lineno"> 3865</span>&#160;        <span class="comment">//Fallthrough, no consequences if you won&#39;t be caught!</span></div>
<div class="line"><a name="l03866"></a><span class="lineno"> 3866</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l03867"></a><span class="lineno"> 3867</span>&#160;                       <span class="stringliteral">&quot;%s attempting to steal %s (owned by player) because it isn&#39;t guarded.&quot;</span>,</div>
<div class="line"><a name="l03868"></a><span class="lineno"> 3868</span>&#160;                       <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l03869"></a><span class="lineno"> 3869</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03870"></a><span class="lineno"> 3870</span>&#160;    }</div>
<div class="line"><a name="l03871"></a><span class="lineno"> 3871</span>&#160; </div>
<div class="line"><a name="l03872"></a><span class="lineno"> 3872</span>&#160; </div>
<div class="line"><a name="l03873"></a><span class="lineno"> 3873</span>&#160;    <span class="comment">// Currently always willing to steal from other NPCs</span></div>
<div class="line"><a name="l03874"></a><span class="lineno"> 3874</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03875"></a><span class="lineno"> 3875</span>&#160;}</div>
<div class="line"><a name="l03876"></a><span class="lineno"> 3876</span>&#160; </div>
<div class="line"><a name="l03877"></a><span class="lineno"><a class="line" href="classnpc.html#ae2697d29c28de70968b3aacccbfb824f"> 3877</a></span>&#160;std::list&lt;item&gt; <a class="code" href="classnpc.html#ae2697d29c28de70968b3aacccbfb824f">npc::pick_up_item_map</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;where )</div>
<div class="line"><a name="l03878"></a><span class="lineno"> 3878</span>&#160;{</div>
<div class="line"><a name="l03879"></a><span class="lineno"> 3879</span>&#160;    <a class="code" href="classmap__stack.html">map_stack</a> stack = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a5130a127601b67e569eaef37a1a88610">i_at</a>( where );</div>
<div class="line"><a name="l03880"></a><span class="lineno"> 3880</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7997463407ad7a54a4e46c55e1d11e23">npc_pickup_from_stack</a>( *<span class="keyword">this</span>, stack );</div>
<div class="line"><a name="l03881"></a><span class="lineno"> 3881</span>&#160;}</div>
<div class="line"><a name="l03882"></a><span class="lineno"> 3882</span>&#160; </div>
<div class="line"><a name="l03883"></a><span class="lineno"><a class="line" href="classnpc.html#aed2e9afbb2e71854fdb5c2df9a59dd5c"> 3883</a></span>&#160;std::list&lt;item&gt; <a class="code" href="classnpc.html#aed2e9afbb2e71854fdb5c2df9a59dd5c">npc::pick_up_item_vehicle</a>( <a class="code" href="classvehicle.html">vehicle</a> &amp;veh, <span class="keywordtype">int</span> part_index )</div>
<div class="line"><a name="l03884"></a><span class="lineno"> 3884</span>&#160;{</div>
<div class="line"><a name="l03885"></a><span class="lineno"> 3885</span>&#160;    <a class="code" href="classvehicle__stack.html">vehicle_stack</a> stack = veh.<a class="code" href="classvehicle.html#abbc4051229bf116dfd03c53dcc4a0765">get_items</a>( veh.<a class="code" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a>( part_index ) );</div>
<div class="line"><a name="l03886"></a><span class="lineno"> 3886</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="npcmove_8cpp.html#a7997463407ad7a54a4e46c55e1d11e23">npc_pickup_from_stack</a>( *<span class="keyword">this</span>, stack );</div>
<div class="line"><a name="l03887"></a><span class="lineno"> 3887</span>&#160;}</div>
<div class="line"><a name="l03888"></a><span class="lineno"> 3888</span>&#160; </div>
<div class="line"><a name="l03889"></a><span class="lineno"><a class="line" href="classnpc.html#a86d59c5c838a35d11b42bd615f36d022"> 3889</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a86d59c5c838a35d11b42bd615f36d022">npc::find_corpse_to_pulp</a>()</div>
<div class="line"><a name="l03890"></a><span class="lineno"> 3890</span>&#160;{</div>
<div class="line"><a name="l03891"></a><span class="lineno"> 3891</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l03892"></a><span class="lineno"> 3892</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l03893"></a><span class="lineno"> 3893</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a4d86aa5b7cf26fbf7d1be4e398b2ce67">ally_rule::allow_pulp</a> ) ||</div>
<div class="line"><a name="l03894"></a><span class="lineno"> 3894</span>&#160;            player_character.<a class="code" href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">in_vehicle</a> || <a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l03895"></a><span class="lineno"> 3895</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03896"></a><span class="lineno"> 3896</span>&#160;        }</div>
<div class="line"><a name="l03897"></a><span class="lineno"> 3897</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &gt;= <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a458f36d8f86be518856dfaf972acb8cf">engagement_distance</a> ) {</div>
<div class="line"><a name="l03898"></a><span class="lineno"> 3898</span>&#160;            <span class="comment">// don&#39;t start to pulp corpses if you&#39;re already far from the player.</span></div>
<div class="line"><a name="l03899"></a><span class="lineno"> 3899</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03900"></a><span class="lineno"> 3900</span>&#160;        }</div>
<div class="line"><a name="l03901"></a><span class="lineno"> 3901</span>&#160;    }</div>
<div class="line"><a name="l03902"></a><span class="lineno"> 3902</span>&#160; </div>
<div class="line"><a name="l03903"></a><span class="lineno"> 3903</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l03904"></a><span class="lineno"> 3904</span>&#160;    <span class="comment">// Pathing with overdraw can get expensive, limit it</span></div>
<div class="line"><a name="l03905"></a><span class="lineno"> 3905</span>&#160;    <span class="keywordtype">int</span> path_counter = 4;</div>
<div class="line"><a name="l03906"></a><span class="lineno"> 3906</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> check_tile = [<span class="keyword">this</span>, &amp;path_counter, &amp;here]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; p ) -&gt; <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> * {</div>
<div class="line"><a name="l03907"></a><span class="lineno"> 3907</span>&#160;        <span class="keywordflow">if</span>( !here.<a class="code" href="classmap.html#a5b666218957f159f8af59e98644c7183">sees_some_items</a>( p, *<span class="keyword">this</span> ) || !<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( p ) )</div>
<div class="line"><a name="l03908"></a><span class="lineno"> 3908</span>&#160;        {</div>
<div class="line"><a name="l03909"></a><span class="lineno"> 3909</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03910"></a><span class="lineno"> 3910</span>&#160;        }</div>
<div class="line"><a name="l03911"></a><span class="lineno"> 3911</span>&#160; </div>
<div class="line"><a name="l03912"></a><span class="lineno"> 3912</span>&#160;        <span class="keyword">const</span> <a class="code" href="classmap__stack.html">map_stack</a> items = here.<a class="code" href="classmap.html#a5130a127601b67e569eaef37a1a88610">i_at</a>( p );</div>
<div class="line"><a name="l03913"></a><span class="lineno"> 3913</span>&#160;        <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> *found = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03914"></a><span class="lineno"> 3914</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it : items )</div>
<div class="line"><a name="l03915"></a><span class="lineno"> 3915</span>&#160;        {</div>
<div class="line"><a name="l03916"></a><span class="lineno"> 3916</span>&#160;            <span class="comment">// Pulp only stuff that revives, but don&#39;t pulp acid stuff</span></div>
<div class="line"><a name="l03917"></a><span class="lineno"> 3917</span>&#160;            <span class="comment">// That is, if you aren&#39;t protected from this stuff!</span></div>
<div class="line"><a name="l03918"></a><span class="lineno"> 3918</span>&#160;            <span class="keywordflow">if</span>( it.can_revive() ) {</div>
<div class="line"><a name="l03919"></a><span class="lineno"> 3919</span>&#160;                <span class="comment">// If the first encountered corpse bleeds something dangerous then</span></div>
<div class="line"><a name="l03920"></a><span class="lineno"> 3920</span>&#160;                <span class="comment">// it is not safe to bash.</span></div>
<div class="line"><a name="l03921"></a><span class="lineno"> 3921</span>&#160;                <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#af5c36ca5b43c92f6cb02afb52a448372">is_dangerous_field</a>( <a class="code" href="classfield__entry.html">field_entry</a>( it.get_mtype()-&gt;bloodType(), 1, 0_turns ) ) ) {</div>
<div class="line"><a name="l03922"></a><span class="lineno"> 3922</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03923"></a><span class="lineno"> 3923</span>&#160;                }</div>
<div class="line"><a name="l03924"></a><span class="lineno"> 3924</span>&#160; </div>
<div class="line"><a name="l03925"></a><span class="lineno"> 3925</span>&#160;                found = &amp;it;</div>
<div class="line"><a name="l03926"></a><span class="lineno"> 3926</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03927"></a><span class="lineno"> 3927</span>&#160;            }</div>
<div class="line"><a name="l03928"></a><span class="lineno"> 3928</span>&#160;        }</div>
<div class="line"><a name="l03929"></a><span class="lineno"> 3929</span>&#160; </div>
<div class="line"><a name="l03930"></a><span class="lineno"> 3930</span>&#160;        <span class="keywordflow">if</span>( found != <span class="keyword">nullptr</span> )</div>
<div class="line"><a name="l03931"></a><span class="lineno"> 3931</span>&#160;        {</div>
<div class="line"><a name="l03932"></a><span class="lineno"> 3932</span>&#160;            path_counter--;</div>
<div class="line"><a name="l03933"></a><span class="lineno"> 3933</span>&#160;            <span class="comment">// Only return corpses we can path to</span></div>
<div class="line"><a name="l03934"></a><span class="lineno"> 3934</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( p, <span class="keyword">false</span>, <span class="keyword">false</span> ) ? found : <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03935"></a><span class="lineno"> 3935</span>&#160;        }</div>
<div class="line"><a name="l03936"></a><span class="lineno"> 3936</span>&#160; </div>
<div class="line"><a name="l03937"></a><span class="lineno"> 3937</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03938"></a><span class="lineno"> 3938</span>&#160;    };</div>
<div class="line"><a name="l03939"></a><span class="lineno"> 3939</span>&#160; </div>
<div class="line"><a name="l03940"></a><span class="lineno"> 3940</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> range = <a class="code" href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">mem_combat</a>.<a class="code" href="structnpc__combat__memory__cache.html#a458f36d8f86be518856dfaf972acb8cf">engagement_distance</a>;</div>
<div class="line"><a name="l03941"></a><span class="lineno"> 3941</span>&#160; </div>
<div class="line"><a name="l03942"></a><span class="lineno"> 3942</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> *<a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03943"></a><span class="lineno"> 3943</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a> &amp;&amp; <a class="code" href="coordinates_8h.html#a9d7b6c83d7cf9846d5f1b56e02d88268">square_dist</a>( <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>(), *<a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a> ) &lt;= range ) {</div>
<div class="line"><a name="l03944"></a><span class="lineno"> 3944</span>&#160;        <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> = check_tile( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a> ) );</div>
<div class="line"><a name="l03945"></a><span class="lineno"> 3945</span>&#160;    }</div>
<div class="line"><a name="l03946"></a><span class="lineno"> 3946</span>&#160; </div>
<div class="line"><a name="l03947"></a><span class="lineno"> 3947</span>&#160;    <span class="comment">// Find the old target to avoid spamming</span></div>
<div class="line"><a name="l03948"></a><span class="lineno"> 3948</span>&#160;    <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> *old_target = <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a>;</div>
<div class="line"><a name="l03949"></a><span class="lineno"> 3949</span>&#160; </div>
<div class="line"><a name="l03950"></a><span class="lineno"> 3950</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> == <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l03951"></a><span class="lineno"> 3951</span>&#160;        <span class="comment">// If we&#39;re following the player, don&#39;t wander off to pulp corpses</span></div>
<div class="line"><a name="l03952"></a><span class="lineno"> 3952</span>&#160;        <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> around = <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() ? player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() : <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l03953"></a><span class="lineno"> 3953</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> &amp;<a class="code" href="classCreature.html#a681e27e1004c58fcdf25adfdac5e9136">location</a> : here.<a class="code" href="classmap.html#a0acb4c11e2fd7a3dc7d2f7a8b52c1503">get_active_items_in_radius</a>( around, range,</div>
<div class="line"><a name="l03954"></a><span class="lineno"> 3954</span>&#160;                <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">special_item_type::corpse</a> ) ) {</div>
<div class="line"><a name="l03955"></a><span class="lineno"> 3955</span>&#160;            <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> = check_tile( <a class="code" href="classCreature.html#a681e27e1004c58fcdf25adfdac5e9136">location</a>.position() );</div>
<div class="line"><a name="l03956"></a><span class="lineno"> 3956</span>&#160; </div>
<div class="line"><a name="l03957"></a><span class="lineno"> 3957</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l03958"></a><span class="lineno"> 3958</span>&#160;                <a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a> = here.<a class="code" href="classmap.html#ac868b594b36b6b9bbcb130650fd4f61f">getglobal</a>( <a class="code" href="classCreature.html#a681e27e1004c58fcdf25adfdac5e9136">location</a>.position() );</div>
<div class="line"><a name="l03959"></a><span class="lineno"> 3959</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03960"></a><span class="lineno"> 3960</span>&#160;            }</div>
<div class="line"><a name="l03961"></a><span class="lineno"> 3961</span>&#160; </div>
<div class="line"><a name="l03962"></a><span class="lineno"> 3962</span>&#160;            <span class="keywordflow">if</span>( path_counter &lt;= 0 ) {</div>
<div class="line"><a name="l03963"></a><span class="lineno"> 3963</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l03964"></a><span class="lineno"> 3964</span>&#160;            }</div>
<div class="line"><a name="l03965"></a><span class="lineno"> 3965</span>&#160;        }</div>
<div class="line"><a name="l03966"></a><span class="lineno"> 3966</span>&#160;    }</div>
<div class="line"><a name="l03967"></a><span class="lineno"> 3967</span>&#160; </div>
<div class="line"><a name="l03968"></a><span class="lineno"> 3968</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> != <span class="keyword">nullptr</span> &amp;&amp; <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> != old_target &amp;&amp; <a class="code" href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">is_walking_with</a>() ) {</div>
<div class="line"><a name="l03969"></a><span class="lineno"> 3969</span>&#160;        std::string talktag = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a530755cbfc0792b48d0762e1ae60fb16">snip_pulp_zombie</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l03970"></a><span class="lineno"> 3970</span>&#160;        <a class="code" href="npc_8h.html#aee50a2d29c2194e6df726113b025e55b">parse_tags</a>( talktag, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>(), *<span class="keyword">this</span> );</div>
<div class="line"><a name="l03971"></a><span class="lineno"> 3971</span>&#160;        <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( talktag, <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a>-&gt;tname() ) );</div>
<div class="line"><a name="l03972"></a><span class="lineno"> 3972</span>&#160;    }</div>
<div class="line"><a name="l03973"></a><span class="lineno"> 3973</span>&#160; </div>
<div class="line"><a name="l03974"></a><span class="lineno"> 3974</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">corpse</a> != <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l03975"></a><span class="lineno"> 3975</span>&#160;}</div>
<div class="line"><a name="l03976"></a><span class="lineno"> 3976</span>&#160; </div>
<div class="line"><a name="l03977"></a><span class="lineno"><a class="line" href="classnpc.html#a44f84e85868e3dbe33073a94c51c1e7c"> 3977</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a44f84e85868e3dbe33073a94c51c1e7c">npc::can_do_pulp</a>()</div>
<div class="line"><a name="l03978"></a><span class="lineno"> 3978</span>&#160;{</div>
<div class="line"><a name="l03979"></a><span class="lineno"> 3979</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a> ) {</div>
<div class="line"><a name="l03980"></a><span class="lineno"> 3980</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03981"></a><span class="lineno"> 3981</span>&#160;    }</div>
<div class="line"><a name="l03982"></a><span class="lineno"> 3982</span>&#160; </div>
<div class="line"><a name="l03983"></a><span class="lineno"> 3983</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( *<a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a>, <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>() ) &gt; 1 || <a class="code" href="classnpc.html#a63bc137408877f29318ca32345247426">pulp_location</a>-&gt;z() != <a class="code" href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">posz</a>() ) {</div>
<div class="line"><a name="l03984"></a><span class="lineno"> 3984</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l03985"></a><span class="lineno"> 3985</span>&#160;    }</div>
<div class="line"><a name="l03986"></a><span class="lineno"> 3986</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l03987"></a><span class="lineno"> 3987</span>&#160;}</div>
<div class="line"><a name="l03988"></a><span class="lineno"> 3988</span>&#160; </div>
<div class="line"><a name="l03989"></a><span class="lineno"><a class="line" href="classnpc.html#aaca9337f2ca21164cfe32e6097995255"> 3989</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#aaca9337f2ca21164cfe32e6097995255">npc::do_player_activity</a>()</div>
<div class="line"><a name="l03990"></a><span class="lineno"> 3990</span>&#160;{</div>
<div class="line"><a name="l03991"></a><span class="lineno"> 3991</span>&#160;    <span class="keywordtype">int</span> old_moves = <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>;</div>
<div class="line"><a name="l03992"></a><span class="lineno"> 3992</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> &gt; 200 &amp;&amp; <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a> &amp;&amp; ( <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#ae44b657c59940e256aeb15e73bf2be1d">is_multi_type</a>() ||</div>
<div class="line"><a name="l03993"></a><span class="lineno"> 3993</span>&#160;                                     <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#a955b947f2ca18118b44d3e44aa72b66e">id</a>() == <a class="code" href="npcmove_8cpp.html#a3ba251501edde65d85515f5febd2fd8b">ACT_TIDY_UP</a> ) ) {</div>
<div class="line"><a name="l03994"></a><span class="lineno"> 3994</span>&#160;        <span class="comment">// a huge backlog of a multi-activity type can forever loop</span></div>
<div class="line"><a name="l03995"></a><span class="lineno"> 3995</span>&#160;        <span class="comment">// instead; just scan the map ONCE for a task to do, and if it returns false</span></div>
<div class="line"><a name="l03996"></a><span class="lineno"> 3996</span>&#160;        <span class="comment">// then stop scanning, abandon the activity, and kill the backlog of moves.</span></div>
<div class="line"><a name="l03997"></a><span class="lineno"> 3997</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="activity__handlers_8h.html#a92427c4a20720f251807f7e70db0640b">generic_multi_activity_handler</a>( <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>, *this-&gt;<a class="code" href="classCharacter.html#a01a7950e28e24252e372d7e74078e12f">as_character</a>(), <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l03998"></a><span class="lineno"> 3998</span>&#160;            <a class="code" href="classnpc.html#aefeae3d14dd64533e5bff412e280c2e8">revert_after_activity</a>();</div>
<div class="line"><a name="l03999"></a><span class="lineno"> 3999</span>&#160;            <a class="code" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a name="l04000"></a><span class="lineno"> 4000</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04001"></a><span class="lineno"> 4001</span>&#160;        }</div>
<div class="line"><a name="l04002"></a><span class="lineno"> 4002</span>&#160;    }</div>
<div class="line"><a name="l04003"></a><span class="lineno"> 4003</span>&#160;    <span class="comment">// the multi-activity types can sometimes cancel the activity, and return without using up any moves.</span></div>
<div class="line"><a name="l04004"></a><span class="lineno"> 4004</span>&#160;    <span class="comment">// ( when they are setting a destination etc. )</span></div>
<div class="line"><a name="l04005"></a><span class="lineno"> 4005</span>&#160;    <span class="comment">// normally this isn&#39;t a problem, but in the main game loop, if the NPC has a huge backlog of moves;</span></div>
<div class="line"><a name="l04006"></a><span class="lineno"> 4006</span>&#160;    <span class="comment">// then each of these occurrences will nudge the infinite loop counter up by one.</span></div>
<div class="line"><a name="l04007"></a><span class="lineno"> 4007</span>&#160;    <span class="comment">// ( even if other move-using things occur inbetween )</span></div>
<div class="line"><a name="l04008"></a><span class="lineno"> 4008</span>&#160;    <span class="comment">// so here - if no moves are used in a multi-type activity do_turn(), then subtract a nominal amount</span></div>
<div class="line"><a name="l04009"></a><span class="lineno"> 4009</span>&#160;    <span class="comment">// to satisfy the infinite loop counter.</span></div>
<div class="line"><a name="l04010"></a><span class="lineno"> 4010</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> multi_type = <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a> ? <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#ae44b657c59940e256aeb15e73bf2be1d">is_multi_type</a>() : <span class="keyword">false</span>;</div>
<div class="line"><a name="l04011"></a><span class="lineno"> 4011</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> moves_before = <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>;</div>
<div class="line"><a name="l04012"></a><span class="lineno"> 4012</span>&#160;    <span class="keywordflow">while</span>( <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> &gt; 0 &amp;&amp; <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a> ) {</div>
<div class="line"><a name="l04013"></a><span class="lineno"> 4013</span>&#160;        <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#a8ec4a2e2ed99099a3ecb383063b95345">do_turn</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l04014"></a><span class="lineno"> 4014</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a5e8e8c9c793c22192e3874c087da4ce6">is_active</a>() ) {</div>
<div class="line"><a name="l04015"></a><span class="lineno"> 4015</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04016"></a><span class="lineno"> 4016</span>&#160;        }</div>
<div class="line"><a name="l04017"></a><span class="lineno"> 4017</span>&#160;    }</div>
<div class="line"><a name="l04018"></a><span class="lineno"> 4018</span>&#160;    <span class="keywordflow">if</span>( multi_type &amp;&amp; <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> == moves_before ) {</div>
<div class="line"><a name="l04019"></a><span class="lineno"> 4019</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -1 );</div>
<div class="line"><a name="l04020"></a><span class="lineno"> 4020</span>&#160;    }</div>
<div class="line"><a name="l04021"></a><span class="lineno"> 4021</span>&#160;    <span class="comment">/* if the activity is finished, grab any backlog or change the mission */</span></div>
<div class="line"><a name="l04022"></a><span class="lineno"> 4022</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#a7f95b5332e70af7ccf1d46fe7a3484f6">has_destination</a>() &amp;&amp; !<a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a> ) {</div>
<div class="line"><a name="l04023"></a><span class="lineno"> 4023</span>&#160;        <span class="comment">// workaround: auto resuming craft activity may cause infinite loop</span></div>
<div class="line"><a name="l04024"></a><span class="lineno"> 4024</span>&#160;        <span class="keywordflow">while</span>( !<a class="code" href="classCharacter.html#ad2f8dc354e09863a8d257b353a749caa">backlog</a>.empty() &amp;&amp; <a class="code" href="classCharacter.html#ad2f8dc354e09863a8d257b353a749caa">backlog</a>.front().id() == <a class="code" href="npcmove_8cpp.html#a998c1f0ad926f40dc54ed31ef34e105e">ACT_CRAFT</a> ) {</div>
<div class="line"><a name="l04025"></a><span class="lineno"> 4025</span>&#160;            <a class="code" href="classCharacter.html#ad2f8dc354e09863a8d257b353a749caa">backlog</a>.pop_front();</div>
<div class="line"><a name="l04026"></a><span class="lineno"> 4026</span>&#160;        }</div>
<div class="line"><a name="l04027"></a><span class="lineno"> 4027</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#ad2f8dc354e09863a8d257b353a749caa">backlog</a>.empty() ) {</div>
<div class="line"><a name="l04028"></a><span class="lineno"> 4028</span>&#160;            <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a> = <a class="code" href="classCharacter.html#ad2f8dc354e09863a8d257b353a749caa">backlog</a>.front();</div>
<div class="line"><a name="l04029"></a><span class="lineno"> 4029</span>&#160;            <a class="code" href="classCharacter.html#ad2f8dc354e09863a8d257b353a749caa">backlog</a>.pop_front();</div>
<div class="line"><a name="l04030"></a><span class="lineno"> 4030</span>&#160;            <a class="code" href="classnpc.html#a965025669d8af18fe89adf0a2f477b9a">current_activity_id</a> = <a class="code" href="classCharacter.html#a20839520f569c4f05876a55e89f67361">activity</a>.<a class="code" href="classplayer__activity.html#a955b947f2ca18118b44d3e44aa72b66e">id</a>();</div>
<div class="line"><a name="l04031"></a><span class="lineno"> 4031</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04032"></a><span class="lineno"> 4032</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l04033"></a><span class="lineno"> 4033</span>&#160;                <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s completed the assigned task.&quot;</span> ), <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() ) );</div>
<div class="line"><a name="l04034"></a><span class="lineno"> 4034</span>&#160;            }</div>
<div class="line"><a name="l04035"></a><span class="lineno"> 4035</span>&#160;            <a class="code" href="classnpc.html#a965025669d8af18fe89adf0a2f477b9a">current_activity_id</a> = <a class="code" href="classstring__id.html#a1b2100ed077789ba45aaf5081791b36c">activity_id::NULL_ID</a>();</div>
<div class="line"><a name="l04036"></a><span class="lineno"> 4036</span>&#160;            <a class="code" href="classnpc.html#aefeae3d14dd64533e5bff412e280c2e8">revert_after_activity</a>();</div>
<div class="line"><a name="l04037"></a><span class="lineno"> 4037</span>&#160;            <span class="comment">// if we loaded after being out of the bubble for a while, we might have more</span></div>
<div class="line"><a name="l04038"></a><span class="lineno"> 4038</span>&#160;            <span class="comment">// moves than we need, so clear them</span></div>
<div class="line"><a name="l04039"></a><span class="lineno"> 4039</span>&#160;            <a class="code" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a name="l04040"></a><span class="lineno"> 4040</span>&#160;        }</div>
<div class="line"><a name="l04041"></a><span class="lineno"> 4041</span>&#160;    }</div>
<div class="line"><a name="l04042"></a><span class="lineno"> 4042</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> != old_moves;</div>
<div class="line"><a name="l04043"></a><span class="lineno"> 4043</span>&#160;}</div>
<div class="line"><a name="l04044"></a><span class="lineno"> 4044</span>&#160; </div>
<div class="line"><a name="l04045"></a><span class="lineno"><a class="line" href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5"> 4045</a></span>&#160;<span class="keywordtype">double</span> <a class="code" href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5">npc::evaluate_weapon</a>( <a class="code" href="classitem.html">item</a> &amp;it, <span class="keywordtype">bool</span> can_use_gun, <span class="keywordtype">bool</span> use_silent )<span class="keyword"> const</span></div>
<div class="line"><a name="l04046"></a><span class="lineno"> 4046</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04047"></a><span class="lineno"> 4047</span>&#160;    <span class="keywordtype">bool</span> allowed = can_use_gun &amp;&amp; it.<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() &amp;&amp; ( !<a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> || it.<a class="code" href="classitem.html#ab180dbb50ec9d55570a1b1de1a2ce126">is_silent</a>() );</div>
<div class="line"><a name="l04048"></a><span class="lineno"> 4048</span>&#160;    <span class="comment">// According to unmodified evaluation score, NPCs almost always prioritize wielding guns if they have one.</span></div>
<div class="line"><a name="l04049"></a><span class="lineno"> 4049</span>&#160;    <span class="comment">// This is relatively reasonable, as players can issue commands to NPCs when we do not want them to use ranged weapons.</span></div>
<div class="line"><a name="l04050"></a><span class="lineno"> 4050</span>&#160;    <span class="comment">// Conversely, we cannot directly issue commands when we want NPCs to prioritize ranged weapons.</span></div>
<div class="line"><a name="l04051"></a><span class="lineno"> 4051</span>&#160;    <span class="comment">// Note that the scoring method here is different from the &#39;weapon_value&#39; used elsewhere.</span></div>
<div class="line"><a name="l04052"></a><span class="lineno"> 4052</span>&#160;    <span class="keywordtype">double</span> val_gun = allowed ? <a class="code" href="classCharacter.html#a64b5eefd36bce677403f1912c414f977">gun_value</a>( it, it.<a class="code" href="classitem.html#a31950d1e38829eb4c5794ffbe4e7d604">shots_remaining</a>( <span class="keyword">this</span> ) ) : 0;</div>
<div class="line"><a name="l04053"></a><span class="lineno"> 4053</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l04054"></a><span class="lineno"> 4054</span>&#160;                   <span class="stringliteral">&quot;%s %s valued at &lt;color_light_cyan&gt;%1.2f as a ranged weapon to wield&lt;/color&gt;.&quot;</span>,</div>
<div class="line"><a name="l04055"></a><span class="lineno"> 4055</span>&#160;                   <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ), it.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a291870408701f0174d8c46b7f770fbaf">get_id</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>(), val_gun );</div>
<div class="line"><a name="l04056"></a><span class="lineno"> 4056</span>&#160;    <span class="keywordtype">double</span> val_melee = <a class="code" href="classCharacter.html#a2d0c03e2157953bcc0a6941554467233">melee_value</a>( it );</div>
<div class="line"><a name="l04057"></a><span class="lineno"> 4057</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a>,</div>
<div class="line"><a name="l04058"></a><span class="lineno"> 4058</span>&#160;                   <span class="stringliteral">&quot;%s %s valued at &lt;color_light_cyan&gt;%1.2f as a melee weapon to wield&lt;/color&gt;.&quot;</span>, <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>( <span class="keyword">true</span> ),</div>
<div class="line"><a name="l04059"></a><span class="lineno"> 4059</span>&#160;                   it.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a291870408701f0174d8c46b7f770fbaf">get_id</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>(), val_melee );</div>
<div class="line"><a name="l04060"></a><span class="lineno"> 4060</span>&#160;    <span class="keywordtype">double</span> val = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( val_gun, val_melee );</div>
<div class="line"><a name="l04061"></a><span class="lineno"> 4061</span>&#160;    <span class="keywordflow">return</span> val;</div>
<div class="line"><a name="l04062"></a><span class="lineno"> 4062</span>&#160;}</div>
<div class="line"><a name="l04063"></a><span class="lineno"> 4063</span>&#160; </div>
<div class="line"><a name="l04064"></a><span class="lineno"><a class="line" href="classnpc.html#a3f84d48b1596bc3da94a53804598e6e0"> 4064</a></span>&#160;<a class="code" href="classitem.html">item</a> *<a class="code" href="classnpc.html#a3f84d48b1596bc3da94a53804598e6e0">npc::evaluate_best_weapon</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l04065"></a><span class="lineno"> 4065</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04066"></a><span class="lineno"> 4066</span>&#160;    <span class="keywordtype">bool</span> can_use_gun = !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() || <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5be11a9176c3d5056b833343103f70f4">ally_rule::use_guns</a> );</div>
<div class="line"><a name="l04067"></a><span class="lineno"> 4067</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> = <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">ally_rule::use_silent</a> );</div>
<div class="line"><a name="l04068"></a><span class="lineno"> 4068</span>&#160; </div>
<div class="line"><a name="l04069"></a><span class="lineno"> 4069</span>&#160;    <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>();</div>
<div class="line"><a name="l04070"></a><span class="lineno"> 4070</span>&#160;    <a class="code" href="classitem.html">item</a> &amp;weap = <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> ? *<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> : <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>();</div>
<div class="line"><a name="l04071"></a><span class="lineno"> 4071</span>&#160; </div>
<div class="line"><a name="l04072"></a><span class="lineno"> 4072</span>&#160;    <span class="comment">// Check if there&#39;s something better to wield</span></div>
<div class="line"><a name="l04073"></a><span class="lineno"> 4073</span>&#160;    <a class="code" href="classitem.html">item</a> *best = &amp;weap;</div>
<div class="line"><a name="l04074"></a><span class="lineno"> 4074</span>&#160;    <span class="keywordtype">double</span> best_value = <a class="code" href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5">evaluate_weapon</a>( weap, can_use_gun, <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> );</div>
<div class="line"><a name="l04075"></a><span class="lineno"> 4075</span>&#160; </div>
<div class="line"><a name="l04076"></a><span class="lineno"> 4076</span>&#160;    <span class="comment">// To prevent changing to barely better stuff</span></div>
<div class="line"><a name="l04077"></a><span class="lineno"> 4077</span>&#160;    best_value *= std::max&lt;float&gt;( 1.0f, <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#af43fa626222f6d28f052da61973043b3">danger_assessment</a> / 10.0f );</div>
<div class="line"><a name="l04078"></a><span class="lineno"> 4078</span>&#160; </div>
<div class="line"><a name="l04079"></a><span class="lineno"> 4079</span>&#160;    <span class="comment">// Fists aren&#39;t checked below</span></div>
<div class="line"><a name="l04080"></a><span class="lineno"> 4080</span>&#160;    <span class="keywordtype">double</span> fist_value = <a class="code" href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5">evaluate_weapon</a>( <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>(), can_use_gun, <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> );</div>
<div class="line"><a name="l04081"></a><span class="lineno"> 4081</span>&#160; </div>
<div class="line"><a name="l04082"></a><span class="lineno"> 4082</span>&#160;    <span class="keywordflow">if</span>( fist_value &gt; best_value ) {</div>
<div class="line"><a name="l04083"></a><span class="lineno"> 4083</span>&#160;        best = &amp;<a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>();</div>
<div class="line"><a name="l04084"></a><span class="lineno"> 4084</span>&#160;        best_value = fist_value;</div>
<div class="line"><a name="l04085"></a><span class="lineno"> 4085</span>&#160;    }</div>
<div class="line"><a name="l04086"></a><span class="lineno"> 4086</span>&#160; </div>
<div class="line"><a name="l04087"></a><span class="lineno"> 4087</span>&#160;    <span class="comment">//Now check through the NPC&#39;s inventory for melee weapons, guns, or holstered items</span></div>
<div class="line"><a name="l04088"></a><span class="lineno"> 4088</span>&#160;    <a class="code" href="classCharacter.html#a64c7f6bc50109cd6e720c3c9bd4fc544">visit_items</a>( [<span class="keyword">this</span>, can_use_gun, <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a>, &amp;weap, &amp;best_value, &amp;best]( <a class="code" href="classitem.html">item</a> * node, <a class="code" href="classitem.html">item</a> * ) {</div>
<div class="line"><a name="l04089"></a><span class="lineno"> 4089</span>&#160;        <span class="keywordtype">double</span> <a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a> = 0.0;</div>
<div class="line"><a name="l04090"></a><span class="lineno"> 4090</span>&#160;        <span class="keywordtype">bool</span> using_same_type_bionic_weapon = <a class="code" href="classCharacter.html#a878f2d584f508107d1f0ba5599de7fa4">is_using_bionic_weapon</a>()</div>
<div class="line"><a name="l04091"></a><span class="lineno"> 4091</span>&#160;                                             &amp;&amp; node != &amp;weap</div>
<div class="line"><a name="l04092"></a><span class="lineno"> 4092</span>&#160;                                             &amp;&amp; node-&gt;<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a291870408701f0174d8c46b7f770fbaf">get_id</a>() == weap.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a291870408701f0174d8c46b7f770fbaf">get_id</a>();</div>
<div class="line"><a name="l04093"></a><span class="lineno"> 4093</span>&#160; </div>
<div class="line"><a name="l04094"></a><span class="lineno"> 4094</span>&#160;        <span class="keywordflow">if</span>( node-&gt;<a class="code" href="classitem.html#afdeb60e09043e124c9c6061f0bffe085">is_melee</a>() || node-&gt;<a class="code" href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">is_gun</a>() ) {</div>
<div class="line"><a name="l04095"></a><span class="lineno"> 4095</span>&#160;            <a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a> = <a class="code" href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5">evaluate_weapon</a>( *node, can_use_gun, <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> );</div>
<div class="line"><a name="l04096"></a><span class="lineno"> 4096</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a> &gt; best_value &amp;&amp; !using_same_type_bionic_weapon ) {</div>
<div class="line"><a name="l04097"></a><span class="lineno"> 4097</span>&#160;                best = <span class="keyword">const_cast&lt;</span><a class="code" href="classitem.html">item</a> *<span class="keyword">&gt;</span>( node );</div>
<div class="line"><a name="l04098"></a><span class="lineno"> 4098</span>&#160;                best_value = <a class="code" href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">weapon_value</a>;</div>
<div class="line"><a name="l04099"></a><span class="lineno"> 4099</span>&#160;            }</div>
<div class="line"><a name="l04100"></a><span class="lineno"> 4100</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabeab85df04e922fe1dd3c1f0692faeaacef">VisitResponse::SKIP</a>;</div>
<div class="line"><a name="l04101"></a><span class="lineno"> 4101</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( node-&gt;<a class="code" href="classitem.html#a71dac02bae8b97487391d5540a89bc1c">get_use</a>( <span class="stringliteral">&quot;holster&quot;</span> ) &amp;&amp; !node-&gt;<a class="code" href="classitem.html#ae05d298b2cf91e4c12d5beca5f38c67f">empty</a>() ) {</div>
<div class="line"><a name="l04102"></a><span class="lineno"> 4102</span>&#160;            <span class="comment">// we just recur to the next farther down</span></div>
<div class="line"><a name="l04103"></a><span class="lineno"> 4103</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea47559fb833ff58321570e5e877b467f6">VisitResponse::NEXT</a>;</div>
<div class="line"><a name="l04104"></a><span class="lineno"> 4104</span>&#160;        }</div>
<div class="line"><a name="l04105"></a><span class="lineno"> 4105</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea47559fb833ff58321570e5e877b467f6">VisitResponse::NEXT</a>;</div>
<div class="line"><a name="l04106"></a><span class="lineno"> 4106</span>&#160;    } );</div>
<div class="line"><a name="l04107"></a><span class="lineno"> 4107</span>&#160; </div>
<div class="line"><a name="l04108"></a><span class="lineno"> 4108</span>&#160;    <span class="keywordflow">return</span> best;</div>
<div class="line"><a name="l04109"></a><span class="lineno"> 4109</span>&#160;}</div>
<div class="line"><a name="l04110"></a><span class="lineno"> 4110</span>&#160; </div>
<div class="line"><a name="l04111"></a><span class="lineno"><a class="line" href="classnpc.html#a803f433a7a6b27fc761a5780db7d6b52"> 4111</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a803f433a7a6b27fc761a5780db7d6b52">npc::wield_better_weapon</a>()</div>
<div class="line"><a name="l04112"></a><span class="lineno"> 4112</span>&#160;{</div>
<div class="line"><a name="l04113"></a><span class="lineno"> 4113</span>&#160;    <span class="comment">// These are also assigned here so npc::evaluate_best_weapon() can be called by itself</span></div>
<div class="line"><a name="l04114"></a><span class="lineno"> 4114</span>&#160;    <span class="keywordtype">bool</span> can_use_gun = !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() || <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5be11a9176c3d5056b833343103f70f4">ally_rule::use_guns</a> );</div>
<div class="line"><a name="l04115"></a><span class="lineno"> 4115</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> = <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">ally_rule::use_silent</a> );</div>
<div class="line"><a name="l04116"></a><span class="lineno"> 4116</span>&#160; </div>
<div class="line"><a name="l04117"></a><span class="lineno"> 4117</span>&#160;    <a class="code" href="classitem__location.html">item_location</a> <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> = <a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>();</div>
<div class="line"><a name="l04118"></a><span class="lineno"> 4118</span>&#160;    <a class="code" href="classitem.html">item</a> &amp;weap = <a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> ? *<a class="code" href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">weapon</a> : <a class="code" href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a>();</div>
<div class="line"><a name="l04119"></a><span class="lineno"> 4119</span>&#160;    <a class="code" href="classitem.html">item</a> *best = &amp;weap;</div>
<div class="line"><a name="l04120"></a><span class="lineno"> 4120</span>&#160; </div>
<div class="line"><a name="l04121"></a><span class="lineno"> 4121</span>&#160;    <a class="code" href="classitem.html">item</a> *better_weapon = <a class="code" href="classnpc.html#a3f84d48b1596bc3da94a53804598e6e0">evaluate_best_weapon</a>();</div>
<div class="line"><a name="l04122"></a><span class="lineno"> 4122</span>&#160; </div>
<div class="line"><a name="l04123"></a><span class="lineno"> 4123</span>&#160;    <span class="keywordflow">if</span>( best == better_weapon ) {</div>
<div class="line"><a name="l04124"></a><span class="lineno"> 4124</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;Wielded %s is best at %.1f, not switching&quot;</span>,</div>
<div class="line"><a name="l04125"></a><span class="lineno"> 4125</span>&#160;                       best-&gt;<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a291870408701f0174d8c46b7f770fbaf">get_id</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>(),</div>
<div class="line"><a name="l04126"></a><span class="lineno"> 4126</span>&#160;                       <a class="code" href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5">evaluate_weapon</a>( *better_weapon, can_use_gun, <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> ) );</div>
<div class="line"><a name="l04127"></a><span class="lineno"> 4127</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04128"></a><span class="lineno"> 4128</span>&#160;    }</div>
<div class="line"><a name="l04129"></a><span class="lineno"> 4129</span>&#160; </div>
<div class="line"><a name="l04130"></a><span class="lineno"> 4130</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;Wielding %s at value %.1f&quot;</span>, better_weapon-&gt;<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a291870408701f0174d8c46b7f770fbaf">get_id</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>(),</div>
<div class="line"><a name="l04131"></a><span class="lineno"> 4131</span>&#160;                   <a class="code" href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5">evaluate_weapon</a>( *better_weapon, can_use_gun, <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">use_silent</a> ) );</div>
<div class="line"><a name="l04132"></a><span class="lineno"> 4132</span>&#160; </div>
<div class="line"><a name="l04133"></a><span class="lineno"> 4133</span>&#160;    <span class="comment">// Always returns true, but future proof</span></div>
<div class="line"><a name="l04134"></a><span class="lineno"> 4134</span>&#160;    <span class="keywordtype">bool</span> wield_success = <a class="code" href="classnpc.html#a251cafb769b1d8ec4585deb3b50aaafd">wield</a>( *better_weapon );</div>
<div class="line"><a name="l04135"></a><span class="lineno"> 4135</span>&#160;    <span class="keywordflow">if</span>( !wield_success ) {</div>
<div class="line"><a name="l04136"></a><span class="lineno"> 4136</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;NPC failed to wield better weapon %s&quot;</span>, better_weapon-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l04137"></a><span class="lineno"> 4137</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04138"></a><span class="lineno"> 4138</span>&#160;    }</div>
<div class="line"><a name="l04139"></a><span class="lineno"> 4139</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04140"></a><span class="lineno"> 4140</span>&#160;}</div>
<div class="line"><a name="l04141"></a><span class="lineno"> 4141</span>&#160; </div>
<div class="line"><a name="l04142"></a><span class="lineno"><a class="line" href="classnpc.html#aafe8341e41f59321adba206531c6b862"> 4142</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#aafe8341e41f59321adba206531c6b862">npc::scan_new_items</a>()</div>
<div class="line"><a name="l04143"></a><span class="lineno"> 4143</span>&#160;{</div>
<div class="line"><a name="l04144"></a><span class="lineno"> 4144</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;%s scanning new items&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l04145"></a><span class="lineno"> 4145</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a803f433a7a6b27fc761a5780db7d6b52">wield_better_weapon</a>() ) {</div>
<div class="line"><a name="l04146"></a><span class="lineno"> 4146</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04147"></a><span class="lineno"> 4147</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04148"></a><span class="lineno"> 4148</span>&#160;        <span class="comment">// Stop &quot;having new items&quot; when you no longer do anything with them</span></div>
<div class="line"><a name="l04149"></a><span class="lineno"> 4149</span>&#160;        <a class="code" href="classnpc.html#a9ca344b214e47beec525f78ebc83dc64">has_new_items</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04150"></a><span class="lineno"> 4150</span>&#160;    }</div>
<div class="line"><a name="l04151"></a><span class="lineno"> 4151</span>&#160; </div>
<div class="line"><a name="l04152"></a><span class="lineno"> 4152</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04153"></a><span class="lineno"> 4153</span>&#160;    <span class="comment">// TODO: Armor?</span></div>
<div class="line"><a name="l04154"></a><span class="lineno"> 4154</span>&#160;}</div>
<div class="line"><a name="l04155"></a><span class="lineno"> 4155</span>&#160; </div>
<div class="line"><a name="l04156"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a196db59a96c71a1c30a1abca71cf0431"> 4156</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="npcmove_8cpp.html#a196db59a96c71a1c30a1abca71cf0431">npc_throw</a>( <a class="code" href="classnpc.html">npc</a> &amp;np, <a class="code" href="classitem.html">item</a> &amp;it, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;<a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a> )</div>
<div class="line"><a name="l04157"></a><span class="lineno"> 4157</span>&#160;{</div>
<div class="line"><a name="l04158"></a><span class="lineno"> 4158</span>&#160;    <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( np, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s throws a %2$s.&quot;</span> ), np.<a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), it.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l04159"></a><span class="lineno"> 4159</span>&#160; </div>
<div class="line"><a name="l04160"></a><span class="lineno"> 4160</span>&#160;    <span class="keywordtype">int</span> stack_size = -1;</div>
<div class="line"><a name="l04161"></a><span class="lineno"> 4161</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a40963a016376016eb408bdb9dbb94388">count_by_charges</a>() ) {</div>
<div class="line"><a name="l04162"></a><span class="lineno"> 4162</span>&#160;        stack_size = it.<a class="code" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>;</div>
<div class="line"><a name="l04163"></a><span class="lineno"> 4163</span>&#160;        it.<a class="code" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> = 1;</div>
<div class="line"><a name="l04164"></a><span class="lineno"> 4164</span>&#160;    }</div>
<div class="line"><a name="l04165"></a><span class="lineno"> 4165</span>&#160;    <span class="keywordflow">if</span>( !np.<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) { <span class="comment">// hallucinations only pretend to throw</span></div>
<div class="line"><a name="l04166"></a><span class="lineno"> 4166</span>&#160;        np.<a class="code" href="classCharacter.html#acfb04a0e86c82c14248f911ebcb23f90">throw_item</a>( <a class="code" href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">pos</a>, it );</div>
<div class="line"><a name="l04167"></a><span class="lineno"> 4167</span>&#160;    }</div>
<div class="line"><a name="l04168"></a><span class="lineno"> 4168</span>&#160;    <span class="comment">// Throw a single charge of a stacking object.</span></div>
<div class="line"><a name="l04169"></a><span class="lineno"> 4169</span>&#160;    <span class="keywordflow">if</span>( stack_size == -1 || stack_size == 1 ) {</div>
<div class="line"><a name="l04170"></a><span class="lineno"> 4170</span>&#160;        np.<a class="code" href="classCharacter.html#a379081ad133b17e4ab3d230270b2414d">i_rem</a>( &amp;it );</div>
<div class="line"><a name="l04171"></a><span class="lineno"> 4171</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04172"></a><span class="lineno"> 4172</span>&#160;        it.<a class="code" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a> = stack_size - 1;</div>
<div class="line"><a name="l04173"></a><span class="lineno"> 4173</span>&#160;    }</div>
<div class="line"><a name="l04174"></a><span class="lineno"> 4174</span>&#160;}</div>
<div class="line"><a name="l04175"></a><span class="lineno"> 4175</span>&#160; </div>
<div class="line"><a name="l04176"></a><span class="lineno"><a class="line" href="classnpc.html#a6c36c6a68cd081709933c1d966feeac7"> 4176</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a6c36c6a68cd081709933c1d966feeac7">npc::alt_attack</a>()</div>
<div class="line"><a name="l04177"></a><span class="lineno"> 4177</span>&#160;{</div>
<div class="line"><a name="l04178"></a><span class="lineno"> 4178</span>&#160;    <span class="keywordflow">if</span>( ( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() &amp;&amp; !<a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a2b753549e5a11f2c1b492fb205bdc142">ally_rule::use_grenades</a> ) ) || <a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l04179"></a><span class="lineno"> 4179</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04180"></a><span class="lineno"> 4180</span>&#160;    }</div>
<div class="line"><a name="l04181"></a><span class="lineno"> 4181</span>&#160; </div>
<div class="line"><a name="l04182"></a><span class="lineno"> 4182</span>&#160;    <a class="code" href="classCreature.html">Creature</a> *critter = <a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">current_target</a>();</div>
<div class="line"><a name="l04183"></a><span class="lineno"> 4183</span>&#160;    <span class="keywordflow">if</span>( critter == <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l04184"></a><span class="lineno"> 4184</span>&#160;        <span class="comment">// This function shouldn&#39;t be called...</span></div>
<div class="line"><a name="l04185"></a><span class="lineno"> 4185</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;npc::alt_attack() called with no target&quot;</span> );</div>
<div class="line"><a name="l04186"></a><span class="lineno"> 4186</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l04187"></a><span class="lineno"> 4187</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04188"></a><span class="lineno"> 4188</span>&#160;    }</div>
<div class="line"><a name="l04189"></a><span class="lineno"> 4189</span>&#160; </div>
<div class="line"><a name="l04190"></a><span class="lineno"> 4190</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> tar = critter-&gt;<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>();</div>
<div class="line"><a name="l04191"></a><span class="lineno"> 4191</span>&#160; </div>
<div class="line"><a name="l04192"></a><span class="lineno"> 4192</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), tar );</div>
<div class="line"><a name="l04193"></a><span class="lineno"> 4193</span>&#160;    <a class="code" href="classitem.html">item</a> *used = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04194"></a><span class="lineno"> 4194</span>&#160;    <span class="comment">// Remember if we have an item that is dangerous to hold</span></div>
<div class="line"><a name="l04195"></a><span class="lineno"> 4195</span>&#160;    <span class="keywordtype">bool</span> used_dangerous = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04196"></a><span class="lineno"> 4196</span>&#160; </div>
<div class="line"><a name="l04197"></a><span class="lineno"> 4197</span>&#160;    <span class="comment">// TODO: The active bomb with shortest fuse should be thrown first</span></div>
<div class="line"><a name="l04198"></a><span class="lineno"> 4198</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> check_alt_item = [&amp;used, &amp;used_dangerous, dist, <span class="keyword">this</span>]( <a class="code" href="classitem.html">item</a> * it ) {</div>
<div class="line"><a name="l04199"></a><span class="lineno"> 4199</span>&#160;        <span class="keywordflow">if</span>( !it ) {</div>
<div class="line"><a name="l04200"></a><span class="lineno"> 4200</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04201"></a><span class="lineno"> 4201</span>&#160;        }</div>
<div class="line"><a name="l04202"></a><span class="lineno"> 4202</span>&#160; </div>
<div class="line"><a name="l04203"></a><span class="lineno"> 4203</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">bool</span> dangerous = it-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a4c5b923aa3a82dbac24b314b75536490">flag_NPC_THROW_NOW</a> );</div>
<div class="line"><a name="l04204"></a><span class="lineno"> 4204</span>&#160;        <span class="keywordflow">if</span>( !dangerous &amp;&amp; used_dangerous ) {</div>
<div class="line"><a name="l04205"></a><span class="lineno"> 4205</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04206"></a><span class="lineno"> 4206</span>&#160;        }</div>
<div class="line"><a name="l04207"></a><span class="lineno"> 4207</span>&#160; </div>
<div class="line"><a name="l04208"></a><span class="lineno"> 4208</span>&#160;        <span class="comment">// Not alt attack</span></div>
<div class="line"><a name="l04209"></a><span class="lineno"> 4209</span>&#160;        <span class="keywordflow">if</span>( !dangerous &amp;&amp; !it-&gt;has_flag( <a class="code" href="flag_8cpp.html#a1089f9000b1350feb5b65a77b706dd7b">flag_NPC_ALT_ATTACK</a> ) ) {</div>
<div class="line"><a name="l04210"></a><span class="lineno"> 4210</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04211"></a><span class="lineno"> 4211</span>&#160;        }</div>
<div class="line"><a name="l04212"></a><span class="lineno"> 4212</span>&#160; </div>
<div class="line"><a name="l04213"></a><span class="lineno"> 4213</span>&#160;        <span class="comment">// TODO: Non-thrown alt items</span></div>
<div class="line"><a name="l04214"></a><span class="lineno"> 4214</span>&#160;        <span class="keywordflow">if</span>( !dangerous &amp;&amp; <a class="code" href="classCharacter.html#a455c06bf0dab6e3558f759fe43e27e98">throw_range</a>( *it ) &lt; dist ) {</div>
<div class="line"><a name="l04215"></a><span class="lineno"> 4215</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04216"></a><span class="lineno"> 4216</span>&#160;        }</div>
<div class="line"><a name="l04217"></a><span class="lineno"> 4217</span>&#160; </div>
<div class="line"><a name="l04218"></a><span class="lineno"> 4218</span>&#160;        <span class="comment">// Low priority items</span></div>
<div class="line"><a name="l04219"></a><span class="lineno"> 4219</span>&#160;        <span class="keywordflow">if</span>( !dangerous &amp;&amp; used != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l04220"></a><span class="lineno"> 4220</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04221"></a><span class="lineno"> 4221</span>&#160;        }</div>
<div class="line"><a name="l04222"></a><span class="lineno"> 4222</span>&#160; </div>
<div class="line"><a name="l04223"></a><span class="lineno"> 4223</span>&#160;        used = it;</div>
<div class="line"><a name="l04224"></a><span class="lineno"> 4224</span>&#160;        used_dangerous = used_dangerous || dangerous;</div>
<div class="line"><a name="l04225"></a><span class="lineno"> 4225</span>&#160;    };</div>
<div class="line"><a name="l04226"></a><span class="lineno"> 4226</span>&#160; </div>
<div class="line"><a name="l04227"></a><span class="lineno"> 4227</span>&#160;    check_alt_item( &amp;*<a class="code" href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">get_wielded_item</a>() );</div>
<div class="line"><a name="l04228"></a><span class="lineno"> 4228</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> inv_all = <a class="code" href="classvisitable.html#a3e80572268abd951cf016d275febe4e6">items_with</a>( []( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp; ) {</div>
<div class="line"><a name="l04229"></a><span class="lineno"> 4229</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04230"></a><span class="lineno"> 4230</span>&#160;    } );</div>
<div class="line"><a name="l04231"></a><span class="lineno"> 4231</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> *it : inv_all ) {</div>
<div class="line"><a name="l04232"></a><span class="lineno"> 4232</span>&#160;        <span class="comment">// TODO: Cached values - an itype slot maybe?</span></div>
<div class="line"><a name="l04233"></a><span class="lineno"> 4233</span>&#160;        check_alt_item( it );</div>
<div class="line"><a name="l04234"></a><span class="lineno"> 4234</span>&#160;    }</div>
<div class="line"><a name="l04235"></a><span class="lineno"> 4235</span>&#160; </div>
<div class="line"><a name="l04236"></a><span class="lineno"> 4236</span>&#160;    <span class="keywordflow">if</span>( used == <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l04237"></a><span class="lineno"> 4237</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04238"></a><span class="lineno"> 4238</span>&#160;    }</div>
<div class="line"><a name="l04239"></a><span class="lineno"> 4239</span>&#160; </div>
<div class="line"><a name="l04240"></a><span class="lineno"> 4240</span>&#160;    <span class="comment">// Are we going to throw this item?</span></div>
<div class="line"><a name="l04241"></a><span class="lineno"> 4241</span>&#160;    <span class="keywordflow">if</span>( !used-&gt;<a class="code" href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">active</a> &amp;&amp; used-&gt;<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#a992a6a80e8fc7944c1eda2676af9bb33">flag_NPC_ACTIVATE</a> ) ) {</div>
<div class="line"><a name="l04242"></a><span class="lineno"> 4242</span>&#160;        <a class="code" href="classnpc.html#a12374102a0fa38c39765bdef9ee12d90">activate_item</a>( *used );</div>
<div class="line"><a name="l04243"></a><span class="lineno"> 4243</span>&#160;        <span class="comment">// Note: intentional lack of return here</span></div>
<div class="line"><a name="l04244"></a><span class="lineno"> 4244</span>&#160;        <span class="comment">// We want to ignore player-centric rules to avoid carrying live explosives</span></div>
<div class="line"><a name="l04245"></a><span class="lineno"> 4245</span>&#160;        <span class="comment">// TODO: Non-grenades</span></div>
<div class="line"><a name="l04246"></a><span class="lineno"> 4246</span>&#160;    }</div>
<div class="line"><a name="l04247"></a><span class="lineno"> 4247</span>&#160; </div>
<div class="line"><a name="l04248"></a><span class="lineno"> 4248</span>&#160;    <span class="comment">// We are throwing it!</span></div>
<div class="line"><a name="l04249"></a><span class="lineno"> 4249</span>&#160;    <span class="keywordtype">int</span> conf = <a class="code" href="classnpc.html#a7126a9df203ace036c3fa22b1c775d7e">confident_throw_range</a>( *used, critter );</div>
<div class="line"><a name="l04250"></a><span class="lineno"> 4250</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> wont_hit = <a class="code" href="classnpc.html#a3899b6eecb74b6b011eba7082685e968">wont_hit_friend</a>( tar, *used, <span class="keyword">true</span> );</div>
<div class="line"><a name="l04251"></a><span class="lineno"> 4251</span>&#160;    <span class="keywordflow">if</span>( dist &lt;= conf &amp;&amp; wont_hit ) {</div>
<div class="line"><a name="l04252"></a><span class="lineno"> 4252</span>&#160;        <a class="code" href="npcmove_8cpp.html#a196db59a96c71a1c30a1abca71cf0431">npc_throw</a>( *<span class="keyword">this</span>, *used, tar );</div>
<div class="line"><a name="l04253"></a><span class="lineno"> 4253</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04254"></a><span class="lineno"> 4254</span>&#160;    }</div>
<div class="line"><a name="l04255"></a><span class="lineno"> 4255</span>&#160; </div>
<div class="line"><a name="l04256"></a><span class="lineno"> 4256</span>&#160;    <span class="keywordflow">if</span>( wont_hit ) {</div>
<div class="line"><a name="l04257"></a><span class="lineno"> 4257</span>&#160;        <span class="comment">// Within this block, our chosen target is outside of our range</span></div>
<div class="line"><a name="l04258"></a><span class="lineno"> 4258</span>&#160;        <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( tar );</div>
<div class="line"><a name="l04259"></a><span class="lineno"> 4259</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>(); <span class="comment">// Move towards the target</span></div>
<div class="line"><a name="l04260"></a><span class="lineno"> 4260</span>&#160;    }</div>
<div class="line"><a name="l04261"></a><span class="lineno"> 4261</span>&#160; </div>
<div class="line"><a name="l04262"></a><span class="lineno"> 4262</span>&#160;    <span class="comment">// Danger of friendly fire</span></div>
<div class="line"><a name="l04263"></a><span class="lineno"> 4263</span>&#160;    <span class="keywordflow">if</span>( !wont_hit &amp;&amp; !used_dangerous ) {</div>
<div class="line"><a name="l04264"></a><span class="lineno"> 4264</span>&#160;        <span class="comment">// Safe to hold on to, for now</span></div>
<div class="line"><a name="l04265"></a><span class="lineno"> 4265</span>&#160;        <span class="comment">// Maneuver around player</span></div>
<div class="line"><a name="l04266"></a><span class="lineno"> 4266</span>&#160;        <a class="code" href="classnpc.html#a4fea1fd042a9225b685b012eec8697ba">avoid_friendly_fire</a>();</div>
<div class="line"><a name="l04267"></a><span class="lineno"> 4267</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04268"></a><span class="lineno"> 4268</span>&#160;    }</div>
<div class="line"><a name="l04269"></a><span class="lineno"> 4269</span>&#160; </div>
<div class="line"><a name="l04270"></a><span class="lineno"> 4270</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l04271"></a><span class="lineno"> 4271</span>&#160;    <a class="code" href="classcreature__tracker.html">creature_tracker</a> &amp;creatures = <a class="code" href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a>();</div>
<div class="line"><a name="l04272"></a><span class="lineno"> 4272</span>&#160;    <span class="comment">// We need to throw this live (grenade, etc) NOW! Pick another target?</span></div>
<div class="line"><a name="l04273"></a><span class="lineno"> 4273</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> dist = 2; dist &lt;= conf; dist++ ) {</div>
<div class="line"><a name="l04274"></a><span class="lineno"> 4274</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;pt : here.<a class="code" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), dist ) ) {</div>
<div class="line"><a name="l04275"></a><span class="lineno"> 4275</span>&#160;            <span class="keyword">const</span> <a class="code" href="classmonster.html">monster</a> *<span class="keyword">const</span> target_ptr = creatures.<a class="code" href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_at</a>&lt;<a class="code" href="classmonster.html">monster</a>&gt;( pt );</div>
<div class="line"><a name="l04276"></a><span class="lineno"> 4276</span>&#160;            <span class="keywordtype">int</span> newdist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), pt );</div>
<div class="line"><a name="l04277"></a><span class="lineno"> 4277</span>&#160;            <span class="comment">// TODO: Change &quot;newdist &gt;= 2&quot; to &quot;newdist &gt;= safe_distance(used)&quot;</span></div>
<div class="line"><a name="l04278"></a><span class="lineno"> 4278</span>&#160;            <span class="keywordflow">if</span>( newdist &lt;= conf &amp;&amp; newdist &gt;= 2 &amp;&amp; target_ptr &amp;&amp;</div>
<div class="line"><a name="l04279"></a><span class="lineno"> 4279</span>&#160;                <a class="code" href="classnpc.html#a3899b6eecb74b6b011eba7082685e968">wont_hit_friend</a>( pt, *used, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l04280"></a><span class="lineno"> 4280</span>&#160;                <span class="comment">// Friendlyfire-safe!</span></div>
<div class="line"><a name="l04281"></a><span class="lineno"> 4281</span>&#160;                <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">target</a> = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;shared_from( *target_ptr );</div>
<div class="line"><a name="l04282"></a><span class="lineno"> 4282</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 100 ) ) {</div>
<div class="line"><a name="l04283"></a><span class="lineno"> 4283</span>&#160;                    <span class="comment">// Just to prevent infinite loops...</span></div>
<div class="line"><a name="l04284"></a><span class="lineno"> 4284</span>&#160;                    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a6c36c6a68cd081709933c1d966feeac7">alt_attack</a>() ) {</div>
<div class="line"><a name="l04285"></a><span class="lineno"> 4285</span>&#160;                        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04286"></a><span class="lineno"> 4286</span>&#160;                    }</div>
<div class="line"><a name="l04287"></a><span class="lineno"> 4287</span>&#160;                }</div>
<div class="line"><a name="l04288"></a><span class="lineno"> 4288</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04289"></a><span class="lineno"> 4289</span>&#160;            }</div>
<div class="line"><a name="l04290"></a><span class="lineno"> 4290</span>&#160;        }</div>
<div class="line"><a name="l04291"></a><span class="lineno"> 4291</span>&#160;    }</div>
<div class="line"><a name="l04292"></a><span class="lineno"> 4292</span>&#160;    <span class="comment">/* If we have reached THIS point, there&#39;s no acceptable monster to throw our</span></div>
<div class="line"><a name="l04293"></a><span class="lineno"> 4293</span>&#160;<span class="comment">     * grenade or whatever at.  Since it&#39;s about to go off in our hands, better to</span></div>
<div class="line"><a name="l04294"></a><span class="lineno"> 4294</span>&#160;<span class="comment">     * just chuck it as far away as possible--while being friendly-safe.</span></div>
<div class="line"><a name="l04295"></a><span class="lineno"> 4295</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l04296"></a><span class="lineno"> 4296</span>&#160;    <span class="keywordtype">int</span> best_dist = 0;</div>
<div class="line"><a name="l04297"></a><span class="lineno"> 4297</span>&#160;    <span class="keywordflow">for</span>( <span class="keywordtype">int</span> dist = 2; dist &lt;= conf; dist++ ) {</div>
<div class="line"><a name="l04298"></a><span class="lineno"> 4298</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;pt : here.<a class="code" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), dist ) ) {</div>
<div class="line"><a name="l04299"></a><span class="lineno"> 4299</span>&#160;            <span class="keywordtype">int</span> new_dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), pt );</div>
<div class="line"><a name="l04300"></a><span class="lineno"> 4300</span>&#160;            <span class="keywordflow">if</span>( new_dist &gt; best_dist &amp;&amp; <a class="code" href="classnpc.html#a3899b6eecb74b6b011eba7082685e968">wont_hit_friend</a>( pt, *used, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l04301"></a><span class="lineno"> 4301</span>&#160;                best_dist = new_dist;</div>
<div class="line"><a name="l04302"></a><span class="lineno"> 4302</span>&#160;                tar = pt;</div>
<div class="line"><a name="l04303"></a><span class="lineno"> 4303</span>&#160;            }</div>
<div class="line"><a name="l04304"></a><span class="lineno"> 4304</span>&#160;        }</div>
<div class="line"><a name="l04305"></a><span class="lineno"> 4305</span>&#160;    }</div>
<div class="line"><a name="l04306"></a><span class="lineno"> 4306</span>&#160;    <span class="comment">/* Even if tar.x/tar.y didn&#39;t get set by the above loop, throw it anyway.  They</span></div>
<div class="line"><a name="l04307"></a><span class="lineno"> 4307</span>&#160;<span class="comment">     * should be equal to the original location of our target, and risking friendly</span></div>
<div class="line"><a name="l04308"></a><span class="lineno"> 4308</span>&#160;<span class="comment">     * fire is better than holding on to a live grenade / whatever.</span></div>
<div class="line"><a name="l04309"></a><span class="lineno"> 4309</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l04310"></a><span class="lineno"> 4310</span>&#160;    <a class="code" href="npcmove_8cpp.html#a196db59a96c71a1c30a1abca71cf0431">npc_throw</a>( *<span class="keyword">this</span>, *used, tar );</div>
<div class="line"><a name="l04311"></a><span class="lineno"> 4311</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04312"></a><span class="lineno"> 4312</span>&#160;}</div>
<div class="line"><a name="l04313"></a><span class="lineno"> 4313</span>&#160; </div>
<div class="line"><a name="l04314"></a><span class="lineno"><a class="line" href="classnpc.html#a12374102a0fa38c39765bdef9ee12d90"> 4314</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a12374102a0fa38c39765bdef9ee12d90">npc::activate_item</a>( <a class="code" href="classitem.html">item</a> &amp;it )</div>
<div class="line"><a name="l04315"></a><span class="lineno"> 4315</span>&#160;{</div>
<div class="line"><a name="l04316"></a><span class="lineno"> 4316</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> oldmoves = <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>;</div>
<div class="line"><a name="l04317"></a><span class="lineno"> 4317</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a59a03649a0636c70e776054db688564a">is_tool</a>() || it.<a class="code" href="classitem.html#aad45569fa1fdd99d602eabbbbca04f75">is_food</a>() ) {</div>
<div class="line"><a name="l04318"></a><span class="lineno"> 4318</span>&#160;        it.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a76600c0d6a88c8d983838f0df2276212">invoke</a>( <span class="keyword">this</span>, it, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l04319"></a><span class="lineno"> 4319</span>&#160;    }</div>
<div class="line"><a name="l04320"></a><span class="lineno"> 4320</span>&#160; </div>
<div class="line"><a name="l04321"></a><span class="lineno"> 4321</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a> == oldmoves ) {</div>
<div class="line"><a name="l04322"></a><span class="lineno"> 4322</span>&#160;        <span class="comment">// HACK: A hack to prevent debugmsgs when NPCs activate 0 move items</span></div>
<div class="line"><a name="l04323"></a><span class="lineno"> 4323</span>&#160;        <span class="comment">// while not removing the debugmsgs for other 0 move actions</span></div>
<div class="line"><a name="l04324"></a><span class="lineno"> 4324</span>&#160;        <a class="code" href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">moves</a>--;</div>
<div class="line"><a name="l04325"></a><span class="lineno"> 4325</span>&#160;    }</div>
<div class="line"><a name="l04326"></a><span class="lineno"> 4326</span>&#160;}</div>
<div class="line"><a name="l04327"></a><span class="lineno"> 4327</span>&#160; </div>
<div class="line"><a name="l04328"></a><span class="lineno"><a class="line" href="classnpc.html#a6616407de598de3d0afaa5230c8448d8"> 4328</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a6616407de598de3d0afaa5230c8448d8">npc::heal_player</a>( <a class="code" href="classCharacter.html">Character</a> &amp;patient )</div>
<div class="line"><a name="l04329"></a><span class="lineno"> 4329</span>&#160;{</div>
<div class="line"><a name="l04330"></a><span class="lineno"> 4330</span>&#160;    <span class="comment">// Avoid more than one first aid activity at a time.</span></div>
<div class="line"><a name="l04331"></a><span class="lineno"> 4331</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a6186c819cc348b5a060e140b5bab8226">Character::has_activity</a>( <a class="code" href="npcmove_8cpp.html#acdc2d231ebdbf7d9571d84ebe9993c5f">ACT_FIRSTAID</a> ) ) {</div>
<div class="line"><a name="l04332"></a><span class="lineno"> 4332</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04333"></a><span class="lineno"> 4333</span>&#160;    }</div>
<div class="line"><a name="l04334"></a><span class="lineno"> 4334</span>&#160; </div>
<div class="line"><a name="l04335"></a><span class="lineno"> 4335</span>&#160;    <span class="keywordtype">int</span> dist = <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), patient.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l04336"></a><span class="lineno"> 4336</span>&#160; </div>
<div class="line"><a name="l04337"></a><span class="lineno"> 4337</span>&#160;    <span class="keywordflow">if</span>( dist &gt; 1 ) {</div>
<div class="line"><a name="l04338"></a><span class="lineno"> 4338</span>&#160;        <span class="comment">// We need to move to the player</span></div>
<div class="line"><a name="l04339"></a><span class="lineno"> 4339</span>&#160;        <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( patient.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l04340"></a><span class="lineno"> 4340</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l04341"></a><span class="lineno"> 4341</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04342"></a><span class="lineno"> 4342</span>&#160;    }</div>
<div class="line"><a name="l04343"></a><span class="lineno"> 4343</span>&#160; </div>
<div class="line"><a name="l04344"></a><span class="lineno"> 4344</span>&#160;    <a class="code" href="classviewer.html">viewer</a> &amp;player_view = <a class="code" href="game_8cpp.html#ab5c977b7e81348725fb7bf09fc64ed95">get_player_view</a>();</div>
<div class="line"><a name="l04345"></a><span class="lineno"> 4345</span>&#160;    <span class="comment">// Close enough to heal!</span></div>
<div class="line"><a name="l04346"></a><span class="lineno"> 4346</span>&#160;    <span class="keywordtype">bool</span> u_see = player_view.<a class="code" href="classviewer.html#a204fe140cdc73d2452fa9a390a32ba29">sees</a>( *<span class="keyword">this</span> ) || player_view.<a class="code" href="classviewer.html#a204fe140cdc73d2452fa9a390a32ba29">sees</a>( patient );</div>
<div class="line"><a name="l04347"></a><span class="lineno"> 4347</span>&#160;    <span class="keywordflow">if</span>( u_see ) {</div>
<div class="line"><a name="l04348"></a><span class="lineno"> 4348</span>&#160;        <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s starts healing %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>(), patient.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l04349"></a><span class="lineno"> 4349</span>&#160;    }</div>
<div class="line"><a name="l04350"></a><span class="lineno"> 4350</span>&#160; </div>
<div class="line"><a name="l04351"></a><span class="lineno"> 4351</span>&#160;    <a class="code" href="classitem.html">item</a> &amp;used = <a class="code" href="classnpc.html#ad9d2ba89ae629f2d915436a06f377c24">get_healing_item</a>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a> );</div>
<div class="line"><a name="l04352"></a><span class="lineno"> 4352</span>&#160;    <span class="keywordflow">if</span>( used.<a class="code" href="classitem.html#a4d5555082454b3cb192f59a70838c891">is_null</a>() ) {</div>
<div class="line"><a name="l04353"></a><span class="lineno"> 4353</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s tried to heal you but has no healing item&quot;</span>, <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l04354"></a><span class="lineno"> 4354</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04355"></a><span class="lineno"> 4355</span>&#160;    }</div>
<div class="line"><a name="l04356"></a><span class="lineno"> 4356</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l04357"></a><span class="lineno"> 4357</span>&#160;        <span class="keywordtype">int</span> charges_used = used.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a76600c0d6a88c8d983838f0df2276212">invoke</a>( <span class="keyword">this</span>, used, patient.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="stringliteral">&quot;heal&quot;</span> ).value_or( 0 );</div>
<div class="line"><a name="l04358"></a><span class="lineno"> 4358</span>&#160;        <a class="code" href="classCharacter.html#a440c45f92704e6fe31024a90f10ac9c1">consume_charges</a>( used, charges_used );</div>
<div class="line"><a name="l04359"></a><span class="lineno"> 4359</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04360"></a><span class="lineno"> 4360</span>&#160;        <a class="code" href="classnpc.html#a535d561f8b634e2bf4867f273098e4c8">pretend_heal</a>( patient, used );</div>
<div class="line"><a name="l04361"></a><span class="lineno"> 4361</span>&#160;    }</div>
<div class="line"><a name="l04362"></a><span class="lineno"> 4362</span>&#160; </div>
<div class="line"><a name="l04363"></a><span class="lineno"> 4363</span>&#160;}</div>
<div class="line"><a name="l04364"></a><span class="lineno"> 4364</span>&#160; </div>
<div class="line"><a name="l04365"></a><span class="lineno"><a class="line" href="classnpc.html#a535d561f8b634e2bf4867f273098e4c8"> 4365</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a535d561f8b634e2bf4867f273098e4c8">npc::pretend_heal</a>( <a class="code" href="classCharacter.html">Character</a> &amp;patient, <a class="code" href="classitem.html">item</a> used )</div>
<div class="line"><a name="l04366"></a><span class="lineno"> 4366</span>&#160;{</div>
<div class="line"><a name="l04367"></a><span class="lineno"> 4367</span>&#160;    <span class="comment">// you can tell that it&#39;s not real by looking at your HP though</span></div>
<div class="line"><a name="l04368"></a><span class="lineno"> 4368</span>&#160;    <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( *<span class="keyword">this</span>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s heals %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>(),</div>
<div class="line"><a name="l04369"></a><span class="lineno"> 4369</span>&#160;                            patient.<a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l04370"></a><span class="lineno"> 4370</span>&#160;    <a class="code" href="classCharacter.html#a440c45f92704e6fe31024a90f10ac9c1">consume_charges</a>( used, 1 ); <span class="comment">// empty hallucination&#39;s inventory to avoid spammming</span></div>
<div class="line"><a name="l04371"></a><span class="lineno"> 4371</span>&#160;    <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() ); <span class="comment">// consumes moves to avoid infinite loop</span></div>
<div class="line"><a name="l04372"></a><span class="lineno"> 4372</span>&#160;}</div>
<div class="line"><a name="l04373"></a><span class="lineno"> 4373</span>&#160; </div>
<div class="line"><a name="l04374"></a><span class="lineno"><a class="line" href="classnpc.html#acf0a5cd5f49a663e11d1631812ff1496"> 4374</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#acf0a5cd5f49a663e11d1631812ff1496">npc::heal_self</a>()</div>
<div class="line"><a name="l04375"></a><span class="lineno"> 4375</span>&#160;{</div>
<div class="line"><a name="l04376"></a><span class="lineno"> 4376</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a2dde49329eef942ec57d25db274942c0">effect_asthma</a> ) ) {</div>
<div class="line"><a name="l04377"></a><span class="lineno"> 4377</span>&#160;        <a class="code" href="classitem.html">item</a> *treatment = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04378"></a><span class="lineno"> 4378</span>&#160;        std::string iusage = <span class="stringliteral">&quot;INHALER&quot;</span>;</div>
<div class="line"><a name="l04379"></a><span class="lineno"> 4379</span>&#160; </div>
<div class="line"><a name="l04380"></a><span class="lineno"> 4380</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> filter_use = [<span class="keyword">this</span>]( <span class="keyword">const</span> std::string &amp; <a class="code" href="input__context_8cpp.html#a077f0863a15ffb1731f2cb207abcb958ab2c97ae425dd751b0e48a3acae79cf4a">filter</a> ) -&gt; std::vector&lt;item *&gt; {</div>
<div class="line"><a name="l04381"></a><span class="lineno"> 4381</span>&#160;            <span class="keyword">auto</span> inv_filtered = <a class="code" href="classvisitable.html#a3e80572268abd951cf016d275febe4e6">items_with</a>( [&amp;<a class="code" href="input__context_8cpp.html#a077f0863a15ffb1731f2cb207abcb958ab2c97ae425dd751b0e48a3acae79cf4a">filter</a>]( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp; itm )</div>
<div class="line"><a name="l04382"></a><span class="lineno"> 4382</span>&#160;            {</div>
<div class="line"><a name="l04383"></a><span class="lineno"> 4383</span>&#160;                <span class="keywordflow">return</span> ( itm.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a304367633fdfe6c63a53bdce0caced92">get_use</a>( <a class="code" href="input__context_8cpp.html#a077f0863a15ffb1731f2cb207abcb958ab2c97ae425dd751b0e48a3acae79cf4a">filter</a> ) != <span class="keyword">nullptr</span> ) &amp;&amp; itm.<a class="code" href="classitem.html#aafdd6e14936eb02b0d71a96e7e325746">ammo_sufficient</a>( <span class="keyword">nullptr</span> );</div>
<div class="line"><a name="l04384"></a><span class="lineno"> 4384</span>&#160;            } );</div>
<div class="line"><a name="l04385"></a><span class="lineno"> 4385</span>&#160;            <span class="keywordflow">return</span> inv_filtered;</div>
<div class="line"><a name="l04386"></a><span class="lineno"> 4386</span>&#160;        };</div>
<div class="line"><a name="l04387"></a><span class="lineno"> 4387</span>&#160; </div>
<div class="line"><a name="l04388"></a><span class="lineno"> 4388</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> inv_inhalers = filter_use( iusage );</div>
<div class="line"><a name="l04389"></a><span class="lineno"> 4389</span>&#160;        <span class="keywordflow">if</span>( !inv_inhalers.empty() ) {</div>
<div class="line"><a name="l04390"></a><span class="lineno"> 4390</span>&#160;            treatment = inv_inhalers.front();</div>
<div class="line"><a name="l04391"></a><span class="lineno"> 4391</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04392"></a><span class="lineno"> 4392</span>&#160;            iusage = <span class="stringliteral">&quot;OXYGEN_BOTTLE&quot;</span>;</div>
<div class="line"><a name="l04393"></a><span class="lineno"> 4393</span>&#160;            <span class="keyword">const</span> <span class="keyword">auto</span> inv_oxybottles = filter_use( iusage );</div>
<div class="line"><a name="l04394"></a><span class="lineno"> 4394</span>&#160;            <span class="keywordflow">if</span>( !inv_oxybottles.empty() ) {</div>
<div class="line"><a name="l04395"></a><span class="lineno"> 4395</span>&#160;                treatment = inv_oxybottles.front();</div>
<div class="line"><a name="l04396"></a><span class="lineno"> 4396</span>&#160;            }</div>
<div class="line"><a name="l04397"></a><span class="lineno"> 4397</span>&#160;        }</div>
<div class="line"><a name="l04398"></a><span class="lineno"> 4398</span>&#160;        <span class="keywordflow">if</span>( treatment != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l04399"></a><span class="lineno"> 4399</span>&#160;            treatment-&gt;<a class="code" href="classitem.html#a71dac02bae8b97487391d5540a89bc1c">get_use</a>( iusage )-&gt;<a class="code" href="structuse__function.html#a308134b3f05ca40164e867ac8d922da8">call</a>( <span class="keyword">this</span>, *treatment, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l04400"></a><span class="lineno"> 4400</span>&#160;            treatment-&gt;<a class="code" href="classitem.html#a57b10fc9db286a3449ddc92ab3d896f5">ammo_consume</a>( treatment-&gt;<a class="code" href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">ammo_required</a>(), <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="keyword">this</span> );</div>
<div class="line"><a name="l04401"></a><span class="lineno"> 4401</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04402"></a><span class="lineno"> 4402</span>&#160;        }</div>
<div class="line"><a name="l04403"></a><span class="lineno"> 4403</span>&#160;    }</div>
<div class="line"><a name="l04404"></a><span class="lineno"> 4404</span>&#160; </div>
<div class="line"><a name="l04405"></a><span class="lineno"> 4405</span>&#160;    <span class="comment">// Avoid more than one first aid activity at a time.</span></div>
<div class="line"><a name="l04406"></a><span class="lineno"> 4406</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a6186c819cc348b5a060e140b5bab8226">Character::has_activity</a>( <a class="code" href="npcmove_8cpp.html#acdc2d231ebdbf7d9571d84ebe9993c5f">ACT_FIRSTAID</a> ) ) {</div>
<div class="line"><a name="l04407"></a><span class="lineno"> 4407</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04408"></a><span class="lineno"> 4408</span>&#160;    }</div>
<div class="line"><a name="l04409"></a><span class="lineno"> 4409</span>&#160; </div>
<div class="line"><a name="l04410"></a><span class="lineno"> 4410</span>&#160;    <a class="code" href="classitem.html">item</a> &amp;used = <a class="code" href="classnpc.html#ad9d2ba89ae629f2d915436a06f377c24">get_healing_item</a>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">can_heal</a> );</div>
<div class="line"><a name="l04411"></a><span class="lineno"> 4411</span>&#160;    <span class="keywordflow">if</span>( used.<a class="code" href="classitem.html#a4d5555082454b3cb192f59a70838c891">is_null</a>() ) {</div>
<div class="line"><a name="l04412"></a><span class="lineno"> 4412</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s tried to heal self but has no healing item&quot;</span>, <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l04413"></a><span class="lineno"> 4413</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04414"></a><span class="lineno"> 4414</span>&#160;    }</div>
<div class="line"><a name="l04415"></a><span class="lineno"> 4415</span>&#160; </div>
<div class="line"><a name="l04416"></a><span class="lineno"> 4416</span>&#160;    <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( *<span class="keyword">this</span>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s starts applying a %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>(), used.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l04417"></a><span class="lineno"> 4417</span>&#160;    <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">warn_about</a>( <span class="stringliteral">&quot;heal_self&quot;</span>, 1_turns );</div>
<div class="line"><a name="l04418"></a><span class="lineno"> 4418</span>&#160; </div>
<div class="line"><a name="l04419"></a><span class="lineno"> 4419</span>&#160;    <span class="keywordtype">int</span> charges_used = used.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#a76600c0d6a88c8d983838f0df2276212">invoke</a>( <span class="keyword">this</span>, used, <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <span class="stringliteral">&quot;heal&quot;</span> ).value_or( 0 );</div>
<div class="line"><a name="l04420"></a><span class="lineno"> 4420</span>&#160;    <span class="keywordflow">if</span>( used.<a class="code" href="classitem.html#aa344ad5d3082d7a56b1c902fbafb6347">is_medication</a>() &amp;&amp; charges_used &gt; 0 ) {</div>
<div class="line"><a name="l04421"></a><span class="lineno"> 4421</span>&#160;        <a class="code" href="classCharacter.html#a440c45f92704e6fe31024a90f10ac9c1">consume_charges</a>( used, charges_used );</div>
<div class="line"><a name="l04422"></a><span class="lineno"> 4422</span>&#160;    }</div>
<div class="line"><a name="l04423"></a><span class="lineno"> 4423</span>&#160;}</div>
<div class="line"><a name="l04424"></a><span class="lineno"> 4424</span>&#160; </div>
<div class="line"><a name="l04425"></a><span class="lineno"><a class="line" href="classnpc.html#ab207c63e57697f76b910b49d38034294"> 4425</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#ab207c63e57697f76b910b49d38034294">npc::use_painkiller</a>()</div>
<div class="line"><a name="l04426"></a><span class="lineno"> 4426</span>&#160;{</div>
<div class="line"><a name="l04427"></a><span class="lineno"> 4427</span>&#160;    <span class="comment">// First, find the best painkiller for our pain level</span></div>
<div class="line"><a name="l04428"></a><span class="lineno"> 4428</span>&#160;    <a class="code" href="classitem.html">item</a> *it = <a class="code" href="classCharacter.html#a96ec9152d401f128cf31a7cc35c97f65">inv</a>-&gt;most_appropriate_painkiller( <a class="code" href="classCreature.html#a71e8440dfb96a7a870c29e0472b7b85d">get_pain</a>() );</div>
<div class="line"><a name="l04429"></a><span class="lineno"> 4429</span>&#160; </div>
<div class="line"><a name="l04430"></a><span class="lineno"> 4430</span>&#160;    <span class="keywordflow">if</span>( it-&gt;<a class="code" href="classitem.html#a4d5555082454b3cb192f59a70838c891">is_null</a>() ) {</div>
<div class="line"><a name="l04431"></a><span class="lineno"> 4431</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;NPC tried to use painkillers, but has none!&quot;</span> );</div>
<div class="line"><a name="l04432"></a><span class="lineno"> 4432</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l04433"></a><span class="lineno"> 4433</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04434"></a><span class="lineno"> 4434</span>&#160;        <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( *<span class="keyword">this</span>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s takes some %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>(), it-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l04435"></a><span class="lineno"> 4435</span>&#160;        <a class="code" href="classitem__location.html">item_location</a> loc = <a class="code" href="classitem__location.html">item_location</a>( *<span class="keyword">this</span>, it );</div>
<div class="line"><a name="l04436"></a><span class="lineno"> 4436</span>&#160;        <span class="keyword">const</span> <a class="code" href="classtime__duration.html">time_duration</a> &amp;consume_time = <a class="code" href="classCharacter.html#a15e1412dda3489886688216c4ef7da34">get_consume_time</a>( *loc );</div>
<div class="line"><a name="l04437"></a><span class="lineno"> 4437</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -to_moves&lt;int&gt;( consume_time ) );</div>
<div class="line"><a name="l04438"></a><span class="lineno"> 4438</span>&#160;        <a class="code" href="classCharacter.html#aeafb75e7e7e7a3716aef9dfdd778a20d">consume</a>( loc );</div>
<div class="line"><a name="l04439"></a><span class="lineno"> 4439</span>&#160;    }</div>
<div class="line"><a name="l04440"></a><span class="lineno"> 4440</span>&#160;}</div>
<div class="line"><a name="l04441"></a><span class="lineno"> 4441</span>&#160; </div>
<div class="line"><a name="l04442"></a><span class="lineno"> 4442</span>&#160;<span class="comment">// We want our food to:</span></div>
<div class="line"><a name="l04443"></a><span class="lineno"> 4443</span>&#160;<span class="comment">// Provide enough nutrition and quench</span></div>
<div class="line"><a name="l04444"></a><span class="lineno"> 4444</span>&#160;<span class="comment">// Not provide too much of either (don&#39;t waste food)</span></div>
<div class="line"><a name="l04445"></a><span class="lineno"> 4445</span>&#160;<span class="comment">// Not be unhealthy</span></div>
<div class="line"><a name="l04446"></a><span class="lineno"> 4446</span>&#160;<span class="comment">// Not have side effects</span></div>
<div class="line"><a name="l04447"></a><span class="lineno"> 4447</span>&#160;<span class="comment">// Be eaten before it rots (favor soon-to-rot perishables)</span></div>
<div class="line"><a name="l04448"></a><span class="lineno"> 4448</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l04449"></a><span class="lineno"> 4449</span>&#160;<span class="comment">// TODO: Cache the results of this, *especially* if there&#39;s nothing we want to eat.</span></div>
<div class="line"><a name="l04450"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a42653f931f94e236c64920609e0b0279"> 4450</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="npcmove_8cpp.html#a42653f931f94e236c64920609e0b0279">rate_food</a>( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp;it, <span class="keywordtype">int</span> want_nutr, <span class="keywordtype">int</span> want_quench )</div>
<div class="line"><a name="l04451"></a><span class="lineno"> 4451</span>&#160;{</div>
<div class="line"><a name="l04452"></a><span class="lineno"> 4452</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> &amp;food = it.<a class="code" href="classitem.html#a411163e892e27c57b802d0d015c05162">get_comestible</a>();</div>
<div class="line"><a name="l04453"></a><span class="lineno"> 4453</span>&#160;    <span class="keywordflow">if</span>( !food ) {</div>
<div class="line"><a name="l04454"></a><span class="lineno"> 4454</span>&#160;        <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a name="l04455"></a><span class="lineno"> 4455</span>&#160;    }</div>
<div class="line"><a name="l04456"></a><span class="lineno"> 4456</span>&#160; </div>
<div class="line"><a name="l04457"></a><span class="lineno"> 4457</span>&#160;    <span class="comment">// Don&#39;t eat it if it&#39;s filled with parasites</span></div>
<div class="line"><a name="l04458"></a><span class="lineno"> 4458</span>&#160;    <span class="keywordflow">if</span>( food-&gt;parasites &amp;&amp; !it.<a class="code" href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">has_flag</a>( <a class="code" href="flag_8cpp.html#ae8607045269d50f5b92c4e7a4c09e95c">flag_NO_PARASITES</a> ) ) {</div>
<div class="line"><a name="l04459"></a><span class="lineno"> 4459</span>&#160;        <span class="keywordflow">return</span> 0.0;</div>
<div class="line"><a name="l04460"></a><span class="lineno"> 4460</span>&#160;    }</div>
<div class="line"><a name="l04461"></a><span class="lineno"> 4461</span>&#160; </div>
<div class="line"><a name="l04462"></a><span class="lineno"> 4462</span>&#160;    <span class="comment">// TODO: Use the actual nutrition for this food, rather than the default?</span></div>
<div class="line"><a name="l04463"></a><span class="lineno"> 4463</span>&#160;    <span class="keywordtype">int</span> nutr = food-&gt;get_default_nutr();</div>
<div class="line"><a name="l04464"></a><span class="lineno"> 4464</span>&#160;    <span class="keywordtype">int</span> quench = food-&gt;quench;</div>
<div class="line"><a name="l04465"></a><span class="lineno"> 4465</span>&#160; </div>
<div class="line"><a name="l04466"></a><span class="lineno"> 4466</span>&#160;    <span class="keywordflow">if</span>( nutr &lt;= 0 &amp;&amp; quench &lt;= 0 ) {</div>
<div class="line"><a name="l04467"></a><span class="lineno"> 4467</span>&#160;        <span class="comment">// Not food - may be salt, drugs etc.</span></div>
<div class="line"><a name="l04468"></a><span class="lineno"> 4468</span>&#160;        <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a name="l04469"></a><span class="lineno"> 4469</span>&#160;    }</div>
<div class="line"><a name="l04470"></a><span class="lineno"> 4470</span>&#160; </div>
<div class="line"><a name="l04471"></a><span class="lineno"> 4471</span>&#160;    <span class="keywordflow">if</span>( !it.<a class="code" href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">type</a>-&gt;<a class="code" href="structitype.html#afa43bb71000c037c9918d907fdacf0b5">use_methods</a>.empty() ) {</div>
<div class="line"><a name="l04472"></a><span class="lineno"> 4472</span>&#160;        <span class="comment">// TODO: Get a good method of telling apart:</span></div>
<div class="line"><a name="l04473"></a><span class="lineno"> 4473</span>&#160;        <span class="comment">// raw meat (parasites - don&#39;t eat unless mutant)</span></div>
<div class="line"><a name="l04474"></a><span class="lineno"> 4474</span>&#160;        <span class="comment">// zed meat (poison - don&#39;t eat unless mutant)</span></div>
<div class="line"><a name="l04475"></a><span class="lineno"> 4475</span>&#160;        <span class="comment">// alcohol (debuffs, health drop - supplement diet but don&#39;t bulk-consume)</span></div>
<div class="line"><a name="l04476"></a><span class="lineno"> 4476</span>&#160;        <span class="comment">// caffeine (fine to consume, but expensive and prevents sleep)</span></div>
<div class="line"><a name="l04477"></a><span class="lineno"> 4477</span>&#160;        <span class="comment">// hallucination mushrooms (NPCs don&#39;t hallucinate, so don&#39;t eat those)</span></div>
<div class="line"><a name="l04478"></a><span class="lineno"> 4478</span>&#160;        <span class="comment">// honeycomb (harmless iuse)</span></div>
<div class="line"><a name="l04479"></a><span class="lineno"> 4479</span>&#160;        <span class="comment">// royal jelly (way too expensive to eat as food)</span></div>
<div class="line"><a name="l04480"></a><span class="lineno"> 4480</span>&#160;        <span class="comment">// mutagenic crap (don&#39;t eat, we want player to micromanage muties)</span></div>
<div class="line"><a name="l04481"></a><span class="lineno"> 4481</span>&#160;        <span class="comment">// marloss (NPCs don&#39;t turn fungal)</span></div>
<div class="line"><a name="l04482"></a><span class="lineno"> 4482</span>&#160;        <span class="comment">// weed brownies (small debuff)</span></div>
<div class="line"><a name="l04483"></a><span class="lineno"> 4483</span>&#160;        <span class="comment">// seeds (too expensive)</span></div>
<div class="line"><a name="l04484"></a><span class="lineno"> 4484</span>&#160; </div>
<div class="line"><a name="l04485"></a><span class="lineno"> 4485</span>&#160;        <span class="comment">// For now skip all of those</span></div>
<div class="line"><a name="l04486"></a><span class="lineno"> 4486</span>&#160;        <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a name="l04487"></a><span class="lineno"> 4487</span>&#160;    }</div>
<div class="line"><a name="l04488"></a><span class="lineno"> 4488</span>&#160; </div>
<div class="line"><a name="l04489"></a><span class="lineno"> 4489</span>&#160;    <span class="keywordtype">double</span> relative_rot = it.<a class="code" href="classitem.html#adfb5ddb3d50f317c79eb7a1a26a63905">get_relative_rot</a>();</div>
<div class="line"><a name="l04490"></a><span class="lineno"> 4490</span>&#160; </div>
<div class="line"><a name="l04491"></a><span class="lineno"> 4491</span>&#160;    <span class="comment">// Don&#39;t eat rotten food.</span></div>
<div class="line"><a name="l04492"></a><span class="lineno"> 4492</span>&#160;    <span class="keywordflow">if</span>( relative_rot &gt;= 1.0f ) {</div>
<div class="line"><a name="l04493"></a><span class="lineno"> 4493</span>&#160;        <span class="comment">// TODO: Allow sapro mutants to eat it anyway and make them prefer it</span></div>
<div class="line"><a name="l04494"></a><span class="lineno"> 4494</span>&#160;        <span class="keywordflow">return</span> 0.0f;</div>
<div class="line"><a name="l04495"></a><span class="lineno"> 4495</span>&#160;    }</div>
<div class="line"><a name="l04496"></a><span class="lineno"> 4496</span>&#160; </div>
<div class="line"><a name="l04497"></a><span class="lineno"> 4497</span>&#160;    <span class="comment">// For non-rotten food, we have a starting weight in the range 1-10</span></div>
<div class="line"><a name="l04498"></a><span class="lineno"> 4498</span>&#160;    <span class="comment">// The closer it is to expiring, the more we should aim to eat it.</span></div>
<div class="line"><a name="l04499"></a><span class="lineno"> 4499</span>&#160;    <span class="keywordtype">float</span> weight = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1.0, 10.0 * relative_rot );</div>
<div class="line"><a name="l04500"></a><span class="lineno"> 4500</span>&#160; </div>
<div class="line"><a name="l04501"></a><span class="lineno"> 4501</span>&#160;    <span class="comment">// TODO: I feel like we should exclude *really* un-fun foods (flour, hot sauce, etc)</span></div>
<div class="line"><a name="l04502"></a><span class="lineno"> 4502</span>&#160;    <span class="comment">//       rather than discount them. Eating cooked liver is fine, eating raw flour... :/</span></div>
<div class="line"><a name="l04503"></a><span class="lineno"> 4503</span>&#160;    <span class="comment">//       Likewise, *fun* foods should be boosted in attractiveness.</span></div>
<div class="line"><a name="l04504"></a><span class="lineno"> 4504</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a66b0bbc211f6fb668781640c971d3acc">get_comestible_fun</a>() &lt; 0 ) {</div>
<div class="line"><a name="l04505"></a><span class="lineno"> 4505</span>&#160;        <span class="comment">// This helps to avoid eating stuff like flour</span></div>
<div class="line"><a name="l04506"></a><span class="lineno"> 4506</span>&#160;        weight /= ( -it.<a class="code" href="classitem.html#a66b0bbc211f6fb668781640c971d3acc">get_comestible_fun</a>() ) + 1;</div>
<div class="line"><a name="l04507"></a><span class="lineno"> 4507</span>&#160;    }</div>
<div class="line"><a name="l04508"></a><span class="lineno"> 4508</span>&#160; </div>
<div class="line"><a name="l04509"></a><span class="lineno"> 4509</span>&#160;    <span class="comment">// NPCs will avoid unhealthy foods.</span></div>
<div class="line"><a name="l04510"></a><span class="lineno"> 4510</span>&#160;    <span class="keywordflow">if</span>( food-&gt;healthy &lt; 0 ) {</div>
<div class="line"><a name="l04511"></a><span class="lineno"> 4511</span>&#160;        weight /= ( -food-&gt;healthy ) + 1;</div>
<div class="line"><a name="l04512"></a><span class="lineno"> 4512</span>&#160;    }</div>
<div class="line"><a name="l04513"></a><span class="lineno"> 4513</span>&#160; </div>
<div class="line"><a name="l04514"></a><span class="lineno"> 4514</span>&#160;    <span class="comment">// Avoid wasting quench values unless it&#39;s about to rot away</span></div>
<div class="line"><a name="l04515"></a><span class="lineno"> 4515</span>&#160;    <span class="keywordflow">if</span>( relative_rot &lt; 0.9f &amp;&amp; quench &gt; want_quench ) {</div>
<div class="line"><a name="l04516"></a><span class="lineno"> 4516</span>&#160;        <span class="comment">// TODO: This can remove a food as a candidate entirely, which means</span></div>
<div class="line"><a name="l04517"></a><span class="lineno"> 4517</span>&#160;        <span class="comment">//       an NPC could avoid eating a slightly hydrating but calorie-dense</span></div>
<div class="line"><a name="l04518"></a><span class="lineno"> 4518</span>&#160;        <span class="comment">//       food because they&#39;re &quot;not thirsty&quot;.</span></div>
<div class="line"><a name="l04519"></a><span class="lineno"> 4519</span>&#160;        weight -= ( 1.0f - relative_rot ) * ( quench - want_quench );</div>
<div class="line"><a name="l04520"></a><span class="lineno"> 4520</span>&#160;    }</div>
<div class="line"><a name="l04521"></a><span class="lineno"> 4521</span>&#160; </div>
<div class="line"><a name="l04522"></a><span class="lineno"> 4522</span>&#160;    <span class="keywordflow">if</span>( quench &lt; 0 &amp;&amp; want_quench &gt; 0 &amp;&amp; want_nutr &lt; want_quench ) {</div>
<div class="line"><a name="l04523"></a><span class="lineno"> 4523</span>&#160;        <span class="comment">// Avoid stuff that makes us thirsty when we&#39;re more thirsty than hungry</span></div>
<div class="line"><a name="l04524"></a><span class="lineno"> 4524</span>&#160;        weight = weight * want_nutr / want_quench;</div>
<div class="line"><a name="l04525"></a><span class="lineno"> 4525</span>&#160;    }</div>
<div class="line"><a name="l04526"></a><span class="lineno"> 4526</span>&#160; </div>
<div class="line"><a name="l04527"></a><span class="lineno"> 4527</span>&#160;    <span class="keywordflow">if</span>( nutr &gt; want_nutr ) {</div>
<div class="line"><a name="l04528"></a><span class="lineno"> 4528</span>&#160; </div>
<div class="line"><a name="l04529"></a><span class="lineno"> 4529</span>&#160;        <span class="comment">// Discount fresh foods that are bigger than our hunger.</span></div>
<div class="line"><a name="l04530"></a><span class="lineno"> 4530</span>&#160;        <span class="keywordflow">if</span>( relative_rot &lt; 0.9f ) {</div>
<div class="line"><a name="l04531"></a><span class="lineno"> 4531</span>&#160;            weight /= nutr - want_nutr;</div>
<div class="line"><a name="l04532"></a><span class="lineno"> 4532</span>&#160;        }</div>
<div class="line"><a name="l04533"></a><span class="lineno"> 4533</span>&#160;    }</div>
<div class="line"><a name="l04534"></a><span class="lineno"> 4534</span>&#160; </div>
<div class="line"><a name="l04535"></a><span class="lineno"> 4535</span>&#160;    <span class="comment">// NPCs won&#39;t eat poison food unless it&#39;s only a little poisoned</span></div>
<div class="line"><a name="l04536"></a><span class="lineno"> 4536</span>&#160;    <span class="keywordflow">if</span>( it.<a class="code" href="classitem.html#a9f276bdd47b29bc1649dce5c64cbe433">poison</a> &gt; 0 ) {</div>
<div class="line"><a name="l04537"></a><span class="lineno"> 4537</span>&#160;        weight -= it.<a class="code" href="classitem.html#a9f276bdd47b29bc1649dce5c64cbe433">poison</a>;</div>
<div class="line"><a name="l04538"></a><span class="lineno"> 4538</span>&#160;    }</div>
<div class="line"><a name="l04539"></a><span class="lineno"> 4539</span>&#160; </div>
<div class="line"><a name="l04540"></a><span class="lineno"> 4540</span>&#160;    <span class="keywordflow">return</span> weight;</div>
<div class="line"><a name="l04541"></a><span class="lineno"> 4541</span>&#160;}</div>
<div class="line"><a name="l04542"></a><span class="lineno"> 4542</span>&#160; </div>
<div class="line"><a name="l04543"></a><span class="lineno"><a class="line" href="classnpc.html#a67e45227dd3808fd25f73ed0a93020ac"> 4543</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a67e45227dd3808fd25f73ed0a93020ac">npc::consume_food_from_camp</a>()</div>
<div class="line"><a name="l04544"></a><span class="lineno"> 4544</span>&#160;{</div>
<div class="line"><a name="l04545"></a><span class="lineno"> 4545</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l04546"></a><span class="lineno"> 4546</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04547"></a><span class="lineno"> 4547</span>&#160;    }</div>
<div class="line"><a name="l04548"></a><span class="lineno"> 4548</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l04549"></a><span class="lineno"> 4549</span>&#160;    std::optional&lt;basecamp *&gt; potential_bc;</div>
<div class="line"><a name="l04550"></a><span class="lineno"> 4550</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_omt</a> &amp;camp_pos : player_character.<a class="code" href="classCharacter.html#a2aa50df39ac7262f946b9d2a4d152e31">camps</a> ) {</div>
<div class="line"><a name="l04551"></a><span class="lineno"> 4551</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( camp_pos, <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>() ) &lt; 3 ) {</div>
<div class="line"><a name="l04552"></a><span class="lineno"> 4552</span>&#160;            potential_bc = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#afb50d2d30ce283fbd3ee8773fde98676">find_camp</a>( camp_pos.<a class="code" href="classcoords_1_1coord__point.html#a7b5804160d1d0e69a9f2fba098bea723">xy</a>() );</div>
<div class="line"><a name="l04553"></a><span class="lineno"> 4553</span>&#160;            <span class="keywordflow">if</span>( potential_bc ) {</div>
<div class="line"><a name="l04554"></a><span class="lineno"> 4554</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04555"></a><span class="lineno"> 4555</span>&#160;            }</div>
<div class="line"><a name="l04556"></a><span class="lineno"> 4556</span>&#160;        }</div>
<div class="line"><a name="l04557"></a><span class="lineno"> 4557</span>&#160;    }</div>
<div class="line"><a name="l04558"></a><span class="lineno"> 4558</span>&#160;    <span class="keywordflow">if</span>( !potential_bc ) {</div>
<div class="line"><a name="l04559"></a><span class="lineno"> 4559</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04560"></a><span class="lineno"> 4560</span>&#160;    }</div>
<div class="line"><a name="l04561"></a><span class="lineno"> 4561</span>&#160;    <a class="code" href="classbasecamp.html">basecamp</a> *bcp = *potential_bc;</div>
<div class="line"><a name="l04562"></a><span class="lineno"> 4562</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a8c0812cf2b1dae1461ff50f9a019796e">get_thirst</a>() &gt; 40 &amp;&amp; bcp-&gt;<a class="code" href="classbasecamp.html#ac422f34b7fd2c82e4b29bf5ad272309a">has_water</a>() ) {</div>
<div class="line"><a name="l04563"></a><span class="lineno"> 4563</span>&#160;        <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( <span class="stringliteral">&quot;camp_water_thanks&quot;</span>, 1_hours,</div>
<div class="line"><a name="l04564"></a><span class="lineno"> 4564</span>&#160;                        <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_camp_water_thanks.translated(), <span class="keyword">false</span> );</div>
<div class="line"><a name="l04565"></a><span class="lineno"> 4565</span>&#160;        <span class="comment">// TODO: Stop skipping the stomach for this, actually put the water in there.</span></div>
<div class="line"><a name="l04566"></a><span class="lineno"> 4566</span>&#160;        <a class="code" href="classCharacter.html#ae6bcae1e1d30b35e0152b5e1bd615f5e">set_thirst</a>( 0 );</div>
<div class="line"><a name="l04567"></a><span class="lineno"> 4567</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04568"></a><span class="lineno"> 4568</span>&#160;    }</div>
<div class="line"><a name="l04569"></a><span class="lineno"> 4569</span>&#160;    <a class="code" href="classfaction.html">faction</a> *yours = player_character.<a class="code" href="classCharacter.html#aee4e2c047e2c683905cade66f04112b8">get_faction</a>();</div>
<div class="line"><a name="l04570"></a><span class="lineno"> 4570</span>&#160; </div>
<div class="line"><a name="l04571"></a><span class="lineno"> 4571</span>&#160;    <span class="keywordtype">int</span> current_kcals = <a class="code" href="classCharacter.html#a824a60fef8920f38a6f1e1b35bea4879">get_stored_kcal</a>() + <a class="code" href="classCharacter.html#aa4ecfee35839a07be48afccbe582023e">stomach</a>.<a class="code" href="classstomach__contents.html#aa5cf12fa92df9630e78c4cf5af74d616">get_calories</a>() + <a class="code" href="classCharacter.html#a6e24aab61f2ff8333a4f938cce785b3f">guts</a>.<a class="code" href="classstomach__contents.html#aa5cf12fa92df9630e78c4cf5af74d616">get_calories</a>();</div>
<div class="line"><a name="l04572"></a><span class="lineno"> 4572</span>&#160;    <span class="keywordtype">int</span> kcal_threshold = <a class="code" href="classCharacter.html#aaa88cf522afdfdc90edcbd9fdefca47d">get_healthy_kcal</a>() * 19 / 20;</div>
<div class="line"><a name="l04573"></a><span class="lineno"> 4573</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#ab937dd4b9a2cf84fb446d0da98a62365">get_hunger</a>() &gt; 0 &amp;&amp; current_kcals &lt; kcal_threshold ) {</div>
<div class="line"><a name="l04574"></a><span class="lineno"> 4574</span>&#160;        <span class="comment">// Try to eat a bit more than the bare minimum so that we&#39;re not eating every 5 minutes</span></div>
<div class="line"><a name="l04575"></a><span class="lineno"> 4575</span>&#160;        <span class="comment">// but also don&#39;t try to eat a week&#39;s worth of food in one sitting</span></div>
<div class="line"><a name="l04576"></a><span class="lineno"> 4576</span>&#160;        <span class="keywordtype">int</span> desired_kcals = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>( <a class="code" href="itype_8h.html#a5aaa0efeab989fe1afbc025b4b84d3c2">base_metabolic_rate</a> ), <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0,</div>
<div class="line"><a name="l04577"></a><span class="lineno"> 4577</span>&#160;                                      kcal_threshold + 100 - current_kcals ) );</div>
<div class="line"><a name="l04578"></a><span class="lineno"> 4578</span>&#160;        <span class="keywordtype">int</span> kcals_to_eat = <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( desired_kcals, yours-&gt;<a class="code" href="classfaction__template.html#a9cda490b58dc788f44e057bfd29a9971">food_supply</a>.<a class="code" href="structnutrients.html#a27fef4783e99c7f2471a9fabcabe19b5">kcal</a>() );</div>
<div class="line"><a name="l04579"></a><span class="lineno"> 4579</span>&#160; </div>
<div class="line"><a name="l04580"></a><span class="lineno"> 4580</span>&#160;        <span class="keywordflow">if</span>( kcals_to_eat &gt; 0 ) {</div>
<div class="line"><a name="l04581"></a><span class="lineno"> 4581</span>&#160;            <span class="comment">// We need food and there&#39;s some available, so let&#39;s eat it</span></div>
<div class="line"><a name="l04582"></a><span class="lineno"> 4582</span>&#160;            <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( <span class="stringliteral">&quot;camp_food_thanks&quot;</span>, 1_hours,</div>
<div class="line"><a name="l04583"></a><span class="lineno"> 4583</span>&#160;                            <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_camp_food_thanks.translated(), <span class="keyword">false</span> );</div>
<div class="line"><a name="l04584"></a><span class="lineno"> 4584</span>&#160; </div>
<div class="line"><a name="l04585"></a><span class="lineno"> 4585</span>&#160;            <span class="comment">// Make a fake food object here to feed the NPC with, since camp calories are abstracted away</span></div>
<div class="line"><a name="l04586"></a><span class="lineno"> 4586</span>&#160; </div>
<div class="line"><a name="l04587"></a><span class="lineno"> 4587</span>&#160;            <span class="comment">// Fill up the stomach to &quot;full&quot; (half of capacity) but no further, to avoid NPCs vomiting</span></div>
<div class="line"><a name="l04588"></a><span class="lineno"> 4588</span>&#160;            <span class="comment">// or becoming engorged</span></div>
<div class="line"><a name="l04589"></a><span class="lineno"> 4589</span>&#160;            <a class="code" href="classunits_1_1quantity.html">units::volume</a> filling_vol = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0_ml, <a class="code" href="classCharacter.html#aa4ecfee35839a07be48afccbe582023e">stomach</a>.<a class="code" href="classstomach__contents.html#a93a1500302155581c1846aa84314b81b">capacity</a>( *<span class="keyword">this</span> ) / 2 - <a class="code" href="classCharacter.html#aa4ecfee35839a07be48afccbe582023e">stomach</a>.<a class="code" href="classstomach__contents.html#a52e4721f4afcc99ddb28d261fc90cc32">contains</a>() );</div>
<div class="line"><a name="l04590"></a><span class="lineno"> 4590</span>&#160; </div>
<div class="line"><a name="l04591"></a><span class="lineno"> 4591</span>&#160;            <span class="comment">// Returns the actual amount of calories and vitamins taken from the camp&#39;s larder.</span></div>
<div class="line"><a name="l04592"></a><span class="lineno"> 4592</span>&#160;            <a class="code" href="structnutrients.html">nutrients</a> nutr = bcp-&gt;<a class="code" href="classbasecamp.html#a399448deb1704654be0979c9a763db03">camp_food_supply</a>( -kcals_to_eat );</div>
<div class="line"><a name="l04593"></a><span class="lineno"> 4593</span>&#160; </div>
<div class="line"><a name="l04594"></a><span class="lineno"> 4594</span>&#160;            <a class="code" href="classCharacter.html#aa4ecfee35839a07be48afccbe582023e">stomach</a>.<a class="code" href="classstomach__contents.html#a96eccd372c5b0f42ca47bfd7bfeabaec">ingest</a>( <a class="code" href="structfood__summary.html">food_summary</a>{</div>
<div class="line"><a name="l04595"></a><span class="lineno"> 4595</span>&#160;                0_ml,</div>
<div class="line"><a name="l04596"></a><span class="lineno"> 4596</span>&#160;                filling_vol,</div>
<div class="line"><a name="l04597"></a><span class="lineno"> 4597</span>&#160;                nutr</div>
<div class="line"><a name="l04598"></a><span class="lineno"> 4598</span>&#160;            } );</div>
<div class="line"><a name="l04599"></a><span class="lineno"> 4599</span>&#160;            <span class="comment">// Ensure our hunger is satisfied so we don&#39;t try to eat again immediately.</span></div>
<div class="line"><a name="l04600"></a><span class="lineno"> 4600</span>&#160;            <span class="comment">// update_stomach() usually takes care of that but it&#39;s only called once every 10 seconds for NPCs</span></div>
<div class="line"><a name="l04601"></a><span class="lineno"> 4601</span>&#160;            <a class="code" href="classCharacter.html#a7bb3c92bba69a2421c07748f57aa4d82">set_hunger</a>( -1 );</div>
<div class="line"><a name="l04602"></a><span class="lineno"> 4602</span>&#160; </div>
<div class="line"><a name="l04603"></a><span class="lineno"> 4603</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l04604"></a><span class="lineno"> 4604</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04605"></a><span class="lineno"> 4605</span>&#160;            <span class="comment">// We need food but there&#39;s none to eat :(</span></div>
<div class="line"><a name="l04606"></a><span class="lineno"> 4606</span>&#160;            <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( <span class="stringliteral">&quot;camp_larder_empty&quot;</span>, 1_hours,</div>
<div class="line"><a name="l04607"></a><span class="lineno"> 4607</span>&#160;                            <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_camp_larder_empty.translated(), <span class="keyword">false</span> );</div>
<div class="line"><a name="l04608"></a><span class="lineno"> 4608</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04609"></a><span class="lineno"> 4609</span>&#160;        }</div>
<div class="line"><a name="l04610"></a><span class="lineno"> 4610</span>&#160;    }</div>
<div class="line"><a name="l04611"></a><span class="lineno"> 4611</span>&#160; </div>
<div class="line"><a name="l04612"></a><span class="lineno"> 4612</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l04613"></a><span class="lineno"> 4613</span>&#160;}</div>
<div class="line"><a name="l04614"></a><span class="lineno"> 4614</span>&#160; </div>
<div class="line"><a name="l04615"></a><span class="lineno"><a class="line" href="classnpc.html#a3dbcb192e2e0e10b54eb324a07afe040"> 4615</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a3dbcb192e2e0e10b54eb324a07afe040">npc::consume_food</a>()</div>
<div class="line"><a name="l04616"></a><span class="lineno"> 4616</span>&#160;{</div>
<div class="line"><a name="l04617"></a><span class="lineno"> 4617</span>&#160;    <span class="keywordtype">float</span> best_weight = 0.0f;</div>
<div class="line"><a name="l04618"></a><span class="lineno"> 4618</span>&#160;    <a class="code" href="classitem.html">item</a> *best_food = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04619"></a><span class="lineno"> 4619</span>&#160;    <span class="keywordtype">bool</span> consumed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04620"></a><span class="lineno"> 4620</span>&#160;    <span class="keywordtype">int</span> want_hunger = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0, <a class="code" href="classCharacter.html#ab937dd4b9a2cf84fb446d0da98a62365">get_hunger</a>() );</div>
<div class="line"><a name="l04621"></a><span class="lineno"> 4621</span>&#160;    <span class="keywordtype">int</span> want_quench = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 0, <a class="code" href="classnpc.html#a8c0812cf2b1dae1461ff50f9a019796e">get_thirst</a>() );</div>
<div class="line"><a name="l04622"></a><span class="lineno"> 4622</span>&#160; </div>
<div class="line"><a name="l04623"></a><span class="lineno"> 4623</span>&#160;    <span class="keyword">const</span> std::vector&lt;item *&gt; inv_food = <a class="code" href="classCharacter.html#a0e8509fc038cee083b5a7cc7bdf0f8f9">cache_get_items_with</a>( <span class="stringliteral">&quot;is_food&quot;</span>, &amp;<a class="code" href="classitem.html#aad45569fa1fdd99d602eabbbbca04f75">item::is_food</a> );</div>
<div class="line"><a name="l04624"></a><span class="lineno"> 4624</span>&#160; </div>
<div class="line"><a name="l04625"></a><span class="lineno"> 4625</span>&#160;    <span class="keywordflow">if</span>( inv_food.empty() ) {</div>
<div class="line"><a name="l04626"></a><span class="lineno"> 4626</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l04627"></a><span class="lineno"> 4627</span>&#160;            <span class="comment">// TODO: Remove this and let player &quot;exploit&quot; hungry NPCs</span></div>
<div class="line"><a name="l04628"></a><span class="lineno"> 4628</span>&#160;            <a class="code" href="classCharacter.html#a7bb3c92bba69a2421c07748f57aa4d82">set_hunger</a>( 0 );</div>
<div class="line"><a name="l04629"></a><span class="lineno"> 4629</span>&#160;            <a class="code" href="classCharacter.html#ae6bcae1e1d30b35e0152b5e1bd615f5e">set_thirst</a>( 0 );</div>
<div class="line"><a name="l04630"></a><span class="lineno"> 4630</span>&#160;        }</div>
<div class="line"><a name="l04631"></a><span class="lineno"> 4631</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04632"></a><span class="lineno"> 4632</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> * <span class="keyword">const</span> &amp;food_item : inv_food ) {</div>
<div class="line"><a name="l04633"></a><span class="lineno"> 4633</span>&#160;            <span class="keywordtype">float</span> cur_weight = <a class="code" href="npcmove_8cpp.html#a42653f931f94e236c64920609e0b0279">rate_food</a>( *food_item, want_hunger, want_quench );</div>
<div class="line"><a name="l04634"></a><span class="lineno"> 4634</span>&#160;            <span class="comment">// Note: will_eat is expensive, avoid calling it if possible</span></div>
<div class="line"><a name="l04635"></a><span class="lineno"> 4635</span>&#160;            <span class="keywordflow">if</span>( cur_weight &gt; best_weight &amp;&amp; <a class="code" href="classCharacter.html#a4eb1793aafe89d34ba7ab96bf9facc19">will_eat</a>( *food_item ).success() ) {</div>
<div class="line"><a name="l04636"></a><span class="lineno"> 4636</span>&#160;                best_weight = cur_weight;</div>
<div class="line"><a name="l04637"></a><span class="lineno"> 4637</span>&#160;                best_food = food_item;</div>
<div class="line"><a name="l04638"></a><span class="lineno"> 4638</span>&#160;            }</div>
<div class="line"><a name="l04639"></a><span class="lineno"> 4639</span>&#160;        }</div>
<div class="line"><a name="l04640"></a><span class="lineno"> 4640</span>&#160; </div>
<div class="line"><a name="l04641"></a><span class="lineno"> 4641</span>&#160;        <span class="comment">// consume doesn&#39;t return a meaningful answer, we need to compare moves</span></div>
<div class="line"><a name="l04642"></a><span class="lineno"> 4642</span>&#160;        <span class="keywordflow">if</span>( best_food != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l04643"></a><span class="lineno"> 4643</span>&#160;            <span class="keyword">const</span> <a class="code" href="classtime__duration.html">time_duration</a> &amp;consume_time = <a class="code" href="classCharacter.html#a15e1412dda3489886688216c4ef7da34">get_consume_time</a>( *best_food );</div>
<div class="line"><a name="l04644"></a><span class="lineno"> 4644</span>&#160;            consumed = <a class="code" href="classCharacter.html#aeafb75e7e7e7a3716aef9dfdd778a20d">consume</a>( <a class="code" href="classitem__location.html">item_location</a>( *<span class="keyword">this</span>, best_food ) ) != <a class="code" href="enums_8h.html#aba0792ae6ae9fa99a07c9c9e6eae94e9ab50339a10e1de285ac99d4c3990b8693">trinary::NONE</a>;</div>
<div class="line"><a name="l04645"></a><span class="lineno"> 4645</span>&#160;            <span class="keywordflow">if</span>( consumed ) {</div>
<div class="line"><a name="l04646"></a><span class="lineno"> 4646</span>&#160;                <span class="comment">// TODO: Message that &quot;X begins eating Y?&quot; Right now it appears to the player</span></div>
<div class="line"><a name="l04647"></a><span class="lineno"> 4647</span>&#160;                <span class="comment">//       that &quot;Urist eats a carp roast&quot; and then stands still doing nothing</span></div>
<div class="line"><a name="l04648"></a><span class="lineno"> 4648</span>&#160;                <span class="comment">//       for a while.</span></div>
<div class="line"><a name="l04649"></a><span class="lineno"> 4649</span>&#160;                <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -to_moves&lt;int&gt;( consume_time ) );</div>
<div class="line"><a name="l04650"></a><span class="lineno"> 4650</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04651"></a><span class="lineno"> 4651</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;%s failed to consume %s&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), best_food-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l04652"></a><span class="lineno"> 4652</span>&#160;            }</div>
<div class="line"><a name="l04653"></a><span class="lineno"> 4653</span>&#160;        }</div>
<div class="line"><a name="l04654"></a><span class="lineno"> 4654</span>&#160; </div>
<div class="line"><a name="l04655"></a><span class="lineno"> 4655</span>&#160;    }</div>
<div class="line"><a name="l04656"></a><span class="lineno"> 4656</span>&#160; </div>
<div class="line"><a name="l04657"></a><span class="lineno"> 4657</span>&#160;    <span class="keywordflow">return</span> consumed;</div>
<div class="line"><a name="l04658"></a><span class="lineno"> 4658</span>&#160;}</div>
<div class="line"><a name="l04659"></a><span class="lineno"> 4659</span>&#160; </div>
<div class="line"><a name="l04660"></a><span class="lineno"><a class="line" href="classnpc.html#aae5cd15ba8200d25c2a5f5e398af76b8"> 4660</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#aae5cd15ba8200d25c2a5f5e398af76b8">npc::mug_player</a>( <a class="code" href="classCharacter.html">Character</a> &amp;mark )</div>
<div class="line"><a name="l04661"></a><span class="lineno"> 4661</span>&#160;{</div>
<div class="line"><a name="l04662"></a><span class="lineno"> 4662</span>&#160;    <span class="keywordflow">if</span>( mark.<a class="code" href="classCharacter.html#ad79464264cb8a2061f5888d092f5cd86">is_armed</a>() ) {</div>
<div class="line"><a name="l04663"></a><span class="lineno"> 4663</span>&#160;        <a class="code" href="classnpc.html#a07f70dcf0d3f4228a4d7eda138c5ff00">make_angry</a>();</div>
<div class="line"><a name="l04664"></a><span class="lineno"> 4664</span>&#160;    }</div>
<div class="line"><a name="l04665"></a><span class="lineno"> 4665</span>&#160; </div>
<div class="line"><a name="l04666"></a><span class="lineno"> 4666</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), mark.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &gt; 1 ) { <span class="comment">// We have to travel</span></div>
<div class="line"><a name="l04667"></a><span class="lineno"> 4667</span>&#160;        <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( mark.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l04668"></a><span class="lineno"> 4668</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l04669"></a><span class="lineno"> 4669</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04670"></a><span class="lineno"> 4670</span>&#160;    }</div>
<div class="line"><a name="l04671"></a><span class="lineno"> 4671</span>&#160; </div>
<div class="line"><a name="l04672"></a><span class="lineno"> 4672</span>&#160;    <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l04673"></a><span class="lineno"> 4673</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> u_see = player_character.<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *<span class="keyword">this</span> ) || player_character.<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( mark );</div>
<div class="line"><a name="l04674"></a><span class="lineno"> 4674</span>&#160;    <span class="keywordflow">if</span>( mark.<a class="code" href="classCharacter.html#a17213386e132fbde5ce772f04e22f5ba">cash</a> &gt; 0 ) {</div>
<div class="line"><a name="l04675"></a><span class="lineno"> 4675</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) { <span class="comment">// hallucinations can&#39;t take items</span></div>
<div class="line"><a name="l04676"></a><span class="lineno"> 4676</span>&#160;            <a class="code" href="classCharacter.html#a17213386e132fbde5ce772f04e22f5ba">cash</a> += mark.<a class="code" href="classCharacter.html#a17213386e132fbde5ce772f04e22f5ba">cash</a>;</div>
<div class="line"><a name="l04677"></a><span class="lineno"> 4677</span>&#160;            mark.<a class="code" href="classCharacter.html#a17213386e132fbde5ce772f04e22f5ba">cash</a> = 0;</div>
<div class="line"><a name="l04678"></a><span class="lineno"> 4678</span>&#160;        }</div>
<div class="line"><a name="l04679"></a><span class="lineno"> 4679</span>&#160;        <a class="code" href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">set_moves</a>( 0 );</div>
<div class="line"><a name="l04680"></a><span class="lineno"> 4680</span>&#160;        <span class="comment">// Describe the action</span></div>
<div class="line"><a name="l04681"></a><span class="lineno"> 4681</span>&#160;        <span class="keywordflow">if</span>( mark.<a class="code" href="classCharacter.html#a8f914d66d3d996a1356a31caf1d44c13">is_npc</a>() ) {</div>
<div class="line"><a name="l04682"></a><span class="lineno"> 4682</span>&#160;            <span class="keywordflow">if</span>( u_see ) {</div>
<div class="line"><a name="l04683"></a><span class="lineno"> 4683</span>&#160;                <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s takes %2$s&#39;s money!&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), mark.<a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l04684"></a><span class="lineno"> 4684</span>&#160;            }</div>
<div class="line"><a name="l04685"></a><span class="lineno"> 4685</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04686"></a><span class="lineno"> 4686</span>&#160;            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s takes your money!&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() );</div>
<div class="line"><a name="l04687"></a><span class="lineno"> 4687</span>&#160;        }</div>
<div class="line"><a name="l04688"></a><span class="lineno"> 4688</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04689"></a><span class="lineno"> 4689</span>&#160;    }</div>
<div class="line"><a name="l04690"></a><span class="lineno"> 4690</span>&#160; </div>
<div class="line"><a name="l04691"></a><span class="lineno"> 4691</span>&#160;    <span class="comment">// We already have their money; take some goodies!</span></div>
<div class="line"><a name="l04692"></a><span class="lineno"> 4692</span>&#160;    <span class="comment">// value_mod affects at what point we &quot;take the money and run&quot;</span></div>
<div class="line"><a name="l04693"></a><span class="lineno"> 4693</span>&#160;    <span class="comment">// A lower value means we&#39;ll take more stuff</span></div>
<div class="line"><a name="l04694"></a><span class="lineno"> 4694</span>&#160;    <span class="keywordtype">double</span> value_mod = 1 - ( ( 10 - <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">bravery</a> ) * .05 ) -</div>
<div class="line"><a name="l04695"></a><span class="lineno"> 4695</span>&#160;                       ( ( 10 - <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#aecf2fbbc5fcbda416d381dc0bde6e18c">aggression</a> ) * .04 ) -</div>
<div class="line"><a name="l04696"></a><span class="lineno"> 4696</span>&#160;                       ( ( 10 - <a class="code" href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">personality</a>.<a class="code" href="structnpc__personality.html#ad2ed57eaba1c878112ed7575bc6ebfbb">collector</a> ) * .06 );</div>
<div class="line"><a name="l04697"></a><span class="lineno"> 4697</span>&#160;    <span class="keywordflow">if</span>( !mark.<a class="code" href="classCharacter.html#a8f914d66d3d996a1356a31caf1d44c13">is_npc</a>() ) {</div>
<div class="line"><a name="l04698"></a><span class="lineno"> 4698</span>&#160;        value_mod += ( <a class="code" href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">op_of_u</a>.<a class="code" href="structnpc__opinion.html#ac3e3687fbefeca03878ed52f641d4bf7">fear</a> * .08 );</div>
<div class="line"><a name="l04699"></a><span class="lineno"> 4699</span>&#160;        value_mod -= ( ( 8 - <a class="code" href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">op_of_u</a>.<a class="code" href="structnpc__opinion.html#a33fc4533430debe24fb3a9a38acfabbe">value</a> ) * .07 );</div>
<div class="line"><a name="l04700"></a><span class="lineno"> 4700</span>&#160;    }</div>
<div class="line"><a name="l04701"></a><span class="lineno"> 4701</span>&#160;    <span class="keywordtype">double</span> best_value = <a class="code" href="classnpc.html#ad43e6fde3fbc21def53e20b418b616e7">minimum_item_value</a>() * value_mod;</div>
<div class="line"><a name="l04702"></a><span class="lineno"> 4702</span>&#160;    <a class="code" href="classitem.html">item</a> *to_steal = <span class="keyword">nullptr</span>;</div>
<div class="line"><a name="l04703"></a><span class="lineno"> 4703</span>&#160;    std::vector&lt;const item *&gt; <a class="code" href="classCharacter.html#abc09f44d013230019fd44156482e273e">pseudo_items</a> = mark.<a class="code" href="classCharacter.html#a038091eadd59de4a96565c17a7b85484">get_pseudo_items</a>();</div>
<div class="line"><a name="l04704"></a><span class="lineno"> 4704</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> inv_valuables = mark.<a class="code" href="classvisitable.html#a3e80572268abd951cf016d275febe4e6">items_with</a>( [<span class="keyword">this</span>, <a class="code" href="classCharacter.html#abc09f44d013230019fd44156482e273e">pseudo_items</a>]( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp; itm ) {</div>
<div class="line"><a name="l04705"></a><span class="lineno"> 4705</span>&#160;        <span class="keywordflow">return</span> std::find( <a class="code" href="classCharacter.html#abc09f44d013230019fd44156482e273e">pseudo_items</a>.begin(), <a class="code" href="classCharacter.html#abc09f44d013230019fd44156482e273e">pseudo_items</a>.end(), &amp;itm ) == <a class="code" href="classCharacter.html#abc09f44d013230019fd44156482e273e">pseudo_items</a>.end() &amp;&amp;</div>
<div class="line"><a name="l04706"></a><span class="lineno"> 4706</span>&#160;               <a class="code" href="classnpc.html#a29fad2798be32c49e72523a6cab2b7f9">value</a>( itm ) &gt; 0;</div>
<div class="line"><a name="l04707"></a><span class="lineno"> 4707</span>&#160;    } );</div>
<div class="line"><a name="l04708"></a><span class="lineno"> 4708</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> *it : inv_valuables ) {</div>
<div class="line"><a name="l04709"></a><span class="lineno"> 4709</span>&#160;        <a class="code" href="classitem.html">item</a> &amp;front_stack = *it; <span class="comment">// is this safe?</span></div>
<div class="line"><a name="l04710"></a><span class="lineno"> 4710</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a29fad2798be32c49e72523a6cab2b7f9">value</a>( front_stack ) &gt;= best_value &amp;&amp;</div>
<div class="line"><a name="l04711"></a><span class="lineno"> 4711</span>&#160;            <a class="code" href="classCharacter.html#a873b6e039822dc744b6c9741385b926d">can_pickVolume</a>( front_stack, <span class="keyword">true</span> ) &amp;&amp;</div>
<div class="line"><a name="l04712"></a><span class="lineno"> 4712</span>&#160;            <a class="code" href="classCharacter.html#a6dc61c40fa13a6124b53785c9db13e70">can_pickWeight</a>( front_stack, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l04713"></a><span class="lineno"> 4713</span>&#160;            best_value = <a class="code" href="classnpc.html#a29fad2798be32c49e72523a6cab2b7f9">value</a>( front_stack );</div>
<div class="line"><a name="l04714"></a><span class="lineno"> 4714</span>&#160;            to_steal = &amp;front_stack;</div>
<div class="line"><a name="l04715"></a><span class="lineno"> 4715</span>&#160;        }</div>
<div class="line"><a name="l04716"></a><span class="lineno"> 4716</span>&#160;    }</div>
<div class="line"><a name="l04717"></a><span class="lineno"> 4717</span>&#160;    <span class="keywordflow">if</span>( to_steal == <span class="keyword">nullptr</span> ) { <span class="comment">// Didn&#39;t find anything worthwhile!</span></div>
<div class="line"><a name="l04718"></a><span class="lineno"> 4718</span>&#160;        <a class="code" href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">set_attitude</a>( <a class="code" href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a> );</div>
<div class="line"><a name="l04719"></a><span class="lineno"> 4719</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a>( 3 ) ) {</div>
<div class="line"><a name="l04720"></a><span class="lineno"> 4720</span>&#160;            <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_done_mugging.translated() );</div>
<div class="line"><a name="l04721"></a><span class="lineno"> 4721</span>&#160;        }</div>
<div class="line"><a name="l04722"></a><span class="lineno"> 4722</span>&#160;        <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l04723"></a><span class="lineno"> 4723</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04724"></a><span class="lineno"> 4724</span>&#160;    }</div>
<div class="line"><a name="l04725"></a><span class="lineno"> 4725</span>&#160;    <a class="code" href="classitem.html">item</a> stolen;</div>
<div class="line"><a name="l04726"></a><span class="lineno"> 4726</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">is_hallucination</a>() ) {</div>
<div class="line"><a name="l04727"></a><span class="lineno"> 4727</span>&#160;        stolen = mark.<a class="code" href="classCharacter.html#a379081ad133b17e4ab3d230270b2414d">i_rem</a>( to_steal );</div>
<div class="line"><a name="l04728"></a><span class="lineno"> 4728</span>&#160;        <a class="code" href="classCharacter.html#af04d061e415da9cb6f1fc234b04f3dfb">i_add</a>( stolen );</div>
<div class="line"><a name="l04729"></a><span class="lineno"> 4729</span>&#160;    }</div>
<div class="line"><a name="l04730"></a><span class="lineno"> 4730</span>&#160;    <span class="keywordflow">if</span>( mark.<a class="code" href="classCharacter.html#a8f914d66d3d996a1356a31caf1d44c13">is_npc</a>() ) {</div>
<div class="line"><a name="l04731"></a><span class="lineno"> 4731</span>&#160;        <span class="keywordflow">if</span>( u_see ) {</div>
<div class="line"><a name="l04732"></a><span class="lineno"> 4732</span>&#160;            <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s takes %2$s&#39;s %3$s.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), mark.<a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), stolen.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l04733"></a><span class="lineno"> 4733</span>&#160;        }</div>
<div class="line"><a name="l04734"></a><span class="lineno"> 4734</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04735"></a><span class="lineno"> 4735</span>&#160;        <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s takes your %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), stolen.<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l04736"></a><span class="lineno"> 4736</span>&#160;    }</div>
<div class="line"><a name="l04737"></a><span class="lineno"> 4737</span>&#160;    <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -<a class="code" href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">get_speed</a>() );</div>
<div class="line"><a name="l04738"></a><span class="lineno"> 4738</span>&#160;    <span class="keywordflow">if</span>( !mark.<a class="code" href="classCharacter.html#a8f914d66d3d996a1356a31caf1d44c13">is_npc</a>() ) {</div>
<div class="line"><a name="l04739"></a><span class="lineno"> 4739</span>&#160;        <a class="code" href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">op_of_u</a>.<a class="code" href="structnpc__opinion.html#a33fc4533430debe24fb3a9a38acfabbe">value</a> -= <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( 0, 1 );  <span class="comment">// Decrease the value of the player</span></div>
<div class="line"><a name="l04740"></a><span class="lineno"> 4740</span>&#160;    }</div>
<div class="line"><a name="l04741"></a><span class="lineno"> 4741</span>&#160;}</div>
<div class="line"><a name="l04742"></a><span class="lineno"> 4742</span>&#160; </div>
<div class="line"><a name="l04743"></a><span class="lineno"><a class="line" href="classnpc.html#abfc3752f6d8399151f22e5514a37c479"> 4743</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#abfc3752f6d8399151f22e5514a37c479">npc::look_for_player</a>( <span class="keyword">const</span> <a class="code" href="classCharacter.html">Character</a> &amp;sought )</div>
<div class="line"><a name="l04744"></a><span class="lineno"> 4744</span>&#160;{</div>
<div class="line"><a name="l04745"></a><span class="lineno"> 4745</span>&#160;    <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( <span class="stringliteral">&quot;look_for_player&quot;</span>, 5_minutes, <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_wait.translated(), <span class="keyword">false</span> );</div>
<div class="line"><a name="l04746"></a><span class="lineno"> 4746</span>&#160;    <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( sought.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() );</div>
<div class="line"><a name="l04747"></a><span class="lineno"> 4747</span>&#160;    <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l04748"></a><span class="lineno"> 4748</span>&#160;    <span class="comment">// The part below is not implemented properly</span></div>
<div class="line"><a name="l04749"></a><span class="lineno"> 4749</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l04750"></a><span class="lineno"> 4750</span>&#160;<span class="comment">    if( sees( sought ) ) {</span></div>
<div class="line"><a name="l04751"></a><span class="lineno"> 4751</span>&#160;<span class="comment">        move_pause();</span></div>
<div class="line"><a name="l04752"></a><span class="lineno"> 4752</span>&#160;<span class="comment">        return;</span></div>
<div class="line"><a name="l04753"></a><span class="lineno"> 4753</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04754"></a><span class="lineno"> 4754</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l04755"></a><span class="lineno"> 4755</span>&#160;<span class="comment">    if (!path.empty()) {</span></div>
<div class="line"><a name="l04756"></a><span class="lineno"> 4756</span>&#160;<span class="comment">        const tripoint &amp;dest = path[path.size() - 1];</span></div>
<div class="line"><a name="l04757"></a><span class="lineno"> 4757</span>&#160;<span class="comment">        if( !sees( dest ) ) {</span></div>
<div class="line"><a name="l04758"></a><span class="lineno"> 4758</span>&#160;<span class="comment">            move_to_next();</span></div>
<div class="line"><a name="l04759"></a><span class="lineno"> 4759</span>&#160;<span class="comment">            return;</span></div>
<div class="line"><a name="l04760"></a><span class="lineno"> 4760</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l04761"></a><span class="lineno"> 4761</span>&#160;<span class="comment">        path.clear();</span></div>
<div class="line"><a name="l04762"></a><span class="lineno"> 4762</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04763"></a><span class="lineno"> 4763</span>&#160;<span class="comment">    std::vector&lt;point&gt; possibilities;</span></div>
<div class="line"><a name="l04764"></a><span class="lineno"> 4764</span>&#160;<span class="comment">    for (int x = 1; x &lt; MAPSIZE_X; x += 11) { // 1, 12, 23, 34</span></div>
<div class="line"><a name="l04765"></a><span class="lineno"> 4765</span>&#160;<span class="comment">        for (int y = 1; y &lt; MAPSIZE_Y; y += 11) {</span></div>
<div class="line"><a name="l04766"></a><span class="lineno"> 4766</span>&#160;<span class="comment">            if( sees( x, y ) ) {</span></div>
<div class="line"><a name="l04767"></a><span class="lineno"> 4767</span>&#160;<span class="comment">                possibilities.push_back(point(x, y));</span></div>
<div class="line"><a name="l04768"></a><span class="lineno"> 4768</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l04769"></a><span class="lineno"> 4769</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l04770"></a><span class="lineno"> 4770</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04771"></a><span class="lineno"> 4771</span>&#160;<span class="comment">    if (possibilities.empty()) { // We see all the spots we&#39;d like to check!</span></div>
<div class="line"><a name="l04772"></a><span class="lineno"> 4772</span>&#160;<span class="comment">        say(&quot;&lt;wait&gt;&quot;);</span></div>
<div class="line"><a name="l04773"></a><span class="lineno"> 4773</span>&#160;<span class="comment">        move_pause();</span></div>
<div class="line"><a name="l04774"></a><span class="lineno"> 4774</span>&#160;<span class="comment">    } else {</span></div>
<div class="line"><a name="l04775"></a><span class="lineno"> 4775</span>&#160;<span class="comment">        if (one_in(6)) {</span></div>
<div class="line"><a name="l04776"></a><span class="lineno"> 4776</span>&#160;<span class="comment">            say(&quot;&lt;wait&gt;&quot;);</span></div>
<div class="line"><a name="l04777"></a><span class="lineno"> 4777</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l04778"></a><span class="lineno"> 4778</span>&#160;<span class="comment">        update_path( tripoint( random_entry( possibilities ), posz() ) );</span></div>
<div class="line"><a name="l04779"></a><span class="lineno"> 4779</span>&#160;<span class="comment">        move_to_next();</span></div>
<div class="line"><a name="l04780"></a><span class="lineno"> 4780</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l04781"></a><span class="lineno"> 4781</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l04782"></a><span class="lineno"> 4782</span>&#160;}</div>
<div class="line"><a name="l04783"></a><span class="lineno"> 4783</span>&#160; </div>
<div class="line"><a name="l04784"></a><span class="lineno"><a class="line" href="classnpc.html#a740bf52a4bcfa3308abb1d236685bbbb"> 4784</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a740bf52a4bcfa3308abb1d236685bbbb">npc::saw_player_recently</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l04785"></a><span class="lineno"> 4785</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04786"></a><span class="lineno"> 4786</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#ac99cedf0bd0394229090e4ea85f10f2a">last_player_seen_pos</a> &amp;&amp; <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>().<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( *<a class="code" href="classnpc.html#ac99cedf0bd0394229090e4ea85f10f2a">last_player_seen_pos</a> ) &amp;&amp;</div>
<div class="line"><a name="l04787"></a><span class="lineno"> 4787</span>&#160;           <a class="code" href="classnpc.html#a5fff562624c8fe72f1f316b554500398">last_seen_player_turn</a> &gt; 0;</div>
<div class="line"><a name="l04788"></a><span class="lineno"> 4788</span>&#160;}</div>
<div class="line"><a name="l04789"></a><span class="lineno"> 4789</span>&#160; </div>
<div class="line"><a name="l04790"></a><span class="lineno"><a class="line" href="classnpc.html#accabb5b29880e5391317d3abc7ecf569"> 4790</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#accabb5b29880e5391317d3abc7ecf569">npc::has_omt_destination</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l04791"></a><span class="lineno"> 4791</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l04792"></a><span class="lineno"> 4792</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> != <a class="code" href="classnpc.html#a3edd19f42f231bbca47391f7a99f8edd">no_goal_point</a>;</div>
<div class="line"><a name="l04793"></a><span class="lineno"> 4793</span>&#160;}</div>
<div class="line"><a name="l04794"></a><span class="lineno"> 4794</span>&#160; </div>
<div class="line"><a name="l04795"></a><span class="lineno"><a class="line" href="classnpc.html#aa04267aeaf6222fe931d48c404df22e3"> 4795</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#aa04267aeaf6222fe931d48c404df22e3">npc::reach_omt_destination</a>()</div>
<div class="line"><a name="l04796"></a><span class="lineno"> 4796</span>&#160;{</div>
<div class="line"><a name="l04797"></a><span class="lineno"> 4797</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.empty() ) {</div>
<div class="line"><a name="l04798"></a><span class="lineno"> 4798</span>&#160;        <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.clear();</div>
<div class="line"><a name="l04799"></a><span class="lineno"> 4799</span>&#160;    }</div>
<div class="line"><a name="l04800"></a><span class="lineno"> 4800</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l04801"></a><span class="lineno"> 4801</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a1e7f4298e31a5665464c5747969a667f">is_travelling</a>() ) {</div>
<div class="line"><a name="l04802"></a><span class="lineno"> 4802</span>&#160;        <a class="code" href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">guard_pos</a> = <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l04803"></a><span class="lineno"> 4803</span>&#160;        <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="classnpc.html#a3edd19f42f231bbca47391f7a99f8edd">no_goal_point</a>;</div>
<div class="line"><a name="l04804"></a><span class="lineno"> 4804</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l04805"></a><span class="lineno"> 4805</span>&#160;            <a class="code" href="classCharacter.html">Character</a> &amp;player_character = <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>();</div>
<div class="line"><a name="l04806"></a><span class="lineno"> 4806</span>&#160;            <a class="code" href="namespacetalk__function.html#accec93a5f1d44d1c33929afb1d0cbd8b">talk_function::assign_guard</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l04807"></a><span class="lineno"> 4807</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( player_character.<a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) &gt; <a class="code" href="game__constants_8h.html#a39fd8a829e3dc412646663066dbdb54c">SEEX</a> * 2 ) {</div>
<div class="line"><a name="l04808"></a><span class="lineno"> 4808</span>&#160;                <span class="keywordflow">if</span>( player_character.<a class="code" href="classCharacter.html#aa62bdeb7c69488dc798a2e1df3259d80">cache_has_item_with_flag</a>( <a class="code" href="flag_8cpp.html#a57bcb21f2d07b56b0c735991710908f7">flag_TWO_WAY_RADIO</a>, <span class="keyword">true</span> ) &amp;&amp;</div>
<div class="line"><a name="l04809"></a><span class="lineno"> 4809</span>&#160;                    <a class="code" href="classCharacter.html#aa62bdeb7c69488dc798a2e1df3259d80">cache_has_item_with_flag</a>( <a class="code" href="flag_8cpp.html#a57bcb21f2d07b56b0c735991710908f7">flag_TWO_WAY_RADIO</a>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l04810"></a><span class="lineno"> 4810</span>&#160;                    <a class="code" href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), <a class="code" href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a>, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;From your two-way radio you hear %s reporting in, &quot;</span></div>
<div class="line"><a name="l04811"></a><span class="lineno"> 4811</span>&#160;                                            <span class="stringliteral">&quot;&#39;I&#39;ve arrived, boss!&#39;&quot;</span> ), <a class="code" href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">disp_name</a>() );</div>
<div class="line"><a name="l04812"></a><span class="lineno"> 4812</span>&#160;                }</div>
<div class="line"><a name="l04813"></a><span class="lineno"> 4813</span>&#160;            }</div>
<div class="line"><a name="l04814"></a><span class="lineno"> 4814</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04815"></a><span class="lineno"> 4815</span>&#160;            <span class="comment">// for now - they just travel to a nearby place they want as a base</span></div>
<div class="line"><a name="l04816"></a><span class="lineno"> 4816</span>&#160;            <span class="comment">// and chill there indefinitely, the plan is to add systems for them to build</span></div>
<div class="line"><a name="l04817"></a><span class="lineno"> 4817</span>&#160;            <span class="comment">// up their base, then go out on looting missions,</span></div>
<div class="line"><a name="l04818"></a><span class="lineno"> 4818</span>&#160;            <span class="comment">// then return to base afterwards.</span></div>
<div class="line"><a name="l04819"></a><span class="lineno"> 4819</span>&#160;            <a class="code" href="classnpc.html#af5d3062f499ce1874b1ec47f3fa7bf4e">set_mission</a>( <a class="code" href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6da821bc9455735440f71106a3f1dcb6eb9">NPC_MISSION_GUARD</a> );</div>
<div class="line"><a name="l04820"></a><span class="lineno"> 4820</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a5d3292bcebd559a0600a365483cf18fd">needs</a>.empty() &amp;&amp; <a class="code" href="classnpc.html#a5d3292bcebd559a0600a365483cf18fd">needs</a>[0] == <a class="code" href="npc_8h.html#a7c691bfc5c3e5258642bbd0e792d9613a1278f671ef69dc7000375b16c7f9acd0">need_safety</a> ) {</div>
<div class="line"><a name="l04821"></a><span class="lineno"> 4821</span>&#160;                <span class="comment">// we found our base.</span></div>
<div class="line"><a name="l04822"></a><span class="lineno"> 4822</span>&#160;                <a class="code" href="classnpc.html#acf6304b234b508736e313750b37d6e79">base_location</a> = <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l04823"></a><span class="lineno"> 4823</span>&#160;            }</div>
<div class="line"><a name="l04824"></a><span class="lineno"> 4824</span>&#160;        }</div>
<div class="line"><a name="l04825"></a><span class="lineno"> 4825</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04826"></a><span class="lineno"> 4826</span>&#160;    }</div>
<div class="line"><a name="l04827"></a><span class="lineno"> 4827</span>&#160;    <span class="comment">// Guarding NPCs want a specific point, not just an overmap tile</span></div>
<div class="line"><a name="l04828"></a><span class="lineno"> 4828</span>&#160;    <span class="comment">// Rest stops having a goal after reaching it</span></div>
<div class="line"><a name="l04829"></a><span class="lineno"> 4829</span>&#160;    <span class="keywordflow">if</span>( !( <a class="code" href="classnpc.html#a983183e0a5423f3d339b1ef8e07e7d2d">is_guarding</a>() || <a class="code" href="classnpc.html#a24098a6c18bfd55695b6cbbdccf66517">is_patrolling</a>() ) ) {</div>
<div class="line"><a name="l04830"></a><span class="lineno"> 4830</span>&#160;        <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="classnpc.html#a3edd19f42f231bbca47391f7a99f8edd">no_goal_point</a>;</div>
<div class="line"><a name="l04831"></a><span class="lineno"> 4831</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04832"></a><span class="lineno"> 4832</span>&#160;    }</div>
<div class="line"><a name="l04833"></a><span class="lineno"> 4833</span>&#160;    <span class="comment">// If we are guarding, remember our position in case we get forcibly moved</span></div>
<div class="line"><a name="l04834"></a><span class="lineno"> 4834</span>&#160;    <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l04835"></a><span class="lineno"> 4835</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">guard_pos</a> &amp;&amp; *<a class="code" href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">guard_pos</a> == <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>() ) {</div>
<div class="line"><a name="l04836"></a><span class="lineno"> 4836</span>&#160;        <span class="comment">// This is the specific point</span></div>
<div class="line"><a name="l04837"></a><span class="lineno"> 4837</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04838"></a><span class="lineno"> 4838</span>&#160;    }</div>
<div class="line"><a name="l04839"></a><span class="lineno"> 4839</span>&#160; </div>
<div class="line"><a name="l04840"></a><span class="lineno"> 4840</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.size() &gt; 1 ) {</div>
<div class="line"><a name="l04841"></a><span class="lineno"> 4841</span>&#160;        <span class="comment">// No point recalculating the path to get home</span></div>
<div class="line"><a name="l04842"></a><span class="lineno"> 4842</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l04843"></a><span class="lineno"> 4843</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">guard_pos</a> ) {</div>
<div class="line"><a name="l04844"></a><span class="lineno"> 4844</span>&#160;        <a class="code" href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">update_path</a>( here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( *<a class="code" href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">guard_pos</a> ) );</div>
<div class="line"><a name="l04845"></a><span class="lineno"> 4845</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l04846"></a><span class="lineno"> 4846</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04847"></a><span class="lineno"> 4847</span>&#160;        <a class="code" href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">guard_pos</a> = <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l04848"></a><span class="lineno"> 4848</span>&#160;    }</div>
<div class="line"><a name="l04849"></a><span class="lineno"> 4849</span>&#160;}</div>
<div class="line"><a name="l04850"></a><span class="lineno"> 4850</span>&#160; </div>
<div class="line"><a name="l04851"></a><span class="lineno"><a class="line" href="classnpc.html#a19117ee6b30948e7c6512eadb719e1cc"> 4851</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a19117ee6b30948e7c6512eadb719e1cc">npc::set_omt_destination</a>()</div>
<div class="line"><a name="l04852"></a><span class="lineno"> 4852</span>&#160;{</div>
<div class="line"><a name="l04853"></a><span class="lineno"> 4853</span>&#160;    <span class="comment">/* TODO: Make NPCs&#39; movement more intelligent.</span></div>
<div class="line"><a name="l04854"></a><span class="lineno"> 4854</span>&#160;<span class="comment">     * Right now this function just makes them attempt to address their needs:</span></div>
<div class="line"><a name="l04855"></a><span class="lineno"> 4855</span>&#160;<span class="comment">     *  if we need ammo, go to a gun store, if we need food, go to a grocery store,</span></div>
<div class="line"><a name="l04856"></a><span class="lineno"> 4856</span>&#160;<span class="comment">     *  and if we don&#39;t have any needs, pick a random spot.</span></div>
<div class="line"><a name="l04857"></a><span class="lineno"> 4857</span>&#160;<span class="comment">     * What it SHOULD do is that, if there&#39;s time; but also look at our mission and</span></div>
<div class="line"><a name="l04858"></a><span class="lineno"> 4858</span>&#160;<span class="comment">     *  our faction to determine more meaningful actions, such as attacking a rival</span></div>
<div class="line"><a name="l04859"></a><span class="lineno"> 4859</span>&#160;<span class="comment">     *  faction&#39;s base, or meeting up with someone friendly.  NPCs should also</span></div>
<div class="line"><a name="l04860"></a><span class="lineno"> 4860</span>&#160;<span class="comment">     *  attempt to reach safety before nightfall, and possibly similar goals.</span></div>
<div class="line"><a name="l04861"></a><span class="lineno"> 4861</span>&#160;<span class="comment">     * Also, NPCs should be able to assign themselves missions like &quot;break into that</span></div>
<div class="line"><a name="l04862"></a><span class="lineno"> 4862</span>&#160;<span class="comment">     *  lab&quot; or &quot;map that river bank.&quot;</span></div>
<div class="line"><a name="l04863"></a><span class="lineno"> 4863</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l04864"></a><span class="lineno"> 4864</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab1230a6bd26c235c1732e7e5dce365c2">is_stationary</a>( <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l04865"></a><span class="lineno"> 4865</span>&#160;        <a class="code" href="classnpc.html#a276de4730030fc73745440817c9a13aa">guard_current_pos</a>();</div>
<div class="line"><a name="l04866"></a><span class="lineno"> 4866</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04867"></a><span class="lineno"> 4867</span>&#160;    }</div>
<div class="line"><a name="l04868"></a><span class="lineno"> 4868</span>&#160; </div>
<div class="line"><a name="l04869"></a><span class="lineno"> 4869</span>&#160;    <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_omt</a> surface_omt_loc = <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l04870"></a><span class="lineno"> 4870</span>&#160;    <span class="comment">// We need that, otherwise find_closest won&#39;t work properly</span></div>
<div class="line"><a name="l04871"></a><span class="lineno"> 4871</span>&#160;    surface_omt_loc.<a class="code" href="classcoords_1_1coord__point__mut.html#aa94b8bd33e85ce94a3634e6e27ab0cdd">z</a>() = 0;</div>
<div class="line"><a name="l04872"></a><span class="lineno"> 4872</span>&#160; </div>
<div class="line"><a name="l04873"></a><span class="lineno"> 4873</span>&#160;    <a class="code" href="classnpc.html#a770a2307ec384a2986e7ca9769cdd2e3">decide_needs</a>();</div>
<div class="line"><a name="l04874"></a><span class="lineno"> 4874</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a5d3292bcebd559a0600a365483cf18fd">needs</a>.empty() ) { <span class="comment">// We don&#39;t need anything in particular.</span></div>
<div class="line"><a name="l04875"></a><span class="lineno"> 4875</span>&#160;        <a class="code" href="classnpc.html#a5d3292bcebd559a0600a365483cf18fd">needs</a>.push_back( <a class="code" href="npc_8h.html#a7c691bfc5c3e5258642bbd0e792d9613abc7c0212ffcf3e4900d0484af6c24a4b">need_none</a> );</div>
<div class="line"><a name="l04876"></a><span class="lineno"> 4876</span>&#160; </div>
<div class="line"><a name="l04877"></a><span class="lineno"> 4877</span>&#160;        <span class="comment">// also, don&#39;t bother looking if the CITY_SIZE is 0, just go somewhere at random</span></div>
<div class="line"><a name="l04878"></a><span class="lineno"> 4878</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> city_size = get_option&lt;int&gt;( <span class="stringliteral">&quot;CITY_SIZE&quot;</span> );</div>
<div class="line"><a name="l04879"></a><span class="lineno"> 4879</span>&#160;        <span class="keywordflow">if</span>( city_size == 0 ) {</div>
<div class="line"><a name="l04880"></a><span class="lineno"> 4880</span>&#160;            <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = surface_omt_loc + <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -90, 90 ), <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -90, 90 ) );</div>
<div class="line"><a name="l04881"></a><span class="lineno"> 4881</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04882"></a><span class="lineno"> 4882</span>&#160;        }</div>
<div class="line"><a name="l04883"></a><span class="lineno"> 4883</span>&#160;    }</div>
<div class="line"><a name="l04884"></a><span class="lineno"> 4884</span>&#160; </div>
<div class="line"><a name="l04885"></a><span class="lineno"> 4885</span>&#160;    std::string dest_type;</div>
<div class="line"><a name="l04886"></a><span class="lineno"> 4886</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="npc_8h.html#a7c691bfc5c3e5258642bbd0e792d9613">npc_need</a> &amp;fulfill : <a class="code" href="classnpc.html#a5d3292bcebd559a0600a365483cf18fd">needs</a> ) {</div>
<div class="line"><a name="l04887"></a><span class="lineno"> 4887</span>&#160;        <span class="keyword">auto</span> cache_iter = <a class="code" href="classnpc.html#ac2377dbbd70201312a89fa0f1c9ac5df">goal_cache</a>.find( fulfill );</div>
<div class="line"><a name="l04888"></a><span class="lineno"> 4888</span>&#160;        <span class="keywordflow">if</span>( cache_iter != <a class="code" href="classnpc.html#ac2377dbbd70201312a89fa0f1c9ac5df">goal_cache</a>.end() &amp;&amp; cache_iter-&gt;second.omt_loc == surface_omt_loc ) {</div>
<div class="line"><a name="l04889"></a><span class="lineno"> 4889</span>&#160;            <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = cache_iter-&gt;second.goal;</div>
<div class="line"><a name="l04890"></a><span class="lineno"> 4890</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04891"></a><span class="lineno"> 4891</span>&#160;            <span class="comment">// look for the closest occurrence of any of that locations terrain types</span></div>
<div class="line"><a name="l04892"></a><span class="lineno"> 4892</span>&#160;            <a class="code" href="structomt__find__params.html">omt_find_params</a> find_params;</div>
<div class="line"><a name="l04893"></a><span class="lineno"> 4893</span>&#160;            <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">oter_type_str_id</a> &amp;elem : <a class="code" href="classnpc.html#ab05ed37f03796e73ab55ee322a5f9f5e">get_location_for</a>( fulfill )-&gt;get_all_terrains() ) {</div>
<div class="line"><a name="l04894"></a><span class="lineno"> 4894</span>&#160;                std::pair&lt;std::string, ot_match_type&gt; temp_pair;</div>
<div class="line"><a name="l04895"></a><span class="lineno"> 4895</span>&#160;                temp_pair.first = elem.str();</div>
<div class="line"><a name="l04896"></a><span class="lineno"> 4896</span>&#160;                temp_pair.second = <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">ot_match_type::type</a>;</div>
<div class="line"><a name="l04897"></a><span class="lineno"> 4897</span>&#160;                find_params.<a class="code" href="structomt__find__params.html#ac47a765ba6d46df98d615b15998db87c">types</a>.push_back( temp_pair );</div>
<div class="line"><a name="l04898"></a><span class="lineno"> 4898</span>&#160;            }</div>
<div class="line"><a name="l04899"></a><span class="lineno"> 4899</span>&#160;            <span class="comment">// note: no shuffle of `find_params.types` is needed, because `find_closest`</span></div>
<div class="line"><a name="l04900"></a><span class="lineno"> 4900</span>&#160;            <span class="comment">// disregards `types` order anyway, and already returns random result among</span></div>
<div class="line"><a name="l04901"></a><span class="lineno"> 4901</span>&#160;            <span class="comment">// those having equal minimal distance</span></div>
<div class="line"><a name="l04902"></a><span class="lineno"> 4902</span>&#160;            find_params.<a class="code" href="structomt__find__params.html#a06e2c0706d595a5bc540e372a3b254f7">search_range</a> = 75;</div>
<div class="line"><a name="l04903"></a><span class="lineno"> 4903</span>&#160;            find_params.<a class="code" href="structomt__find__params.html#a09fac42ef79884ebd50509d739867e1b">existing_only</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l04904"></a><span class="lineno"> 4904</span>&#160;            <span class="comment">// force finding goal on the same zlevel (for random spawned NPCs that&#39;s z=0), otherwise</span></div>
<div class="line"><a name="l04905"></a><span class="lineno"> 4905</span>&#160;            <span class="comment">// we may target unreachable overmap tiles (no ramp up/down) which makes</span></div>
<div class="line"><a name="l04906"></a><span class="lineno"> 4906</span>&#160;            <span class="comment">// overmap_buffer.get_travel_path waste a lot of time</span></div>
<div class="line"><a name="l04907"></a><span class="lineno"> 4907</span>&#160;            find_params.<a class="code" href="structomt__find__params.html#af5229b00ad90cd2d88aadeb09ba11291">min_z</a> = surface_omt_loc.<a class="code" href="classcoords_1_1coord__point__mut.html#aa94b8bd33e85ce94a3634e6e27ab0cdd">z</a>();</div>
<div class="line"><a name="l04908"></a><span class="lineno"> 4908</span>&#160;            find_params.<a class="code" href="structomt__find__params.html#a45a981bb3a1c05d30e897c156d908699">max_z</a> = surface_omt_loc.<a class="code" href="classcoords_1_1coord__point__mut.html#aa94b8bd33e85ce94a3634e6e27ab0cdd">z</a>();</div>
<div class="line"><a name="l04909"></a><span class="lineno"> 4909</span>&#160;            <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#a60309f685adc56b0b7e5f69206e3cff4">find_closest</a>( surface_omt_loc, find_params );</div>
<div class="line"><a name="l04910"></a><span class="lineno"> 4910</span>&#160;            <a class="code" href="structnpc__need__goal__cache.html">npc_need_goal_cache</a> &amp;cache = <a class="code" href="classnpc.html#ac2377dbbd70201312a89fa0f1c9ac5df">goal_cache</a>[fulfill];</div>
<div class="line"><a name="l04911"></a><span class="lineno"> 4911</span>&#160;            cache.<a class="code" href="structnpc__need__goal__cache.html#a685453685e2edc9b7fe672969e2198ea">goal</a> = <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a>;</div>
<div class="line"><a name="l04912"></a><span class="lineno"> 4912</span>&#160;            cache.<a class="code" href="structnpc__need__goal__cache.html#aa794b7c08c2b9f020b3f25e0d8ec0102">omt_loc</a> = surface_omt_loc;</div>
<div class="line"><a name="l04913"></a><span class="lineno"> 4913</span>&#160;        }</div>
<div class="line"><a name="l04914"></a><span class="lineno"> 4914</span>&#160;        <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.clear();</div>
<div class="line"><a name="l04915"></a><span class="lineno"> 4915</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> != <a class="code" href="classovermap.html#aa0999e49bed45fc1eb5e30498b8934f4">overmap::invalid_tripoint</a> ) {</div>
<div class="line"><a name="l04916"></a><span class="lineno"> 4916</span>&#160;            <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a> = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#a5b59e43dc5c0e4f7bce3501dde28c20a">get_travel_path</a>( surface_omt_loc, <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a>, <a class="code" href="structovermap__path__params.html#a64dc55bc7e0784c689c0c97459131ac7">overmap_path_params::for_npc</a>() );</div>
<div class="line"><a name="l04917"></a><span class="lineno"> 4917</span>&#160;        }</div>
<div class="line"><a name="l04918"></a><span class="lineno"> 4918</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.empty() ) {</div>
<div class="line"><a name="l04919"></a><span class="lineno"> 4919</span>&#160;            dest_type = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#aa9fbf966291f6b82de9c540262324aba">ter</a>( <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> )-&gt;<a class="code" href="structoter__t.html#ab1638475c8650985ec100f0bc7fcafe7">get_type_id</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>();</div>
<div class="line"><a name="l04920"></a><span class="lineno"> 4920</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l04921"></a><span class="lineno"> 4921</span>&#160;        }</div>
<div class="line"><a name="l04922"></a><span class="lineno"> 4922</span>&#160;    }</div>
<div class="line"><a name="l04923"></a><span class="lineno"> 4923</span>&#160; </div>
<div class="line"><a name="l04924"></a><span class="lineno"> 4924</span>&#160;    <span class="comment">// couldn&#39;t find any places to go, so go somewhere.</span></div>
<div class="line"><a name="l04925"></a><span class="lineno"> 4925</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> == <a class="code" href="classovermap.html#aa0999e49bed45fc1eb5e30498b8934f4">overmap::invalid_tripoint</a> || <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.empty() ) {</div>
<div class="line"><a name="l04926"></a><span class="lineno"> 4926</span>&#160;        <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = surface_omt_loc + <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -90, 90 ), <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -90, 90 ) );</div>
<div class="line"><a name="l04927"></a><span class="lineno"> 4927</span>&#160;        <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a> = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#a5b59e43dc5c0e4f7bce3501dde28c20a">get_travel_path</a>( surface_omt_loc, <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a>, <a class="code" href="structovermap__path__params.html#a64dc55bc7e0784c689c0c97459131ac7">overmap_path_params::for_npc</a>() );</div>
<div class="line"><a name="l04928"></a><span class="lineno"> 4928</span>&#160;        <span class="comment">// try one more time</span></div>
<div class="line"><a name="l04929"></a><span class="lineno"> 4929</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.empty() ) {</div>
<div class="line"><a name="l04930"></a><span class="lineno"> 4930</span>&#160;            <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = surface_omt_loc + <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -90, 90 ), <a class="code" href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a>( -90, 90 ) );</div>
<div class="line"><a name="l04931"></a><span class="lineno"> 4931</span>&#160;            <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a> = <a class="code" href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a>.<a class="code" href="classovermapbuffer.html#a5b59e43dc5c0e4f7bce3501dde28c20a">get_travel_path</a>( surface_omt_loc, <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a>, <a class="code" href="structovermap__path__params.html#a64dc55bc7e0784c689c0c97459131ac7">overmap_path_params::for_npc</a>() );</div>
<div class="line"><a name="l04932"></a><span class="lineno"> 4932</span>&#160;        }</div>
<div class="line"><a name="l04933"></a><span class="lineno"> 4933</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.empty() ) {</div>
<div class="line"><a name="l04934"></a><span class="lineno"> 4934</span>&#160;            <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="classnpc.html#a3edd19f42f231bbca47391f7a99f8edd">no_goal_point</a>;</div>
<div class="line"><a name="l04935"></a><span class="lineno"> 4935</span>&#160;        }</div>
<div class="line"><a name="l04936"></a><span class="lineno"> 4936</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04937"></a><span class="lineno"> 4937</span>&#160;    }</div>
<div class="line"><a name="l04938"></a><span class="lineno"> 4938</span>&#160; </div>
<div class="line"><a name="l04939"></a><span class="lineno"> 4939</span>&#160;    <a class="code" href="debug_8cpp.html#a240782b16593c6bd607c64787c62da0e">DebugLog</a>( <a class="code" href="debug_8h.html#ab658e6d84759440dbf3c890446075395ab51d2329abb542af139bd358206609ba">D_INFO</a>, <a class="code" href="debug_8h.html#afa45cf12d72d4226196a7d03c54ad7d3adfa3ea5b834aebc2a8e4e83b7d33db14">DC_ALL</a> ) &lt;&lt; <span class="stringliteral">&quot;npc::set_omt_destination - new goal for NPC [&quot;</span> &lt;&lt; <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>() &lt;&lt;</div>
<div class="line"><a name="l04940"></a><span class="lineno"> 4940</span>&#160;                               <span class="stringliteral">&quot;] with [&quot;</span> &lt;&lt; <a class="code" href="classnpc.html#a0480c687e6127de6a1c87b060804a34f">get_need_str_id</a>( <a class="code" href="classnpc.html#a5d3292bcebd559a0600a365483cf18fd">needs</a>.front() ) &lt;&lt;</div>
<div class="line"><a name="l04941"></a><span class="lineno"> 4941</span>&#160;                               <span class="stringliteral">&quot;] is [&quot;</span> &lt;&lt; dest_type &lt;&lt;</div>
<div class="line"><a name="l04942"></a><span class="lineno"> 4942</span>&#160;                               <span class="stringliteral">&quot;] in &quot;</span> &lt;&lt; <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a>.<a class="code" href="classcoords_1_1coord__point__base.html#abadb043d4129616ea20396a03e046301">to_string</a>() &lt;&lt; <span class="stringliteral">&quot;.&quot;</span>;</div>
<div class="line"><a name="l04943"></a><span class="lineno"> 4943</span>&#160;}</div>
<div class="line"><a name="l04944"></a><span class="lineno"> 4944</span>&#160; </div>
<div class="line"><a name="l04945"></a><span class="lineno"><a class="line" href="classnpc.html#a95d1b3db80157a00032df4c4918606f0"> 4945</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a95d1b3db80157a00032df4c4918606f0">npc::go_to_omt_destination</a>()</div>
<div class="line"><a name="l04946"></a><span class="lineno"> 4946</span>&#160;{</div>
<div class="line"><a name="l04947"></a><span class="lineno"> 4947</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l04948"></a><span class="lineno"> 4948</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> ) {</div>
<div class="line"><a name="l04949"></a><span class="lineno"> 4949</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>() == *<a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> ) {</div>
<div class="line"><a name="l04950"></a><span class="lineno"> 4950</span>&#160;            <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.clear();</div>
<div class="line"><a name="l04951"></a><span class="lineno"> 4951</span>&#160;            <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">guard_pos</a> = std::nullopt;</div>
<div class="line"><a name="l04952"></a><span class="lineno"> 4952</span>&#160;            <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l04953"></a><span class="lineno"> 4953</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04954"></a><span class="lineno"> 4954</span>&#160;        }</div>
<div class="line"><a name="l04955"></a><span class="lineno"> 4955</span>&#160;    }</div>
<div class="line"><a name="l04956"></a><span class="lineno"> 4956</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> == <a class="code" href="classnpc.html#a3edd19f42f231bbca47391f7a99f8edd">no_goal_point</a> || <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.empty() ) {</div>
<div class="line"><a name="l04957"></a><span class="lineno"> 4957</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;npc::go_to_destination with no goal&quot;</span> );</div>
<div class="line"><a name="l04958"></a><span class="lineno"> 4958</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l04959"></a><span class="lineno"> 4959</span>&#160;        <a class="code" href="classnpc.html#aa04267aeaf6222fe931d48c404df22e3">reach_omt_destination</a>();</div>
<div class="line"><a name="l04960"></a><span class="lineno"> 4960</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04961"></a><span class="lineno"> 4961</span>&#160;    }</div>
<div class="line"><a name="l04962"></a><span class="lineno"> 4962</span>&#160;    <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_omt</a> omt_pos = <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l04963"></a><span class="lineno"> 4963</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> == omt_pos ) {</div>
<div class="line"><a name="l04964"></a><span class="lineno"> 4964</span>&#160;        <span class="comment">// We&#39;re at our desired map square!  Pause to keep the NPC infinite loop counter happy</span></div>
<div class="line"><a name="l04965"></a><span class="lineno"> 4965</span>&#160;        <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l04966"></a><span class="lineno"> 4966</span>&#160;        <a class="code" href="classnpc.html#aa04267aeaf6222fe931d48c404df22e3">reach_omt_destination</a>();</div>
<div class="line"><a name="l04967"></a><span class="lineno"> 4967</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04968"></a><span class="lineno"> 4968</span>&#160;    }</div>
<div class="line"><a name="l04969"></a><span class="lineno"> 4969</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l04970"></a><span class="lineno"> 4970</span>&#160;        <span class="comment">// we already have a path, just use that until we can&#39;t.</span></div>
<div class="line"><a name="l04971"></a><span class="lineno"> 4971</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l04972"></a><span class="lineno"> 4972</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04973"></a><span class="lineno"> 4973</span>&#160;    }</div>
<div class="line"><a name="l04974"></a><span class="lineno"> 4974</span>&#160;    <span class="comment">// get the next path point</span></div>
<div class="line"><a name="l04975"></a><span class="lineno"> 4975</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.back() == omt_pos ) {</div>
<div class="line"><a name="l04976"></a><span class="lineno"> 4976</span>&#160;        <span class="comment">// this should be the square we are at.</span></div>
<div class="line"><a name="l04977"></a><span class="lineno"> 4977</span>&#160;        <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.pop_back();</div>
<div class="line"><a name="l04978"></a><span class="lineno"> 4978</span>&#160;    }</div>
<div class="line"><a name="l04979"></a><span class="lineno"> 4979</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.empty() ) {</div>
<div class="line"><a name="l04980"></a><span class="lineno"> 4980</span>&#160;        <a class="code" href="classcoords_1_1coord__point.html">point_rel_omt</a> omt_diff = <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.back().xy() - omt_pos.<a class="code" href="classcoords_1_1coord__point.html#a7b5804160d1d0e69a9f2fba098bea723">xy</a>();</div>
<div class="line"><a name="l04981"></a><span class="lineno"> 4981</span>&#160;        <span class="keywordflow">if</span>( omt_diff.<a class="code" href="classcoords_1_1coord__point__mut.html#a0fa1f1039d6d6f5b5f744a5d3d039a02">x</a>() &gt; 3 || omt_diff.<a class="code" href="classcoords_1_1coord__point__mut.html#a0fa1f1039d6d6f5b5f744a5d3d039a02">x</a>() &lt; -3 || omt_diff.<a class="code" href="classcoords_1_1coord__point__mut.html#a0e6b02267065e16149a37d98991f653e">y</a>() &gt; 3 || omt_diff.<a class="code" href="classcoords_1_1coord__point__mut.html#a0e6b02267065e16149a37d98991f653e">y</a>() &lt; -3 ) {</div>
<div class="line"><a name="l04982"></a><span class="lineno"> 4982</span>&#160;            <span class="comment">// we&#39;ve gone wandering somehow, reset destination.</span></div>
<div class="line"><a name="l04983"></a><span class="lineno"> 4983</span>&#160;            <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() ) {</div>
<div class="line"><a name="l04984"></a><span class="lineno"> 4984</span>&#160;                <a class="code" href="classnpc.html#a19117ee6b30948e7c6512eadb719e1cc">set_omt_destination</a>();</div>
<div class="line"><a name="l04985"></a><span class="lineno"> 4985</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l04986"></a><span class="lineno"> 4986</span>&#160;                <a class="code" href="namespacetalk__function.html#accec93a5f1d44d1c33929afb1d0cbd8b">talk_function::assign_guard</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l04987"></a><span class="lineno"> 4987</span>&#160;            }</div>
<div class="line"><a name="l04988"></a><span class="lineno"> 4988</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l04989"></a><span class="lineno"> 4989</span>&#160;        }</div>
<div class="line"><a name="l04990"></a><span class="lineno"> 4990</span>&#160;    }</div>
<div class="line"><a name="l04991"></a><span class="lineno"> 4991</span>&#160;    <span class="comment">// TODO: fix point types</span></div>
<div class="line"><a name="l04992"></a><span class="lineno"> 4992</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> sm_tri =</div>
<div class="line"><a name="l04993"></a><span class="lineno"> 4993</span>&#160;        here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( project_to&lt;coords::ms&gt;( <a class="code" href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">omt_path</a>.back() ).raw() );</div>
<div class="line"><a name="l04994"></a><span class="lineno"> 4994</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> centre_sub = sm_tri + <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">point</a>( <a class="code" href="game__constants_8h.html#a39fd8a829e3dc412646663066dbdb54c">SEEX</a>, <a class="code" href="game__constants_8h.html#a4cfa35de359af17f7bc6c2a424339eb5">SEEY</a> );</div>
<div class="line"><a name="l04995"></a><span class="lineno"> 4995</span>&#160;    <span class="keywordflow">if</span>( !here.<a class="code" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( centre_sub ) ) {</div>
<div class="line"><a name="l04996"></a><span class="lineno"> 4996</span>&#160;        <span class="keyword">auto</span> candidates = here.<a class="code" href="classmap.html#a4f5f812d7e89a998429958573a4c340f">points_in_radius</a>( centre_sub, 2 );</div>
<div class="line"><a name="l04997"></a><span class="lineno"> 4997</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;elem : candidates ) {</div>
<div class="line"><a name="l04998"></a><span class="lineno"> 4998</span>&#160;            <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">passable</a>( elem ) ) {</div>
<div class="line"><a name="l04999"></a><span class="lineno"> 4999</span>&#160;                centre_sub = elem;</div>
<div class="line"><a name="l05000"></a><span class="lineno"> 5000</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05001"></a><span class="lineno"> 5001</span>&#160;            }</div>
<div class="line"><a name="l05002"></a><span class="lineno"> 5002</span>&#160;        }</div>
<div class="line"><a name="l05003"></a><span class="lineno"> 5003</span>&#160;    }</div>
<div class="line"><a name="l05004"></a><span class="lineno"> 5004</span>&#160;    <a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a> = here.<a class="code" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">route</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), centre_sub, <a class="code" href="classnpc.html#ab117ea356d49855e02448774397d23b9">get_pathfinding_settings</a>(), <a class="code" href="classnpc.html#acb437607e20194f9d5b94c95b860b744">get_path_avoid</a>() );</div>
<div class="line"><a name="l05005"></a><span class="lineno"> 5005</span>&#160;    <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, <span class="stringliteral">&quot;%s going %s-&gt;%s&quot;</span>, <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), omt_pos.<a class="code" href="classcoords_1_1coord__point__base.html#adffa74cccb8c246a8b12eeca632b1642">to_string_writable</a>(),</div>
<div class="line"><a name="l05006"></a><span class="lineno"> 5006</span>&#160;                   <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a>.<a class="code" href="classcoords_1_1coord__point__base.html#adffa74cccb8c246a8b12eeca632b1642">to_string_writable</a>() );</div>
<div class="line"><a name="l05007"></a><span class="lineno"> 5007</span>&#160; </div>
<div class="line"><a name="l05008"></a><span class="lineno"> 5008</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">path</a>.empty() ) {</div>
<div class="line"><a name="l05009"></a><span class="lineno"> 5009</span>&#160;        <a class="code" href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">move_to_next</a>();</div>
<div class="line"><a name="l05010"></a><span class="lineno"> 5010</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05011"></a><span class="lineno"> 5011</span>&#160;    }</div>
<div class="line"><a name="l05012"></a><span class="lineno"> 5012</span>&#160;    <a class="code" href="classnpc.html#aa66ea634e85fda5b9964025922499524">move_pause</a>();</div>
<div class="line"><a name="l05013"></a><span class="lineno"> 5013</span>&#160;}</div>
<div class="line"><a name="l05014"></a><span class="lineno"> 5014</span>&#160; </div>
<div class="line"><a name="l05015"></a><span class="lineno"><a class="line" href="classnpc.html#a276de4730030fc73745440817c9a13aa"> 5015</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a276de4730030fc73745440817c9a13aa">npc::guard_current_pos</a>()</div>
<div class="line"><a name="l05016"></a><span class="lineno"> 5016</span>&#160;{</div>
<div class="line"><a name="l05017"></a><span class="lineno"> 5017</span>&#160;    <a class="code" href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">goal</a> = <a class="code" href="classCreature.html#a14ecbd8f044628463354090421a805b4">global_omt_location</a>();</div>
<div class="line"><a name="l05018"></a><span class="lineno"> 5018</span>&#160;    <a class="code" href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">guard_pos</a> = <a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l05019"></a><span class="lineno"> 5019</span>&#160;}</div>
<div class="line"><a name="l05020"></a><span class="lineno"> 5020</span>&#160; </div>
<div class="line"><a name="l05021"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#a8d1c3c3d8e1c9281ac6f0a333487c414"> 5021</a></span>&#160;std::string <a class="code" href="npcmove_8cpp.html#a8d1c3c3d8e1c9281ac6f0a333487c414">npc_action_name</a>( <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> )</div>
<div class="line"><a name="l05022"></a><span class="lineno"> 5022</span>&#160;{</div>
<div class="line"><a name="l05023"></a><span class="lineno"> 5023</span>&#160;    <span class="keywordflow">switch</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) {</div>
<div class="line"><a name="l05024"></a><span class="lineno"> 5024</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a>:</div>
<div class="line"><a name="l05025"></a><span class="lineno"> 5025</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Undecided&quot;</span>;</div>
<div class="line"><a name="l05026"></a><span class="lineno"> 5026</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a>:</div>
<div class="line"><a name="l05027"></a><span class="lineno"> 5027</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Pause&quot;</span>;</div>
<div class="line"><a name="l05028"></a><span class="lineno"> 5028</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a058b148b092d45266de475aa2281477b">npc_worker_downtime</a>:</div>
<div class="line"><a name="l05029"></a><span class="lineno"> 5029</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Relaxing&quot;</span>;</div>
<div class="line"><a name="l05030"></a><span class="lineno"> 5030</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a34e61bbbaf8abebf63326320fec60c53">npc_reload</a>:</div>
<div class="line"><a name="l05031"></a><span class="lineno"> 5031</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Reload&quot;</span>;</div>
<div class="line"><a name="l05032"></a><span class="lineno"> 5032</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5">npc_investigate_sound</a>:</div>
<div class="line"><a name="l05033"></a><span class="lineno"> 5033</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Investigate sound&quot;</span>;</div>
<div class="line"><a name="l05034"></a><span class="lineno"> 5034</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">npc_return_to_guard_pos</a>:</div>
<div class="line"><a name="l05035"></a><span class="lineno"> 5035</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Returning to guard position&quot;</span>;</div>
<div class="line"><a name="l05036"></a><span class="lineno"> 5036</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1c5faa755f1cd29189d4e164dd3b1411">npc_sleep</a>:</div>
<div class="line"><a name="l05037"></a><span class="lineno"> 5037</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Sleep&quot;</span>;</div>
<div class="line"><a name="l05038"></a><span class="lineno"> 5038</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a82965fc7cec7bafbe6a94100f689895d">npc_pickup</a>:</div>
<div class="line"><a name="l05039"></a><span class="lineno"> 5039</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Pick up items&quot;</span>;</div>
<div class="line"><a name="l05040"></a><span class="lineno"> 5040</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af8a5950d177e7da5bb22362a7e8949c1">npc_heal</a>:</div>
<div class="line"><a name="l05041"></a><span class="lineno"> 5041</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Heal self&quot;</span>;</div>
<div class="line"><a name="l05042"></a><span class="lineno"> 5042</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ab3ea6db7edf0f1efbf6082d8b7307d15">npc_use_painkiller</a>:</div>
<div class="line"><a name="l05043"></a><span class="lineno"> 5043</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Use painkillers&quot;</span>;</div>
<div class="line"><a name="l05044"></a><span class="lineno"> 5044</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a4c50de30d1fe74ad9f2f7146ef81ede1">npc_drop_items</a>:</div>
<div class="line"><a name="l05045"></a><span class="lineno"> 5045</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Drop items&quot;</span>;</div>
<div class="line"><a name="l05046"></a><span class="lineno"> 5046</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">npc_flee</a>:</div>
<div class="line"><a name="l05047"></a><span class="lineno"> 5047</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Flee&quot;</span>;</div>
<div class="line"><a name="l05048"></a><span class="lineno"> 5048</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1b0dd2cfef9c4f9a367079199c7c80af">npc_melee</a>:</div>
<div class="line"><a name="l05049"></a><span class="lineno"> 5049</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Melee&quot;</span>;</div>
<div class="line"><a name="l05050"></a><span class="lineno"> 5050</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3a4fe08fa3d733f7956e1c5692e1a3da">npc_reach_attack</a>:</div>
<div class="line"><a name="l05051"></a><span class="lineno"> 5051</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Reach attack&quot;</span>;</div>
<div class="line"><a name="l05052"></a><span class="lineno"> 5052</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ad178d28c383136b41476fe0df9c71306">npc_aim</a>:</div>
<div class="line"><a name="l05053"></a><span class="lineno"> 5053</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Aim&quot;</span>;</div>
<div class="line"><a name="l05054"></a><span class="lineno"> 5054</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a48cceb4e0db33f4525fee6c3f7c7924d">npc_shoot</a>:</div>
<div class="line"><a name="l05055"></a><span class="lineno"> 5055</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Shoot&quot;</span>;</div>
<div class="line"><a name="l05056"></a><span class="lineno"> 5056</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a55a7ea511d5d1d406ea6edfb96a65c56">npc_look_for_player</a>:</div>
<div class="line"><a name="l05057"></a><span class="lineno"> 5057</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Look for player&quot;</span>;</div>
<div class="line"><a name="l05058"></a><span class="lineno"> 5058</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9c46449f66af0d972656ec500f4d39ba">npc_heal_player</a>:</div>
<div class="line"><a name="l05059"></a><span class="lineno"> 5059</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Heal player or ally&quot;</span>;</div>
<div class="line"><a name="l05060"></a><span class="lineno"> 5060</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a>:</div>
<div class="line"><a name="l05061"></a><span class="lineno"> 5061</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Follow player&quot;</span>;</div>
<div class="line"><a name="l05062"></a><span class="lineno"> 5062</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">npc_follow_embarked</a>:</div>
<div class="line"><a name="l05063"></a><span class="lineno"> 5063</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Follow player (embarked)&quot;</span>;</div>
<div class="line"><a name="l05064"></a><span class="lineno"> 5064</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a30c4f16c4a66425e87f3e462c987d762">npc_talk_to_player</a>:</div>
<div class="line"><a name="l05065"></a><span class="lineno"> 5065</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Talk to player&quot;</span>;</div>
<div class="line"><a name="l05066"></a><span class="lineno"> 5066</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a85155639ee95331052d51900b16fdbb1">npc_mug_player</a>:</div>
<div class="line"><a name="l05067"></a><span class="lineno"> 5067</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Mug player&quot;</span>;</div>
<div class="line"><a name="l05068"></a><span class="lineno"> 5068</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">npc_goto_destination</a>:</div>
<div class="line"><a name="l05069"></a><span class="lineno"> 5069</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Go to destination&quot;</span>;</div>
<div class="line"><a name="l05070"></a><span class="lineno"> 5070</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6afb1482ed3f94beb6473c2f9b3b8189">npc_avoid_friendly_fire</a>:</div>
<div class="line"><a name="l05071"></a><span class="lineno"> 5071</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Avoid friendly fire&quot;</span>;</div>
<div class="line"><a name="l05072"></a><span class="lineno"> 5072</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6fd72bcdd3524d15de954838ceb03e5a">npc_escape_explosion</a>:</div>
<div class="line"><a name="l05073"></a><span class="lineno"> 5073</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Escape explosion&quot;</span>;</div>
<div class="line"><a name="l05074"></a><span class="lineno"> 5074</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a>:</div>
<div class="line"><a name="l05075"></a><span class="lineno"> 5075</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Performing activity&quot;</span>;</div>
<div class="line"><a name="l05076"></a><span class="lineno"> 5076</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a>:</div>
<div class="line"><a name="l05077"></a><span class="lineno"> 5077</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Do nothing&quot;</span>;</div>
<div class="line"><a name="l05078"></a><span class="lineno"> 5078</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ae7395a29bb423bfddfba92378abe9a27">npc_do_attack</a>:</div>
<div class="line"><a name="l05079"></a><span class="lineno"> 5079</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Attack&quot;</span>;</div>
<div class="line"><a name="l05080"></a><span class="lineno"> 5080</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a320566dc8704d228e05b9fa1191726d8">npc_goto_to_this_pos</a>:</div>
<div class="line"><a name="l05081"></a><span class="lineno"> 5081</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Go to position&quot;</span>;</div>
<div class="line"><a name="l05082"></a><span class="lineno"> 5082</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a06ebb628884ecce6136bb9a6040bab9b">num_npc_actions</a>:</div>
<div class="line"><a name="l05083"></a><span class="lineno"> 5083</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unnamed action&quot;</span>;</div>
<div class="line"><a name="l05084"></a><span class="lineno"> 5084</span>&#160;    }</div>
<div class="line"><a name="l05085"></a><span class="lineno"> 5085</span>&#160; </div>
<div class="line"><a name="l05086"></a><span class="lineno"> 5086</span>&#160;    <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unnamed action&quot;</span>;</div>
<div class="line"><a name="l05087"></a><span class="lineno"> 5087</span>&#160;}</div>
<div class="line"><a name="l05088"></a><span class="lineno"> 5088</span>&#160; </div>
<div class="line"><a name="l05089"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609"> 5089</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609">print_action</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *prepend, <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a> <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> )</div>
<div class="line"><a name="l05090"></a><span class="lineno"> 5090</span>&#160;{</div>
<div class="line"><a name="l05091"></a><span class="lineno"> 5091</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> != <a class="code" href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a> ) {</div>
<div class="line"><a name="l05092"></a><span class="lineno"> 5092</span>&#160;        <a class="code" href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a>( <a class="code" href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a>, prepend, <a class="code" href="npcmove_8cpp.html#a8d1c3c3d8e1c9281ac6f0a333487c414">npc_action_name</a>( <a class="code" href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a> ) );</div>
<div class="line"><a name="l05093"></a><span class="lineno"> 5093</span>&#160;    }</div>
<div class="line"><a name="l05094"></a><span class="lineno"> 5094</span>&#160;}</div>
<div class="line"><a name="l05095"></a><span class="lineno"> 5095</span>&#160; </div>
<div class="line"><a name="l05096"></a><span class="lineno"><a class="line" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5"> 5096</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> *<a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">npc::current_target</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l05097"></a><span class="lineno"> 5097</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l05098"></a><span class="lineno"> 5098</span>&#160;    <span class="comment">// TODO: Arguably we should return a shared_ptr to ensure that the returned</span></div>
<div class="line"><a name="l05099"></a><span class="lineno"> 5099</span>&#160;    <span class="comment">// object stays alive while the caller uses it.  Not doing that for now.</span></div>
<div class="line"><a name="l05100"></a><span class="lineno"> 5100</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">target</a>.lock().get();</div>
<div class="line"><a name="l05101"></a><span class="lineno"> 5101</span>&#160;}</div>
<div class="line"><a name="l05102"></a><span class="lineno"> 5102</span>&#160; </div>
<div class="line"><a name="l05103"></a><span class="lineno"> 5103</span>&#160;<span class="comment">// NOLINTNEXTLINE(readability-make-member-function-const)</span></div>
<div class="line"><a name="l05104"></a><span class="lineno"><a class="line" href="classnpc.html#a56e1a5f5d72b510392f51617720bcc7e"> 5104</a></span>&#160;<a class="code" href="classCreature.html">Creature</a> *<a class="code" href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">npc::current_target</a>()</div>
<div class="line"><a name="l05105"></a><span class="lineno"> 5105</span>&#160;{</div>
<div class="line"><a name="l05106"></a><span class="lineno"> 5106</span>&#160;    <span class="comment">// TODO: As above.</span></div>
<div class="line"><a name="l05107"></a><span class="lineno"> 5107</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">target</a>.lock().get();</div>
<div class="line"><a name="l05108"></a><span class="lineno"> 5108</span>&#160;}</div>
<div class="line"><a name="l05109"></a><span class="lineno"> 5109</span>&#160; </div>
<div class="line"><a name="l05110"></a><span class="lineno"><a class="line" href="classnpc.html#a3a138724d95b7991fb0bea8f2c719439"> 5110</a></span>&#160;<span class="keyword">const</span> <a class="code" href="classCreature.html">Creature</a> *<a class="code" href="classnpc.html#a3a138724d95b7991fb0bea8f2c719439">npc::current_ally</a>()<span class="keyword"> const</span></div>
<div class="line"><a name="l05111"></a><span class="lineno"> 5111</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l05112"></a><span class="lineno"> 5112</span>&#160;    <span class="comment">// TODO: Arguably we should return a shared_ptr to ensure that the returned</span></div>
<div class="line"><a name="l05113"></a><span class="lineno"> 5113</span>&#160;    <span class="comment">// object stays alive while the caller uses it.  Not doing that for now.</span></div>
<div class="line"><a name="l05114"></a><span class="lineno"> 5114</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa0a891ed2c8f48d72ddb341986bd3463">ally</a>.lock().get();</div>
<div class="line"><a name="l05115"></a><span class="lineno"> 5115</span>&#160;}</div>
<div class="line"><a name="l05116"></a><span class="lineno"> 5116</span>&#160; </div>
<div class="line"><a name="l05117"></a><span class="lineno"> 5117</span>&#160;<span class="comment">// NOLINTNEXTLINE(readability-make-member-function-const)</span></div>
<div class="line"><a name="l05118"></a><span class="lineno"><a class="line" href="classnpc.html#a0d2853e0fdad8ee7d3ba69a683d8dd1e"> 5118</a></span>&#160;<a class="code" href="classCreature.html">Creature</a> *<a class="code" href="classnpc.html#a3a138724d95b7991fb0bea8f2c719439">npc::current_ally</a>()</div>
<div class="line"><a name="l05119"></a><span class="lineno"> 5119</span>&#160;{</div>
<div class="line"><a name="l05120"></a><span class="lineno"> 5120</span>&#160;    <span class="comment">// TODO: As above.</span></div>
<div class="line"><a name="l05121"></a><span class="lineno"> 5121</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">ai_cache</a>.<a class="code" href="structnpc__short__term__cache.html#aa0a891ed2c8f48d72ddb341986bd3463">ally</a>.lock().get();</div>
<div class="line"><a name="l05122"></a><span class="lineno"> 5122</span>&#160;}</div>
<div class="line"><a name="l05123"></a><span class="lineno"> 5123</span>&#160; </div>
<div class="line"><a name="l05124"></a><span class="lineno"> 5124</span>&#160;<span class="comment">// Maybe TODO: Move to Character method and use map methods</span></div>
<div class="line"><a name="l05125"></a><span class="lineno"><a class="line" href="npcmove_8cpp.html#ae04afbed56ed2363a8752a5dc0200b1b"> 5125</a></span>&#160;<span class="keyword">static</span> <a class="code" href="classint__id.html">bodypart_id</a> <a class="code" href="npcmove_8cpp.html#ae04afbed56ed2363a8752a5dc0200b1b">bp_affected</a>( <a class="code" href="classnpc.html">npc</a> &amp;who, <span class="keyword">const</span> <a class="code" href="classstring__id.html">efftype_id</a> &amp;<a class="code" href="classeffect__type.html">effect_type</a> )</div>
<div class="line"><a name="l05126"></a><span class="lineno"> 5126</span>&#160;{</div>
<div class="line"><a name="l05127"></a><span class="lineno"> 5127</span>&#160;    <a class="code" href="classint__id.html">bodypart_id</a> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l05128"></a><span class="lineno"> 5128</span>&#160;    <span class="keywordtype">int</span> highest_intensity = INT_MIN;</div>
<div class="line"><a name="l05129"></a><span class="lineno"> 5129</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classint__id.html">bodypart_id</a> &amp;<a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> : who.<a class="code" href="classCreature.html#a4537397ede1aea8ecec28183252aabe3">get_all_body_parts</a>() ) {</div>
<div class="line"><a name="l05130"></a><span class="lineno"> 5130</span>&#160;        <span class="keyword">const</span> <a class="code" href="classeffect.html">effect</a> &amp;eff = who.<a class="code" href="classCreature.html#aa8d3d8f5a3260c5b54e4973e957f356d">get_effect</a>( <a class="code" href="classeffect__type.html">effect_type</a>, <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> );</div>
<div class="line"><a name="l05131"></a><span class="lineno"> 5131</span>&#160;        <span class="keywordflow">if</span>( !eff.<a class="code" href="classeffect.html#a39ebd2ec5b2faacde7483e0c07240baa">is_null</a>() &amp;&amp; eff.<a class="code" href="classeffect.html#a68192c5a91cf7ad4618263ba3de8b802">get_intensity</a>() &gt; highest_intensity ) {</div>
<div class="line"><a name="l05132"></a><span class="lineno"> 5132</span>&#160;            <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a> = <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a>;</div>
<div class="line"><a name="l05133"></a><span class="lineno"> 5133</span>&#160;            highest_intensity = eff.<a class="code" href="classeffect.html#a68192c5a91cf7ad4618263ba3de8b802">get_intensity</a>();</div>
<div class="line"><a name="l05134"></a><span class="lineno"> 5134</span>&#160;        }</div>
<div class="line"><a name="l05135"></a><span class="lineno"> 5135</span>&#160;    }</div>
<div class="line"><a name="l05136"></a><span class="lineno"> 5136</span>&#160; </div>
<div class="line"><a name="l05137"></a><span class="lineno"> 5137</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l05138"></a><span class="lineno"> 5138</span>&#160;}</div>
<div class="line"><a name="l05139"></a><span class="lineno"> 5139</span>&#160; </div>
<div class="line"><a name="l05140"></a><span class="lineno"><a class="line" href="classnpc.html#a05996f017d647a5d1b7c9cae190c6507"> 5140</a></span>&#160;std::string <a class="code" href="classnpc.html#a05996f017d647a5d1b7c9cae190c6507">npc::distance_string</a>( <span class="keywordtype">int</span> range )<span class="keyword"> const</span></div>
<div class="line"><a name="l05141"></a><span class="lineno"> 5141</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l05142"></a><span class="lineno"> 5142</span>&#160;    <span class="keywordflow">if</span>( range &lt; 6 ) {</div>
<div class="line"><a name="l05143"></a><span class="lineno"> 5143</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a1dcff1acadd0438fec30bf7dc487ce6b">snip_danger_close_distance</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05144"></a><span class="lineno"> 5144</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( range &lt; 11 ) {</div>
<div class="line"><a name="l05145"></a><span class="lineno"> 5145</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a31b1dcd35fda54be38e4e4f8d3b6ae5f">snip_close_distance</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05146"></a><span class="lineno"> 5146</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( range &lt; 26 ) {</div>
<div class="line"><a name="l05147"></a><span class="lineno"> 5147</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#ab0a8660e4755f4d15e8aa6c5b4b49b18">snip_medium_distance</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05148"></a><span class="lineno"> 5148</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05149"></a><span class="lineno"> 5149</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a13113449812840bc5d6a027c4906956e">snip_far_distance</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05150"></a><span class="lineno"> 5150</span>&#160;    }</div>
<div class="line"><a name="l05151"></a><span class="lineno"> 5151</span>&#160;}</div>
<div class="line"><a name="l05152"></a><span class="lineno"> 5152</span>&#160; </div>
<div class="line"><a name="l05153"></a><span class="lineno"><a class="line" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9"> 5153</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">npc::warn_about</a>( <span class="keyword">const</span> std::string &amp;type, <span class="keyword">const</span> <a class="code" href="classtime__duration.html">time_duration</a> &amp;d, <span class="keyword">const</span> std::string &amp;<a class="code" href="namespaceom__direction.html#a8ba958ccfad28c0a5572a04dd1428f32">name</a>,</div>
<div class="line"><a name="l05154"></a><span class="lineno"> 5154</span>&#160;                      <span class="keywordtype">int</span> range, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;danger_pos )</div>
<div class="line"><a name="l05155"></a><span class="lineno"> 5155</span>&#160;{</div>
<div class="line"><a name="l05156"></a><span class="lineno"> 5156</span>&#160;    std::string snip;</div>
<div class="line"><a name="l05157"></a><span class="lineno"> 5157</span>&#160;    <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3">sounds::sound_t</a> spriority = <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a7ed21143076d0cca420653d4345baa2f">sounds::sound_t::alert</a>;</div>
<div class="line"><a name="l05158"></a><span class="lineno"> 5158</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;monster&quot;</span> ) {</div>
<div class="line"><a name="l05159"></a><span class="lineno"> 5159</span>&#160;        snip = <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ? <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a6e26b47acf769074e73c17fd1a521b6a">snip_monster_warning_h</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>()</div>
<div class="line"><a name="l05160"></a><span class="lineno"> 5160</span>&#160;               : <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#add480233f4fa2917735fd7da12f784f0">snip_monster_warning</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05161"></a><span class="lineno"> 5161</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;explosion&quot;</span> ) {</div>
<div class="line"><a name="l05162"></a><span class="lineno"> 5162</span>&#160;        snip = <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ? <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a4286c66c15a3c1a988b8386511cefc4d">snip_fire_in_the_hole_h</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>()</div>
<div class="line"><a name="l05163"></a><span class="lineno"> 5163</span>&#160;               : <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#ae2de31459f0d43c877e7610239d05f0f">snip_fire_in_the_hole</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05164"></a><span class="lineno"> 5164</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;general_danger&quot;</span> ) {</div>
<div class="line"><a name="l05165"></a><span class="lineno"> 5165</span>&#160;        snip = <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ? <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#ae9c9a367b94dbb61c38ffe094971fd89">snip_general_danger_h</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>()</div>
<div class="line"><a name="l05166"></a><span class="lineno"> 5166</span>&#160;               : <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a44adfad4a6edb194e3be2a22dc1194e5">snip_general_danger</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05167"></a><span class="lineno"> 5167</span>&#160;        spriority = <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14">sounds::sound_t::speech</a>;</div>
<div class="line"><a name="l05168"></a><span class="lineno"> 5168</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;relax&quot;</span> ) {</div>
<div class="line"><a name="l05169"></a><span class="lineno"> 5169</span>&#160;        snip = <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ? <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#aff1bb134f7aac67385a065d22f74a6db">snip_its_safe_h</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>()</div>
<div class="line"><a name="l05170"></a><span class="lineno"> 5170</span>&#160;               : <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a4df05b3a6577b40f2f9cb22cfc96de0e">snip_its_safe</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05171"></a><span class="lineno"> 5171</span>&#160;        spriority = <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14">sounds::sound_t::speech</a>;</div>
<div class="line"><a name="l05172"></a><span class="lineno"> 5172</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;kill_npc&quot;</span> ) {</div>
<div class="line"><a name="l05173"></a><span class="lineno"> 5173</span>&#160;        snip = <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ? <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a1bf21bd13cb3a895a1463e1b8f902a5b">snip_kill_npc_h</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>()</div>
<div class="line"><a name="l05174"></a><span class="lineno"> 5174</span>&#160;               : <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a666942d986ad71eb87df1ccb3773083d">snip_kill_npc</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05175"></a><span class="lineno"> 5175</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;kill_player&quot;</span> ) {</div>
<div class="line"><a name="l05176"></a><span class="lineno"> 5176</span>&#160;        snip = <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>() ? <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a4a941e688346378bcc8fd98a8b2ab138">snip_kill_player_h</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>() : <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line"><a name="l05177"></a><span class="lineno"> 5177</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;run_away&quot;</span> ) {</div>
<div class="line"><a name="l05178"></a><span class="lineno"> 5178</span>&#160;        snip = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a28f759152ce9567d37ba6c257fba0f69">snip_run_away</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05179"></a><span class="lineno"> 5179</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;cant_flee&quot;</span> ) {</div>
<div class="line"><a name="l05180"></a><span class="lineno"> 5180</span>&#160;        snip = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a41430c6e3eb1f79b41f1d68b8ad32157">snip_cant_flee</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05181"></a><span class="lineno"> 5181</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;fire_bad&quot;</span> ) {</div>
<div class="line"><a name="l05182"></a><span class="lineno"> 5182</span>&#160;        snip = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#ab66e0207425e52dd5ea6c740c641cfdd">snip_fire_bad</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05183"></a><span class="lineno"> 5183</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;speech_noise&quot;</span> &amp;&amp; !<a class="code" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code" href="npcmove_8cpp.html#adf56eab61890bbb283d4dbd7d26dde16">trait_IGNORE_SOUND</a> ) ) {</div>
<div class="line"><a name="l05184"></a><span class="lineno"> 5184</span>&#160;        snip = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a3add351c0c2103212c9c9a842c6b8c69">snip_speech_warning</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05185"></a><span class="lineno"> 5185</span>&#160;        spriority = <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14">sounds::sound_t::speech</a>;</div>
<div class="line"><a name="l05186"></a><span class="lineno"> 5186</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;combat_noise&quot;</span> &amp;&amp; !<a class="code" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code" href="npcmove_8cpp.html#adf56eab61890bbb283d4dbd7d26dde16">trait_IGNORE_SOUND</a> ) ) {</div>
<div class="line"><a name="l05187"></a><span class="lineno"> 5187</span>&#160;        snip = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a3a549ccd3a016409e91ee7a132449037">snip_combat_noise_warning</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05188"></a><span class="lineno"> 5188</span>&#160;        spriority = <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14">sounds::sound_t::speech</a>;</div>
<div class="line"><a name="l05189"></a><span class="lineno"> 5189</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;movement_noise&quot;</span> &amp;&amp; !<a class="code" href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">has_trait</a>( <a class="code" href="npcmove_8cpp.html#adf56eab61890bbb283d4dbd7d26dde16">trait_IGNORE_SOUND</a> ) ) {</div>
<div class="line"><a name="l05190"></a><span class="lineno"> 5190</span>&#160;        snip = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#ac8937e6e53c5ebd6a4a7fff500303c42">snip_movement_noise_warning</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05191"></a><span class="lineno"> 5191</span>&#160;        spriority = <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14">sounds::sound_t::speech</a>;</div>
<div class="line"><a name="l05192"></a><span class="lineno"> 5192</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> == <span class="stringliteral">&quot;heal_self&quot;</span> ) {</div>
<div class="line"><a name="l05193"></a><span class="lineno"> 5193</span>&#160;        snip = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a909144e9f40f6f6657ffdb43c98d06a1">snip_heal_self</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05194"></a><span class="lineno"> 5194</span>&#160;        spriority = <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14">sounds::sound_t::speech</a>;</div>
<div class="line"><a name="l05195"></a><span class="lineno"> 5195</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05196"></a><span class="lineno"> 5196</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05197"></a><span class="lineno"> 5197</span>&#160;    }</div>
<div class="line"><a name="l05198"></a><span class="lineno"> 5198</span>&#160;    <span class="keyword">const</span> std::string warning_name = <span class="stringliteral">&quot;warning_&quot;</span> + <a class="code" href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">type</a> + <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>;</div>
<div class="line"><a name="l05199"></a><span class="lineno"> 5199</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>.empty() ) {</div>
<div class="line"><a name="l05200"></a><span class="lineno"> 5200</span>&#160;        <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( warning_name, d, snip, <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>(), spriority );</div>
<div class="line"><a name="l05201"></a><span class="lineno"> 5201</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05202"></a><span class="lineno"> 5202</span>&#160;        <span class="keyword">const</span> std::string range_str = range &lt; 1 ? <span class="stringliteral">&quot;&lt;punc&gt;&quot;</span> :</div>
<div class="line"><a name="l05203"></a><span class="lineno"> 5203</span>&#160;                                      <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot; %s, %s&quot;</span> ),</div>
<div class="line"><a name="l05204"></a><span class="lineno"> 5204</span>&#160;                                              <a class="code" href="line_8cpp.html#a19634ed59e09da9312d6fa110a38539c">direction_name</a>( <a class="code" href="coordinates_8h.html#a70d5706d5a84c7c1953498fa0c651b3e">direction_from</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>(), danger_pos ) ),</div>
<div class="line"><a name="l05205"></a><span class="lineno"> 5205</span>&#160;                                              <a class="code" href="classnpc.html#a05996f017d647a5d1b7c9cae190c6507">distance_string</a>( range ) );</div>
<div class="line"><a name="l05206"></a><span class="lineno"> 5206</span>&#160;        <span class="keyword">const</span> std::string <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%s %s%s&quot;</span> ), snip, <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> ), range_str );</div>
<div class="line"><a name="l05207"></a><span class="lineno"> 5207</span>&#160;        <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( warning_name, d, <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a>, <a class="code" href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">is_enemy</a>(), spriority );</div>
<div class="line"><a name="l05208"></a><span class="lineno"> 5208</span>&#160;    }</div>
<div class="line"><a name="l05209"></a><span class="lineno"> 5209</span>&#160;}</div>
<div class="line"><a name="l05210"></a><span class="lineno"> 5210</span>&#160; </div>
<div class="line"><a name="l05211"></a><span class="lineno"><a class="line" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8"> 5211</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">npc::complain_about</a>( <span class="keyword">const</span> std::string &amp;issue, <span class="keyword">const</span> <a class="code" href="classtime__duration.html">time_duration</a> &amp;<a class="code" href="creature_8h.html#afb9a39a835be84327a86693636f5fc49">dur</a>,</div>
<div class="line"><a name="l05212"></a><span class="lineno"> 5212</span>&#160;                          <span class="keyword">const</span> std::string &amp;<a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a>, <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="creature_8h.html#a4b73e33b57ae387dc418906492d5f998">force</a>, <span class="keyword">const</span> <a class="code" href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3">sounds::sound_t</a> priority )</div>
<div class="line"><a name="l05213"></a><span class="lineno"> 5213</span>&#160;{</div>
<div class="line"><a name="l05214"></a><span class="lineno"> 5214</span>&#160;    <span class="comment">// Don&#39;t have a default constructor for time_point, so accessing it in the</span></div>
<div class="line"><a name="l05215"></a><span class="lineno"> 5215</span>&#160;    <span class="comment">// complaints map is a bit difficult, those lambdas should cover it.</span></div>
<div class="line"><a name="l05216"></a><span class="lineno"> 5216</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> complain_since = [<span class="keyword">this</span>]( <span class="keyword">const</span> std::string &amp; key, <span class="keyword">const</span> <a class="code" href="classtime__duration.html">time_duration</a> &amp; d ) {</div>
<div class="line"><a name="l05217"></a><span class="lineno"> 5217</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> iter = <a class="code" href="classnpc.html#ac88f9115887e5da9075701a14588b637">complaints</a>.find( key );</div>
<div class="line"><a name="l05218"></a><span class="lineno"> 5218</span>&#160;        <span class="keywordflow">return</span> iter == <a class="code" href="classnpc.html#ac88f9115887e5da9075701a14588b637">complaints</a>.end() || iter-&gt;second &lt; <a class="code" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a> - d;</div>
<div class="line"><a name="l05219"></a><span class="lineno"> 5219</span>&#160;    };</div>
<div class="line"><a name="l05220"></a><span class="lineno"> 5220</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> set_complain_since = [<span class="keyword">this</span>]( <span class="keyword">const</span> std::string &amp; key ) {</div>
<div class="line"><a name="l05221"></a><span class="lineno"> 5221</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> iter = <a class="code" href="classnpc.html#ac88f9115887e5da9075701a14588b637">complaints</a>.find( key );</div>
<div class="line"><a name="l05222"></a><span class="lineno"> 5222</span>&#160;        <span class="keywordflow">if</span>( iter == <a class="code" href="classnpc.html#ac88f9115887e5da9075701a14588b637">complaints</a>.end() ) {</div>
<div class="line"><a name="l05223"></a><span class="lineno"> 5223</span>&#160;            <a class="code" href="classnpc.html#ac88f9115887e5da9075701a14588b637">complaints</a>.emplace( key, <a class="code" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a> );</div>
<div class="line"><a name="l05224"></a><span class="lineno"> 5224</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05225"></a><span class="lineno"> 5225</span>&#160;            iter-&gt;second = <a class="code" href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a>;</div>
<div class="line"><a name="l05226"></a><span class="lineno"> 5226</span>&#160;        }</div>
<div class="line"><a name="l05227"></a><span class="lineno"> 5227</span>&#160;    };</div>
<div class="line"><a name="l05228"></a><span class="lineno"> 5228</span>&#160; </div>
<div class="line"><a name="l05229"></a><span class="lineno"> 5229</span>&#160;    <span class="comment">// Don&#39;t wake player up with non-serious complaints</span></div>
<div class="line"><a name="l05230"></a><span class="lineno"> 5230</span>&#160;    <span class="comment">// Stop complaining while asleep</span></div>
<div class="line"><a name="l05231"></a><span class="lineno"> 5231</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> do_complain = <a class="code" href="creature_8h.html#a4b73e33b57ae387dc418906492d5f998">force</a> || ( <a class="code" href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">rules</a>.<a class="code" href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">has_flag</a>( <a class="code" href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5d295cf614c72aacdee1110f17041ce7">ally_rule::allow_complain</a> ) &amp;&amp;</div>
<div class="line"><a name="l05232"></a><span class="lineno"> 5232</span>&#160;                                        !<a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>().<a class="code" href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">in_sleep_state</a>() &amp;&amp; !<a class="code" href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">in_sleep_state</a>() );</div>
<div class="line"><a name="l05233"></a><span class="lineno"> 5233</span>&#160; </div>
<div class="line"><a name="l05234"></a><span class="lineno"> 5234</span>&#160;    <span class="keywordflow">if</span>( complain_since( issue, <a class="code" href="creature_8h.html#afb9a39a835be84327a86693636f5fc49">dur</a> ) &amp;&amp; do_complain ) {</div>
<div class="line"><a name="l05235"></a><span class="lineno"> 5235</span>&#160;        <a class="code" href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">say</a>( <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a>, priority );</div>
<div class="line"><a name="l05236"></a><span class="lineno"> 5236</span>&#160;        set_complain_since( issue );</div>
<div class="line"><a name="l05237"></a><span class="lineno"> 5237</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05238"></a><span class="lineno"> 5238</span>&#160;    }</div>
<div class="line"><a name="l05239"></a><span class="lineno"> 5239</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05240"></a><span class="lineno"> 5240</span>&#160;}</div>
<div class="line"><a name="l05241"></a><span class="lineno"> 5241</span>&#160; </div>
<div class="line"><a name="l05242"></a><span class="lineno"><a class="line" href="classnpc.html#a305f1416efd6a05654042edb9d23f2da"> 5242</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#a305f1416efd6a05654042edb9d23f2da">npc::complain</a>()</div>
<div class="line"><a name="l05243"></a><span class="lineno"> 5243</span>&#160;{</div>
<div class="line"><a name="l05244"></a><span class="lineno"> 5244</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string infected_string = <span class="stringliteral">&quot;infected&quot;</span>;</div>
<div class="line"><a name="l05245"></a><span class="lineno"> 5245</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string sleepiness_string = <span class="stringliteral">&quot;sleepiness&quot;</span>;</div>
<div class="line"><a name="l05246"></a><span class="lineno"> 5246</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string bite_string = <span class="stringliteral">&quot;bite&quot;</span>;</div>
<div class="line"><a name="l05247"></a><span class="lineno"> 5247</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string bleed_string = <span class="stringliteral">&quot;bleed&quot;</span>;</div>
<div class="line"><a name="l05248"></a><span class="lineno"> 5248</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string hypovolemia_string = <span class="stringliteral">&quot;hypovolemia&quot;</span>;</div>
<div class="line"><a name="l05249"></a><span class="lineno"> 5249</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string radiation_string = <span class="stringliteral">&quot;radiation&quot;</span>;</div>
<div class="line"><a name="l05250"></a><span class="lineno"> 5250</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string hunger_string = <span class="stringliteral">&quot;hunger&quot;</span>;</div>
<div class="line"><a name="l05251"></a><span class="lineno"> 5251</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> std::string thirst_string = <span class="stringliteral">&quot;thirst&quot;</span>;</div>
<div class="line"><a name="l05252"></a><span class="lineno"> 5252</span>&#160; </div>
<div class="line"><a name="l05253"></a><span class="lineno"> 5253</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">is_player_ally</a>() || !<a class="code" href="game_8cpp.html#ab5c977b7e81348725fb7bf09fc64ed95">get_player_view</a>().<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *<span class="keyword">this</span> ) ) {</div>
<div class="line"><a name="l05254"></a><span class="lineno"> 5254</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05255"></a><span class="lineno"> 5255</span>&#160;    }</div>
<div class="line"><a name="l05256"></a><span class="lineno"> 5256</span>&#160; </div>
<div class="line"><a name="l05257"></a><span class="lineno"> 5257</span>&#160;    <span class="comment">// When infected, complain every (4-intensity) hours</span></div>
<div class="line"><a name="l05258"></a><span class="lineno"> 5258</span>&#160;    <span class="comment">// At intensity 3, ignore player wanting us to shut up</span></div>
<div class="line"><a name="l05259"></a><span class="lineno"> 5259</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a1de43fa1f6d16ce87ab7a3a49e47c463">effect_infected</a> ) ) {</div>
<div class="line"><a name="l05260"></a><span class="lineno"> 5260</span>&#160;        <span class="keyword">const</span> <a class="code" href="classint__id.html">bodypart_id</a> &amp;<a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> =  <a class="code" href="npcmove_8cpp.html#ae04afbed56ed2363a8752a5dc0200b1b">bp_affected</a>( *<span class="keyword">this</span>, <a class="code" href="npcmove_8cpp.html#a1de43fa1f6d16ce87ab7a3a49e47c463">effect_infected</a> );</div>
<div class="line"><a name="l05261"></a><span class="lineno"> 5261</span>&#160;        <span class="keyword">const</span> <a class="code" href="classeffect.html">effect</a> &amp;eff = <a class="code" href="classCreature.html#aa8d3d8f5a3260c5b54e4973e957f356d">get_effect</a>( <a class="code" href="npcmove_8cpp.html#a1de43fa1f6d16ce87ab7a3a49e47c463">effect_infected</a>, <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> );</div>
<div class="line"><a name="l05262"></a><span class="lineno"> 5262</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="creature_8h.html#a299ec0c42ccc5a2d79d1739428ac3210">intensity</a> = eff.<a class="code" href="classeffect.html#a68192c5a91cf7ad4618263ba3de8b802">get_intensity</a>();</div>
<div class="line"><a name="l05263"></a><span class="lineno"> 5263</span>&#160;        std::string talktag = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a3cbb903371269780136c70f20070299b">snip_wound_infected</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05264"></a><span class="lineno"> 5264</span>&#160;        <a class="code" href="npc_8h.html#aee50a2d29c2194e6df726113b025e55b">parse_tags</a>( talktag, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>(), *<span class="keyword">this</span> );</div>
<div class="line"><a name="l05265"></a><span class="lineno"> 5265</span>&#160;        <span class="keyword">const</span> std::string <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( talktag, <a class="code" href="bodypart_8cpp.html#ac9aaf0eca53f33436ba15a5b29f68a16">body_part_name</a>( <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> ) );</div>
<div class="line"><a name="l05266"></a><span class="lineno"> 5266</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( infected_string, <a class="code" href="classtime__duration.html#af151c8d00f18411742bf9766f5be1b79">time_duration::from_hours</a>( 4 - <a class="code" href="creature_8h.html#a299ec0c42ccc5a2d79d1739428ac3210">intensity</a> ), <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a>,</div>
<div class="line"><a name="l05267"></a><span class="lineno"> 5267</span>&#160;                            <a class="code" href="creature_8h.html#a299ec0c42ccc5a2d79d1739428ac3210">intensity</a> &gt;= 3 ) ) {</div>
<div class="line"><a name="l05268"></a><span class="lineno"> 5268</span>&#160;            <span class="comment">// Only one complaint per turn</span></div>
<div class="line"><a name="l05269"></a><span class="lineno"> 5269</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05270"></a><span class="lineno"> 5270</span>&#160;        }</div>
<div class="line"><a name="l05271"></a><span class="lineno"> 5271</span>&#160;    }</div>
<div class="line"><a name="l05272"></a><span class="lineno"> 5272</span>&#160; </div>
<div class="line"><a name="l05273"></a><span class="lineno"> 5273</span>&#160;    <span class="comment">// When bitten, complain every hour, but respect restrictions</span></div>
<div class="line"><a name="l05274"></a><span class="lineno"> 5274</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a39b21fc30fecd7d4fb15047600d03522">effect_bite</a> ) ) {</div>
<div class="line"><a name="l05275"></a><span class="lineno"> 5275</span>&#160;        <span class="keyword">const</span> <a class="code" href="classint__id.html">bodypart_id</a> &amp;<a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> =  <a class="code" href="npcmove_8cpp.html#ae04afbed56ed2363a8752a5dc0200b1b">bp_affected</a>( *<span class="keyword">this</span>, <a class="code" href="npcmove_8cpp.html#a39b21fc30fecd7d4fb15047600d03522">effect_bite</a> );</div>
<div class="line"><a name="l05276"></a><span class="lineno"> 5276</span>&#160;        std::string talktag = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a34e76c43138090b43396fd341b2d5502">snip_wound_bite</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05277"></a><span class="lineno"> 5277</span>&#160;        <a class="code" href="npc_8h.html#aee50a2d29c2194e6df726113b025e55b">parse_tags</a>( talktag, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>(), *<span class="keyword">this</span> );</div>
<div class="line"><a name="l05278"></a><span class="lineno"> 5278</span>&#160;        <span class="keyword">const</span> std::string <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( talktag, <a class="code" href="bodypart_8cpp.html#ac9aaf0eca53f33436ba15a5b29f68a16">body_part_name</a>( <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> ) );</div>
<div class="line"><a name="l05279"></a><span class="lineno"> 5279</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( bite_string, 1_hours, <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> ) ) {</div>
<div class="line"><a name="l05280"></a><span class="lineno"> 5280</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05281"></a><span class="lineno"> 5281</span>&#160;        }</div>
<div class="line"><a name="l05282"></a><span class="lineno"> 5282</span>&#160;    }</div>
<div class="line"><a name="l05283"></a><span class="lineno"> 5283</span>&#160; </div>
<div class="line"><a name="l05284"></a><span class="lineno"> 5284</span>&#160;    <span class="comment">// When tired, complain every 30 minutes</span></div>
<div class="line"><a name="l05285"></a><span class="lineno"> 5285</span>&#160;    <span class="comment">// If massively tired, ignore restrictions</span></div>
<div class="line"><a name="l05286"></a><span class="lineno"> 5286</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#a241e50ee41a2a2b54f1c1329cb60a174">get_sleepiness</a>() &gt; <a class="code" href="character_8h.html#a28256deb3e43854efdc7035ae555212ba18eb54216d0a6c8fcfcc347228e1d8d3">sleepiness_levels::TIRED</a> &amp;&amp;</div>
<div class="line"><a name="l05287"></a><span class="lineno"> 5287</span>&#160;        <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( sleepiness_string, 30_minutes, <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_yawn.translated(),</div>
<div class="line"><a name="l05288"></a><span class="lineno"> 5288</span>&#160;                        <a class="code" href="classCharacter.html#a241e50ee41a2a2b54f1c1329cb60a174">get_sleepiness</a>() &gt; <a class="code" href="character_8h.html#a28256deb3e43854efdc7035ae555212baa82737450ee7c37246cff4af1541525d">sleepiness_levels::MASSIVE_SLEEPINESS</a> - 100 ) )  {</div>
<div class="line"><a name="l05289"></a><span class="lineno"> 5289</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05290"></a><span class="lineno"> 5290</span>&#160;    }</div>
<div class="line"><a name="l05291"></a><span class="lineno"> 5291</span>&#160; </div>
<div class="line"><a name="l05292"></a><span class="lineno"> 5292</span>&#160;    <span class="comment">// Radiation every 10 minutes</span></div>
<div class="line"><a name="l05293"></a><span class="lineno"> 5293</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#aa81a4b0db6f2387bfc02706a6b7a678e">get_rad</a>() &gt; 90 ) {</div>
<div class="line"><a name="l05294"></a><span class="lineno"> 5294</span>&#160;        <a class="code" href="classnpc.html#a00c66c9875847030710d6c619a178168">activate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#ab7fca7b08d020989cad3cfad9e31c274">bio_radscrubber</a> );</div>
<div class="line"><a name="l05295"></a><span class="lineno"> 5295</span>&#160;        std::string <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a232fe542d51159fc0e84bd938a3e05ad">snip_radiation_sickness</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05296"></a><span class="lineno"> 5296</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( radiation_string, 10_minutes, <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a>, <a class="code" href="classCharacter.html#aa81a4b0db6f2387bfc02706a6b7a678e">get_rad</a>() &gt; 150 ) ) {</div>
<div class="line"><a name="l05297"></a><span class="lineno"> 5297</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05298"></a><span class="lineno"> 5298</span>&#160;        }</div>
<div class="line"><a name="l05299"></a><span class="lineno"> 5299</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( !<a class="code" href="classCharacter.html#aa81a4b0db6f2387bfc02706a6b7a678e">get_rad</a>() ) {</div>
<div class="line"><a name="l05300"></a><span class="lineno"> 5300</span>&#160;        <a class="code" href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">deactivate_bionic_by_id</a>( <a class="code" href="npcmove_8cpp.html#ab7fca7b08d020989cad3cfad9e31c274">bio_radscrubber</a> );</div>
<div class="line"><a name="l05301"></a><span class="lineno"> 5301</span>&#160;    }</div>
<div class="line"><a name="l05302"></a><span class="lineno"> 5302</span>&#160; </div>
<div class="line"><a name="l05303"></a><span class="lineno"> 5303</span>&#160;    <span class="comment">// Hunger every 3-6 hours</span></div>
<div class="line"><a name="l05304"></a><span class="lineno"> 5304</span>&#160;    <span class="comment">// Since NPCs can&#39;t starve to death, respect the rules</span></div>
<div class="line"><a name="l05305"></a><span class="lineno"> 5305</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#ab937dd4b9a2cf84fb446d0da98a62365">get_hunger</a>() &gt; <a class="code" href="npcmove_8cpp.html#ae2002588c2e33a355ee6f1416df681e3">NPC_HUNGER_COMPLAIN</a> &amp;&amp;</div>
<div class="line"><a name="l05306"></a><span class="lineno"> 5306</span>&#160;        <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( hunger_string,</div>
<div class="line"><a name="l05307"></a><span class="lineno"> 5307</span>&#160;                        <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 3_hours, <a class="code" href="classtime__duration.html#a20688ca0a8848ec0d73636ede90d27ad">time_duration::from_minutes</a>( 60 * 8 - <a class="code" href="classCharacter.html#ab937dd4b9a2cf84fb446d0da98a62365">get_hunger</a>() ) ),</div>
<div class="line"><a name="l05308"></a><span class="lineno"> 5308</span>&#160;                        <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_hungry.translated() ) ) {</div>
<div class="line"><a name="l05309"></a><span class="lineno"> 5309</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05310"></a><span class="lineno"> 5310</span>&#160;    }</div>
<div class="line"><a name="l05311"></a><span class="lineno"> 5311</span>&#160; </div>
<div class="line"><a name="l05312"></a><span class="lineno"> 5312</span>&#160;    <span class="comment">// Thirst every 2 hours</span></div>
<div class="line"><a name="l05313"></a><span class="lineno"> 5313</span>&#160;    <span class="comment">// Since NPCs can&#39;t dry to death, respect the rules</span></div>
<div class="line"><a name="l05314"></a><span class="lineno"> 5314</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#a8c0812cf2b1dae1461ff50f9a019796e">get_thirst</a>() &gt; <a class="code" href="npcmove_8cpp.html#a0dea205d5b8aa85ab213a0b84fa3a006">NPC_THIRST_COMPLAIN</a> &amp;&amp;</div>
<div class="line"><a name="l05315"></a><span class="lineno"> 5315</span>&#160;        <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( thirst_string, 2_hours, <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().snip_thirsty.translated() ) ) {</div>
<div class="line"><a name="l05316"></a><span class="lineno"> 5316</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05317"></a><span class="lineno"> 5317</span>&#160;    }</div>
<div class="line"><a name="l05318"></a><span class="lineno"> 5318</span>&#160; </div>
<div class="line"><a name="l05319"></a><span class="lineno"> 5319</span>&#160;    <span class="comment">//Bleeding every 5 minutes</span></div>
<div class="line"><a name="l05320"></a><span class="lineno"> 5320</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a> ) ) {</div>
<div class="line"><a name="l05321"></a><span class="lineno"> 5321</span>&#160;        <span class="keyword">const</span> <a class="code" href="classint__id.html">bodypart_id</a> &amp;<a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> =  <a class="code" href="npcmove_8cpp.html#ae04afbed56ed2363a8752a5dc0200b1b">bp_affected</a>( *<span class="keyword">this</span>, <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a> );</div>
<div class="line"><a name="l05322"></a><span class="lineno"> 5322</span>&#160;        std::string <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a>;</div>
<div class="line"><a name="l05323"></a><span class="lineno"> 5323</span>&#160;        <a class="code" href="classtime__duration.html">time_duration</a> often;</div>
<div class="line"><a name="l05324"></a><span class="lineno"> 5324</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#aa8d3d8f5a3260c5b54e4973e957f356d">get_effect</a>( <a class="code" href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a>, <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> ).get_intensity() &lt; 10 ) {</div>
<div class="line"><a name="l05325"></a><span class="lineno"> 5325</span>&#160;            std::string talktag = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a9a7654d0f398764564f42baa519ccd75">snip_bleeding</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05326"></a><span class="lineno"> 5326</span>&#160;            <a class="code" href="npc_8h.html#aee50a2d29c2194e6df726113b025e55b">parse_tags</a>( talktag, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>(), *<span class="keyword">this</span> );</div>
<div class="line"><a name="l05327"></a><span class="lineno"> 5327</span>&#160;            <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( talktag, <a class="code" href="bodypart_8cpp.html#ac9aaf0eca53f33436ba15a5b29f68a16">body_part_name</a>( <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> ) );</div>
<div class="line"><a name="l05328"></a><span class="lineno"> 5328</span>&#160;            often = 5_minutes;</div>
<div class="line"><a name="l05329"></a><span class="lineno"> 5329</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l05330"></a><span class="lineno"> 5330</span>&#160;            std::string talktag = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#a02b7e4d4cc2f34ee9eb96cf21f9b67de">snip_bleeding_badly</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05331"></a><span class="lineno"> 5331</span>&#160;            <a class="code" href="npc_8h.html#aee50a2d29c2194e6df726113b025e55b">parse_tags</a>( talktag, <a class="code" href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a>(), *<span class="keyword">this</span> );</div>
<div class="line"><a name="l05332"></a><span class="lineno"> 5332</span>&#160;            <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> = <a class="code" href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a>( talktag, <a class="code" href="bodypart_8cpp.html#ac9aaf0eca53f33436ba15a5b29f68a16">body_part_name</a>( <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> ) );</div>
<div class="line"><a name="l05333"></a><span class="lineno"> 5333</span>&#160;            often = 1_minutes;</div>
<div class="line"><a name="l05334"></a><span class="lineno"> 5334</span>&#160;        }</div>
<div class="line"><a name="l05335"></a><span class="lineno"> 5335</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( bleed_string, often, <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> ) ) {</div>
<div class="line"><a name="l05336"></a><span class="lineno"> 5336</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05337"></a><span class="lineno"> 5337</span>&#160;        }</div>
<div class="line"><a name="l05338"></a><span class="lineno"> 5338</span>&#160;    }</div>
<div class="line"><a name="l05339"></a><span class="lineno"> 5339</span>&#160; </div>
<div class="line"><a name="l05340"></a><span class="lineno"> 5340</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">has_effect</a>( <a class="code" href="npcmove_8cpp.html#ab987f0249d5dcb5a351fe48ffebffc55">effect_hypovolemia</a> ) ) {</div>
<div class="line"><a name="l05341"></a><span class="lineno"> 5341</span>&#160;        std::string <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> = <a class="code" href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">chat_snippets</a>().<a class="code" href="structdialogue__chatbin__snippets.html#ab6ed908d4643a42308ccad1cfe4aa678">snip_lost_blood</a>.<a class="code" href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translated</a>();</div>
<div class="line"><a name="l05342"></a><span class="lineno"> 5342</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">complain_about</a>( hypovolemia_string, 10_minutes, <a class="code" href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a> ) ) {</div>
<div class="line"><a name="l05343"></a><span class="lineno"> 5343</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05344"></a><span class="lineno"> 5344</span>&#160;        }</div>
<div class="line"><a name="l05345"></a><span class="lineno"> 5345</span>&#160;    }</div>
<div class="line"><a name="l05346"></a><span class="lineno"> 5346</span>&#160; </div>
<div class="line"><a name="l05347"></a><span class="lineno"> 5347</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05348"></a><span class="lineno"> 5348</span>&#160;}</div>
<div class="line"><a name="l05349"></a><span class="lineno"> 5349</span>&#160; </div>
<div class="line"><a name="l05350"></a><span class="lineno"><a class="line" href="classnpc.html#a7760d95b7aab094c750965eaa7d77071"> 5350</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a7760d95b7aab094c750965eaa7d77071">npc::do_reload</a>( <span class="keyword">const</span> <a class="code" href="classitem__location.html">item_location</a> &amp;it )</div>
<div class="line"><a name="l05351"></a><span class="lineno"> 5351</span>&#160;{</div>
<div class="line"><a name="l05352"></a><span class="lineno"> 5352</span>&#160;    <span class="keywordflow">if</span>( !it ) {</div>
<div class="line"><a name="l05353"></a><span class="lineno"> 5353</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;do_reload failed: %s tried to reload a none&quot;</span>, <a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a> );</div>
<div class="line"><a name="l05354"></a><span class="lineno"> 5354</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05355"></a><span class="lineno"> 5355</span>&#160;    }</div>
<div class="line"><a name="l05356"></a><span class="lineno"> 5356</span>&#160; </div>
<div class="line"><a name="l05357"></a><span class="lineno"> 5357</span>&#160;    <a class="code" href="classitem_1_1reload__option.html">item::reload_option</a> reload_opt = <a class="code" href="classnpc.html#a1af5092f25a6cfeaff67584bb53cc17b">select_ammo</a>( it );</div>
<div class="line"><a name="l05358"></a><span class="lineno"> 5358</span>&#160; </div>
<div class="line"><a name="l05359"></a><span class="lineno"> 5359</span>&#160;    <span class="keywordflow">if</span>( !reload_opt ) {</div>
<div class="line"><a name="l05360"></a><span class="lineno"> 5360</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;do_reload failed: no usable ammo for %s&quot;</span>, it-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l05361"></a><span class="lineno"> 5361</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05362"></a><span class="lineno"> 5362</span>&#160;    }</div>
<div class="line"><a name="l05363"></a><span class="lineno"> 5363</span>&#160; </div>
<div class="line"><a name="l05364"></a><span class="lineno"> 5364</span>&#160;    <span class="comment">// Note: we may be reloading the magazine inside, not the gun itself</span></div>
<div class="line"><a name="l05365"></a><span class="lineno"> 5365</span>&#160;    <span class="comment">// Maybe TODO: allow reload functions to understand such reloads instead of const casts</span></div>
<div class="line"><a name="l05366"></a><span class="lineno"> 5366</span>&#160;    <a class="code" href="classitem.html">item</a> &amp;target = <span class="keyword">const_cast&lt;</span><a class="code" href="classitem.html">item</a> &amp;<span class="keyword">&gt;</span>( *reload_opt.<a class="code" href="classitem_1_1reload__option.html#a8088bb504a905699d547374881015768">target</a> );</div>
<div class="line"><a name="l05367"></a><span class="lineno"> 5367</span>&#160;    <a class="code" href="classitem__location.html">item_location</a> &amp;usable_ammo = reload_opt.<a class="code" href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">ammo</a>;</div>
<div class="line"><a name="l05368"></a><span class="lineno"> 5368</span>&#160; </div>
<div class="line"><a name="l05369"></a><span class="lineno"> 5369</span>&#160;    <span class="keywordtype">int</span> qty = <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( 1, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( usable_ammo-&gt;<a class="code" href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">charges</a>,</div>
<div class="line"><a name="l05370"></a><span class="lineno"> 5370</span>&#160;                                     it-&gt;<a class="code" href="classitem.html#a084b8b7138242ba272d566bf49d007c3">ammo_capacity</a>( usable_ammo-&gt;<a class="code" href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">ammo_data</a>()-&gt;<a class="code" href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">ammo</a>-&gt;type ) - it-&gt;<a class="code" href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">ammo_remaining</a>() ) );</div>
<div class="line"><a name="l05371"></a><span class="lineno"> 5371</span>&#160;    <span class="keywordtype">int</span> reload_time = <a class="code" href="classCharacter.html#a57755c95d5b0189de2858f4ea2637b87">item_reload_cost</a>( *it, *usable_ammo, qty );</div>
<div class="line"><a name="l05372"></a><span class="lineno"> 5372</span>&#160;    <span class="comment">// TODO: Consider printing this info to player too</span></div>
<div class="line"><a name="l05373"></a><span class="lineno"> 5373</span>&#160;    <span class="keyword">const</span> std::string ammo_name = usable_ammo-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>();</div>
<div class="line"><a name="l05374"></a><span class="lineno"> 5374</span>&#160;    <span class="keywordflow">if</span>( !target.<a class="code" href="classitem.html#a9b7de1507e4000d58e9d813354073188">reload</a>( *<span class="keyword">this</span>, std::move( usable_ammo ), qty ) ) {</div>
<div class="line"><a name="l05375"></a><span class="lineno"> 5375</span>&#160;        <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;do_reload failed: item %s could not be reloaded with %ld charge(s) of %s&quot;</span>,</div>
<div class="line"><a name="l05376"></a><span class="lineno"> 5376</span>&#160;                  it-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>(), qty, ammo_name );</div>
<div class="line"><a name="l05377"></a><span class="lineno"> 5377</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l05378"></a><span class="lineno"> 5378</span>&#160;    }</div>
<div class="line"><a name="l05379"></a><span class="lineno"> 5379</span>&#160; </div>
<div class="line"><a name="l05380"></a><span class="lineno"> 5380</span>&#160;    <a class="code" href="classCreature.html#a891bc2d0c564449cb462178317819254">mod_moves</a>( -reload_time );</div>
<div class="line"><a name="l05381"></a><span class="lineno"> 5381</span>&#160;    <a class="code" href="classCharacter.html#a057d68671b298012a18f4e289b39935d">recoil</a> = <a class="code" href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a>;</div>
<div class="line"><a name="l05382"></a><span class="lineno"> 5382</span>&#160; </div>
<div class="line"><a name="l05383"></a><span class="lineno"> 5383</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="game_8cpp.html#ab5c977b7e81348725fb7bf09fc64ed95">get_player_view</a>().<a class="code" href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">sees</a>( *<span class="keyword">this</span> ) ) {</div>
<div class="line"><a name="l05384"></a><span class="lineno"> 5384</span>&#160;        <a class="code" href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a>( <a class="code" href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a>( <span class="stringliteral">&quot;%1$s reloads their %2$s.&quot;</span> ), <a class="code" href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">get_name</a>(), it-&gt;<a class="code" href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">tname</a>() );</div>
<div class="line"><a name="l05385"></a><span class="lineno"> 5385</span>&#160;        <a class="code" href="namespacesfx.html#a8fa2bb887ac81392fb686cc4079b5d5a">sfx::play_variant_sound</a>( <span class="stringliteral">&quot;reload&quot;</span>, it-&gt;<a class="code" href="classitem.html#a4a9972e826d25be6736b749ab94b230f">typeId</a>().<a class="code" href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">str</a>(), <a class="code" href="namespacesfx.html#a1f138eaa92db132e81ce591751c512cc">sfx::get_heard_volume</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ),</div>
<div class="line"><a name="l05386"></a><span class="lineno"> 5386</span>&#160;                                 <a class="code" href="namespacesfx.html#aa186eb63210729f73d7c76dcda527ff5">sfx::get_heard_angle</a>( <a class="code" href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">pos</a>() ) );</div>
<div class="line"><a name="l05387"></a><span class="lineno"> 5387</span>&#160;    }</div>
<div class="line"><a name="l05388"></a><span class="lineno"> 5388</span>&#160; </div>
<div class="line"><a name="l05389"></a><span class="lineno"> 5389</span>&#160;    <span class="comment">// Otherwise the NPC may not equip the weapon until they see danger</span></div>
<div class="line"><a name="l05390"></a><span class="lineno"> 5390</span>&#160;    <a class="code" href="classnpc.html#a9ca344b214e47beec525f78ebc83dc64">has_new_items</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05391"></a><span class="lineno"> 5391</span>&#160;}</div>
<div class="line"><a name="l05392"></a><span class="lineno"> 5392</span>&#160; </div>
<div class="line"><a name="l05393"></a><span class="lineno"><a class="line" href="classnpc.html#aaf81f803ffb0e285d1af4c5b5de6c7d5"> 5393</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classnpc.html#aaf81f803ffb0e285d1af4c5b5de6c7d5">npc::adjust_worn</a>()</div>
<div class="line"><a name="l05394"></a><span class="lineno"> 5394</span>&#160;{</div>
<div class="line"><a name="l05395"></a><span class="lineno"> 5395</span>&#160;    <span class="keywordtype">bool</span> any_broken = <span class="keyword">false</span>;</div>
<div class="line"><a name="l05396"></a><span class="lineno"> 5396</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="classint__id.html">bodypart_id</a> &amp;<a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> : <a class="code" href="classCreature.html#a4537397ede1aea8ecec28183252aabe3">get_all_body_parts</a>() ) {</div>
<div class="line"><a name="l05397"></a><span class="lineno"> 5397</span>&#160;        <span class="keywordflow">if</span>( <a class="code" href="classCharacter.html#ac2245aed6c7279986f42ef9208e816c0">is_limb_broken</a>( <a class="code" href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a> ) ) {</div>
<div class="line"><a name="l05398"></a><span class="lineno"> 5398</span>&#160;            any_broken = <span class="keyword">true</span>;</div>
<div class="line"><a name="l05399"></a><span class="lineno"> 5399</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l05400"></a><span class="lineno"> 5400</span>&#160;        }</div>
<div class="line"><a name="l05401"></a><span class="lineno"> 5401</span>&#160;    }</div>
<div class="line"><a name="l05402"></a><span class="lineno"> 5402</span>&#160; </div>
<div class="line"><a name="l05403"></a><span class="lineno"> 5403</span>&#160;    <span class="keywordflow">if</span>( !any_broken ) {</div>
<div class="line"><a name="l05404"></a><span class="lineno"> 5404</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05405"></a><span class="lineno"> 5405</span>&#160;    }</div>
<div class="line"><a name="l05406"></a><span class="lineno"> 5406</span>&#160; </div>
<div class="line"><a name="l05407"></a><span class="lineno"> 5407</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="classCharacter.html#a46302dc71cfc84856e8af85ddb61c7e1">worn</a>.<a class="code" href="classoutfit.html#ac07ab91b69bc4e7b435dd9e6af4d3407">adjust_worn</a>( *<span class="keyword">this</span> );</div>
<div class="line"><a name="l05408"></a><span class="lineno"> 5408</span>&#160;}</div>
<div class="line"><a name="l05409"></a><span class="lineno"> 5409</span>&#160; </div>
<div class="line"><a name="l05410"></a><span class="lineno"><a class="line" href="classoutfit.html#ac07ab91b69bc4e7b435dd9e6af4d3407"> 5410</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classoutfit.html#ac07ab91b69bc4e7b435dd9e6af4d3407">outfit::adjust_worn</a>( <a class="code" href="classnpc.html">npc</a> &amp;guy )</div>
<div class="line"><a name="l05411"></a><span class="lineno"> 5411</span>&#160;{</div>
<div class="line"><a name="l05412"></a><span class="lineno"> 5412</span>&#160;    <span class="keyword">const</span> <span class="keyword">auto</span> covers_broken = [&amp;guy]( <span class="keyword">const</span> <a class="code" href="classitem.html">item</a> &amp; it, <a class="code" href="subbodypart_8h.html#ae70ba95c272bf8b7296bc0df8bcd03e4">side</a> s ) {</div>
<div class="line"><a name="l05413"></a><span class="lineno"> 5413</span>&#160;        <span class="keyword">const</span> <a class="code" href="classbody__part__set.html">body_part_set</a> covered = it.<a class="code" href="classitem.html#aa370bf267d606ed6098dc9d1c518ebf5">get_covered_body_parts</a>( s );</div>
<div class="line"><a name="l05414"></a><span class="lineno"> 5414</span>&#160;        <span class="keywordflow">for</span>( <span class="keyword">const</span> std::pair&lt;const bodypart_str_id, bodypart&gt; &amp;elem : guy.<a class="code" href="classCreature.html#ac4dbde454c86b3296f53681c60612974">get_body</a>() ) {</div>
<div class="line"><a name="l05415"></a><span class="lineno"> 5415</span>&#160;            <span class="keywordflow">if</span>( elem.second.get_hp_cur() &lt;= 0 &amp;&amp; covered.<a class="code" href="classbody__part__set.html#ac4e5ce7eea67f44279a4db416a7903cd">test</a>( elem.first ) ) {</div>
<div class="line"><a name="l05416"></a><span class="lineno"> 5416</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05417"></a><span class="lineno"> 5417</span>&#160;            }</div>
<div class="line"><a name="l05418"></a><span class="lineno"> 5418</span>&#160;        }</div>
<div class="line"><a name="l05419"></a><span class="lineno"> 5419</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05420"></a><span class="lineno"> 5420</span>&#160;    };</div>
<div class="line"><a name="l05421"></a><span class="lineno"> 5421</span>&#160; </div>
<div class="line"><a name="l05422"></a><span class="lineno"> 5422</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> &amp;elem : <a class="code" href="classoutfit.html#ace7613f56f5afd81a6d043691cd8b887">worn</a> ) {</div>
<div class="line"><a name="l05423"></a><span class="lineno"> 5423</span>&#160;        <span class="keywordflow">if</span>( !elem.has_flag( <a class="code" href="flag_8cpp.html#ad12eb85cdd376a51aa3859ca5894377b">flag_SPLINT</a> ) ) {</div>
<div class="line"><a name="l05424"></a><span class="lineno"> 5424</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l05425"></a><span class="lineno"> 5425</span>&#160;        }</div>
<div class="line"><a name="l05426"></a><span class="lineno"> 5426</span>&#160; </div>
<div class="line"><a name="l05427"></a><span class="lineno"> 5427</span>&#160;        <span class="keywordflow">if</span>( !covers_broken( elem, elem.get_side() ) ) {</div>
<div class="line"><a name="l05428"></a><span class="lineno"> 5428</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">bool</span> needs_change = covers_broken( elem, <a class="code" href="bodypart_8cpp.html#a7e67f6bbe865282540080a39151106c6">opposite_side</a>( elem.get_side() ) );</div>
<div class="line"><a name="l05429"></a><span class="lineno"> 5429</span>&#160;            <span class="comment">//create an item_location for takeoff() to handle.</span></div>
<div class="line"><a name="l05430"></a><span class="lineno"> 5430</span>&#160;            <a class="code" href="classitem__location.html">item_location</a> loc_for_takeoff = <a class="code" href="classitem__location.html">item_location</a>( guy, &amp;elem );</div>
<div class="line"><a name="l05431"></a><span class="lineno"> 5431</span>&#160;            <span class="comment">// Try to change side (if it makes sense), or take off.</span></div>
<div class="line"><a name="l05432"></a><span class="lineno"> 5432</span>&#160;            std::list&lt;item&gt; temp_list;</div>
<div class="line"><a name="l05433"></a><span class="lineno"> 5433</span>&#160;            <span class="keywordflow">if</span>( ( needs_change &amp;&amp; guy.<a class="code" href="classCharacter.html#a8c67a9a553e858645037e7a5abe6a41a">change_side</a>( elem ) ) || <a class="code" href="classoutfit.html#a59316384f010c280db9c30d8e14d005a">takeoff</a>( loc_for_takeoff, &amp;temp_list, guy ) ) {</div>
<div class="line"><a name="l05434"></a><span class="lineno"> 5434</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l05435"></a><span class="lineno"> 5435</span>&#160;            }</div>
<div class="line"><a name="l05436"></a><span class="lineno"> 5436</span>&#160;        }</div>
<div class="line"><a name="l05437"></a><span class="lineno"> 5437</span>&#160;    }</div>
<div class="line"><a name="l05438"></a><span class="lineno"> 5438</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l05439"></a><span class="lineno"> 5439</span>&#160;}</div>
<div class="line"><a name="l05440"></a><span class="lineno"> 5440</span>&#160; </div>
<div class="line"><a name="l05441"></a><span class="lineno"><a class="line" href="classnpc.html#a3ea18f464bd67891e058ad91de84fe55"> 5441</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classnpc.html#a3ea18f464bd67891e058ad91de84fe55">npc::set_movement_mode</a>( <span class="keyword">const</span> <a class="code" href="classstring__id.html">move_mode_id</a> &amp;new_mode )</div>
<div class="line"><a name="l05442"></a><span class="lineno"> 5442</span>&#160;{</div>
<div class="line"><a name="l05443"></a><span class="lineno"> 5443</span>&#160;    <span class="comment">// Enchantments based on move modes can stack inappropriately without a recalc here</span></div>
<div class="line"><a name="l05444"></a><span class="lineno"> 5444</span>&#160;    <a class="code" href="classCharacter.html#aa6396870f289f9c3b1dc4ea91f7a65f0">recalculate_enchantment_cache</a>();</div>
<div class="line"><a name="l05445"></a><span class="lineno"> 5445</span>&#160;    <a class="code" href="classmove__mode.html">move_mode</a> = new_mode;</div>
<div class="line"><a name="l05446"></a><span class="lineno"> 5446</span>&#160;}</div>
<div class="ttc" id="aachievement_8cpp_html_a89b60f534d269451d6fdb9be657dcb09a98bd1c45684cf587ac2347a92dd7bb51"><div class="ttname"><a href="achievement_8cpp.html#a89b60f534d269451d6fdb9be657dcb09a98bd1c45684cf587ac2347a92dd7bb51">requirement_visibility::last</a></div><div class="ttdeci">@ last</div></div>
<div class="ttc" id="aactive__item__cache_8h_html"><div class="ttname"><a href="active__item__cache_8h.html">active_item_cache.h</a></div></div>
<div class="ttc" id="aactive__item__cache_8h_html_acc683dc9a32f0cb3fb0032b41c6e17b5a16ec845a09700f77aea693ee40434e73"><div class="ttname"><a href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5a16ec845a09700f77aea693ee40434e73">special_item_type::explosive</a></div><div class="ttdeci">@ explosive</div></div>
<div class="ttc" id="aactive__item__cache_8h_html_acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f"><div class="ttname"><a href="active__item__cache_8h.html#acc683dc9a32f0cb3fb0032b41c6e17b5ae89196f1cb52069efe1f4bf0942bcb7f">special_item_type::corpse</a></div><div class="ttdeci">@ corpse</div></div>
<div class="ttc" id="aactivity__handlers_8h_html"><div class="ttname"><a href="activity__handlers_8h.html">activity_handlers.h</a></div></div>
<div class="ttc" id="aactivity__handlers_8h_html_a92427c4a20720f251807f7e70db0640b"><div class="ttname"><a href="activity__handlers_8h.html#a92427c4a20720f251807f7e70db0640b">generic_multi_activity_handler</a></div><div class="ttdeci">bool generic_multi_activity_handler(player_activity &amp;act, Character &amp;you, bool check_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="activity__item__handling_8cpp_source.html#l03153">activity_item_handling.cpp:3153</a></div></div>
<div class="ttc" id="aammo_8h_html"><div class="ttname"><a href="ammo_8h.html">ammo.h</a></div></div>
<div class="ttc" id="aavatar_8cpp_html_a75dcf1534079311161f26d7250306379"><div class="ttname"><a href="avatar_8cpp.html#a75dcf1534079311161f26d7250306379">get_talker_for</a></div><div class="ttdeci">std::unique_ptr&lt; talker &gt; get_talker_for(avatar &amp;me)</div><div class="ttdef"><b>Definition:</b> <a href="avatar_8cpp_source.html#l01795">avatar.cpp:1795</a></div></div>
<div class="ttc" id="aavatar_8h_html"><div class="ttname"><a href="avatar_8h.html">avatar.h</a></div></div>
<div class="ttc" id="aavatar_8h_html_a7fe2c1a3376948380f856732d4f34c5c"><div class="ttname"><a href="avatar_8h.html#a7fe2c1a3376948380f856732d4f34c5c">get_avatar</a></div><div class="ttdeci">avatar &amp; get_avatar()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13817">game.cpp:13817</a></div></div>
<div class="ttc" id="abasecamp_8h_html"><div class="ttname"><a href="basecamp_8h.html">basecamp.h</a></div></div>
<div class="ttc" id="abionics_8h_html"><div class="ttname"><a href="bionics_8h.html">bionics.h</a></div></div>
<div class="ttc" id="abodypart_8cpp_html_a7e67f6bbe865282540080a39151106c6"><div class="ttname"><a href="bodypart_8cpp.html#a7e67f6bbe865282540080a39151106c6">opposite_side</a></div><div class="ttdeci">side opposite_side(side s)</div><div class="ttdoc">Returns the opposite side.</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8cpp_source.html#l00040">bodypart.cpp:40</a></div></div>
<div class="ttc" id="abodypart_8cpp_html_aa1af101175ef4c9194f748dd67829fa9"><div class="ttname"><a href="bodypart_8cpp.html#aa1af101175ef4c9194f748dd67829fa9">body_part_torso</a></div><div class="ttdeci">const bodypart_str_id body_part_torso(&quot;torso&quot;)</div></div>
<div class="ttc" id="abodypart_8cpp_html_ac9aaf0eca53f33436ba15a5b29f68a16"><div class="ttname"><a href="bodypart_8cpp.html#ac9aaf0eca53f33436ba15a5b29f68a16">body_part_name</a></div><div class="ttdeci">std::string body_part_name(const bodypart_id &amp;bp, int number)</div><div class="ttdoc">Returns the matching name of the body_part token.</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8cpp_source.html#l00791">bodypart.cpp:791</a></div></div>
<div class="ttc" id="abodypart_8cpp_html_ade2e301ed150ac0191c87e8fb19420c1"><div class="ttname"><a href="bodypart_8cpp.html#ade2e301ed150ac0191c87e8fb19420c1">body_part_head</a></div><div class="ttdeci">const bodypart_str_id body_part_head(&quot;head&quot;)</div></div>
<div class="ttc" id="abodypart_8h_html"><div class="ttname"><a href="bodypart_8h.html">bodypart.h</a></div></div>
<div class="ttc" id="abodypart_8h_html_a426444e2d486ce1ee315d8b8acc86b40"><div class="ttname"><a href="bodypart_8h.html#a426444e2d486ce1ee315d8b8acc86b40">bodypart_id</a></div><div class="ttdeci">int_id&lt; body_part_type &gt; bodypart_id</div><div class="ttdef"><b>Definition:</b> <a href="bodypart_8h_source.html#l00032">bodypart.h:32</a></div></div>
<div class="ttc" id="acalendar_8cpp_html_a4249b6f1d0842211bfe53e5f9e206a10"><div class="ttname"><a href="calendar_8cpp.html#a4249b6f1d0842211bfe53e5f9e206a10">rng</a></div><div class="ttdeci">time_duration rng(time_duration lo, time_duration hi)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00779">calendar.cpp:779</a></div></div>
<div class="ttc" id="acata__algo_8h_html"><div class="ttname"><a href="cata__algo_8h.html">cata_algo.h</a></div></div>
<div class="ttc" id="acata__tiles_8h_html_affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667"><div class="ttname"><a href="cata__tiles_8h.html#affa90804269b044a43867f93746f8f8eaadb115059e28d960fa8badfac5516667">text_alignment::center</a></div><div class="ttdeci">@ center</div></div>
<div class="ttc" id="acata__variant_8h_html_adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9"><div class="ttname"><a href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a78ee54aa8f813885fe2fe20d232518b9">cata_variant_type::point</a></div><div class="ttdeci">@ point</div></div>
<div class="ttc" id="acharacter_8h_html"><div class="ttname"><a href="character_8h.html">character.h</a></div></div>
<div class="ttc" id="acharacter_8h_html_a28256deb3e43854efdc7035ae555212ba18eb54216d0a6c8fcfcc347228e1d8d3"><div class="ttname"><a href="character_8h.html#a28256deb3e43854efdc7035ae555212ba18eb54216d0a6c8fcfcc347228e1d8d3">sleepiness_levels::TIRED</a></div><div class="ttdeci">@ TIRED</div></div>
<div class="ttc" id="acharacter_8h_html_a28256deb3e43854efdc7035ae555212baa82737450ee7c37246cff4af1541525d"><div class="ttname"><a href="character_8h.html#a28256deb3e43854efdc7035ae555212baa82737450ee7c37246cff4af1541525d">sleepiness_levels::MASSIVE_SLEEPINESS</a></div><div class="ttdeci">@ MASSIVE_SLEEPINESS</div></div>
<div class="ttc" id="acharacter_8h_html_abaafa6561de05c3b1324214e3048745a"><div class="ttname"><a href="character_8h.html#abaafa6561de05c3b1324214e3048745a">get_player_character</a></div><div class="ttdeci">Character &amp; get_player_character()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13807">game.cpp:13807</a></div></div>
<div class="ttc" id="acharacter__id_8h_html"><div class="ttname"><a href="character__id_8h.html">character_id.h</a></div></div>
<div class="ttc" id="aclassCharacter_html"><div class="ttname"><a href="classCharacter.html">Character</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00522">character.h:523</a></div></div>
<div class="ttc" id="aclassCharacter_html_a01a7950e28e24252e372d7e74078e12f"><div class="ttname"><a href="classCharacter.html#a01a7950e28e24252e372d7e74078e12f">Character::as_character</a></div><div class="ttdeci">Character * as_character() override</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00532">character.h:532</a></div></div>
<div class="ttc" id="aclassCharacter_html_a038091eadd59de4a96565c17a7b85484"><div class="ttname"><a href="classCharacter.html#a038091eadd59de4a96565c17a7b85484">Character::get_pseudo_items</a></div><div class="ttdeci">std::vector&lt; const item * &gt; get_pseudo_items() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02666">character.cpp:2666</a></div></div>
<div class="ttc" id="aclassCharacter_html_a03a17861579bf099c665ca234cd2a3b5"><div class="ttname"><a href="classCharacter.html#a03a17861579bf099c665ca234cd2a3b5">Character::can_stash</a></div><div class="ttdeci">bool can_stash(const item &amp;it, bool ignore_pkt_settings=false)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01494">character.cpp:1494</a></div></div>
<div class="ttc" id="aclassCharacter_html_a05331bfbde3df1348a870d987597d29a"><div class="ttname"><a href="classCharacter.html#a05331bfbde3df1348a870d987597d29a">Character::get_weapon_dispersion</a></div><div class="ttdeci">dispersion_sources get_weapon_dispersion(const item &amp;obj) const</div><div class="ttdoc">Returns a weapon's modified dispersion value.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02290">ranged.cpp:2290</a></div></div>
<div class="ttc" id="aclassCharacter_html_a057d68671b298012a18f4e289b39935d"><div class="ttname"><a href="classCharacter.html#a057d68671b298012a18f4e289b39935d">Character::recoil</a></div><div class="ttdeci">double recoil</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01117">character.h:1117</a></div></div>
<div class="ttc" id="aclassCharacter_html_a05af3f6fab8229b6c4439481421e80b6"><div class="ttname"><a href="classCharacter.html#a05af3f6fab8229b6c4439481421e80b6">Character::get_auto_move_route</a></div><div class="ttdeci">std::vector&lt; tripoint_bub_ms &gt; &amp; get_auto_move_route()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11485">character.cpp:11485</a></div></div>
<div class="ttc" id="aclassCharacter_html_a0bdec852c8280a1cb4bb5e45e14057b5"><div class="ttname"><a href="classCharacter.html#a0bdec852c8280a1cb4bb5e45e14057b5">Character::weight_capacity</a></div><div class="ttdeci">units::mass weight_capacity() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03197">character.cpp:3197</a></div></div>
<div class="ttc" id="aclassCharacter_html_a0e8509fc038cee083b5a7cc7bdf0f8f9"><div class="ttname"><a href="classCharacter.html#a0e8509fc038cee083b5a7cc7bdf0f8f9">Character::cache_get_items_with</a></div><div class="ttdeci">std::vector&lt; item * &gt; cache_get_items_with(const itype_id &amp;type, const std::function&lt; bool(item &amp;)&gt; &amp;do_and_check_func=return_true&lt; item &gt;)</div><div class="ttdoc">Returns all items with the given flag and/or that pass the given boolean item function,...</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09494">character.cpp:9494</a></div></div>
<div class="ttc" id="aclassCharacter_html_a1012850d13ca8a58bcf82aa75b3a55d1"><div class="ttname"><a href="classCharacter.html#a1012850d13ca8a58bcf82aa75b3a55d1">Character::pause</a></div><div class="ttdeci">void pause()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l13218">character.cpp:13218</a></div></div>
<div class="ttc" id="aclassCharacter_html_a15e1412dda3489886688216c4ef7da34"><div class="ttname"><a href="classCharacter.html#a15e1412dda3489886688216c4ef7da34">Character::get_consume_time</a></div><div class="ttdeci">time_duration get_consume_time(const item &amp;it) const</div><div class="ttdef"><b>Definition:</b> <a href="consumption_8cpp_source.html#l01709">consumption.cpp:1709</a></div></div>
<div class="ttc" id="aclassCharacter_html_a16c0c32345164bcdcfe6236977164fd8"><div class="ttname"><a href="classCharacter.html#a16c0c32345164bcdcfe6236977164fd8">Character::fac_id</a></div><div class="ttdeci">faction_id fac_id</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l03958">character.h:3958</a></div></div>
<div class="ttc" id="aclassCharacter_html_a17213386e132fbde5ce772f04e22f5ba"><div class="ttname"><a href="classCharacter.html#a17213386e132fbde5ce772f04e22f5ba">Character::cash</a></div><div class="ttdeci">int cash</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02760">character.h:2760</a></div></div>
<div class="ttc" id="aclassCharacter_html_a17446e14fd6046648a505c4aaec3d976"><div class="ttname"><a href="classCharacter.html#a17446e14fd6046648a505c4aaec3d976">Character::mod_power_level</a></div><div class="ttdeci">void mod_power_level(const units::energy &amp;npower)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02852">character.cpp:2852</a></div></div>
<div class="ttc" id="aclassCharacter_html_a1881ce22e9f108fea6ff32da4d4accc2"><div class="ttname"><a href="classCharacter.html#a1881ce22e9f108fea6ff32da4d4accc2">Character::use</a></div><div class="ttdeci">void use(int inventory_position)</div><div class="ttdoc">Uses a tool.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l13037">character.cpp:13037</a></div></div>
<div class="ttc" id="aclassCharacter_html_a1e1996b6d6fc0a86d917cd155e1656d8"><div class="ttname"><a href="classCharacter.html#a1e1996b6d6fc0a86d917cd155e1656d8">Character::disp_name</a></div><div class="ttdeci">std::string disp_name(bool possessive=false, bool capitalize_first=false) const override</div><div class="ttdoc">Returns either &quot;you&quot; or the player's name.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00829">character.cpp:829</a></div></div>
<div class="ttc" id="aclassCharacter_html_a20839520f569c4f05876a55e89f67361"><div class="ttname"><a href="classCharacter.html#a20839520f569c4f05876a55e89f67361">Character::activity</a></div><div class="ttdeci">player_activity activity</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02709">character.h:2709</a></div></div>
<div class="ttc" id="aclassCharacter_html_a22c61a1b7ab6ae71a3cac5f92bca2fd5"><div class="ttname"><a href="classCharacter.html#a22c61a1b7ab6ae71a3cac5f92bca2fd5">Character::melee_attack</a></div><div class="ttdeci">bool melee_attack(Creature &amp;t, bool allow_special, const matec_id &amp;force_technique, bool allow_unarmed=true, int forced_movecost=-1)</div><div class="ttdoc">Sets up a melee attack and handles melee attack function calls.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l00563">melee.cpp:563</a></div></div>
<div class="ttc" id="aclassCharacter_html_a241e50ee41a2a2b54f1c1329cb60a174"><div class="ttname"><a href="classCharacter.html#a241e50ee41a2a2b54f1c1329cb60a174">Character::get_sleepiness</a></div><div class="ttdeci">int get_sleepiness() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04604">character.cpp:4604</a></div></div>
<div class="ttc" id="aclassCharacter_html_a264388843c2319708b9f727da5d15a81"><div class="ttname"><a href="classCharacter.html#a264388843c2319708b9f727da5d15a81">Character::get_weight</a></div><div class="ttdeci">units::mass get_weight() const override</div><div class="ttdoc">Returns body weight plus weight of inventory and worn/wielded items.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03889">character.cpp:3889</a></div></div>
<div class="ttc" id="aclassCharacter_html_a28028d965c0eaed38c5e132f52bf41cf"><div class="ttname"><a href="classCharacter.html#a28028d965c0eaed38c5e132f52bf41cf">Character::cached_info</a></div><div class="ttdeci">std::map&lt; std::string, double &gt; cached_info</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l03898">character.h:3898</a></div></div>
<div class="ttc" id="aclassCharacter_html_a2aa50df39ac7262f946b9d2a4d152e31"><div class="ttname"><a href="classCharacter.html#a2aa50df39ac7262f946b9d2a4d152e31">Character::camps</a></div><div class="ttdeci">std::set&lt; tripoint_abs_omt &gt; camps</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02766">character.h:2766</a></div></div>
<div class="ttc" id="aclassCharacter_html_a2b208d2f40f1ae46337013f16c4a30a3"><div class="ttname"><a href="classCharacter.html#a2b208d2f40f1ae46337013f16c4a30a3">Character::get_fueled_bionics</a></div><div class="ttdeci">std::vector&lt; bionic_id &gt; get_fueled_bionics() const</div><div class="ttdoc">Return bionic_id of fueled bionics.</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l03288">bionics.cpp:3288</a></div></div>
<div class="ttc" id="aclassCharacter_html_a2b38269bfb5ffc4edef08f904bd487f6"><div class="ttname"><a href="classCharacter.html#a2b38269bfb5ffc4edef08f904bd487f6">Character::check_outbounds_activity</a></div><div class="ttdeci">bool check_outbounds_activity(const player_activity &amp;act, bool check_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01553">character.cpp:1553</a></div></div>
<div class="ttc" id="aclassCharacter_html_a2d0c03e2157953bcc0a6941554467233"><div class="ttname"><a href="classCharacter.html#a2d0c03e2157953bcc0a6941554467233">Character::melee_value</a></div><div class="ttdeci">double melee_value(const item &amp;weap) const</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l02814">melee.cpp:2814</a></div></div>
<div class="ttc" id="aclassCharacter_html_a30213377669d5f9a8288b1123e849205"><div class="ttname"><a href="classCharacter.html#a30213377669d5f9a8288b1123e849205">Character::set_sleepiness</a></div><div class="ttdeci">void set_sleepiness(int nsleepiness)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04554">character.cpp:4554</a></div></div>
<div class="ttc" id="aclassCharacter_html_a338396f1ca421f7f2284aec2eabf88fb"><div class="ttname"><a href="classCharacter.html#a338396f1ca421f7f2284aec2eabf88fb">Character::make_footstep_noise</a></div><div class="ttdeci">void make_footstep_noise() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02235">character.cpp:2235</a></div></div>
<div class="ttc" id="aclassCharacter_html_a33eb1760d53a4076bbf192bae1e4209f"><div class="ttname"><a href="classCharacter.html#a33eb1760d53a4076bbf192bae1e4209f">Character::move_in_vehicle</a></div><div class="ttdeci">bool move_in_vehicle(Creature *c, const tripoint &amp;dest_loc) const</div><div class="ttdoc">Attempt to enter a tile in a vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08021">character.cpp:8021</a></div></div>
<div class="ttc" id="aclassCharacter_html_a34a927d0f161ac92ab0d462397828bd5"><div class="ttname"><a href="classCharacter.html#a34a927d0f161ac92ab0d462397828bd5">Character::get_dex</a></div><div class="ttdeci">int get_dex() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04131">character.cpp:4131</a></div></div>
<div class="ttc" id="aclassCharacter_html_a37772343c5d5a20510bafe1890a5a839"><div class="ttname"><a href="classCharacter.html#a37772343c5d5a20510bafe1890a5a839">Character::move_effects</a></div><div class="ttdeci">bool move_effects(bool attacking) override</div><div class="ttdoc">Processes effects which may prevent the Character from moving (bear traps, crushed,...</div><div class="ttdef"><b>Definition:</b> <a href="character__escape_8cpp_source.html#l00373">character_escape.cpp:373</a></div></div>
<div class="ttc" id="aclassCharacter_html_a379081ad133b17e4ab3d230270b2414d"><div class="ttname"><a href="classCharacter.html#a379081ad133b17e4ab3d230270b2414d">Character::i_rem</a></div><div class="ttdeci">item i_rem(const item *it)</div><div class="ttdoc">Remove a specific item from player possession.</div><div class="ttdef"><b>Definition:</b> <a href="character__inventory_8cpp_source.html#l00433">character_inventory.cpp:433</a></div></div>
<div class="ttc" id="aclassCharacter_html_a37cbf03be0b64ebb45c3eb5cdb6a3b18"><div class="ttname"><a href="classCharacter.html#a37cbf03be0b64ebb45c3eb5cdb6a3b18">Character::assign_stashed_activity</a></div><div class="ttdeci">void assign_stashed_activity()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01546">character.cpp:1546</a></div></div>
<div class="ttc" id="aclassCharacter_html_a388bca3ef975bd265c67df45bb280bee"><div class="ttname"><a href="classCharacter.html#a388bca3ef975bd265c67df45bb280bee">Character::my_bionics</a></div><div class="ttdeci">pimpl&lt; bionic_collection &gt; my_bionics</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02723">character.h:2723</a></div></div>
<div class="ttc" id="aclassCharacter_html_a3e8d89aafa00fbeae676c54433ee6d75"><div class="ttname"><a href="classCharacter.html#a3e8d89aafa00fbeae676c54433ee6d75">Character::destination_point</a></div><div class="ttdeci">std::optional&lt; tripoint &gt; destination_point</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02711">character.h:2711</a></div></div>
<div class="ttc" id="aclassCharacter_html_a408e887059da5e9a0b1bfd7672ff392d"><div class="ttname"><a href="classCharacter.html#a408e887059da5e9a0b1bfd7672ff392d">Character::reach_attack</a></div><div class="ttdeci">void reach_attack(const tripoint &amp;p, int forced_movecost=-1)</div><div class="ttdoc">Handles reach melee attacks.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l01012">melee.cpp:1012</a></div></div>
<div class="ttc" id="aclassCharacter_html_a43b143f2db40723fbedb92899ac58601"><div class="ttname"><a href="classCharacter.html#a43b143f2db40723fbedb92899ac58601">Character::can_reload</a></div><div class="ttdeci">bool can_reload(const item &amp;it, const item *ammo=nullptr) const</div><div class="ttdoc">Whether a tool or gun is potentially reloadable (optionally considering a specific ammo)</div><div class="ttdef"><b>Definition:</b> <a href="character__ammo_8cpp_source.html#l00067">character_ammo.cpp:67</a></div></div>
<div class="ttc" id="aclassCharacter_html_a440c45f92704e6fe31024a90f10ac9c1"><div class="ttname"><a href="classCharacter.html#a440c45f92704e6fe31024a90f10ac9c1">Character::consume_charges</a></div><div class="ttdeci">bool consume_charges(item &amp;used, int qty)</div><div class="ttdoc">Consume charges of a tool or comestible item, potentially destroying it in the process.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l07239">character.cpp:7239</a></div></div>
<div class="ttc" id="aclassCharacter_html_a455c06bf0dab6e3558f759fe43e27e98"><div class="ttname"><a href="classCharacter.html#a455c06bf0dab6e3558f759fe43e27e98">Character::throw_range</a></div><div class="ttdeci">int throw_range(const item &amp;) const</div><div class="ttdoc">Maximum thrown range with a given item, taking all active effects into account.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l05937">character.cpp:5937</a></div></div>
<div class="ttc" id="aclassCharacter_html_a46302dc71cfc84856e8af85ddb61c7e1"><div class="ttname"><a href="classCharacter.html#a46302dc71cfc84856e8af85ddb61c7e1">Character::worn</a></div><div class="ttdeci">outfit worn</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02690">character.h:2690</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4eb1793aafe89d34ba7ab96bf9facc19"><div class="ttname"><a href="classCharacter.html#a4eb1793aafe89d34ba7ab96bf9facc19">Character::will_eat</a></div><div class="ttdeci">ret_val&lt; edible_rating &gt; will_eat(const item &amp;food, bool interactive=false) const</div><div class="ttdoc">Same as can_eat, but takes consequences into account.</div><div class="ttdef"><b>Definition:</b> <a href="consumption_8cpp_source.html#l00923">consumption.cpp:923</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4eddeb86babf626e7869882079b40651"><div class="ttname"><a href="classCharacter.html#a4eddeb86babf626e7869882079b40651">Character::can_use</a></div><div class="ttdeci">bool can_use(const item &amp;it, const item &amp;context=item()) const</div><div class="ttdoc">Checks if character stats and skills meet minimum requirements for the item.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03271">character.cpp:3271</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4f0bdbd929787a486a0dd5748ef10c65"><div class="ttname"><a href="classCharacter.html#a4f0bdbd929787a486a0dd5748ef10c65">Character::in_sleep_state</a></div><div class="ttdeci">bool in_sleep_state() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09307">character.cpp:9307</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4f0f412e4bec8d107de42bd34f1fa441"><div class="ttname"><a href="classCharacter.html#a4f0f412e4bec8d107de42bd34f1fa441">Character::volume_capacity</a></div><div class="ttdeci">units::volume volume_capacity() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08778">character.cpp:8778</a></div></div>
<div class="ttc" id="aclassCharacter_html_a4f949c2084af2abb310c92c08a8aa1cd"><div class="ttname"><a href="classCharacter.html#a4f949c2084af2abb310c92c08a8aa1cd">Character::hp_percentage</a></div><div class="ttdeci">int hp_percentage() const override</div><div class="ttdoc">Returns overall % of HP remaining.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l12783">character.cpp:12783</a></div></div>
<div class="ttc" id="aclassCharacter_html_a57755c95d5b0189de2858f4ea2637b87"><div class="ttname"><a href="classCharacter.html#a57755c95d5b0189de2858f4ea2637b87">Character::item_reload_cost</a></div><div class="ttdeci">int item_reload_cost(const item &amp;it, const item &amp;ammo, int qty) const</div><div class="ttdoc">Calculate (but do not deduct) the number of moves required to reload an item with specified quantity ...</div><div class="ttdef"><b>Definition:</b> <a href="character__ammo_8cpp_source.html#l00124">character_ammo.cpp:124</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5815e4a8e87aa5ac0faf6a045bdaf4c8"><div class="ttname"><a href="classCharacter.html#a5815e4a8e87aa5ac0faf6a045bdaf4c8">Character::get_stashed_activity</a></div><div class="ttdeci">player_activity get_stashed_activity() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01530">character.cpp:1530</a></div></div>
<div class="ttc" id="aclassCharacter_html_a581c2e6646bc18796f26d3c18e38120a"><div class="ttname"><a href="classCharacter.html#a581c2e6646bc18796f26d3c18e38120a">Character::available_ups</a></div><div class="ttdeci">units::energy available_ups() const</div><div class="ttdoc">Available ups from all sources Sum of mech, bionic UPS and UPS.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09642">character.cpp:9642</a></div></div>
<div class="ttc" id="aclassCharacter_html_a588d5cc1d729490552fe03b006685ae5"><div class="ttname"><a href="classCharacter.html#a588d5cc1d729490552fe03b006685ae5">Character::get_int</a></div><div class="ttdeci">int get_int() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04139">character.cpp:4139</a></div></div>
<div class="ttc" id="aclassCharacter_html_a5929e955c11ee6c749447472df7c774d"><div class="ttname"><a href="classCharacter.html#a5929e955c11ee6c749447472df7c774d">Character::weight_carried</a></div><div class="ttdeci">units::mass weight_carried() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03088">character.cpp:3088</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6186c819cc348b5a060e140b5bab8226"><div class="ttname"><a href="classCharacter.html#a6186c819cc348b5a060e140b5bab8226">Character::has_activity</a></div><div class="ttdeci">bool has_activity(const activity_id &amp;type) const</div><div class="ttdoc">Check if player currently has a given activity.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08973">character.cpp:8973</a></div></div>
<div class="ttc" id="aclassCharacter_html_a61bc9422c35b63128532af268e52cb71"><div class="ttname"><a href="classCharacter.html#a61bc9422c35b63128532af268e52cb71">Character::in_vehicle</a></div><div class="ttdeci">bool in_vehicle</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02693">character.h:2693</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6243be833eae8764b8dc841fb05cf867"><div class="ttname"><a href="classCharacter.html#a6243be833eae8764b8dc841fb05cf867">Character::aim_per_move</a></div><div class="ttdeci">double aim_per_move(const item &amp;gun, double recoil, const Target_attributes &amp;target_attributes=Target_attributes(), std::optional&lt; std::reference_wrapper&lt; const aim_mods_cache &gt;&gt; aim_cache=std::nullopt) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01087">character.cpp:1087</a></div></div>
<div class="ttc" id="aclassCharacter_html_a637b69da1eaea75f12d248d14c939703"><div class="ttname"><a href="classCharacter.html#a637b69da1eaea75f12d248d14c939703">Character::clairvoyance</a></div><div class="ttdeci">int clairvoyance() const</div><div class="ttdoc">Returns the distance the player can see through walls.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01333">character.cpp:1333</a></div></div>
<div class="ttc" id="aclassCharacter_html_a64b5eefd36bce677403f1912c414f977"><div class="ttname"><a href="classCharacter.html#a64b5eefd36bce677403f1912c414f977">Character::gun_value</a></div><div class="ttdeci">double gun_value(const item &amp;weap, int ammo=10) const</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l02339">ranged.cpp:2339</a></div></div>
<div class="ttc" id="aclassCharacter_html_a64c7f6bc50109cd6e720c3c9bd4fc544"><div class="ttname"><a href="classCharacter.html#a64c7f6bc50109cd6e720c3c9bd4fc544">Character::visit_items</a></div><div class="ttdeci">VisitResponse visit_items(const std::function&lt; VisitResponse(item *, item *)&gt; &amp;func) const override</div><div class="ttdoc">Traverses this object and any child items contained using a visitor pattern.</div></div>
<div class="ttc" id="aclassCharacter_html_a6592c35167738421f3e04ca8808d37db"><div class="ttname"><a href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">Character::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02684">character.h:2684</a></div></div>
<div class="ttc" id="aclassCharacter_html_a67b51491c2529df09755e07bc633cc55"><div class="ttname"><a href="classCharacter.html#a67b51491c2529df09755e07bc633cc55">Character::is_mounted</a></div><div class="ttdeci">bool is_mounted() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01732">character.cpp:1732</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6853521cfe7399330d90c08271e003b4"><div class="ttname"><a href="classCharacter.html#a6853521cfe7399330d90c08271e003b4">Character::throwing_dispersion</a></div><div class="ttdeci">int throwing_dispersion(const item &amp;to_throw, Creature *critter=nullptr, bool is_blind_throw=false) const</div><div class="ttdoc">Dispersion of a thrown item, against a given target, taking into account whether or not the throw was...</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01183">ranged.cpp:1183</a></div></div>
<div class="ttc" id="aclassCharacter_html_a68aa2ae54953a601b5dc27ec7c380b53"><div class="ttname"><a href="classCharacter.html#a68aa2ae54953a601b5dc27ec7c380b53">Character::list_ammo</a></div><div class="ttdeci">bool list_ammo(const item_location &amp;base, std::vector&lt; item::reload_option &gt; &amp;ammo_list, bool empty=true) const</div><div class="ttdef"><b>Definition:</b> <a href="character__ammo_8cpp_source.html#l00083">character_ammo.cpp:83</a></div></div>
<div class="ttc" id="aclassCharacter_html_a68de7da109abd90b4f2210057c982fe0"><div class="ttname"><a href="classCharacter.html#a68de7da109abd90b4f2210057c982fe0">Character::get_perceived_pain</a></div><div class="ttdeci">int get_perceived_pain() const override</div><div class="ttdoc">Returns perceived pain (reduced with painkillers)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l12517">character.cpp:12517</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6dc61c40fa13a6124b53785c9db13e70"><div class="ttname"><a href="classCharacter.html#a6dc61c40fa13a6124b53785c9db13e70">Character::can_pickWeight</a></div><div class="ttdeci">bool can_pickWeight(const item &amp;it, bool safe=true) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03251">character.cpp:3251</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6e191f46038ed0321be507015b5abc58"><div class="ttname"><a href="classCharacter.html#a6e191f46038ed0321be507015b5abc58">Character::weapon_value</a></div><div class="ttdeci">double weapon_value(const item &amp;weap, int ammo=10) const</div><div class="ttdoc">NPC-related item rating functions.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l02781">melee.cpp:2781</a></div></div>
<div class="ttc" id="aclassCharacter_html_a6e24aab61f2ff8333a4f938cce785b3f"><div class="ttname"><a href="classCharacter.html#a6e24aab61f2ff8333a4f938cce785b3f">Character::guts</a></div><div class="ttdeci">stomach_contents guts</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02729">character.h:2729</a></div></div>
<div class="ttc" id="aclassCharacter_html_a73e94730498f4353bf773eba0c3dd69a"><div class="ttname"><a href="classCharacter.html#a73e94730498f4353bf773eba0c3dd69a">Character::has_destination_activity</a></div><div class="ttdeci">bool has_destination_activity() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11468">character.cpp:11468</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7bb3c92bba69a2421c07748f57aa4d82"><div class="ttname"><a href="classCharacter.html#a7bb3c92bba69a2421c07748f57aa4d82">Character::set_hunger</a></div><div class="ttdeci">void set_hunger(int nhunger)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04493">character.cpp:4493</a></div></div>
<div class="ttc" id="aclassCharacter_html_a7f95b5332e70af7ccf1d46fe7a3484f6"><div class="ttname"><a href="classCharacter.html#a7f95b5332e70af7ccf1d46fe7a3484f6">Character::has_destination</a></div><div class="ttdeci">bool has_destination() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11463">character.cpp:11463</a></div></div>
<div class="ttc" id="aclassCharacter_html_a81864eee5b75943bd4222b696117a52a"><div class="ttname"><a href="classCharacter.html#a81864eee5b75943bd4222b696117a52a">Character::is_wielding</a></div><div class="ttdeci">bool is_wielding(const item &amp;target) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03319">character.cpp:3319</a></div></div>
<div class="ttc" id="aclassCharacter_html_a824a60fef8920f38a6f1e1b35bea4879"><div class="ttname"><a href="classCharacter.html#a824a60fef8920f38a6f1e1b35bea4879">Character::get_stored_kcal</a></div><div class="ttdeci">int get_stored_kcal() const</div><div class="ttdoc">Getter for need values exclusive to characters.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04375">character.cpp:4375</a></div></div>
<div class="ttc" id="aclassCharacter_html_a85e40d1109c07460a6e03ff0421c7e2d"><div class="ttname"><a href="classCharacter.html#a85e40d1109c07460a6e03ff0421c7e2d">Character::run_cost</a></div><div class="ttdeci">int run_cost(int base_cost, bool diag=false) const</div><div class="ttdoc">Returns the player's modified base movement cost.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l10243">character.cpp:10243</a></div></div>
<div class="ttc" id="aclassCharacter_html_a873b6e039822dc744b6c9741385b926d"><div class="ttname"><a href="classCharacter.html#a873b6e039822dc744b6c9741385b926d">Character::can_pickVolume</a></div><div class="ttdeci">bool can_pickVolume(const item &amp;it, bool safe=false, const item *avoid=nullptr, bool ignore_pkt_settings=true) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03222">character.cpp:3222</a></div></div>
<div class="ttc" id="aclassCharacter_html_a878f2d584f508107d1f0ba5599de7fa4"><div class="ttname"><a href="classCharacter.html#a878f2d584f508107d1f0ba5599de7fa4">Character::is_using_bionic_weapon</a></div><div class="ttdeci">bool is_using_bionic_weapon() const</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l03429">bionics.cpp:3429</a></div></div>
<div class="ttc" id="aclassCharacter_html_a8a65544960c46310fe2d2ed12f52dc10"><div class="ttname"><a href="classCharacter.html#a8a65544960c46310fe2d2ed12f52dc10">Character::start_destination_activity</a></div><div class="ttdeci">void start_destination_activity()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11474">character.cpp:11474</a></div></div>
<div class="ttc" id="aclassCharacter_html_a8c67a9a553e858645037e7a5abe6a41a"><div class="ttname"><a href="classCharacter.html#a8c67a9a553e858645037e7a5abe6a41a">Character::change_side</a></div><div class="ttdeci">bool change_side(item &amp;it, bool interactive=true)</div><div class="ttdoc">Swap side on which item is worn; returns false on fail.</div><div class="ttdef"><b>Definition:</b> <a href="character__attire_8cpp_source.html#l00758">character_attire.cpp:758</a></div></div>
<div class="ttc" id="aclassCharacter_html_a8f914d66d3d996a1356a31caf1d44c13"><div class="ttname"><a href="classCharacter.html#a8f914d66d3d996a1356a31caf1d44c13">Character::is_npc</a></div><div class="ttdeci">bool is_npc() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00538">character.h:538</a></div></div>
<div class="ttc" id="aclassCharacter_html_a906192bd3a5f29a61ee12695e18d2eb5"><div class="ttname"><a href="classCharacter.html#a906192bd3a5f29a61ee12695e18d2eb5">Character::sees</a></div><div class="ttdeci">bool sees(const tripoint &amp;t, bool is_avatar=false, int range_mod=0) const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11397">character.cpp:11397</a></div></div>
<div class="ttc" id="aclassCharacter_html_a93a3570e884214ba5c0eb3cdf1af75cc"><div class="ttname"><a href="classCharacter.html#a93a3570e884214ba5c0eb3cdf1af75cc">Character::get_skill_level</a></div><div class="ttdeci">float get_skill_level(const skill_id &amp;ident) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l03428">character.cpp:3428</a></div></div>
<div class="ttc" id="aclassCharacter_html_a96ec9152d401f128cf31a7cc35c97f65"><div class="ttname"><a href="classCharacter.html#a96ec9152d401f128cf31a7cc35c97f65">Character::inv</a></div><div class="ttdeci">pimpl&lt; inventory &gt; inv</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02712">character.h:2712</a></div></div>
<div class="ttc" id="aclassCharacter_html_a9f90838e7733c76ae2b1eaa7b9e418cb"><div class="ttname"><a href="classCharacter.html#a9f90838e7733c76ae2b1eaa7b9e418cb">Character::fire_gun</a></div><div class="ttdeci">int fire_gun(const tripoint &amp;target, int shots=1)</div><div class="ttdoc">Fires a gun or auxiliary gunmod (ignoring any current mode)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00857">ranged.cpp:857</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa33f9870c95a95d8a46423c9d6477d99"><div class="ttname"><a href="classCharacter.html#aa33f9870c95a95d8a46423c9d6477d99">Character::has_charges</a></div><div class="ttdeci">bool has_charges(const itype_id &amp;it, int quantity, const std::function&lt; bool(const item &amp;)&gt; &amp;filter=return_true&lt; item &gt;) const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09586">character.cpp:9586</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa342bc315f7b61074f2ac81217a2a0f5"><div class="ttname"><a href="classCharacter.html#aa342bc315f7b61074f2ac81217a2a0f5">Character::drop_invalid_inventory</a></div><div class="ttdeci">void drop_invalid_inventory()</div><div class="ttdef"><b>Definition:</b> <a href="character__inventory_8cpp_source.html#l00665">character_inventory.cpp:665</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa4ecfee35839a07be48afccbe582023e"><div class="ttname"><a href="classCharacter.html#aa4ecfee35839a07be48afccbe582023e">Character::stomach</a></div><div class="ttdeci">stomach_contents stomach</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02728">character.h:2728</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa58280d717f23351fb1cdc6f7a83047f"><div class="ttname"><a href="classCharacter.html#aa58280d717f23351fb1cdc6f7a83047f">Character::gen_aim_mods_cache</a></div><div class="ttdeci">aim_mods_cache gen_aim_mods_cache(const item &amp;gun) const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00935">character.cpp:935</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa62bdeb7c69488dc798a2e1df3259d80"><div class="ttname"><a href="classCharacter.html#aa62bdeb7c69488dc798a2e1df3259d80">Character::cache_has_item_with_flag</a></div><div class="ttdeci">bool cache_has_item_with_flag(const flag_id &amp;type_flag, bool need_charges=false) const</div><div class="ttdoc">Find if the character has an item whose type has a specific flag.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09485">character.cpp:9485</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa6396870f289f9c3b1dc4ea91f7a65f0"><div class="ttname"><a href="classCharacter.html#aa6396870f289f9c3b1dc4ea91f7a65f0">Character::recalculate_enchantment_cache</a></div><div class="ttdeci">void recalculate_enchantment_cache()</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l07750">character.cpp:7750</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa81a4b0db6f2387bfc02706a6b7a678e"><div class="ttname"><a href="classCharacter.html#aa81a4b0db6f2387bfc02706a6b7a678e">Character::get_rad</a></div><div class="ttdeci">int get_rad() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l06757">character.cpp:6757</a></div></div>
<div class="ttc" id="aclassCharacter_html_aa9a4335ab1fd0d975199750b1ebf5bef"><div class="ttname"><a href="classCharacter.html#aa9a4335ab1fd0d975199750b1ebf5bef">Character::get_wielded_item</a></div><div class="ttdeci">item_location get_wielded_item() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00674">character.cpp:674</a></div></div>
<div class="ttc" id="aclassCharacter_html_aaa88cf522afdfdc90edcbd9fdefca47d"><div class="ttname"><a href="classCharacter.html#aaa88cf522afdfdc90edcbd9fdefca47d">Character::get_healthy_kcal</a></div><div class="ttdeci">int get_healthy_kcal() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04470">character.cpp:4470</a></div></div>
<div class="ttc" id="aclassCharacter_html_aaf1c149989ac933ff6b094384f4a5462a2d02b60eaa3c25912ee2e3ba0b669068"><div class="ttname"><a href="classCharacter.html#aaf1c149989ac933ff6b094384f4a5462a2d02b60eaa3c25912ee2e3ba0b669068">Character::comfort_level::very_comfortable</a></div><div class="ttdeci">@ very_comfortable</div></div>
<div class="ttc" id="aclassCharacter_html_ab3a5a1cd76002a3e9903b7e09b77bb3f"><div class="ttname"><a href="classCharacter.html#ab3a5a1cd76002a3e9903b7e09b77bb3f">Character::volume_carried</a></div><div class="ttdeci">units::volume volume_carried() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08814">character.cpp:8814</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab4adbfffca2784d18af7a0d3a4c05453"><div class="ttname"><a href="classCharacter.html#ab4adbfffca2784d18af7a0d3a4c05453">Character::get_armor_type</a></div><div class="ttdeci">int get_armor_type(const damage_type_id &amp;dt, bodypart_id bp) const override</div><div class="ttdoc">Returns overall resistance to given type on the bod part.</div><div class="ttdef"><b>Definition:</b> <a href="character__armor_8cpp_source.html#l00074">character_armor.cpp:74</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab65baa23495a79929ae62fd7ad1cd524"><div class="ttname"><a href="classCharacter.html#ab65baa23495a79929ae62fd7ad1cd524">Character::sleep_spot</a></div><div class="ttdeci">int sleep_spot(const tripoint_bub_ms &amp;p) const</div><div class="ttdoc">Rate point's ability to serve as a bed.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l11245">character.cpp:11245</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab6979ac863e9720c526acc08c3065a56"><div class="ttname"><a href="classCharacter.html#ab6979ac863e9720c526acc08c3065a56">Character::floor_bedding_warmth</a></div><div class="ttdeci">static units::temperature_delta floor_bedding_warmth(const tripoint &amp;pos)</div><div class="ttdoc">Warmth from terrain, furniture, vehicle furniture and traps.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l09216">character.cpp:9216</a></div></div>
<div class="ttc" id="aclassCharacter_html_ab937dd4b9a2cf84fb446d0da98a62365"><div class="ttname"><a href="classCharacter.html#ab937dd4b9a2cf84fb446d0da98a62365">Character::get_hunger</a></div><div class="ttdeci">int get_hunger() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04481">character.cpp:4481</a></div></div>
<div class="ttc" id="aclassCharacter_html_abb0a1847902e6db0bd3c923ee8187702"><div class="ttname"><a href="classCharacter.html#abb0a1847902e6db0bd3c923ee8187702">Character::get_per</a></div><div class="ttdeci">int get_per() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04135">character.cpp:4135</a></div></div>
<div class="ttc" id="aclassCharacter_html_abc09f44d013230019fd44156482e273e"><div class="ttname"><a href="classCharacter.html#abc09f44d013230019fd44156482e273e">Character::pseudo_items</a></div><div class="ttdeci">std::vector&lt; const item * &gt; pseudo_items</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l04075">character.h:4075</a></div></div>
<div class="ttc" id="aclassCharacter_html_abf9fb0e53589386ea19d64a377ad6247"><div class="ttname"><a href="classCharacter.html#abf9fb0e53589386ea19d64a377ad6247">Character::omt_path</a></div><div class="ttdeci">std::vector&lt; tripoint_abs_omt &gt; omt_path</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l01703">character.h:1703</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac154c2ae0d5b2bb879e46d730ce47bc8"><div class="ttname"><a href="classCharacter.html#ac154c2ae0d5b2bb879e46d730ce47bc8">Character::get_bionic_fuels</a></div><div class="ttdeci">std::vector&lt; item * &gt; get_bionic_fuels(const bionic_id &amp;bio)</div><div class="ttdoc">Return list of available fuel sources that are not empty for this bionic.</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l03309">bionics.cpp:3309</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac2245aed6c7279986f42ef9208e816c0"><div class="ttname"><a href="classCharacter.html#ac2245aed6c7279986f42ef9208e816c0">Character::is_limb_broken</a></div><div class="ttdeci">bool is_limb_broken(const bodypart_id &amp;limb) const</div><div class="ttdoc">Returns true if the limb is broken.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02149">character.cpp:2149</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac3d46549b7cdaac1f98991167ad5f1b3"><div class="ttname"><a href="classCharacter.html#ac3d46549b7cdaac1f98991167ad5f1b3">Character::mounted_creature</a></div><div class="ttdeci">shared_ptr_fast&lt; monster &gt; mounted_creature</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02800">character.h:2800</a></div></div>
<div class="ttc" id="aclassCharacter_html_ac3e27cd8b8fe445e06e6d20d0eb82aff"><div class="ttname"><a href="classCharacter.html#ac3e27cd8b8fe445e06e6d20d0eb82aff">Character::get_max_power_level</a></div><div class="ttdeci">units::energy get_max_power_level() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02829">character.cpp:2829</a></div></div>
<div class="ttc" id="aclassCharacter_html_acfb04a0e86c82c14248f911ebcb23f90"><div class="ttname"><a href="classCharacter.html#acfb04a0e86c82c14248f911ebcb23f90">Character::throw_item</a></div><div class="ttdeci">dealt_projectile_attack throw_item(const tripoint &amp;target, const item &amp;to_throw, const std::optional&lt; tripoint &gt; &amp;blind_throw_from_pos=std::nullopt)</div><div class="ttdoc">Execute a throw.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l01308">ranged.cpp:1308</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad2f8dc354e09863a8d257b353a749caa"><div class="ttname"><a href="classCharacter.html#ad2f8dc354e09863a8d257b353a749caa">Character::backlog</a></div><div class="ttdeci">std::list&lt; player_activity &gt; backlog</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02710">character.h:2710</a></div></div>
<div class="ttc" id="aclassCharacter_html_ad79464264cb8a2061f5888d092f5cd86"><div class="ttname"><a href="classCharacter.html#ad79464264cb8a2061f5888d092f5cd86">Character::is_armed</a></div><div class="ttdeci">bool is_armed() const</div><div class="ttdoc">Returns true if the character is wielding something.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l00192">melee.cpp:192</a></div></div>
<div class="ttc" id="aclassCharacter_html_adb54bdcb284abb66b6be99c8ae225065"><div class="ttname"><a href="classCharacter.html#adb54bdcb284abb66b6be99c8ae225065">Character::getID</a></div><div class="ttdeci">character_id getID() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l00652">character.cpp:652</a></div></div>
<div class="ttc" id="aclassCharacter_html_add22510ff2fa20a662868b4dd86e030e"><div class="ttname"><a href="classCharacter.html#add22510ff2fa20a662868b4dd86e030e">Character::get_power_level</a></div><div class="ttdeci">units::energy get_power_level() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l02824">character.cpp:2824</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae0f7eba286e1cd07e6a3be58443aaca3"><div class="ttname"><a href="classCharacter.html#ae0f7eba286e1cd07e6a3be58443aaca3">Character::deactivate_bionic</a></div><div class="ttdeci">bool deactivate_bionic(bionic &amp;bio, bool eff_only=false)</div><div class="ttdoc">Handles bionic deactivation effects of the entered bionic, returns if anything deactivated.</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l01211">bionics.cpp:1211</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae33ef4afcc2718785f970888d6f70116"><div class="ttname"><a href="classCharacter.html#ae33ef4afcc2718785f970888d6f70116">Character::activate_bionic</a></div><div class="ttdeci">bool activate_bionic(bionic &amp;bio, bool eff_only=false, bool *close_bionics_ui=nullptr)</div><div class="ttdoc">Handles bionic activation effects of the entered bionic, returns if anything activated.</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l00722">bionics.cpp:722</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae47514f140700c67ea21ccbadf66d106"><div class="ttname"><a href="classCharacter.html#ae47514f140700c67ea21ccbadf66d106">Character::get_name</a></div><div class="ttdeci">std::string get_name() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l05731">character.cpp:5731</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae68b7a6565646ba662e448bded8b6599"><div class="ttname"><a href="classCharacter.html#ae68b7a6565646ba662e448bded8b6599">Character::weapon</a></div><div class="ttdeci">item weapon</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02715">character.h:2715</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae6bcae1e1d30b35e0152b5e1bd615f5e"><div class="ttname"><a href="classCharacter.html#ae6bcae1e1d30b35e0152b5e1bd615f5e">Character::set_thirst</a></div><div class="ttdeci">void set_thirst(int nthirst)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04536">character.cpp:4536</a></div></div>
<div class="ttc" id="aclassCharacter_html_ae7a24870910dfafa681280d9e76e36dd"><div class="ttname"><a href="classCharacter.html#ae7a24870910dfafa681280d9e76e36dd">Character::weapon_bionic_uid</a></div><div class="ttdeci">bionic_uid weapon_bionic_uid</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l04087">character.h:4087</a></div></div>
<div class="ttc" id="aclassCharacter_html_aeafb75e7e7e7a3716aef9dfdd778a20d"><div class="ttname"><a href="classCharacter.html#aeafb75e7e7e7a3716aef9dfdd778a20d">Character::consume</a></div><div class="ttdeci">trinary consume(item_location loc, bool force=false)</div><div class="ttdoc">Used for eating object at a location.</div><div class="ttdef"><b>Definition:</b> <a href="consumption_8cpp_source.html#l01891">consumption.cpp:1891</a></div></div>
<div class="ttc" id="aclassCharacter_html_aec46a4b513360ef60f6143830bbb711d"><div class="ttname"><a href="classCharacter.html#aec46a4b513360ef60f6143830bbb711d">Character::recoil_total</a></div><div class="ttdeci">double recoil_total() const</div><div class="ttdoc">Current total maximum recoil penalty from all sources.</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l12360">character.cpp:12360</a></div></div>
<div class="ttc" id="aclassCharacter_html_aedc66fc50d352420cae7791b4a0f57f7"><div class="ttname"><a href="classCharacter.html#aedc66fc50d352420cae7791b4a0f57f7">Character::get_speed</a></div><div class="ttdeci">int get_speed() const override</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l04192">character.cpp:4192</a></div></div>
<div class="ttc" id="aclassCharacter_html_aee4e2c047e2c683905cade66f04112b8"><div class="ttname"><a href="classCharacter.html#aee4e2c047e2c683905cade66f04112b8">Character::get_faction</a></div><div class="ttdeci">virtual faction * get_faction() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00768">character.h:768</a></div></div>
<div class="ttc" id="aclassCharacter_html_af04d061e415da9cb6f1fc234b04f3dfb"><div class="ttname"><a href="classCharacter.html#af04d061e415da9cb6f1fc234b04f3dfb">Character::i_add</a></div><div class="ttdeci">item_location i_add(item it, bool should_stack=true, const item *avoid=nullptr, const item *original_inventory_item=nullptr, bool allow_drop=true, bool allow_wield=true, bool ignore_pkt_settings=false)</div><div class="ttdoc">Adds the item to the character's worn items or wields it, or prompts if the Character cannot pick it ...</div><div class="ttdef"><b>Definition:</b> <a href="character__inventory_8cpp_source.html#l00326">character_inventory.cpp:326</a></div></div>
<div class="ttc" id="aclassCharacter_html_af06dd97724f4f05df782e7a4b4f9cfe1"><div class="ttname"><a href="classCharacter.html#af06dd97724f4f05df782e7a4b4f9cfe1">Character::has_trait</a></div><div class="ttdeci">bool has_trait(const trait_id &amp;b) const override</div><div class="ttdoc">Returns true if the player has the entered trait.</div><div class="ttdef"><b>Definition:</b> <a href="mutation_8cpp_source.html#l00111">mutation.cpp:111</a></div></div>
<div class="ttc" id="aclassCharacter_html_af2ff32cce5f17bcf04be958121abe524"><div class="ttname"><a href="classCharacter.html#af2ff32cce5f17bcf04be958121abe524">Character::magic</a></div><div class="ttdeci">pimpl&lt; known_magic &gt; magic</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02485">character.h:2485</a></div></div>
<div class="ttc" id="aclassCharacter_html_af7d50915d362a56eeff40bc6b392326d"><div class="ttname"><a href="classCharacter.html#af7d50915d362a56eeff40bc6b392326d">Character::assign_activity</a></div><div class="ttdeci">void assign_activity(const activity_id &amp;type, int moves=calendar::INDEFINITELY_LONG, int index=-1, int pos=INT_MIN, const std::string &amp;name=&quot;&quot;)</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l08935">character.cpp:8935</a></div></div>
<div class="ttc" id="aclassCharacter_html_af8ad769685d160f275ead29362360de1"><div class="ttname"><a href="classCharacter.html#af8ad769685d160f275ead29362360de1">Character::my_fac</a></div><div class="ttdeci">faction * my_fac</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l03959">character.h:3959</a></div></div>
<div class="ttc" id="aclassCharacter_html_af9a9d879469286e1da635f69bc39c736"><div class="ttname"><a href="classCharacter.html#af9a9d879469286e1da635f69bc39c736">Character::has_stashed_activity</a></div><div class="ttdeci">bool has_stashed_activity() const</div><div class="ttdef"><b>Definition:</b> <a href="character_8cpp_source.html#l01541">character.cpp:1541</a></div></div>
<div class="ttc" id="aclassCharacter_html_af9c7419575e23d52745c94009929fafb"><div class="ttname"><a href="classCharacter.html#af9c7419575e23d52745c94009929fafb">Character::has_active_bionic</a></div><div class="ttdeci">bool has_active_bionic(const bionic_id &amp;b) const</div><div class="ttdoc">Returns true if the player has the entered bionic id and it is powered on.</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l02658">bionics.cpp:2658</a></div></div>
<div class="ttc" id="aclassCharacter_html_aff7c6ea07bde0a44d9d08b1bacde9064"><div class="ttname"><a href="classCharacter.html#aff7c6ea07bde0a44d9d08b1bacde9064">Character::get_dodge</a></div><div class="ttdeci">float get_dodge() const override</div><div class="ttdoc">Returns Creature::get_dodge() modified by any Character effects.</div><div class="ttdef"><b>Definition:</b> <a href="melee_8cpp_source.html#l01208">melee.cpp:1208</a></div></div>
<div class="ttc" id="aclassCreature_html"><div class="ttname"><a href="classCreature.html">Creature</a></div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00250">creature.h:251</a></div></div>
<div class="ttc" id="aclassCreature_html_a14ecbd8f044628463354090421a805b4"><div class="ttname"><a href="classCreature.html#a14ecbd8f044628463354090421a805b4">Creature::global_omt_location</a></div><div class="ttdeci">tripoint_abs_omt global_omt_location() const</div><div class="ttdoc">Returns the location of the creature in global overmap terrain coordinates.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l03242">creature.cpp:3242</a></div></div>
<div class="ttc" id="aclassCreature_html_a1a65722d07102550f16d17ebd79e2743"><div class="ttname"><a href="classCreature.html#a1a65722d07102550f16d17ebd79e2743">Creature::pos</a></div><div class="ttdeci">tripoint pos() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00178">creature.cpp:178</a></div></div>
<div class="ttc" id="aclassCreature_html_a1c6d98c5a339561c989ba3e1ca34eeb8"><div class="ttname"><a href="classCreature.html#a1c6d98c5a339561c989ba3e1ca34eeb8">Creature::remove_effect</a></div><div class="ttdeci">bool remove_effect(const efftype_id &amp;eff_id, const bodypart_id &amp;bp)</div><div class="ttdoc">Removes a listed effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01722">creature.cpp:1722</a></div></div>
<div class="ttc" id="aclassCreature_html_a1c8ea56d06ff96a720201c46a40969aa"><div class="ttname"><a href="classCreature.html#a1c8ea56d06ff96a720201c46a40969aa">Creature::ranged_target_size</a></div><div class="ttdeci">double ranged_target_size() const</div><div class="ttdoc">Size of the target this creature presents to ranged weapons.</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00547">ranged.cpp:547</a></div></div>
<div class="ttc" id="aclassCreature_html_a21b8fbeb525a28615eec6a6c22beff44"><div class="ttname"><a href="classCreature.html#a21b8fbeb525a28615eec6a6c22beff44">Creature::facing</a></div><div class="ttdeci">FacingDirection facing</div><div class="ttdoc">return the direction the creature is facing, for sdl horizontal flip</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00303">creature.h:303</a></div></div>
<div class="ttc" id="aclassCreature_html_a23ca807a88c3b940eb5b68461849b7df"><div class="ttname"><a href="classCreature.html#a23ca807a88c3b940eb5b68461849b7df">Creature::speed_rating</a></div><div class="ttdeci">virtual float speed_rating() const =0</div><div class="ttdoc">Returns an approximate number of tiles this creature can travel per turn.</div></div>
<div class="ttc" id="aclassCreature_html_a26b7c431f85f0b99b888db69318ebdc5"><div class="ttname"><a href="classCreature.html#a26b7c431f85f0b99b888db69318ebdc5">Creature::disp_name</a></div><div class="ttdeci">virtual std::string disp_name(bool possessive=false, bool capitalize_first=false) const =0</div></div>
<div class="ttc" id="aclassCreature_html_a3261de1530798f5b934a71b9a4e17f5b"><div class="ttname"><a href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">Creature::get_location</a></div><div class="ttdeci">tripoint_abs_ms get_location() const</div><div class="ttdoc">Returns the location of the creature in map square coordinates (the most detailed coordinate system),...</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l03232">creature.cpp:3232</a></div></div>
<div class="ttc" id="aclassCreature_html_a3e322a5b9e8f42f840ddffa01ec2787f"><div class="ttname"><a href="classCreature.html#a3e322a5b9e8f42f840ddffa01ec2787f">Creature::attack_air</a></div><div class="ttdeci">bool attack_air(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01415">creature.cpp:1415</a></div></div>
<div class="ttc" id="aclassCreature_html_a4537397ede1aea8ecec28183252aabe3"><div class="ttname"><a href="classCreature.html#a4537397ede1aea8ecec28183252aabe3">Creature::get_all_body_parts</a></div><div class="ttdeci">std::vector&lt; bodypart_id &gt; get_all_body_parts(get_body_part_flags=get_body_part_flags::none) const</div><div class="ttdoc">Returns body parts this creature have.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02627">creature.cpp:2627</a></div></div>
<div class="ttc" id="aclassCreature_html_a6410520bceb652ba361502f404fc1005"><div class="ttname"><a href="classCreature.html#a6410520bceb652ba361502f404fc1005">Creature::stumble_invis</a></div><div class="ttdeci">bool stumble_invis(const Creature &amp;player, bool stumblemsg=true)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01389">creature.cpp:1389</a></div></div>
<div class="ttc" id="aclassCreature_html_a666022fd3ed772fa109d273c20e8de55"><div class="ttname"><a href="classCreature.html#a666022fd3ed772fa109d273c20e8de55">Creature::add_effect</a></div><div class="ttdeci">void add_effect(const effect &amp;eff, bool force=false, bool deferred=false)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00604">creature.h:604</a></div></div>
<div class="ttc" id="aclassCreature_html_a681e27e1004c58fcdf25adfdac5e9136"><div class="ttname"><a href="classCreature.html#a681e27e1004c58fcdf25adfdac5e9136">Creature::location</a></div><div class="ttdeci">tripoint_abs_ms location</div><div class="ttdoc">The creature's position in absolute coordinates.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00776">creature.h:776</a></div></div>
<div class="ttc" id="aclassCreature_html_a6a4c43d66f5a8b50a879d78682b00976"><div class="ttname"><a href="classCreature.html#a6a4c43d66f5a8b50a879d78682b00976">Creature::is_dangerous_fields</a></div><div class="ttdeci">bool is_dangerous_fields(const field &amp;fld) const</div><div class="ttdoc">Returns true if there is a field in the field set that is dangerous to us.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00334">creature.cpp:334</a></div></div>
<div class="ttc" id="aclassCreature_html_a71e8440dfb96a7a870c29e0472b7b85d"><div class="ttname"><a href="classCreature.html#a71e8440dfb96a7a870c29e0472b7b85d">Creature::get_pain</a></div><div class="ttdeci">virtual int get_pain() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01994">creature.cpp:1994</a></div></div>
<div class="ttc" id="aclassCreature_html_a7bf62f4f36b0475f1f39ea27f3beebb0"><div class="ttname"><a href="classCreature.html#a7bf62f4f36b0475f1f39ea27f3beebb0">Creature::has_effect</a></div><div class="ttdeci">bool has_effect(const efftype_id &amp;eff_id, const bodypart_id &amp;bp) const</div><div class="ttdoc">Check if creature has the matching effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01770">creature.cpp:1770</a></div></div>
<div class="ttc" id="aclassCreature_html_a88c28bc08aa3e0d6fa1b187cee97d1c4"><div class="ttname"><a href="classCreature.html#a88c28bc08aa3e0d6fa1b187cee97d1c4">Creature::posz</a></div><div class="ttdeci">int posz() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00317">creature.h:317</a></div></div>
<div class="ttc" id="aclassCreature_html_a891bc2d0c564449cb462178317819254"><div class="ttname"><a href="classCreature.html#a891bc2d0c564449cb462178317819254">Creature::mod_moves</a></div><div class="ttdeci">void mod_moves(int nmoves)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02008">creature.cpp:2008</a></div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217">Creature::Attitude</a></div><div class="ttdeci">Attitude</div><div class="ttdoc">Simplified attitude towards any creature: hostile - hate, want to kill, etc.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00352">creature.h:352</a></div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217a10794171f9c3f68753d26303cfec9747">Creature::Attitude::HOSTILE</a></div><div class="ttdeci">@ HOSTILE</div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217a31ba17aa58cdb681423f07ca21a6efc7"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217a31ba17aa58cdb681423f07ca21a6efc7">Creature::Attitude::NEUTRAL</a></div><div class="ttdeci">@ NEUTRAL</div></div>
<div class="ttc" id="aclassCreature_html_a8a475630b3289c468bd06cf114008217af6a34a956d1ce0a552bf4731b9f9d9c0"><div class="ttname"><a href="classCreature.html#a8a475630b3289c468bd06cf114008217af6a34a956d1ce0a552bf4731b9f9d9c0">Creature::Attitude::FRIENDLY</a></div><div class="ttdeci">@ FRIENDLY</div></div>
<div class="ttc" id="aclassCreature_html_a8c5a392caa213bee9581b47e9f0e2052"><div class="ttname"><a href="classCreature.html#a8c5a392caa213bee9581b47e9f0e2052">Creature::moves</a></div><div class="ttdeci">int moves</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l01193">creature.h:1193</a></div></div>
<div class="ttc" id="aclassCreature_html_a9689d4816bc2d1204c53c114190fde50"><div class="ttname"><a href="classCreature.html#a9689d4816bc2d1204c53c114190fde50">Creature::get_effect_int</a></div><div class="ttdeci">int get_effect_int(const efftype_id &amp;eff_id, const bodypart_id &amp;bp=bodypart_str_id::NULL_ID()) const</div><div class="ttdoc">Returns the intensity of the matching effect.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01872">creature.cpp:1872</a></div></div>
<div class="ttc" id="aclassCreature_html_a9f0365208b65ab1c45d23f03f402f491"><div class="ttname"><a href="classCreature.html#a9f0365208b65ab1c45d23f03f402f491">Creature::posy</a></div><div class="ttdeci">int posy() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00314">creature.h:314</a></div></div>
<div class="ttc" id="aclassCreature_html_aa8d3d8f5a3260c5b54e4973e957f356d"><div class="ttname"><a href="classCreature.html#aa8d3d8f5a3260c5b54e4973e957f356d">Creature::get_effect</a></div><div class="ttdeci">const effect &amp; get_effect(const efftype_id &amp;eff_id, const bodypart_id &amp;bp=bodypart_str_id::NULL_ID()) const</div><div class="ttdoc">Return the effect that matches the given arguments exactly.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l01852">creature.cpp:1852</a></div></div>
<div class="ttc" id="aclassCreature_html_ac16dcdb688f6f47c594c98c83528a670"><div class="ttname"><a href="classCreature.html#ac16dcdb688f6f47c594c98c83528a670">Creature::setpos</a></div><div class="ttdeci">void setpos(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00188">creature.cpp:188</a></div></div>
<div class="ttc" id="aclassCreature_html_ac209d32cbfd3774af3d5c0500e2fae52"><div class="ttname"><a href="classCreature.html#ac209d32cbfd3774af3d5c0500e2fae52">Creature::is_avatar</a></div><div class="ttdeci">virtual bool is_avatar() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00265">creature.h:265</a></div></div>
<div class="ttc" id="aclassCreature_html_ac4dbde454c86b3296f53681c60612974"><div class="ttname"><a href="classCreature.html#ac4dbde454c86b3296f53681c60612974">Creature::get_body</a></div><div class="ttdeci">const std::map&lt; bodypart_str_id, bodypart &gt; &amp; get_body() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02167">creature.cpp:2167</a></div></div>
<div class="ttc" id="aclassCreature_html_aecea7d852ffba499ec12350c95340b9d"><div class="ttname"><a href="classCreature.html#aecea7d852ffba499ec12350c95340b9d">Creature::posx</a></div><div class="ttdeci">int posx() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00311">creature.h:311</a></div></div>
<div class="ttc" id="aclassCreature_html_aed84fe52e1335d48d53f482f8a278c87"><div class="ttname"><a href="classCreature.html#aed84fe52e1335d48d53f482f8a278c87">Creature::is_npc</a></div><div class="ttdeci">virtual bool is_npc() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00268">creature.h:268</a></div></div>
<div class="ttc" id="aclassCreature_html_af5c36ca5b43c92f6cb02afb52a448372"><div class="ttname"><a href="classCreature.html#af5c36ca5b43c92f6cb02afb52a448372">Creature::is_dangerous_field</a></div><div class="ttdeci">bool is_dangerous_field(const field_entry &amp;entry) const</div><div class="ttdoc">Returns true if the given field entry is dangerous to us.</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00346">creature.cpp:346</a></div></div>
<div class="ttc" id="aclassCreature_html_af7172e571c5c69240d9f71a01fddf035"><div class="ttname"><a href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">Creature::pos_bub</a></div><div class="ttdeci">tripoint_bub_ms pos_bub() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00183">creature.cpp:183</a></div></div>
<div class="ttc" id="aclassCreature_html_af826bfbdc9d7f81a8b9e53775f43d080"><div class="ttname"><a href="classCreature.html#af826bfbdc9d7f81a8b9e53775f43d080">Creature::set_moves</a></div><div class="ttdeci">void set_moves(int nmoves)</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l02012">creature.cpp:2012</a></div></div>
<div class="ttc" id="aclassavatar_html_a2d69f2df17dc25330b825a2e6a1aa93b"><div class="ttname"><a href="classavatar.html#a2d69f2df17dc25330b825a2e6a1aa93b">avatar::talk_to</a></div><div class="ttdeci">void talk_to(std::unique_ptr&lt; talker &gt; talk_with, bool radio_contact=false, bool is_computer=false, bool is_not_conversation=false)</div><div class="ttdef"><b>Definition:</b> <a href="npctalk_8cpp_source.html#l01358">npctalk.cpp:1358</a></div></div>
<div class="ttc" id="aclassbasecamp_html"><div class="ttname"><a href="classbasecamp.html">basecamp</a></div><div class="ttdef"><b>Definition:</b> <a href="basecamp_8h_source.html#l00158">basecamp.h:159</a></div></div>
<div class="ttc" id="aclassbasecamp_html_a399448deb1704654be0979c9a763db03"><div class="ttname"><a href="classbasecamp.html#a399448deb1704654be0979c9a763db03">basecamp::camp_food_supply</a></div><div class="ttdeci">nutrients camp_food_supply(nutrients &amp;change)</div><div class="ttdoc">Changes the faction food supply by change, returns the amount of kcal+vitamins consumed,...</div><div class="ttdef"><b>Definition:</b> <a href="faction__camp_8cpp_source.html#l05522">faction_camp.cpp:5522</a></div></div>
<div class="ttc" id="aclassbasecamp_html_ab11f768b4bb03073257d817875de4178"><div class="ttname"><a href="classbasecamp.html#ab11f768b4bb03073257d817875de4178">basecamp::get_bb_pos</a></div><div class="ttdeci">tripoint get_bb_pos() const</div><div class="ttdef"><b>Definition:</b> <a href="basecamp_8h_source.html#l00181">basecamp.h:181</a></div></div>
<div class="ttc" id="aclassbasecamp_html_ac422f34b7fd2c82e4b29bf5ad272309a"><div class="ttname"><a href="classbasecamp.html#ac422f34b7fd2c82e4b29bf5ad272309a">basecamp::has_water</a></div><div class="ttdeci">bool has_water() const</div><div class="ttdef"><b>Definition:</b> <a href="basecamp_8cpp_source.html#l00316">basecamp.cpp:316</a></div></div>
<div class="ttc" id="aclassbody__part__set_html"><div class="ttname"><a href="classbody__part__set.html">body_part_set</a></div><div class="ttdef"><b>Definition:</b> <a href="body__part__set_8h_source.html#l00011">body_part_set.h:12</a></div></div>
<div class="ttc" id="aclassbody__part__set_html_ac4e5ce7eea67f44279a4db416a7903cd"><div class="ttname"><a href="classbody__part__set.html#ac4e5ce7eea67f44279a4db416a7903cd">body_part_set::test</a></div><div class="ttdeci">bool test(const bodypart_str_id &amp;bp) const</div><div class="ttdef"><b>Definition:</b> <a href="body__part__set_8h_source.html#l00034">body_part_set.h:34</a></div></div>
<div class="ttc" id="aclasscharacter__id_html"><div class="ttname"><a href="classcharacter__id.html">character_id</a></div><div class="ttdef"><b>Definition:</b> <a href="character__id_8h_source.html#l00009">character_id.h:10</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__base_html_abadb043d4129616ea20396a03e046301"><div class="ttname"><a href="classcoords_1_1coord__point__base.html#abadb043d4129616ea20396a03e046301">coords::coord_point_base::to_string</a></div><div class="ttdeci">std::string to_string() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00121">coordinates.h:121</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__base_html_adffa74cccb8c246a8b12eeca632b1642"><div class="ttname"><a href="classcoords_1_1coord__point__base.html#adffa74cccb8c246a8b12eeca632b1642">coords::coord_point_base::to_string_writable</a></div><div class="ttdeci">std::string to_string_writable() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00124">coordinates.h:124</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__mut_html_a0e6b02267065e16149a37d98991f653e"><div class="ttname"><a href="classcoords_1_1coord__point__mut.html#a0e6b02267065e16149a37d98991f653e">coords::coord_point_mut::y</a></div><div class="ttdeci">constexpr auto y() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00164">coordinates.h:164</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__mut_html_a0fa1f1039d6d6f5b5f744a5d3d039a02"><div class="ttname"><a href="classcoords_1_1coord__point__mut.html#a0fa1f1039d6d6f5b5f744a5d3d039a02">coords::coord_point_mut::x</a></div><div class="ttdeci">constexpr auto x() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00161">coordinates.h:161</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__mut_html_a5a5454f4ce144b5b3a84c2698a54ab8c"><div class="ttname"><a href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">coords::coord_point_mut::raw</a></div><div class="ttdeci">constexpr const Point &amp; raw() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00157">coordinates.h:157</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__mut_html_aa94b8bd33e85ce94a3634e6e27ab0cdd"><div class="ttname"><a href="classcoords_1_1coord__point__mut.html#aa94b8bd33e85ce94a3634e6e27ab0cdd">coords::coord_point_mut::z</a></div><div class="ttdeci">constexpr auto z() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00167">coordinates.h:167</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point_html"><div class="ttname"><a href="classcoords_1_1coord__point.html">coords::coord_point&lt; tripoint, coords::origin::abs, coords::ms &gt;</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point_html_a7b5804160d1d0e69a9f2fba098bea723"><div class="ttname"><a href="classcoords_1_1coord__point.html#a7b5804160d1d0e69a9f2fba098bea723">coords::coord_point::xy</a></div><div class="ttdeci">constexpr auto xy() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00273">coordinates.h:273</a></div></div>
<div class="ttc" id="aclasscreature__tracker_html"><div class="ttname"><a href="classcreature__tracker.html">creature_tracker</a></div><div class="ttdef"><b>Definition:</b> <a href="creature__tracker_8h_source.html#l00024">creature_tracker.h:25</a></div></div>
<div class="ttc" id="aclasscreature__tracker_html_aba3c6663688bcd1806ea685d6961cb72"><div class="ttname"><a href="classcreature__tracker.html#aba3c6663688bcd1806ea685d6961cb72">creature_tracker::creature_at</a></div><div class="ttdeci">T * creature_at(const tripoint &amp;p, bool allow_hallucination=false)</div><div class="ttdoc">Returns the Creature at the given location.</div><div class="ttdef"><b>Definition:</b> <a href="creature__tracker_8cpp_source.html#l00303">creature_tracker.cpp:303</a></div></div>
<div class="ttc" id="aclassdispersion__sources_html_ac3dc7f13e78a217aeaba57740f3af17c"><div class="ttname"><a href="classdispersion__sources.html#ac3dc7f13e78a217aeaba57740f3af17c">dispersion_sources::max</a></div><div class="ttdeci">double max() const</div><div class="ttdef"><b>Definition:</b> <a href="dispersion_8cpp_source.html#l00031">dispersion.cpp:31</a></div></div>
<div class="ttc" id="aclasseffect__type_html"><div class="ttname"><a href="classeffect__type.html">effect_type</a></div><div class="ttdef"><b>Definition:</b> <a href="effect_8h_source.html#l00104">effect.h:105</a></div></div>
<div class="ttc" id="aclasseffect_html"><div class="ttname"><a href="classeffect.html">effect</a></div><div class="ttdef"><b>Definition:</b> <a href="effect_8h_source.html#l00260">effect.h:261</a></div></div>
<div class="ttc" id="aclasseffect_html_a39ebd2ec5b2faacde7483e0c07240baa"><div class="ttname"><a href="classeffect.html#a39ebd2ec5b2faacde7483e0c07240baa">effect::is_null</a></div><div class="ttdeci">bool is_null() const</div><div class="ttdoc">Returns true if the effect is the result of effect(), ie.</div><div class="ttdef"><b>Definition:</b> <a href="effect_8cpp_source.html#l00767">effect.cpp:767</a></div></div>
<div class="ttc" id="aclasseffect_html_a68192c5a91cf7ad4618263ba3de8b802"><div class="ttname"><a href="classeffect.html#a68192c5a91cf7ad4618263ba3de8b802">effect::get_intensity</a></div><div class="ttdeci">int get_intensity() const</div><div class="ttdoc">Returns the intensity of an effect.</div><div class="ttdef"><b>Definition:</b> <a href="effect_8cpp_source.html#l01188">effect.cpp:1188</a></div></div>
<div class="ttc" id="aclassevent__bus_html_ab753616a3a663185377ac52560068194"><div class="ttname"><a href="classevent__bus.html#ab753616a3a663185377ac52560068194">event_bus::send</a></div><div class="ttdeci">void send(const cata::event &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="event__bus_8cpp_source.html#l00072">event_bus.cpp:72</a></div></div>
<div class="ttc" id="aclassexplosion__iuse_html"><div class="ttname"><a href="classexplosion__iuse.html">explosion_iuse</a></div><div class="ttdoc">This is a iuse_actor for active items that explode when their charges reaches 0.</div><div class="ttdef"><b>Definition:</b> <a href="iuse__actor_8h_source.html#l00192">iuse_actor.h:193</a></div></div>
<div class="ttc" id="aclassexplosion__iuse_html_acd5385d9ee934784e54f651f697ac53b"><div class="ttname"><a href="classexplosion__iuse.html#acd5385d9ee934784e54f651f697ac53b">explosion_iuse::explosion</a></div><div class="ttdeci">explosion_data explosion</div><div class="ttdef"><b>Definition:</b> <a href="iuse__actor_8h_source.html#l00197">iuse_actor.h:197</a></div></div>
<div class="ttc" id="aclassfaction__template_html_a7c6bf7af56797169006e95328f81a1fd"><div class="ttname"><a href="classfaction__template.html#a7c6bf7af56797169006e95328f81a1fd">faction_template::trusts_u</a></div><div class="ttdeci">int trusts_u</div><div class="ttdef"><b>Definition:</b> <a href="faction_8h_source.html#l00110">faction.h:110</a></div></div>
<div class="ttc" id="aclassfaction__template_html_a9cda490b58dc788f44e057bfd29a9971"><div class="ttname"><a href="classfaction__template.html#a9cda490b58dc788f44e057bfd29a9971">faction_template::food_supply</a></div><div class="ttdeci">nutrients food_supply</div><div class="ttdef"><b>Definition:</b> <a href="faction_8h_source.html#l00116">faction.h:116</a></div></div>
<div class="ttc" id="aclassfaction_html"><div class="ttname"><a href="classfaction.html">faction</a></div><div class="ttdef"><b>Definition:</b> <a href="faction_8h_source.html#l00126">faction.h:127</a></div></div>
<div class="ttc" id="aclassfield__entry_html"><div class="ttname"><a href="classfield__entry.html">field_entry</a></div><div class="ttdoc">An active or passive effect existing on a tile.</div><div class="ttdef"><b>Definition:</b> <a href="field_8h_source.html#l00020">field.h:21</a></div></div>
<div class="ttc" id="aclassfield_html"><div class="ttname"><a href="classfield.html">field</a></div><div class="ttdoc">A variable sized collection of field entries on a given map square.</div><div class="ttdef"><b>Definition:</b> <a href="field_8h_source.html#l00106">field.h:107</a></div></div>
<div class="ttc" id="aclassfield_html_ad45f87597ebb8629628d9f35c238947d"><div class="ttname"><a href="classfield.html#ad45f87597ebb8629628d9f35c238947d">field::find_field</a></div><div class="ttdeci">field_entry * find_field(const field_type_id &amp;field_type_to_find, bool alive_only=true)</div><div class="ttdoc">Returns a field entry corresponding to the field_type_id parameter passed in.</div><div class="ttdef"><b>Definition:</b> <a href="field_8cpp_source.html#l00122">field.cpp:122</a></div></div>
<div class="ttc" id="aclassgun__mode_html"><div class="ttname"><a href="classgun__mode.html">gun_mode</a></div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00012">gun_mode.h:13</a></div></div>
<div class="ttc" id="aclassgun__mode_html_a0b58020ecc1a637010d13f0ee7c40ef8"><div class="ttname"><a href="classgun__mode.html#a0b58020ecc1a637010d13f0ee7c40ef8">gun_mode::qty</a></div><div class="ttdeci">int qty</div><div class="ttdoc">burst size for is_gun() firearms, or melee range for is_melee() weapons</div><div class="ttdef"><b>Definition:</b> <a href="gun__mode_8h_source.html#l00021">gun_mode.h:21</a></div></div>
<div class="ttc" id="aclassint__id_html"><div class="ttname"><a href="classint__id.html">int_id&lt; body_part_type &gt;</a></div></div>
<div class="ttc" id="aclassitem_1_1reload__option_html"><div class="ttname"><a href="classitem_1_1reload__option.html">item::reload_option</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00550">item.h:551</a></div></div>
<div class="ttc" id="aclassitem_1_1reload__option_html_a8088bb504a905699d547374881015768"><div class="ttname"><a href="classitem_1_1reload__option.html#a8088bb504a905699d547374881015768">item::reload_option::target</a></div><div class="ttdeci">item_location target</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00561">item.h:561</a></div></div>
<div class="ttc" id="aclassitem_1_1reload__option_html_ab7102268fec39b1a9104321e4f2c98f5"><div class="ttname"><a href="classitem_1_1reload__option.html#ab7102268fec39b1a9104321e4f2c98f5">item::reload_option::moves</a></div><div class="ttdeci">int moves() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11532">item.cpp:11532</a></div></div>
<div class="ttc" id="aclassitem_1_1reload__option_html_afec3eb8ab3dff71940912db4a84ae7ea"><div class="ttname"><a href="classitem_1_1reload__option.html#afec3eb8ab3dff71940912db4a84ae7ea">item::reload_option::ammo</a></div><div class="ttdeci">item_location ammo</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00562">item.h:562</a></div></div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00028">item_location.h:29</a></div></div>
<div class="ttc" id="aclassitem__location_html_a350bb267073f30205f780b394324a32c"><div class="ttname"><a href="classitem__location.html#a350bb267073f30205f780b394324a32c">item_location::get_item</a></div><div class="ttdeci">item * get_item()</div><div class="ttdoc">Gets the selected item or nullptr.</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8cpp_source.html#l01087">item_location.cpp:1087</a></div></div>
<div class="ttc" id="aclassitem__stack_html_a09718022e82be5bc5dd6d84463521751"><div class="ttname"><a href="classitem__stack.html#a09718022e82be5bc5dd6d84463521751">item_stack::size</a></div><div class="ttdeci">size_t size() const</div><div class="ttdef"><b>Definition:</b> <a href="item__stack_8cpp_source.html#l00014">item_stack.cpp:14</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00195">item.h:196</a></div></div>
<div class="ttc" id="aclassitem_html_a084b8b7138242ba272d566bf49d007c3"><div class="ttname"><a href="classitem.html#a084b8b7138242ba272d566bf49d007c3">item::ammo_capacity</a></div><div class="ttdeci">int ammo_capacity(const ammotype &amp;ammo, bool include_linked=false) const</div><div class="ttdoc">ammo capacity for a specific ammo</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10801">item.cpp:10801</a></div></div>
<div class="ttc" id="aclassitem_html_a0b35b9066ad71987b77727af45d96059"><div class="ttname"><a href="classitem.html#a0b35b9066ad71987b77727af45d96059">item::is_owned_by</a></div><div class="ttdeci">bool is_owned_by(const Character &amp;c, bool available_to_take=false) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l02116">item.cpp:2116</a></div></div>
<div class="ttc" id="aclassitem_html_a1a94ea108d695febf7f2bcf090f097fa"><div class="ttname"><a href="classitem.html#a1a94ea108d695febf7f2bcf090f097fa">item::gun_current_mode</a></div><div class="ttdeci">gun_mode gun_current_mode() const</div><div class="ttdoc">Get the current mode for this gun (or an invalid mode if item is not a gun)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11420">item.cpp:11420</a></div></div>
<div class="ttc" id="aclassitem_html_a2912b2e15a4eec07a5070fffbbd152e8"><div class="ttname"><a href="classitem.html#a2912b2e15a4eec07a5070fffbbd152e8">item::is_gun</a></div><div class="ttdeci">bool is_gun() const</div><div class="ttdoc">Can this item be used to perform a ranged attack?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09297">item.cpp:9297</a></div></div>
<div class="ttc" id="aclassitem_html_a2993eb10a5ae589e6bb1be0a74cb65c1"><div class="ttname"><a href="classitem.html#a2993eb10a5ae589e6bb1be0a74cb65c1">item::active</a></div><div class="ttdeci">bool active</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03212">item.h:3212</a></div></div>
<div class="ttc" id="aclassitem_html_a30837987c08ac5daf3b1e377e0ecaa21"><div class="ttname"><a href="classitem.html#a30837987c08ac5daf3b1e377e0ecaa21">item::tname</a></div><div class="ttdeci">std::string tname(unsigned int quantity=1, tname::segment_bitset const &amp;segments=tname::default_tname) const</div><div class="ttdoc">Return the (translated) item name.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l06814">item.cpp:6814</a></div></div>
<div class="ttc" id="aclassitem_html_a3157f01f1da6fe89bdbc87db2605afb9"><div class="ttname"><a href="classitem.html#a3157f01f1da6fe89bdbc87db2605afb9">item::weight</a></div><div class="ttdeci">units::mass weight(bool include_contents=true, bool integral=false) const</div><div class="ttdoc">Total weight of an item accounting for all contained/integrated items.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07081">item.cpp:7081</a></div></div>
<div class="ttc" id="aclassitem_html_a31950d1e38829eb4c5794ffbe4e7d604"><div class="ttname"><a href="classitem.html#a31950d1e38829eb4c5794ffbe4e7d604">item::shots_remaining</a></div><div class="ttdeci">int shots_remaining(const Character *carrier) const</div><div class="ttdoc">Quantity of shots in the gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10668">item.cpp:10668</a></div></div>
<div class="ttc" id="aclassitem_html_a3e532e4e5b7cef943634b1d910f99384"><div class="ttname"><a href="classitem.html#a3e532e4e5b7cef943634b1d910f99384">item::has_flag</a></div><div class="ttdeci">bool has_flag(const flag_id &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07578">item.cpp:7578</a></div></div>
<div class="ttc" id="aclassitem_html_a40963a016376016eb408bdb9dbb94388"><div class="ttname"><a href="classitem.html#a40963a016376016eb408bdb9dbb94388">item::count_by_charges</a></div><div class="ttdeci">bool count_by_charges() const</div><div class="ttdoc">Return true if this item's type is counted by charges (true for stackable, ammo, or comestible)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l08618">item.cpp:8618</a></div></div>
<div class="ttc" id="aclassitem_html_a411163e892e27c57b802d0d015c05162"><div class="ttname"><a href="classitem.html#a411163e892e27c57b802d0d015c05162">item::get_comestible</a></div><div class="ttdeci">const cata::value_ptr&lt; islot_comestible &gt; &amp; get_comestible() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l14803">item.cpp:14803</a></div></div>
<div class="ttc" id="aclassitem_html_a428ea67bcf1a68b717f7cd4871b0b980"><div class="ttname"><a href="classitem.html#a428ea67bcf1a68b717f7cd4871b0b980">item::ammo_remaining</a></div><div class="ttdeci">int ammo_remaining(const Character *carrier=nullptr, bool include_linked=false) const</div><div class="ttdoc">Quantity of ammunition currently loaded in tool, gun or auxiliary gunmod.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10739">item.cpp:10739</a></div></div>
<div class="ttc" id="aclassitem_html_a4a9972e826d25be6736b749ab94b230f"><div class="ttname"><a href="classitem.html#a4a9972e826d25be6736b749ab94b230f">item::typeId</a></div><div class="ttdeci">itype_id typeId() const</div><div class="ttdoc">return the unique identifier of the items underlying type</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11850">item.cpp:11850</a></div></div>
<div class="ttc" id="aclassitem_html_a4adcc4a3a5f5fb20a4d245d79109640a"><div class="ttname"><a href="classitem.html#a4adcc4a3a5f5fb20a4d245d79109640a">item::ammo_data</a></div><div class="ttdeci">const itype * ammo_data() const</div><div class="ttdoc">Specific ammo data, returns nullptr if item is neither ammo nor loaded with any.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10995">item.cpp:10995</a></div></div>
<div class="ttc" id="aclassitem_html_a4d5555082454b3cb192f59a70838c891"><div class="ttname"><a href="classitem.html#a4d5555082454b3cb192f59a70838c891">item::is_null</a></div><div class="ttdeci">bool is_null() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00931">item.cpp:931</a></div></div>
<div class="ttc" id="aclassitem_html_a57b10fc9db286a3449ddc92ab3d896f5"><div class="ttname"><a href="classitem.html#a57b10fc9db286a3449ddc92ab3d896f5">item::ammo_consume</a></div><div class="ttdeci">int ammo_consume(int qty, const tripoint &amp;pos, Character *carrier)</div><div class="ttdoc">Consume ammo (if available) and return the amount of ammo that was consumed Consume order: loaded ite...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10878">item.cpp:10878</a></div></div>
<div class="ttc" id="aclassitem_html_a59a03649a0636c70e776054db688564a"><div class="ttname"><a href="classitem.html#a59a03649a0636c70e776054db688564a">item::is_tool</a></div><div class="ttdeci">bool is_tool() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09953">item.cpp:9953</a></div></div>
<div class="ttc" id="aclassitem_html_a66b0bbc211f6fb668781640c971d3acc"><div class="ttname"><a href="classitem.html#a66b0bbc211f6fb668781640c971d3acc">item::get_comestible_fun</a></div><div class="ttdeci">int get_comestible_fun() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07798">item.cpp:7798</a></div></div>
<div class="ttc" id="aclassitem_html_a6bfb92ab5d41e0eb3a1da160fac71b0e"><div class="ttname"><a href="classitem.html#a6bfb92ab5d41e0eb3a1da160fac71b0e">item::charges</a></div><div class="ttdeci">int charges</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03133">item.h:3133</a></div></div>
<div class="ttc" id="aclassitem_html_a71dac02bae8b97487391d5540a89bc1c"><div class="ttname"><a href="classitem.html#a71dac02bae8b97487391d5540a89bc1c">item::get_use</a></div><div class="ttdeci">const use_function * get_use(const std::string &amp;use_name) const</div><div class="ttdoc">Returns the pointer to use_function with name use_name assigned to the type of this item or any of it...</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11463">item.cpp:11463</a></div></div>
<div class="ttc" id="aclassitem_html_a77cad1ee17273a24e50fe42e03eea269"><div class="ttname"><a href="classitem.html#a77cad1ee17273a24e50fe42e03eea269">item::gun_range</a></div><div class="ttdeci">int gun_range(const Character *p) const</div><div class="ttdoc">The weapons range in map squares.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10648">item.cpp:10648</a></div></div>
<div class="ttc" id="aclassitem_html_a7dc5d9ccf5638ae80cebe1864050fa26"><div class="ttname"><a href="classitem.html#a7dc5d9ccf5638ae80cebe1864050fa26">item::ammo_required</a></div><div class="ttdeci">int ammo_required() const</div><div class="ttdoc">Quantity of ammunition consumed per usage of tool or with each shot of gun.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10821">item.cpp:10821</a></div></div>
<div class="ttc" id="aclassitem_html_a84cbca948718b41241902acce542f352"><div class="ttname"><a href="classitem.html#a84cbca948718b41241902acce542f352">item::is_reloadable</a></div><div class="ttdeci">bool is_reloadable() const</div><div class="ttdoc">Is it ever possible to reload this item? ALso checks for reloading installed gunmods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l14413">item.cpp:14413</a></div></div>
<div class="ttc" id="aclassitem_html_a9b7de1507e4000d58e9d813354073188"><div class="ttname"><a href="classitem.html#a9b7de1507e4000d58e9d813354073188">item::reload</a></div><div class="ttdeci">bool reload(Character &amp;u, item_location ammo, int qty)</div><div class="ttdoc">Reload item using ammo from location returning true if successful.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11612">item.cpp:11612</a></div></div>
<div class="ttc" id="aclassitem_html_a9f276bdd47b29bc1649dce5c64cbe433"><div class="ttname"><a href="classitem.html#a9f276bdd47b29bc1649dce5c64cbe433">item::poison</a></div><div class="ttdeci">int poison</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03138">item.h:3138</a></div></div>
<div class="ttc" id="aclassitem_html_aa1a2ecb3e9ebf95dc7fedac4c1de32b4"><div class="ttname"><a href="classitem.html#aa1a2ecb3e9ebf95dc7fedac4c1de32b4">item::gun_all_modes</a></div><div class="ttdeci">std::map&lt; gun_mode_id, gun_mode &gt; gun_all_modes() const</div><div class="ttdoc">Get all possible modes for this gun inclusive of any attached gunmods.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l11361">item.cpp:11361</a></div></div>
<div class="ttc" id="aclassitem_html_aa344ad5d3082d7a56b1c902fbafb6347"><div class="ttname"><a href="classitem.html#aa344ad5d3082d7a56b1c902fbafb6347">item::is_medication</a></div><div class="ttdeci">bool is_medication() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09489">item.cpp:9489</a></div></div>
<div class="ttc" id="aclassitem_html_aa370bf267d606ed6098dc9d1c518ebf5"><div class="ttname"><a href="classitem.html#aa370bf267d606ed6098dc9d1c518ebf5">item::get_covered_body_parts</a></div><div class="ttdeci">body_part_set get_covered_body_parts() const</div><div class="ttdoc">Bitset of all covered body parts.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l01031">item.cpp:1031</a></div></div>
<div class="ttc" id="aclassitem_html_aad45569fa1fdd99d602eabbbbca04f75"><div class="ttname"><a href="classitem.html#aad45569fa1fdd99d602eabbbbca04f75">item::is_food</a></div><div class="ttdeci">bool is_food() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09480">item.cpp:9480</a></div></div>
<div class="ttc" id="aclassitem_html_aafdd6e14936eb02b0d71a96e7e325746"><div class="ttname"><a href="classitem.html#aafdd6e14936eb02b0d71a96e7e325746">item::ammo_sufficient</a></div><div class="ttdeci">bool ammo_sufficient(const Character *carrier, int qty=1) const</div><div class="ttdoc">Check if sufficient ammo is loaded for given number of uses.</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l10855">item.cpp:10855</a></div></div>
<div class="ttc" id="aclassitem_html_ab180dbb50ec9d55570a1b1de1a2ce126"><div class="ttname"><a href="classitem.html#ab180dbb50ec9d55570a1b1de1a2ce126">item::is_silent</a></div><div class="ttdeci">bool is_silent() const</div><div class="ttdoc">Whether this is a (nearly) silent gun (a tiny bit of sound is allowed).</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09430">item.cpp:9430</a></div></div>
<div class="ttc" id="aclassitem_html_ac1d2c4c33b8a499812f3437cb2fad742"><div class="ttname"><a href="classitem.html#ac1d2c4c33b8a499812f3437cb2fad742">item::type</a></div><div class="ttdeci">const itype * type</div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l03074">item.h:3074</a></div></div>
<div class="ttc" id="aclassitem_html_adce43f2490a85e2dc212a26ce5ded4fc"><div class="ttname"><a href="classitem.html#adce43f2490a85e2dc212a26ce5ded4fc">item::is_magazine</a></div><div class="ttdeci">bool is_magazine() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09445">item.cpp:9445</a></div></div>
<div class="ttc" id="aclassitem_html_adfb5ddb3d50f317c79eb7a1a26a63905"><div class="ttname"><a href="classitem.html#adfb5ddb3d50f317c79eb7a1a26a63905">item::get_relative_rot</a></div><div class="ttdeci">double get_relative_rot() const</div><div class="ttdoc">Get rot value relative to shelf life (or 0 if item does not spoil)</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l07849">item.cpp:7849</a></div></div>
<div class="ttc" id="aclassitem_html_ae05d298b2cf91e4c12d5beca5f38c67f"><div class="ttname"><a href="classitem.html#ae05d298b2cf91e4c12d5beca5f38c67f">item::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l15135">item.cpp:15135</a></div></div>
<div class="ttc" id="aclassitem_html_af486ddb23bd7e254cc07ef3ba1ba846d"><div class="ttname"><a href="classitem.html#af486ddb23bd7e254cc07ef3ba1ba846d">item::made_of_from_type</a></div><div class="ttdeci">bool made_of_from_type(phase_id phase) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09268">item.cpp:9268</a></div></div>
<div class="ttc" id="aclassitem_html_afdeb60e09043e124c9c6061f0bffe085"><div class="ttname"><a href="classitem.html#afdeb60e09043e124c9c6061f0bffe085">item::is_melee</a></div><div class="ttdeci">bool is_melee(const damage_type_id &amp;dt) const</div><div class="ttdoc">Is this item an effective melee weapon for the given damage type?</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l09596">item.cpp:9596</a></div></div>
<div class="ttc" id="aclassiuse__transform_html"><div class="ttname"><a href="classiuse__transform.html">iuse_transform</a></div><div class="ttdoc">Transform an item into a specific type.</div><div class="ttdef"><b>Definition:</b> <a href="iuse__actor_8h_source.html#l00047">iuse_actor.h:48</a></div></div>
<div class="ttc" id="aclassjob__data_html_a3268948e4e306da36705f0666f5741da"><div class="ttname"><a href="classjob__data.html#a3268948e4e306da36705f0666f5741da">job_data::get_prioritised_vector</a></div><div class="ttdeci">std::vector&lt; activity_id &gt; get_prioritised_vector() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l00202">npc.cpp:202</a></div></div>
<div class="ttc" id="aclassjob__data_html_a74adef0b6a154ba1114e84e70fc93872"><div class="ttname"><a href="classjob__data.html#a74adef0b6a154ba1114e84e70fc93872">job_data::fetch_history</a></div><div class="ttdeci">std::unordered_map&lt; std::string, time_point &gt; fetch_history</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00160">npc.h:160</a></div></div>
<div class="ttc" id="aclassjob__data_html_a9a088b1ef414b06de0184794f89df640"><div class="ttname"><a href="classjob__data.html#a9a088b1ef414b06de0184794f89df640">job_data::get_priority_of_job</a></div><div class="ttdeci">int get_priority_of_job(const activity_id &amp;req_job) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l00192">npc.cpp:192</a></div></div>
<div class="ttc" id="aclasslru__cache_html_a0039118ed2fb526c6a9ae9e3a51f75ae"><div class="ttname"><a href="classlru__cache.html#a0039118ed2fb526c6a9ae9e3a51f75ae">lru_cache::insert</a></div><div class="ttdeci">void insert(int limit, const Key &amp;, const Value &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="lru__cache_8h_source.html#l00048">lru_cache.h:48</a></div></div>
<div class="ttc" id="aclasslru__cache_html_a1b5e943a1577d9ff732a63c130c58a45"><div class="ttname"><a href="classlru__cache.html#a1b5e943a1577d9ff732a63c130c58a45">lru_cache::get</a></div><div class="ttdeci">Value get(const Key &amp;, const Value &amp;default_) const</div><div class="ttdef"><b>Definition:</b> <a href="lru__cache_8h_source.html#l00028">lru_cache.h:28</a></div></div>
<div class="ttc" id="aclassmap__cursor_html"><div class="ttname"><a href="classmap__cursor.html">map_cursor</a></div><div class="ttdef"><b>Definition:</b> <a href="map__selector_8h_source.html#l00015">map_selector.h:16</a></div></div>
<div class="ttc" id="aclassmap__stack_html"><div class="ttname"><a href="classmap__stack.html">map_stack</a></div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00106">map.h:107</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00345">map.h:346</a></div></div>
<div class="ttc" id="aclassmap_html_a04983d87d4316ae7adc5e1d52220dd90"><div class="ttname"><a href="classmap.html#a04983d87d4316ae7adc5e1d52220dd90">map::get_dir_circle</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; get_dir_circle(const tripoint &amp;f, const tripoint &amp;t) const</div><div class="ttdoc">Calculate next search points surrounding the current position.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l07845">map.cpp:7845</a></div></div>
<div class="ttc" id="aclassmap_html_a09ef3e8c2e6664e3ed98d1e1e18a4b4f"><div class="ttname"><a href="classmap.html#a09ef3e8c2e6664e3ed98d1e1e18a4b4f">map::has_flag_furn</a></div><div class="ttdeci">bool has_flag_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03112">map.cpp:3112</a></div></div>
<div class="ttc" id="aclassmap_html_a0acb4c11e2fd7a3dc7d2f7a8b52c1503"><div class="ttname"><a href="classmap.html#a0acb4c11e2fd7a3dc7d2f7a8b52c1503">map::get_active_items_in_radius</a></div><div class="ttdeci">std::list&lt; item_location &gt; get_active_items_in_radius(const tripoint &amp;center, int radius)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l10148">map.cpp:10148</a></div></div>
<div class="ttc" id="aclassmap_html_a19208d20803ab7c5da1073e17da18bd1"><div class="ttname"><a href="classmap.html#a19208d20803ab7c5da1073e17da18bd1">map::is_harvestable</a></div><div class="ttdeci">bool is_harvestable(const tripoint &amp;pos) const</div><div class="ttdoc">Returns true if point at pos is harvestable right now, with no extra tools.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02217">map.cpp:2217</a></div></div>
<div class="ttc" id="aclassmap_html_a1cc29653b8305e7192311c05a0bd4c99"><div class="ttname"><a href="classmap.html#a1cc29653b8305e7192311c05a0bd4c99">map::bub_from_abs</a></div><div class="ttdeci">tripoint_bub_ms bub_from_abs(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09647">map.cpp:9647</a></div></div>
<div class="ttc" id="aclassmap_html_a1e5a0861247defbe414be8cc65475a17"><div class="ttname"><a href="classmap.html#a1e5a0861247defbe414be8cc65475a17">map::point_within_camp</a></div><div class="ttdeci">bool point_within_camp(const tripoint &amp;point_check) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06760">map.cpp:6760</a></div></div>
<div class="ttc" id="aclassmap_html_a27e22f0999ea03eff18babc48643c568"><div class="ttname"><a href="classmap.html#a27e22f0999ea03eff18babc48643c568">map::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03077">map.cpp:3077</a></div></div>
<div class="ttc" id="aclassmap_html_a30cfefdb115c16c5e1af6cc99f94bbbd"><div class="ttname"><a href="classmap.html#a30cfefdb115c16c5e1af6cc99f94bbbd">map::get_field</a></div><div class="ttdeci">field_entry * get_field(const tripoint &amp;p, const field_type_id &amp;type)</div><div class="ttdoc">Get field of specific type at point.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06516">map.cpp:6516</a></div></div>
<div class="ttc" id="aclassmap_html_a395a729a4b954692cf08d13e1d32f73e"><div class="ttname"><a href="classmap.html#a395a729a4b954692cf08d13e1d32f73e">map::field_at</a></div><div class="ttdeci">const field &amp; field_at(const tripoint &amp;p) const</div><div class="ttdoc">Get the fields that are here.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06379">map.cpp:6379</a></div></div>
<div class="ttc" id="aclassmap_html_a3bc75c8b706a54c1575b4460b2f363b1"><div class="ttname"><a href="classmap.html#a3bc75c8b706a54c1575b4460b2f363b1">map::is_outside</a></div><div class="ttdeci">bool is_outside(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03395">map.cpp:3395</a></div></div>
<div class="ttc" id="aclassmap_html_a426c21f7244ff80a61685a89e9146fec"><div class="ttname"><a href="classmap.html#a426c21f7244ff80a61685a89e9146fec">map::getlocal</a></div><div class="ttdeci">tripoint getlocal(const tripoint &amp;p) const</div><div class="ttdoc">Inverse of getabs.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09635">map.cpp:9635</a></div></div>
<div class="ttc" id="aclassmap_html_a46608709f68358365d0734b1063fed73"><div class="ttname"><a href="classmap.html#a46608709f68358365d0734b1063fed73">map::inbounds</a></div><div class="ttdeci">bool inbounds(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09057">map.cpp:9057</a></div></div>
<div class="ttc" id="aclassmap_html_a4f5f812d7e89a998429958573a4c340f"><div class="ttname"><a href="classmap.html#a4f5f812d7e89a998429958573a4c340f">map::points_in_radius</a></div><div class="ttdeci">tripoint_range&lt; tripoint &gt; points_in_radius(const tripoint &amp;center, size_t radius, size_t radiusz=0) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l10109">map.cpp:10109</a></div></div>
<div class="ttc" id="aclassmap_html_a501f3a1d449ac022f1b36b99da653e94"><div class="ttname"><a href="classmap.html#a501f3a1d449ac022f1b36b99da653e94">map::getabs</a></div><div class="ttdeci">tripoint getabs(const tripoint &amp;p) const</div><div class="ttdoc">Translates local (to this map) coordinates of a square to global absolute coordinates.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09614">map.cpp:9614</a></div></div>
<div class="ttc" id="aclassmap_html_a5130a127601b67e569eaef37a1a88610"><div class="ttname"><a href="classmap.html#a5130a127601b67e569eaef37a1a88610">map::i_at</a></div><div class="ttdeci">map_stack i_at(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l04978">map.cpp:4978</a></div></div>
<div class="ttc" id="aclassmap_html_a516c0764134cc86b57297811520395f7"><div class="ttname"><a href="classmap.html#a516c0764134cc86b57297811520395f7">map::has_flag_ter_or_furn</a></div><div class="ttdeci">bool has_flag_ter_or_furn(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03122">map.cpp:3122</a></div></div>
<div class="ttc" id="aclassmap_html_a51e32639c8df0c90e0743f929bcf2111"><div class="ttname"><a href="classmap.html#a51e32639c8df0c90e0743f929bcf2111">map::tername</a></div><div class="ttdeci">std::string tername(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02340">map.cpp:2340</a></div></div>
<div class="ttc" id="aclassmap_html_a53d95390d133477f8b4a1ce76482750b"><div class="ttname"><a href="classmap.html#a53d95390d133477f8b4a1ce76482750b">map::unboard_vehicle</a></div><div class="ttdeci">void unboard_vehicle(const vpart_reference &amp;, Character *passenger, bool dead_passenger=false)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01395">map.cpp:1395</a></div></div>
<div class="ttc" id="aclassmap_html_a5b4d4347883c3f0f622b2a0d9ca65b93"><div class="ttname"><a href="classmap.html#a5b4d4347883c3f0f622b2a0d9ca65b93">map::has_potential_los</a></div><div class="ttdeci">bool has_potential_los(const tripoint &amp;from, const tripoint &amp;to) const</div><div class="ttdoc">A pre-filter for bresenham LOS.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l10509">map.cpp:10509</a></div></div>
<div class="ttc" id="aclassmap_html_a5b666218957f159f8af59e98644c7183"><div class="ttname"><a href="classmap.html#a5b666218957f159f8af59e98644c7183">map::sees_some_items</a></div><div class="ttdeci">bool sees_some_items(const tripoint &amp;p, const Creature &amp;who) const</div><div class="ttdoc">Check if creature can see some items at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05855">map.cpp:5855</a></div></div>
<div class="ttc" id="aclassmap_html_a5ee9fe3a08892870a0574b8e1ab4e6b0"><div class="ttname"><a href="classmap.html#a5ee9fe3a08892870a0574b8e1ab4e6b0">map::has_vehicle_floor</a></div><div class="ttdeci">bool has_vehicle_floor(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02739">map.cpp:2739</a></div></div>
<div class="ttc" id="aclassmap_html_a670590e1c5a25d81f56def7c89dbde95"><div class="ttname"><a href="classmap.html#a670590e1c5a25d81f56def7c89dbde95">map::is_bashable</a></div><div class="ttdeci">bool is_bashable(const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns true if there is a bashable vehicle part or the furn/terrain is bashable at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03240">map.cpp:3240</a></div></div>
<div class="ttc" id="aclassmap_html_a6c9fdb474119bafd75efa7c12e0bec1a"><div class="ttname"><a href="classmap.html#a6c9fdb474119bafd75efa7c12e0bec1a">map::bash_rating</a></div><div class="ttdeci">int bash_rating(int str, const tripoint &amp;p, bool allow_floor=false) const</div><div class="ttdoc">Returns a success rating from -1 to 10 for a given tile based on a set strength, used for AI movement...</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03304">map.cpp:3304</a></div></div>
<div class="ttc" id="aclassmap_html_a728d97469f08da32ae2108d30d2a51ca"><div class="ttname"><a href="classmap.html#a728d97469f08da32ae2108d30d2a51ca">map::combined_movecost</a></div><div class="ttdeci">int combined_movecost(const tripoint &amp;from, const tripoint &amp;to, const vehicle *ignored_vehicle=nullptr, int modifier=0, bool flying=false, bool via_ramp=false) const</div><div class="ttdoc">Cost to move out of one tile and into the next.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02519">map.cpp:2519</a></div></div>
<div class="ttc" id="aclassmap_html_a780bfbdc19649391081c1ad6e0e4aa81"><div class="ttname"><a href="classmap.html#a780bfbdc19649391081c1ad6e0e4aa81">map::creature_in_field</a></div><div class="ttdeci">void creature_in_field(Creature &amp;critter)</div><div class="ttdoc">Apply field effects to the creature when it's on a square with fields.</div><div class="ttdef"><b>Definition:</b> <a href="map__field_8cpp_source.html#l01745">map_field.cpp:1745</a></div></div>
<div class="ttc" id="aclassmap_html_a78e0a35a5041e0daf6e7a2a4ec522014"><div class="ttname"><a href="classmap.html#a78e0a35a5041e0daf6e7a2a4ec522014">map::has_floor_or_water</a></div><div class="ttdeci">bool has_floor_or_water(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02703">map.cpp:2703</a></div></div>
<div class="ttc" id="aclassmap_html_a9ac1c68c3941554a86bff27bf1ce2389"><div class="ttname"><a href="classmap.html#a9ac1c68c3941554a86bff27bf1ce2389">map::open_door</a></div><div class="ttdeci">bool open_door(Creature const &amp;u, const tripoint &amp;p, bool inside, bool check_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l04689">map.cpp:4689</a></div></div>
<div class="ttc" id="aclassmap_html_aa487d96256c3d35db7a1bf273156b64a"><div class="ttname"><a href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">map::veh_at</a></div><div class="ttdeci">optional_vpart_position veh_at(const tripoint &amp;p) const</div><div class="ttdoc">Checks if tile is occupied by vehicle and by which part.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01316">map.cpp:1316</a></div></div>
<div class="ttc" id="aclassmap_html_aa69021d452dbc555723d55d7c9fe98ef"><div class="ttname"><a href="classmap.html#aa69021d452dbc555723d55d7c9fe98ef">map::has_field_at</a></div><div class="ttdeci">bool has_field_at(const tripoint &amp;p, bool check_bounds=true) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l06487">map.cpp:6487</a></div></div>
<div class="ttc" id="aclassmap_html_aa904e9f61ca568d8ed985cf22193b8ed"><div class="ttname"><a href="classmap.html#aa904e9f61ca568d8ed985cf22193b8ed">map::has_items</a></div><div class="ttdeci">bool has_items(const tripoint &amp;p) const</div><div class="ttdoc">Checks for existence of items.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05890">map.cpp:5890</a></div></div>
<div class="ttc" id="aclassmap_html_aaa8d85d40512cf240c55a050d8952c2f"><div class="ttname"><a href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">map::bash</a></div><div class="ttdeci">bash_params bash(const tripoint &amp;p, int str, bool silent=false, bool destroy=false, bool bash_floor=false, const vehicle *bashing_vehicle=nullptr)</div><div class="ttdoc">Returns a pair where first is whether anything was smashed and second is if it was destroyed.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l04292">map.cpp:4292</a></div></div>
<div class="ttc" id="aclassmap_html_abe9e7b93cf8ee15c370ad55c3138c4f6"><div class="ttname"><a href="classmap.html#abe9e7b93cf8ee15c370ad55c3138c4f6">map::move_cost</a></div><div class="ttdeci">int move_cost(const tripoint &amp;p, const vehicle *ignored_vehicle=nullptr) const</div><div class="ttdoc">Calculate the cost to move past the tile at p.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02434">map.cpp:2434</a></div></div>
<div class="ttc" id="aclassmap_html_ac868b594b36b6b9bbcb130650fd4f61f"><div class="ttname"><a href="classmap.html#ac868b594b36b6b9bbcb130650fd4f61f">map::getglobal</a></div><div class="ttdeci">tripoint_abs_ms getglobal(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09625">map.cpp:9625</a></div></div>
<div class="ttc" id="aclassmap_html_ac9d96deaafa7d74a897a9e5ca1c1f928"><div class="ttname"><a href="classmap.html#ac9d96deaafa7d74a897a9e5ca1c1f928">map::get_harvest_names</a></div><div class="ttdeci">const std::set&lt; std::string &gt; &amp; get_harvest_names(const tripoint &amp;p) const</div><div class="ttdoc">Returns names of the items that would be dropped.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02175">map.cpp:2175</a></div></div>
<div class="ttc" id="aclassmap_html_acd464679b3bb514e2568ffdb3260ef0c"><div class="ttname"><a href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">map::route</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; route(const tripoint &amp;f, const tripoint &amp;t, const pathfinding_settings &amp;settings, const std::unordered_set&lt; tripoint &gt; &amp;pre_closed={{ }}) const</div><div class="ttdoc">Calculate the best path using A*.</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00192">pathfinding.cpp:192</a></div></div>
<div class="ttc" id="aclassmap_html_ad5ce012d209eb449670565155ec30f4b"><div class="ttname"><a href="classmap.html#ad5ce012d209eb449670565155ec30f4b">map::examine</a></div><div class="ttdeci">void examine(Character &amp;you, const tripoint &amp;pos) const</div><div class="ttdoc">Calls the examine function of furniture or terrain at given tile, for given character.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02207">map.cpp:2207</a></div></div>
<div class="ttc" id="aclassmap_html_ae0dae45aeed1b7221d318c0a36abca5b"><div class="ttname"><a href="classmap.html#ae0dae45aeed1b7221d318c0a36abca5b">map::creature_on_trap</a></div><div class="ttdeci">void creature_on_trap(Creature &amp;critter, bool may_avoid=true) const</div><div class="ttdoc">Apply trap effects to the creature, similar to creature_in_field.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09887">map.cpp:9887</a></div></div>
<div class="ttc" id="aclassmap_html_ae9e52026d9d68ff5e7fe85c6f8963421"><div class="ttname"><a href="classmap.html#ae9e52026d9d68ff5e7fe85c6f8963421">map::board_vehicle</a></div><div class="ttdeci">void board_vehicle(const tripoint &amp;p, Character *pl)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01361">map.cpp:1361</a></div></div>
<div class="ttc" id="aclassmap_html_af563dc2397e71a053569cb45c6bb7e77"><div class="ttname"><a href="classmap.html#af563dc2397e71a053569cb45c6bb7e77">map::passable</a></div><div class="ttdeci">bool passable(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02472">map.cpp:2472</a></div></div>
<div class="ttc" id="aclassmission_html"><div class="ttname"><a href="classmission.html">mission</a></div><div class="ttdef"><b>Definition:</b> <a href="mission_8h_source.html#l00272">mission.h:273</a></div></div>
<div class="ttc" id="aclassmission_html_ac276c5e4ecbe985340656c2183e73b8e"><div class="ttname"><a href="classmission.html#ac276c5e4ecbe985340656c2183e73b8e">mission::is_complete</a></div><div class="ttdeci">bool is_complete(const character_id &amp;npc_id) const</div><div class="ttdoc">Checks if the player has completed the matching mission and returns true if they have.</div><div class="ttdef"><b>Definition:</b> <a href="mission_8cpp_source.html#l00467">mission.cpp:467</a></div></div>
<div class="ttc" id="aclassmission_html_af99364a9afac4abce5af8a056835f95d"><div class="ttname"><a href="classmission.html#af99364a9afac4abce5af8a056835f95d">mission::get_type</a></div><div class="ttdeci">const mission_type &amp; get_type() const</div><div class="ttdef"><b>Definition:</b> <a href="mission_8cpp_source.html#l00714">mission.cpp:714</a></div></div>
<div class="ttc" id="aclassmonster_html"><div class="ttname"><a href="classmonster.html">monster</a></div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00085">monster.h:86</a></div></div>
<div class="ttc" id="aclassmonster_html_a2d0e466b9d25796cd99402ddd5d3ce20"><div class="ttname"><a href="classmonster.html#a2d0e466b9d25796cd99402ddd5d3ce20">monster::get_hp</a></div><div class="ttdeci">int get_hp(const bodypart_id &amp;) const override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l03743">monster.cpp:3743</a></div></div>
<div class="ttc" id="aclassmonster_html_a551f4a380282f8ec082c74f410c397de"><div class="ttname"><a href="classmonster.html#a551f4a380282f8ec082c74f410c397de">monster::get_hp_max</a></div><div class="ttdeci">int get_hp_max(const bodypart_id &amp;) const override</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l03733">monster.cpp:3733</a></div></div>
<div class="ttc" id="aclassmonster_html_aa30f973bf524ba275ada847f6118b048"><div class="ttname"><a href="classmonster.html#aa30f973bf524ba275ada847f6118b048">monster::type</a></div><div class="ttdeci">const mtype * type</div><div class="ttdef"><b>Definition:</b> <a href="monster_8h_source.html#l00550">monster.h:550</a></div></div>
<div class="ttc" id="aclassmonster_html_aa726a9074840d376b00a575d4079bcbc"><div class="ttname"><a href="classmonster.html#aa726a9074840d376b00a575d4079bcbc">monster::speed_rating</a></div><div class="ttdeci">float speed_rating() const override</div><div class="ttdoc">Returns an approximate number of tiles this creature can travel per turn.</div><div class="ttdef"><b>Definition:</b> <a href="monster_8cpp_source.html#l03662">monster.cpp:3662</a></div></div>
<div class="ttc" id="aclassmove__mode_html"><div class="ttname"><a href="classmove__mode.html">move_mode</a></div><div class="ttdef"><b>Definition:</b> <a href="move__mode_8h_source.html#l00033">move_mode.h:34</a></div></div>
<div class="ttc" id="aclassnpc__attack__rating_html"><div class="ttname"><a href="classnpc__attack__rating.html">npc_attack_rating</a></div><div class="ttdef"><b>Definition:</b> <a href="npc__attack_8h_source.html#l00017">npc_attack.h:18</a></div></div>
<div class="ttc" id="aclassnpc__attack__rating_html_a5edbe25131a7337a3738bd24cd113f5b"><div class="ttname"><a href="classnpc__attack__rating.html#a5edbe25131a7337a3738bd24cd113f5b">npc_attack_rating::target</a></div><div class="ttdeci">tripoint target() const</div><div class="ttdef"><b>Definition:</b> <a href="npc__attack_8h_source.html#l00030">npc_attack.h:30</a></div></div>
<div class="ttc" id="aclassnpc__attack__rating_html_a97f49e57c67623b107e7781f1ff31c24"><div class="ttname"><a href="classnpc__attack__rating.html#a97f49e57c67623b107e7781f1ff31c24">npc_attack_rating::value</a></div><div class="ttdeci">std::optional&lt; int &gt; value() const</div><div class="ttdef"><b>Definition:</b> <a href="npc__attack_8h_source.html#l00027">npc_attack.h:27</a></div></div>
<div class="ttc" id="aclassnpc_html"><div class="ttname"><a href="classnpc.html">npc</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00791">npc.h:792</a></div></div>
<div class="ttc" id="aclassnpc_html_a00c66c9875847030710d6c619a178168"><div class="ttname"><a href="classnpc.html#a00c66c9875847030710d6c619a178168">npc::activate_bionic_by_id</a></div><div class="ttdeci">bool activate_bionic_by_id(const bionic_id &amp;cbm_id, bool eff_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02234">npcmove.cpp:2234</a></div></div>
<div class="ttc" id="aclassnpc_html_a01b95be72400ef6e5b659c34f634bcfd"><div class="ttname"><a href="classnpc.html#a01b95be72400ef6e5b659c34f634bcfd">npc::regen_ai_cache</a></div><div class="ttdeci">void regen_ai_cache()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01215">npcmove.cpp:1215</a></div></div>
<div class="ttc" id="aclassnpc_html_a037349e70b7f5c207424db299ac6d5af"><div class="ttname"><a href="classnpc.html#a037349e70b7f5c207424db299ac6d5af">npc::confidence_mult</a></div><div class="ttdeci">double confidence_mult() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02654">npcmove.cpp:2654</a></div></div>
<div class="ttc" id="aclassnpc_html_a03d847cc01fcfd290871893e9418d2f0"><div class="ttname"><a href="classnpc.html#a03d847cc01fcfd290871893e9418d2f0">npc::can_use_offensive_cbm</a></div><div class="ttdeci">bool can_use_offensive_cbm() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02293">npcmove.cpp:2293</a></div></div>
<div class="ttc" id="aclassnpc_html_a0480c687e6127de6a1c87b060804a34f"><div class="ttname"><a href="classnpc.html#a0480c687e6127de6a1c87b060804a34f">npc::get_need_str_id</a></div><div class="ttdeci">static std::string get_need_str_id(const npc_need &amp;need)</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03248">npc.cpp:3248</a></div></div>
<div class="ttc" id="aclassnpc_html_a05996f017d647a5d1b7c9cae190c6507"><div class="ttname"><a href="classnpc.html#a05996f017d647a5d1b7c9cae190c6507">npc::distance_string</a></div><div class="ttdeci">std::string distance_string(int range) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05140">npcmove.cpp:5140</a></div></div>
<div class="ttc" id="aclassnpc_html_a06abd7ca2094ae40ba3aa9dbd53311e4"><div class="ttname"><a href="classnpc.html#a06abd7ca2094ae40ba3aa9dbd53311e4">npc::attitude_to</a></div><div class="ttdeci">Attitude attitude_to(const Creature &amp;other) const override</div><div class="ttdoc">Attitude (of this creature) towards another creature.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02386">npc.cpp:2386</a></div></div>
<div class="ttc" id="aclassnpc_html_a073590db1d48bcb4b2f5e6e432f9d560"><div class="ttname"><a href="classnpc.html#a073590db1d48bcb4b2f5e6e432f9d560">npc::item_whitelisted</a></div><div class="ttdeci">bool item_whitelisted(const item &amp;it)</div><div class="ttdef"><b>Definition:</b> <a href="npctalk_8cpp_source.html#l07244">npctalk.cpp:7244</a></div></div>
<div class="ttc" id="aclassnpc_html_a074b34b0dee2182901293c937d523f04"><div class="ttname"><a href="classnpc.html#a074b34b0dee2182901293c937d523f04">npc::can_move_to</a></div><div class="ttdeci">bool can_move_to(const tripoint &amp;p, bool no_bashing=false) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02870">npcmove.cpp:2870</a></div></div>
<div class="ttc" id="aclassnpc_html_a0764f3bbdc903b94bf57fdc2b75cd3e9"><div class="ttname"><a href="classnpc.html#a0764f3bbdc903b94bf57fdc2b75cd3e9">npc::average_damage_dealt</a></div><div class="ttdeci">float average_damage_dealt()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02506">npc.cpp:2506</a></div></div>
<div class="ttc" id="aclassnpc_html_a077962bdd033d5a96974c8ddf3e26a59"><div class="ttname"><a href="classnpc.html#a077962bdd033d5a96974c8ddf3e26a59">npc::say</a></div><div class="ttdeci">void say(const char *const line, Args &amp;&amp;... args) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01025">npc.h:1025</a></div></div>
<div class="ttc" id="aclassnpc_html_a07c860826f1bf71399b1821e0a6850d0"><div class="ttname"><a href="classnpc.html#a07c860826f1bf71399b1821e0a6850d0">npc::ai_cache</a></div><div class="ttdeci">npc_short_term_cache ai_cache</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01348">npc.h:1348</a></div></div>
<div class="ttc" id="aclassnpc_html_a07f70dcf0d3f4228a4d7eda138c5ff00"><div class="ttname"><a href="classnpc.html#a07f70dcf0d3f4228a4d7eda138c5ff00">npc::make_angry</a></div><div class="ttdeci">void make_angry()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l01626">npc.cpp:1626</a></div></div>
<div class="ttc" id="aclassnpc_html_a08d40b6122ca1dcb1a96007b579b6826"><div class="ttname"><a href="classnpc.html#a08d40b6122ca1dcb1a96007b579b6826">npc::confident_range_cache</a></div><div class="ttdeci">std::optional&lt; int &gt; confident_range_cache</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01413">npc.h:1413</a></div></div>
<div class="ttc" id="aclassnpc_html_a0c12ca9af78ebc18189992cc866f5ddc"><div class="ttname"><a href="classnpc.html#a0c12ca9af78ebc18189992cc866f5ddc">npc::find_job_to_perform</a></div><div class="ttdeci">bool find_job_to_perform()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03262">npcmove.cpp:3262</a></div></div>
<div class="ttc" id="aclassnpc_html_a0c523bd03d1dac96dc9ff4597b0e8bdf"><div class="ttname"><a href="classnpc.html#a0c523bd03d1dac96dc9ff4597b0e8bdf">npc::deactivate_or_discharge_bionic_weapon</a></div><div class="ttdeci">void deactivate_or_discharge_bionic_weapon(bool stow_real_weapon=false)</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l00600">bionics.cpp:600</a></div></div>
<div class="ttc" id="aclassnpc_html_a0d2cf37dce89d7725da7dd6633b05974"><div class="ttname"><a href="classnpc.html#a0d2cf37dce89d7725da7dd6633b05974">npc::worst_item_value</a></div><div class="ttdeci">int worst_item_value</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01388">npc.h:1388</a></div></div>
<div class="ttc" id="aclassnpc_html_a0e89849551a6cea0a80ab0d882d871c7"><div class="ttname"><a href="classnpc.html#a0e89849551a6cea0a80ab0d882d871c7">npc::patience</a></div><div class="ttdeci">int patience</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01407">npc.h:1407</a></div></div>
<div class="ttc" id="aclassnpc_html_a10b9a47610d02f871beea8ad74a29e5b"><div class="ttname"><a href="classnpc.html#a10b9a47610d02f871beea8ad74a29e5b">npc::activate_combat_items</a></div><div class="ttdeci">void activate_combat_items()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02344">npcmove.cpp:2344</a></div></div>
<div class="ttc" id="aclassnpc_html_a12374102a0fa38c39765bdef9ee12d90"><div class="ttname"><a href="classnpc.html#a12374102a0fa38c39765bdef9ee12d90">npc::activate_item</a></div><div class="ttdeci">void activate_item(item &amp;it)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04314">npcmove.cpp:4314</a></div></div>
<div class="ttc" id="aclassnpc_html_a12f0365c5c7c143d560cdea7f741aba7"><div class="ttname"><a href="classnpc.html#a12f0365c5c7c143d560cdea7f741aba7">npc::check_or_use_weapon_cbm</a></div><div class="ttdeci">void check_or_use_weapon_cbm(const bionic_id &amp;cbm_id)</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l00623">bionics.cpp:623</a></div></div>
<div class="ttc" id="aclassnpc_html_a1730187ef8f8a6123602a9a8101985ce"><div class="ttname"><a href="classnpc.html#a1730187ef8f8a6123602a9a8101985ce">npc::can_reload_current</a></div><div class="ttdeci">bool can_reload_current()</div><div class="ttdoc">Can reload currently wielded gun?</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02146">npcmove.cpp:2146</a></div></div>
<div class="ttc" id="aclassnpc_html_a18c08c8cf5be52dd8e4016b8e371fb73"><div class="ttname"><a href="classnpc.html#a18c08c8cf5be52dd8e4016b8e371fb73">npc::path</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; path</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01390">npc.h:1390</a></div></div>
<div class="ttc" id="aclassnpc_html_a18ee33441ade8d84af224dd27d0d9914"><div class="ttname"><a href="classnpc.html#a18ee33441ade8d84af224dd27d0d9914">npc::wanted_item_pos</a></div><div class="ttdeci">tripoint wanted_item_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01369">npc.h:1369</a></div></div>
<div class="ttc" id="aclassnpc_html_a19117ee6b30948e7c6512eadb719e1cc"><div class="ttname"><a href="classnpc.html#a19117ee6b30948e7c6512eadb719e1cc">npc::set_omt_destination</a></div><div class="ttdeci">void set_omt_destination()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04851">npcmove.cpp:4851</a></div></div>
<div class="ttc" id="aclassnpc_html_a19b1f35fba77c40af8f65dcc16b9a373"><div class="ttname"><a href="classnpc.html#a19b1f35fba77c40af8f65dcc16b9a373">npc::update_path</a></div><div class="ttdeci">bool update_path(const tripoint &amp;p, bool no_bashing=false, bool force=true)</div><div class="ttdoc">Tries to find path to p.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02811">npcmove.cpp:2811</a></div></div>
<div class="ttc" id="aclassnpc_html_a1af5092f25a6cfeaff67584bb53cc17b"><div class="ttname"><a href="classnpc.html#a1af5092f25a6cfeaff67584bb53cc17b">npc::select_ammo</a></div><div class="ttdeci">item::reload_option select_ammo(const item_location &amp;base, bool prompt=false, bool empty=true) override</div><div class="ttdoc">Select suitable ammo with which to reload the item.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02175">npcmove.cpp:2175</a></div></div>
<div class="ttc" id="aclassnpc_html_a1bb26e5e69786664977de68e3b14079e"><div class="ttname"><a href="classnpc.html#a1bb26e5e69786664977de68e3b14079e">npc::fetching_item</a></div><div class="ttdeci">bool fetching_item</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01386">npc.h:1386</a></div></div>
<div class="ttc" id="aclassnpc_html_a1de32e84a90fa7bb60848c013eb95586"><div class="ttname"><a href="classnpc.html#a1de32e84a90fa7bb60848c013eb95586">npc::find_reloadable</a></div><div class="ttdeci">item_location find_reloadable()</div><div class="ttdoc">Has a gun or magazine that can be reloaded.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02108">npcmove.cpp:2108</a></div></div>
<div class="ttc" id="aclassnpc_html_a1e7f4298e31a5665464c5747969a667f"><div class="ttname"><a href="classnpc.html#a1e7f4298e31a5665464c5747969a667f">npc::is_travelling</a></div><div class="ttdeci">bool is_travelling() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02381">npc.cpp:2381</a></div></div>
<div class="ttc" id="aclassnpc_html_a1f96488976268ad1990ae03cf7b5fe95"><div class="ttname"><a href="classnpc.html#a1f96488976268ad1990ae03cf7b5fe95">npc::estimate_armour</a></div><div class="ttdeci">float estimate_armour(const Character &amp;candidate) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00649">npcmove.cpp:649</a></div></div>
<div class="ttc" id="aclassnpc_html_a20c2937980c35ac70675d8261f95ffd9"><div class="ttname"><a href="classnpc.html#a20c2937980c35ac70675d8261f95ffd9">npc::warn_about</a></div><div class="ttdeci">void warn_about(const std::string &amp;type, const time_duration &amp;d=10_minutes, const std::string &amp;name=&quot;&quot;, int range=-1, const tripoint &amp;danger_pos=tripoint_zero)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05153">npcmove.cpp:5153</a></div></div>
<div class="ttc" id="aclassnpc_html_a21a2c9d7a8bebc596239365fb6aff1c5"><div class="ttname"><a href="classnpc.html#a21a2c9d7a8bebc596239365fb6aff1c5">npc::personality</a></div><div class="ttdeci">npc_personality personality</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01402">npc.h:1402</a></div></div>
<div class="ttc" id="aclassnpc_html_a24098a6c18bfd55695b6cbbdccf66517"><div class="ttname"><a href="classnpc.html#a24098a6c18bfd55695b6cbbdccf66517">npc::is_patrolling</a></div><div class="ttdeci">bool is_patrolling() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02371">npc.cpp:2371</a></div></div>
<div class="ttc" id="aclassnpc_html_a251cafb769b1d8ec4585deb3b50aaafd"><div class="ttname"><a href="classnpc.html#a251cafb769b1d8ec4585deb3b50aaafd">npc::wield</a></div><div class="ttdeci">bool wield(item &amp;it) override</div><div class="ttdoc">Removes currently wielded item (if any) and replaces it with the target item.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l01327">npc.cpp:1327</a></div></div>
<div class="ttc" id="aclassnpc_html_a276de4730030fc73745440817c9a13aa"><div class="ttname"><a href="classnpc.html#a276de4730030fc73745440817c9a13aa">npc::guard_current_pos</a></div><div class="ttdeci">void guard_current_pos()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05015">npcmove.cpp:5015</a></div></div>
<div class="ttc" id="aclassnpc_html_a279682d01e74e6dbe6ef590047fd3d94"><div class="ttname"><a href="classnpc.html#a279682d01e74e6dbe6ef590047fd3d94">npc::goto_to_this_pos</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; goto_to_this_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01363">npc.h:1363</a></div></div>
<div class="ttc" id="aclassnpc_html_a295b6e064a8ef2defd64eb8f9774ba64"><div class="ttname"><a href="classnpc.html#a295b6e064a8ef2defd64eb8f9774ba64">npc::vehicle_danger</a></div><div class="ttdeci">float vehicle_danger(int radius) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l01573">npc.cpp:1573</a></div></div>
<div class="ttc" id="aclassnpc_html_a29fad2798be32c49e72523a6cab2b7f9"><div class="ttname"><a href="classnpc.html#a29fad2798be32c49e72523a6cab2b7f9">npc::value</a></div><div class="ttdeci">double value(const item &amp;it) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02050">npc.cpp:2050</a></div></div>
<div class="ttc" id="aclassnpc_html_a2b5862e4eb0c9d1b8b4fc6bc93f7aca0"><div class="ttname"><a href="classnpc.html#a2b5862e4eb0c9d1b8b4fc6bc93f7aca0">npc::cleanup_on_no_danger</a></div><div class="ttdeci">void cleanup_on_no_danger()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02375">npcmove.cpp:2375</a></div></div>
<div class="ttc" id="aclassnpc_html_a2d47ff8926fed9a85d1168e7e514f871"><div class="ttname"><a href="classnpc.html#a2d47ff8926fed9a85d1168e7e514f871">npc::myclass</a></div><div class="ttdeci">npc_class_id myclass</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01329">npc.h:1329</a></div></div>
<div class="ttc" id="aclassnpc_html_a2ebcfb2511df0644de3d422dcb50d71b"><div class="ttname"><a href="classnpc.html#a2ebcfb2511df0644de3d422dcb50d71b">npc::move</a></div><div class="ttdeci">void move()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01301">npcmove.cpp:1301</a></div></div>
<div class="ttc" id="aclassnpc_html_a2f119a95de9c88dabad376d9b65dd4e6"><div class="ttname"><a href="classnpc.html#a2f119a95de9c88dabad376d9b65dd4e6">npc::add_msg_if_npc</a></div><div class="ttdeci">void add_msg_if_npc(const std::string &amp;msg) const override</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03015">npc.cpp:3015</a></div></div>
<div class="ttc" id="aclassnpc_html_a3053738f4a1e327292e1af7afcd34c9c"><div class="ttname"><a href="classnpc.html#a3053738f4a1e327292e1af7afcd34c9c">npc::speed_rating</a></div><div class="ttdeci">float speed_rating() const override</div><div class="ttdoc">Returns an approximate number of tiles this creature can travel per turn.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03167">npc.cpp:3167</a></div></div>
<div class="ttc" id="aclassnpc_html_a305f1416efd6a05654042edb9d23f2da"><div class="ttname"><a href="classnpc.html#a305f1416efd6a05654042edb9d23f2da">npc::complain</a></div><div class="ttdeci">bool complain()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05242">npcmove.cpp:5242</a></div></div>
<div class="ttc" id="aclassnpc_html_a325fff8094f3e9ce2ba6970f969ada3f"><div class="ttname"><a href="classnpc.html#a325fff8094f3e9ce2ba6970f969ada3f">npc::is_ally</a></div><div class="ttdeci">bool is_ally(const Character &amp;p) const override</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02260">npc.cpp:2260</a></div></div>
<div class="ttc" id="aclassnpc_html_a32ceae6e42afded1f9fef157bfec8715"><div class="ttname"><a href="classnpc.html#a32ceae6e42afded1f9fef157bfec8715">npc::is_walking_with</a></div><div class="ttdeci">bool is_walking_with() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02317">npc.cpp:2317</a></div></div>
<div class="ttc" id="aclassnpc_html_a35fa560c9b36ecb6b7ba4d569d156604"><div class="ttname"><a href="classnpc.html#a35fa560c9b36ecb6b7ba4d569d156604">npc::goal</a></div><div class="ttdeci">tripoint_abs_omt goal</div><div class="ttdoc">Global overmap terrain coordinate, where we want to get to if no goal exist, this is no_goal_point.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01379">npc.h:1379</a></div></div>
<div class="ttc" id="aclassnpc_html_a36732f064214ecc3943cacea307f2597"><div class="ttname"><a href="classnpc.html#a36732f064214ecc3943cacea307f2597">npc::assigned_camp</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_omt &gt; assigned_camp</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01333">npc.h:1333</a></div></div>
<div class="ttc" id="aclassnpc_html_a3740f4479ecfacc0afa8c938ba1ffcd7"><div class="ttname"><a href="classnpc.html#a3740f4479ecfacc0afa8c938ba1ffcd7">npc::act_on_danger_assessment</a></div><div class="ttdeci">void act_on_danger_assessment()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01101">npcmove.cpp:1101</a></div></div>
<div class="ttc" id="aclassnpc_html_a3899b6eecb74b6b011eba7082685e968"><div class="ttname"><a href="classnpc.html#a3899b6eecb74b6b011eba7082685e968">npc::wont_hit_friend</a></div><div class="ttdeci">bool wont_hit_friend(const tripoint &amp;tar, const item &amp;it, bool throwing) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02715">npcmove.cpp:2715</a></div></div>
<div class="ttc" id="aclassnpc_html_a39b2e456baccd5ed6941ca4a4027860e"><div class="ttname"><a href="classnpc.html#a39b2e456baccd5ed6941ca4a4027860e">npc::find_dangerous_explosives</a></div><div class="ttdeci">std::vector&lt; sphere &gt; find_dangerous_explosives() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00434">npcmove.cpp:434</a></div></div>
<div class="ttc" id="aclassnpc_html_a3a138724d95b7991fb0bea8f2c719439"><div class="ttname"><a href="classnpc.html#a3a138724d95b7991fb0bea8f2c719439">npc::current_ally</a></div><div class="ttdeci">const Creature * current_ally() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05110">npcmove.cpp:5110</a></div></div>
<div class="ttc" id="aclassnpc_html_a3c14cd2fb4cf34bfe59c9d1fbe8646dc"><div class="ttname"><a href="classnpc.html#a3c14cd2fb4cf34bfe59c9d1fbe8646dc">npc::has_painkiller</a></div><div class="ttdeci">bool has_painkiller()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02227">npc.cpp:2227</a></div></div>
<div class="ttc" id="aclassnpc_html_a3dbcb192e2e0e10b54eb324a07afe040"><div class="ttname"><a href="classnpc.html#a3dbcb192e2e0e10b54eb324a07afe040">npc::consume_food</a></div><div class="ttdeci">bool consume_food()</div><div class="ttdoc">Returns true if food was consumed, false otherwise.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04615">npcmove.cpp:4615</a></div></div>
<div class="ttc" id="aclassnpc_html_a3ea18f464bd67891e058ad91de84fe55"><div class="ttname"><a href="classnpc.html#a3ea18f464bd67891e058ad91de84fe55">npc::set_movement_mode</a></div><div class="ttdeci">void set_movement_mode(const move_mode_id &amp;mode) override</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05441">npcmove.cpp:5441</a></div></div>
<div class="ttc" id="aclassnpc_html_a3edd19f42f231bbca47391f7a99f8edd"><div class="ttname"><a href="classnpc.html#a3edd19f42f231bbca47391f7a99f8edd">npc::no_goal_point</a></div><div class="ttdeci">static constexpr tripoint_abs_omt no_goal_point</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01415">npc.h:1415</a></div></div>
<div class="ttc" id="aclassnpc_html_a3f84d48b1596bc3da94a53804598e6e0"><div class="ttname"><a href="classnpc.html#a3f84d48b1596bc3da94a53804598e6e0">npc::evaluate_best_weapon</a></div><div class="ttdeci">item * evaluate_best_weapon() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04064">npcmove.cpp:4064</a></div></div>
<div class="ttc" id="aclassnpc_html_a41b0a58a7ddf03b23766abcb760bcff0"><div class="ttname"><a href="classnpc.html#a41b0a58a7ddf03b23766abcb760bcff0">npc::is_hallucination</a></div><div class="ttdeci">bool is_hallucination() const override</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00911">npc.h:911</a></div></div>
<div class="ttc" id="aclassnpc_html_a44f84e85868e3dbe33073a94c51c1e7c"><div class="ttname"><a href="classnpc.html#a44f84e85868e3dbe33073a94c51c1e7c">npc::can_do_pulp</a></div><div class="ttdeci">bool can_do_pulp()</div><div class="ttdoc">Returns true if NPC can do pulp in this turn.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03977">npcmove.cpp:3977</a></div></div>
<div class="ttc" id="aclassnpc_html_a49c7b6c2988b72d3122895b76952e0ac"><div class="ttname"><a href="classnpc.html#a49c7b6c2988b72d3122895b76952e0ac">npc::wants_to_recharge_cbm</a></div><div class="ttdeci">bool wants_to_recharge_cbm()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02276">npcmove.cpp:2276</a></div></div>
<div class="ttc" id="aclassnpc_html_a4fea1fd042a9225b685b012eec8697ba"><div class="ttname"><a href="classnpc.html#a4fea1fd042a9225b685b012eec8697ba">npc::avoid_friendly_fire</a></div><div class="ttdeci">void avoid_friendly_fire()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03167">npcmove.cpp:3167</a></div></div>
<div class="ttc" id="aclassnpc_html_a535d561f8b634e2bf4867f273098e4c8"><div class="ttname"><a href="classnpc.html#a535d561f8b634e2bf4867f273098e4c8">npc::pretend_heal</a></div><div class="ttdeci">void pretend_heal(Character &amp;patient, item used)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04365">npcmove.cpp:4365</a></div></div>
<div class="ttc" id="aclassnpc_html_a53c9eb784312e0594c5a9922668d630e"><div class="ttname"><a href="classnpc.html#a53c9eb784312e0594c5a9922668d630e">npc::set_attitude</a></div><div class="ttdeci">void set_attitude(npc_attitude new_attitude)</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03551">npc.cpp:3551</a></div></div>
<div class="ttc" id="aclassnpc_html_a559ec32dce9038a1859990813f857bf3"><div class="ttname"><a href="classnpc.html#a559ec32dce9038a1859990813f857bf3">npc::deactivate_combat_cbms</a></div><div class="ttdeci">void deactivate_combat_cbms()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02221">npcmove.cpp:2221</a></div></div>
<div class="ttc" id="aclassnpc_html_a5a4638fb5090eb6a0042c8f41430bc3a"><div class="ttname"><a href="classnpc.html#a5a4638fb5090eb6a0042c8f41430bc3a">npc::find_item</a></div><div class="ttdeci">void find_item()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03492">npcmove.cpp:3492</a></div></div>
<div class="ttc" id="aclassnpc_html_a5b4cef057ec82989f71d88b4529d3359"><div class="ttname"><a href="classnpc.html#a5b4cef057ec82989f71d88b4529d3359">npc::escape_explosion</a></div><div class="ttdeci">void escape_explosion()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03211">npcmove.cpp:3211</a></div></div>
<div class="ttc" id="aclassnpc_html_a5d3292bcebd559a0600a365483cf18fd"><div class="ttname"><a href="classnpc.html#a5d3292bcebd559a0600a365483cf18fd">npc::needs</a></div><div class="ttdeci">std::vector&lt; npc_need &gt; needs</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01412">npc.h:1412</a></div></div>
<div class="ttc" id="aclassnpc_html_a5dc98048130339546b98fdace437f983"><div class="ttname"><a href="classnpc.html#a5dc98048130339546b98fdace437f983">npc::attitude</a></div><div class="ttdeci">npc_attitude attitude</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01342">npc.h:1342</a></div></div>
<div class="ttc" id="aclassnpc_html_a5e8e8c9c793c22192e3874c087da4ce6"><div class="ttname"><a href="classnpc.html#a5e8e8c9c793c22192e3874c087da4ce6">npc::is_active</a></div><div class="ttdeci">bool is_active() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02529">npc.cpp:2529</a></div></div>
<div class="ttc" id="aclassnpc_html_a5f1c46d11b9e4115e7a5c8c9ddfa6aa4"><div class="ttname"><a href="classnpc.html#a5f1c46d11b9e4115e7a5c8c9ddfa6aa4">npc::took_painkiller</a></div><div class="ttdeci">bool took_painkiller() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02232">npc.cpp:2232</a></div></div>
<div class="ttc" id="aclassnpc_html_a5f5e60265406a2edb65327e360406b37"><div class="ttname"><a href="classnpc.html#a5f5e60265406a2edb65327e360406b37">npc::chair_pos</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; chair_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01373">npc.h:1373</a></div></div>
<div class="ttc" id="aclassnpc_html_a5f6abf15a7e7de731322b31ece25d127"><div class="ttname"><a href="classnpc.html#a5f6abf15a7e7de731322b31ece25d127">npc::has_faction_relationship</a></div><div class="ttdeci">bool has_faction_relationship(const Character &amp;you, npc_factions::relationship flag) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02249">npc.cpp:2249</a></div></div>
<div class="ttc" id="aclassnpc_html_a5fff562624c8fe72f1f316b554500398"><div class="ttname"><a href="classnpc.html#a5fff562624c8fe72f1f316b554500398">npc::last_seen_player_turn</a></div><div class="ttdeci">int last_seen_player_turn</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01364">npc.h:1364</a></div></div>
<div class="ttc" id="aclassnpc_html_a60031636b41769c87690d2fc6aae59eb"><div class="ttname"><a href="classnpc.html#a60031636b41769c87690d2fc6aae59eb">npc::smash_ability</a></div><div class="ttdeci">int smash_ability() const override</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02491">npc.cpp:2491</a></div></div>
<div class="ttc" id="aclassnpc_html_a60564ac83c4b15970af09d70ede219fc"><div class="ttname"><a href="classnpc.html#a60564ac83c4b15970af09d70ede219fc">npc::sees_dangerous_field</a></div><div class="ttdeci">bool sees_dangerous_field(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00395">npcmove.cpp:395</a></div></div>
<div class="ttc" id="aclassnpc_html_a63bc137408877f29318ca32345247426"><div class="ttname"><a href="classnpc.html#a63bc137408877f29318ca32345247426">npc::pulp_location</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; pulp_location</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01384">npc.h:1384</a></div></div>
<div class="ttc" id="aclassnpc_html_a647e4cf025498dc0798f5fb0d80f3b3a"><div class="ttname"><a href="classnpc.html#a647e4cf025498dc0798f5fb0d80f3b3a">npc::execute_action</a></div><div class="ttdeci">void execute_action(npc_action action)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01565">npcmove.cpp:1565</a></div></div>
<div class="ttc" id="aclassnpc_html_a650bd06d1fc1709728d11d30684580af"><div class="ttname"><a href="classnpc.html#a650bd06d1fc1709728d11d30684580af">npc::address_player</a></div><div class="ttdeci">npc_action address_player()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02570">npcmove.cpp:2570</a></div></div>
<div class="ttc" id="aclassnpc_html_a6616407de598de3d0afaa5230c8448d8"><div class="ttname"><a href="classnpc.html#a6616407de598de3d0afaa5230c8448d8">npc::heal_player</a></div><div class="ttdeci">void heal_player(Character &amp;patient)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04328">npcmove.cpp:4328</a></div></div>
<div class="ttc" id="aclassnpc_html_a66fcb50d8997cc5410d66dbd9bc7c4df"><div class="ttname"><a href="classnpc.html#a66fcb50d8997cc5410d66dbd9bc7c4df">npc::assess_danger</a></div><div class="ttdeci">void assess_danger()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00707">npcmove.cpp:707</a></div></div>
<div class="ttc" id="aclassnpc_html_a67e45227dd3808fd25f73ed0a93020ac"><div class="ttname"><a href="classnpc.html#a67e45227dd3808fd25f73ed0a93020ac">npc::consume_food_from_camp</a></div><div class="ttdeci">bool consume_food_from_camp()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04543">npcmove.cpp:4543</a></div></div>
<div class="ttc" id="aclassnpc_html_a695c83f659378e693bd10acbfcdfdc94"><div class="ttname"><a href="classnpc.html#a695c83f659378e693bd10acbfcdfdc94">npc::deactivate_bionic_by_id</a></div><div class="ttdeci">bool deactivate_bionic_by_id(const bionic_id &amp;cbm_id, bool eff_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02262">npcmove.cpp:2262</a></div></div>
<div class="ttc" id="aclassnpc_html_a6c36c6a68cd081709933c1d966feeac7"><div class="ttname"><a href="classnpc.html#a6c36c6a68cd081709933c1d966feeac7">npc::alt_attack</a></div><div class="ttdeci">bool alt_attack()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04176">npcmove.cpp:4176</a></div></div>
<div class="ttc" id="aclassnpc_html_a6c629f03474e0723da4dfa19d8e08bda"><div class="ttname"><a href="classnpc.html#a6c629f03474e0723da4dfa19d8e08bda">npc::confident_shoot_range</a></div><div class="ttdeci">int confident_shoot_range(const item &amp;it, int at_recoil) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02674">npcmove.cpp:2674</a></div></div>
<div class="ttc" id="aclassnpc_html_a6dd57d8c350fc1aff1a66012d7eaeed8"><div class="ttname"><a href="classnpc.html#a6dd57d8c350fc1aff1a66012d7eaeed8">npc::method_of_fleeing</a></div><div class="ttdeci">npc_action method_of_fleeing()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01954">npcmove.cpp:1954</a></div></div>
<div class="ttc" id="aclassnpc_html_a6ffa08f6503465b7fe5ec70ab3180b92"><div class="ttname"><a href="classnpc.html#a6ffa08f6503465b7fe5ec70ab3180b92">npc::item_name_whitelisted</a></div><div class="ttdeci">bool item_name_whitelisted(const std::string &amp;to_match)</div><div class="ttdef"><b>Definition:</b> <a href="npctalk_8cpp_source.html#l07224">npctalk.cpp:7224</a></div></div>
<div class="ttc" id="aclassnpc_html_a7126a9df203ace036c3fa22b1c775d7e"><div class="ttname"><a href="classnpc.html#a7126a9df203ace036c3fa22b1c775d7e">npc::confident_throw_range</a></div><div class="ttdeci">int confident_throw_range(const item &amp;, Creature *) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02703">npcmove.cpp:2703</a></div></div>
<div class="ttc" id="aclassnpc_html_a71c2e08d14b32913076f198a293adea1"><div class="ttname"><a href="classnpc.html#a71c2e08d14b32913076f198a293adea1">npc::worker_downtime</a></div><div class="ttdeci">void worker_downtime()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03289">npcmove.cpp:3289</a></div></div>
<div class="ttc" id="aclassnpc_html_a7293d62130bbac9ea2c90d461d478ca2"><div class="ttname"><a href="classnpc.html#a7293d62130bbac9ea2c90d461d478ca2">npc::prepare_for_combat</a></div><div class="ttdeci">void prepare_for_combat()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02369">npcmove.cpp:2369</a></div></div>
<div class="ttc" id="aclassnpc_html_a72a5010d44054d2ba97f29b5226d3b7c"><div class="ttname"><a href="classnpc.html#a72a5010d44054d2ba97f29b5226d3b7c">npc::long_term_goal_action</a></div><div class="ttdeci">npc_action long_term_goal_action()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02630">npcmove.cpp:2630</a></div></div>
<div class="ttc" id="aclassnpc_html_a740bf52a4bcfa3308abb1d236685bbbb"><div class="ttname"><a href="classnpc.html#a740bf52a4bcfa3308abb1d236685bbbb">npc::saw_player_recently</a></div><div class="ttdeci">bool saw_player_recently() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04784">npcmove.cpp:4784</a></div></div>
<div class="ttc" id="aclassnpc_html_a770a2307ec384a2986e7ca9769cdd2e3"><div class="ttname"><a href="classnpc.html#a770a2307ec384a2986e7ca9769cdd2e3">npc::decide_needs</a></div><div class="ttdeci">void decide_needs()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l01670">npc.cpp:1670</a></div></div>
<div class="ttc" id="aclassnpc_html_a7760d95b7aab094c750965eaa7d77071"><div class="ttname"><a href="classnpc.html#a7760d95b7aab094c750965eaa7d77071">npc::do_reload</a></div><div class="ttdeci">void do_reload(const item_location &amp;it)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05350">npcmove.cpp:5350</a></div></div>
<div class="ttc" id="aclassnpc_html_a78aff0d002c14e7448e2db08f7be7afe"><div class="ttname"><a href="classnpc.html#a78aff0d002c14e7448e2db08f7be7afe">npc::can_take_that</a></div><div class="ttdeci">bool can_take_that(const item &amp;it)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03788">npcmove.cpp:3788</a></div></div>
<div class="ttc" id="aclassnpc_html_a7aa9c62909265efef5877730958edacb"><div class="ttname"><a href="classnpc.html#a7aa9c62909265efef5877730958edacb">npc::wanted_item</a></div><div class="ttdeci">item_location wanted_item</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01367">npc.h:1367</a></div></div>
<div class="ttc" id="aclassnpc_html_a7ec5e20c68a58cbae52c51de36e2a539"><div class="ttname"><a href="classnpc.html#a7ec5e20c68a58cbae52c51de36e2a539">npc::deactivate_combat_items</a></div><div class="ttdeci">void deactivate_combat_items()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02364">npcmove.cpp:2364</a></div></div>
<div class="ttc" id="aclassnpc_html_a7ee1c9e434339418cb9b5907d8695806"><div class="ttname"><a href="classnpc.html#a7ee1c9e434339418cb9b5907d8695806">npc::is_enemy</a></div><div class="ttdeci">bool is_enemy() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02352">npc.cpp:2352</a></div></div>
<div class="ttc" id="aclassnpc_html_a803f433a7a6b27fc761a5780db7d6b52"><div class="ttname"><a href="classnpc.html#a803f433a7a6b27fc761a5780db7d6b52">npc::wield_better_weapon</a></div><div class="ttdeci">bool wield_better_weapon()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04111">npcmove.cpp:4111</a></div></div>
<div class="ttc" id="aclassnpc_html_a804d15a6005963a24df4434c8aa1b94e"><div class="ttname"><a href="classnpc.html#a804d15a6005963a24df4434c8aa1b94e">npc::invalidate_range_cache</a></div><div class="ttdeci">void invalidate_range_cache()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l01383">npc.cpp:1383</a></div></div>
<div class="ttc" id="aclassnpc_html_a827ea43a24174972a2453c9bf62bf55c"><div class="ttname"><a href="classnpc.html#a827ea43a24174972a2453c9bf62bf55c">npc::move_to_next</a></div><div class="ttdeci">void move_to_next()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03148">npcmove.cpp:3148</a></div></div>
<div class="ttc" id="aclassnpc_html_a82c1e391aa196be38ec7ddd7d66bab8d"><div class="ttname"><a href="classnpc.html#a82c1e391aa196be38ec7ddd7d66bab8d">npc::confident_gun_mode_range</a></div><div class="ttdeci">int confident_gun_mode_range(const gun_mode &amp;gun, int at_recoil) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02687">npcmove.cpp:2687</a></div></div>
<div class="ttc" id="aclassnpc_html_a85d4c148bce6c6d7300f5f139be4b0e9"><div class="ttname"><a href="classnpc.html#a85d4c148bce6c6d7300f5f139be4b0e9">npc::mutiny</a></div><div class="ttdeci">void mutiny()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l01540">npc.cpp:1540</a></div></div>
<div class="ttc" id="aclassnpc_html_a8659ec918e22207511ebed3a20afb844"><div class="ttname"><a href="classnpc.html#a8659ec918e22207511ebed3a20afb844">npc::aim</a></div><div class="ttdeci">void aim(const Target_attributes &amp;target_attributes)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02798">npcmove.cpp:2798</a></div></div>
<div class="ttc" id="aclassnpc_html_a86a36265d6d5b5c34e93087c963a2376"><div class="ttname"><a href="classnpc.html#a86a36265d6d5b5c34e93087c963a2376">npc::emergency</a></div><div class="ttdeci">bool emergency() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02517">npc.cpp:2517</a></div></div>
<div class="ttc" id="aclassnpc_html_a86d59c5c838a35d11b42bd615f36d022"><div class="ttname"><a href="classnpc.html#a86d59c5c838a35d11b42bd615f36d022">npc::find_corpse_to_pulp</a></div><div class="ttdeci">bool find_corpse_to_pulp()</div><div class="ttdoc">Returns true if it finds one.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03889">npcmove.cpp:3889</a></div></div>
<div class="ttc" id="aclassnpc_html_a8726121e70cd1ce0d351a926de30fcc1"><div class="ttname"><a href="classnpc.html#a8726121e70cd1ce0d351a926de30fcc1">npc::is_friendly</a></div><div class="ttdeci">bool is_friendly(const Character &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02302">npc.cpp:2302</a></div></div>
<div class="ttc" id="aclassnpc_html_a8b8977c621cdf1a6a4cdcc79225eb8b2"><div class="ttname"><a href="classnpc.html#a8b8977c621cdf1a6a4cdcc79225eb8b2">npc::chatbin</a></div><div class="ttdeci">dialogue_chatbin chatbin</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01406">npc.h:1406</a></div></div>
<div class="ttc" id="aclassnpc_html_a8c0812cf2b1dae1461ff50f9a019796e"><div class="ttname"><a href="classnpc.html#a8c0812cf2b1dae1461ff50f9a019796e">npc::get_thirst</a></div><div class="ttdeci">int get_thirst() const override</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03740">npc.cpp:3740</a></div></div>
<div class="ttc" id="aclassnpc_html_a8ce99d58c99225d2002d3c5b1cb7dde5"><div class="ttname"><a href="classnpc.html#a8ce99d58c99225d2002d3c5b1cb7dde5">npc::evaluate_weapon</a></div><div class="ttdeci">double evaluate_weapon(item &amp;maybe_weapon, bool can_use_gun, bool use_silent) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04045">npcmove.cpp:4045</a></div></div>
<div class="ttc" id="aclassnpc_html_a91fd8991b5e867555b74fb3c48891335"><div class="ttname"><a href="classnpc.html#a91fd8991b5e867555b74fb3c48891335">npc::follow_distance</a></div><div class="ttdeci">int follow_distance() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02534">npc.cpp:2534</a></div></div>
<div class="ttc" id="aclassnpc_html_a95d1b3db80157a00032df4c4918606f0"><div class="ttname"><a href="classnpc.html#a95d1b3db80157a00032df4c4918606f0">npc::go_to_omt_destination</a></div><div class="ttdeci">void go_to_omt_destination()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04945">npcmove.cpp:4945</a></div></div>
<div class="ttc" id="aclassnpc_html_a9617195bc7f6266927e51fb823f40c3c"><div class="ttname"><a href="classnpc.html#a9617195bc7f6266927e51fb823f40c3c">npc::can_open_door</a></div><div class="ttdeci">bool can_open_door(const tripoint &amp;p, bool inside) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02864">npcmove.cpp:2864</a></div></div>
<div class="ttc" id="aclassnpc_html_a965025669d8af18fe89adf0a2f477b9a"><div class="ttname"><a href="classnpc.html#a965025669d8af18fe89adf0a2f477b9a">npc::current_activity_id</a></div><div class="ttdeci">activity_id current_activity_id</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01328">npc.h:1328</a></div></div>
<div class="ttc" id="aclassnpc_html_a983183e0a5423f3d339b1ef8e07e7d2d"><div class="ttname"><a href="classnpc.html#a983183e0a5423f3d339b1ef8e07e7d2d">npc::is_guarding</a></div><div class="ttdeci">bool is_guarding() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02366">npc.cpp:2366</a></div></div>
<div class="ttc" id="aclassnpc_html_a9ca344b214e47beec525f78ebc83dc64"><div class="ttname"><a href="classnpc.html#a9ca344b214e47beec525f78ebc83dc64">npc::has_new_items</a></div><div class="ttdeci">bool has_new_items</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01387">npc.h:1387</a></div></div>
<div class="ttc" id="aclassnpc_html_a9ebaf7c38b4eb34255acc88302011ce0"><div class="ttname"><a href="classnpc.html#a9ebaf7c38b4eb34255acc88302011ce0">npc::get_faction</a></div><div class="ttdeci">faction * get_faction() const override</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l00776">npc.cpp:776</a></div></div>
<div class="ttc" id="aclassnpc_html_a9fd28cfcf0b96db41e54ba6c2387ba8d"><div class="ttname"><a href="classnpc.html#a9fd28cfcf0b96db41e54ba6c2387ba8d">npc::mem_combat</a></div><div class="ttdeci">npc_combat_memory_cache mem_combat</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01404">npc.h:1404</a></div></div>
<div class="ttc" id="aclassnpc_html_aa04267aeaf6222fe931d48c404df22e3"><div class="ttname"><a href="classnpc.html#aa04267aeaf6222fe931d48c404df22e3">npc::reach_omt_destination</a></div><div class="ttdeci">void reach_omt_destination()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04795">npcmove.cpp:4795</a></div></div>
<div class="ttc" id="aclassnpc_html_aa3708f97cac2aed72689434f292168c5"><div class="ttname"><a href="classnpc.html#aa3708f97cac2aed72689434f292168c5">npc::find_usable_ammo</a></div><div class="ttdeci">item_location find_usable_ammo(const item_location &amp;weap)</div><div class="ttdoc">Finds ammo the NPC could use to reload a given object.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02156">npcmove.cpp:2156</a></div></div>
<div class="ttc" id="aclassnpc_html_aa6481cdc3b95b8a3836ab98f2446fc81"><div class="ttname"><a href="classnpc.html#aa6481cdc3b95b8a3836ab98f2446fc81">npc::recharge_cbm</a></div><div class="ttdeci">bool recharge_cbm()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02299">npcmove.cpp:2299</a></div></div>
<div class="ttc" id="aclassnpc_html_aa66ea634e85fda5b9964025922499524"><div class="ttname"><a href="classnpc.html#aa66ea634e85fda5b9964025922499524">npc::move_pause</a></div><div class="ttdeci">void move_pause()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03372">npcmove.cpp:3372</a></div></div>
<div class="ttc" id="aclassnpc_html_aa672dcdbbd6dd9bbd53f12261d9fb8d2"><div class="ttname"><a href="classnpc.html#aa672dcdbbd6dd9bbd53f12261d9fb8d2">npc::evaluate_sleep_spot</a></div><div class="ttdeci">int evaluate_sleep_spot(tripoint_bub_ms p)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02043">npcmove.cpp:2043</a></div></div>
<div class="ttc" id="aclassnpc_html_aa8fd6069a77516d0fec45248f9069345"><div class="ttname"><a href="classnpc.html#aa8fd6069a77516d0fec45248f9069345">npc::is_safe</a></div><div class="ttdeci">bool is_safe() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01210">npcmove.cpp:1210</a></div></div>
<div class="ttc" id="aclassnpc_html_aaca9337f2ca21164cfe32e6097995255"><div class="ttname"><a href="classnpc.html#aaca9337f2ca21164cfe32e6097995255">npc::do_player_activity</a></div><div class="ttdeci">bool do_player_activity()</div><div class="ttdoc">perform a player activity, returning true if it took up the turn</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03989">npcmove.cpp:3989</a></div></div>
<div class="ttc" id="aclassnpc_html_aadce3a5fdf41c95969a87e996e49591e"><div class="ttname"><a href="classnpc.html#aadce3a5fdf41c95969a87e996e49591e">npc::guard_pos</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; guard_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01371">npc.h:1371</a></div></div>
<div class="ttc" id="aclassnpc_html_aae2234e886f871aad230f1ed37bed033"><div class="ttname"><a href="classnpc.html#aae2234e886f871aad230f1ed37bed033">npc::could_move_onto</a></div><div class="ttdeci">bool could_move_onto(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00400">npcmove.cpp:400</a></div></div>
<div class="ttc" id="aclassnpc_html_aae5cd15ba8200d25c2a5f5e398af76b8"><div class="ttname"><a href="classnpc.html#aae5cd15ba8200d25c2a5f5e398af76b8">npc::mug_player</a></div><div class="ttdeci">void mug_player(Character &amp;mark)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04660">npcmove.cpp:4660</a></div></div>
<div class="ttc" id="aclassnpc_html_aaf3e6613525deaf4d7799df3da648089"><div class="ttname"><a href="classnpc.html#aaf3e6613525deaf4d7799df3da648089">npc::has_player_activity</a></div><div class="ttdeci">bool has_player_activity() const</div><div class="ttdoc">is performing a player_activity</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02376">npc.cpp:2376</a></div></div>
<div class="ttc" id="aclassnpc_html_aaf81f803ffb0e285d1af4c5b5de6c7d5"><div class="ttname"><a href="classnpc.html#aaf81f803ffb0e285d1af4c5b5de6c7d5">npc::adjust_worn</a></div><div class="ttdeci">bool adjust_worn()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05393">npcmove.cpp:5393</a></div></div>
<div class="ttc" id="aclassnpc_html_aafe8341e41f59321adba206531c6b862"><div class="ttname"><a href="classnpc.html#aafe8341e41f59321adba206531c6b862">npc::scan_new_items</a></div><div class="ttdeci">bool scan_new_items()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04142">npcmove.cpp:4142</a></div></div>
<div class="ttc" id="aclassnpc_html_ab05ed37f03796e73ab55ee322a5f9f5e"><div class="ttname"><a href="classnpc.html#ab05ed37f03796e73ab55ee322a5f9f5e">npc::get_location_for</a></div><div class="ttdeci">static overmap_location_str_id get_location_for(const npc_need &amp;need)</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03253">npc.cpp:3253</a></div></div>
<div class="ttc" id="aclassnpc_html_ab117ea356d49855e02448774397d23b9"><div class="ttname"><a href="classnpc.html#ab117ea356d49855e02448774397d23b9">npc::get_pathfinding_settings</a></div><div class="ttdeci">const pathfinding_settings &amp; get_pathfinding_settings() const override</div><div class="ttdoc">Returns settings for pathfinding.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03287">npc.cpp:3287</a></div></div>
<div class="ttc" id="aclassnpc_html_ab1230a6bd26c235c1732e7e5dce365c2"><div class="ttname"><a href="classnpc.html#ab1230a6bd26c235c1732e7e5dce365c2">npc::is_stationary</a></div><div class="ttdeci">bool is_stationary(bool include_guards=true) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02357">npc.cpp:2357</a></div></div>
<div class="ttc" id="aclassnpc_html_ab1a415046c99b60a6b1e96e0917b50c5"><div class="ttname"><a href="classnpc.html#ab1a415046c99b60a6b1e96e0917b50c5">npc::current_target</a></div><div class="ttdeci">const Creature * current_target() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05096">npcmove.cpp:5096</a></div></div>
<div class="ttc" id="aclassnpc_html_ab207c63e57697f76b910b49d38034294"><div class="ttname"><a href="classnpc.html#ab207c63e57697f76b910b49d38034294">npc::use_painkiller</a></div><div class="ttdeci">void use_painkiller()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04425">npcmove.cpp:4425</a></div></div>
<div class="ttc" id="aclassnpc_html_ab22c3f4b5e0ddbf4311313caa003d9ec"><div class="ttname"><a href="classnpc.html#ab22c3f4b5e0ddbf4311313caa003d9ec">npc::evaluate_character</a></div><div class="ttdeci">float evaluate_character(const Character &amp;candidate, bool my_gun, bool enemy)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00484">npcmove.cpp:484</a></div></div>
<div class="ttc" id="aclassnpc_html_ab2805d6e7e3cfd83a2993115a7c710d8"><div class="ttname"><a href="classnpc.html#ab2805d6e7e3cfd83a2993115a7c710d8">npc::complain_about</a></div><div class="ttdeci">bool complain_about(const std::string &amp;issue, const time_duration &amp;dur, const std::string &amp;speech, bool force=false, sounds::sound_t priority=sounds::sound_t::speech)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05211">npcmove.cpp:5211</a></div></div>
<div class="ttc" id="aclassnpc_html_ab44bba7e06bacb5074d0c2977244622b"><div class="ttname"><a href="classnpc.html#ab44bba7e06bacb5074d0c2977244622b">npc::evaluate_self</a></div><div class="ttdeci">float evaluate_self(bool my_gun)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00588">npcmove.cpp:588</a></div></div>
<div class="ttc" id="aclassnpc_html_ab762e1b5cc3053fb9b04df37714e14b7"><div class="ttname"><a href="classnpc.html#ab762e1b5cc3053fb9b04df37714e14b7">npc::is_player_ally</a></div><div class="ttdeci">bool is_player_ally() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02297">npc.cpp:2297</a></div></div>
<div class="ttc" id="aclassnpc_html_ab985d46b3b8f2b52f7625109f100a1ab"><div class="ttname"><a href="classnpc.html#ab985d46b3b8f2b52f7625109f100a1ab">npc::patient_assessment</a></div><div class="ttdeci">healing_options patient_assessment(const Character &amp;c)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02381">npcmove.cpp:2381</a></div></div>
<div class="ttc" id="aclassnpc_html_ab9b160de34864006d1cb44ec76802f56"><div class="ttname"><a href="classnpc.html#ab9b160de34864006d1cb44ec76802f56">npc::activate_combat_cbms</a></div><div class="ttdeci">void activate_combat_cbms()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02209">npcmove.cpp:2209</a></div></div>
<div class="ttc" id="aclassnpc_html_abb6a5aefceeaa114ad6099c4b37060af"><div class="ttname"><a href="classnpc.html#abb6a5aefceeaa114ad6099c4b37060af">npc::job</a></div><div class="ttdeci">job_data job</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01416">npc.h:1416</a></div></div>
<div class="ttc" id="aclassnpc_html_abb973d85b8141f14a41d43171eb32353"><div class="ttname"><a href="classnpc.html#abb973d85b8141f14a41d43171eb32353">npc::has_job</a></div><div class="ttdeci">bool has_job() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01316">npc.h:1316</a></div></div>
<div class="ttc" id="aclassnpc_html_abdbbb214958165a75a2e0b7a4ae2187f"><div class="ttname"><a href="classnpc.html#abdbbb214958165a75a2e0b7a4ae2187f">npc::move_away_from</a></div><div class="ttdeci">void move_away_from(const tripoint &amp;p, bool no_bash_atk=false, std::set&lt; tripoint &gt; *nomove=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03222">npcmove.cpp:3222</a></div></div>
<div class="ttc" id="aclassnpc_html_abfc3752f6d8399151f22e5514a37c479"><div class="ttname"><a href="classnpc.html#abfc3752f6d8399151f22e5514a37c479">npc::look_for_player</a></div><div class="ttdeci">void look_for_player(const Character &amp;sought)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04743">npcmove.cpp:4743</a></div></div>
<div class="ttc" id="aclassnpc_html_ac17b98393632654d6724c71251bbdadf"><div class="ttname"><a href="classnpc.html#ac17b98393632654d6724c71251bbdadf">npc::move_to</a></div><div class="ttdeci">void move_to(const tripoint &amp;p, bool no_bashing=false, std::set&lt; tripoint &gt; *nomove=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02882">npcmove.cpp:2882</a></div></div>
<div class="ttc" id="aclassnpc_html_ac2377dbbd70201312a89fa0f1c9ac5df"><div class="ttname"><a href="classnpc.html#ac2377dbbd70201312a89fa0f1c9ac5df">npc::goal_cache</a></div><div class="ttdeci">std::map&lt; npc_need, npc_need_goal_cache &gt; goal_cache</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01350">npc.h:1350</a></div></div>
<div class="ttc" id="aclassnpc_html_ac4e1ed70f31d88db8ea95fadad468784"><div class="ttname"><a href="classnpc.html#ac4e1ed70f31d88db8ea95fadad468784">npc::known_stolen_item</a></div><div class="ttdeci">item * known_stolen_item</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01382">npc.h:1382</a></div></div>
<div class="ttc" id="aclassnpc_html_ac52afe116abbbd44057f2da774cef3b5"><div class="ttname"><a href="classnpc.html#ac52afe116abbbd44057f2da774cef3b5">npc::has_item_whitelist</a></div><div class="ttdeci">bool has_item_whitelist() const</div><div class="ttdef"><b>Definition:</b> <a href="npctalk_8cpp_source.html#l07219">npctalk.cpp:7219</a></div></div>
<div class="ttc" id="aclassnpc_html_ac53fbaa9d7ba82b585a16468de52be02"><div class="ttname"><a href="classnpc.html#ac53fbaa9d7ba82b585a16468de52be02">npc::chat_snippets</a></div><div class="ttdeci">const dialogue_chatbin_snippets &amp; chat_snippets() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03805">npc.cpp:3805</a></div></div>
<div class="ttc" id="aclassnpc_html_ac7ecd979db776f376e3ccb34553e45d6"><div class="ttname"><a href="classnpc.html#ac7ecd979db776f376e3ccb34553e45d6">npc::pretend_fire</a></div><div class="ttdeci">void pretend_fire(npc *source, int shots, item &amp;gun)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00835">ranged.cpp:835</a></div></div>
<div class="ttc" id="aclassnpc_html_ac88f9115887e5da9075701a14588b637"><div class="ttname"><a href="classnpc.html#ac88f9115887e5da9075701a14588b637">npc::complaints</a></div><div class="ttdeci">std::map&lt; std::string, time_point &gt; complaints</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01346">npc.h:1346</a></div></div>
<div class="ttc" id="aclassnpc_html_ac9750804446346082e700070b59cb663"><div class="ttname"><a href="classnpc.html#ac9750804446346082e700070b59cb663">npc::has_healing_options</a></div><div class="ttdeci">healing_options has_healing_options()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02151">npc.cpp:2151</a></div></div>
<div class="ttc" id="aclassnpc_html_ac99cedf0bd0394229090e4ea85f10f2a"><div class="ttname"><a href="classnpc.html#ac99cedf0bd0394229090e4ea85f10f2a">npc::last_player_seen_pos</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; last_player_seen_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01361">npc.h:1361</a></div></div>
<div class="ttc" id="aclassnpc_html_acb437607e20194f9d5b94c95b860b744"><div class="ttname"><a href="classnpc.html#acb437607e20194f9d5b94c95b860b744">npc::get_path_avoid</a></div><div class="ttdeci">std::unordered_set&lt; tripoint &gt; get_path_avoid() const override</div><div class="ttdoc">Returns a set of points we do not want to path through.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03312">npc.cpp:3312</a></div></div>
<div class="ttc" id="aclassnpc_html_accabb5b29880e5391317d3abc7ecf569"><div class="ttname"><a href="classnpc.html#accabb5b29880e5391317d3abc7ecf569">npc::has_omt_destination</a></div><div class="ttdeci">bool has_omt_destination() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04790">npcmove.cpp:4790</a></div></div>
<div class="ttc" id="aclassnpc_html_acf0a5cd5f49a663e11d1631812ff1496"><div class="ttname"><a href="classnpc.html#acf0a5cd5f49a663e11d1631812ff1496">npc::heal_self</a></div><div class="ttdeci">void heal_self()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04374">npcmove.cpp:4374</a></div></div>
<div class="ttc" id="aclassnpc_html_acf6304b234b508736e313750b37d6e79"><div class="ttname"><a href="classnpc.html#acf6304b234b508736e313750b37d6e79">npc::base_location</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_omt &gt; base_location</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01374">npc.h:1374</a></div></div>
<div class="ttc" id="aclassnpc_html_ad19cf8c5a4e78a6e5f36b0674a812e97"><div class="ttname"><a href="classnpc.html#ad19cf8c5a4e78a6e5f36b0674a812e97">npc::address_needs</a></div><div class="ttdeci">npc_action address_needs()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02038">npcmove.cpp:2038</a></div></div>
<div class="ttc" id="aclassnpc_html_ad2e3df76c8b9cf5027ac0c6a6ed2109f"><div class="ttname"><a href="classnpc.html#ad2e3df76c8b9cf5027ac0c6a6ed2109f">npc::set_guard_pos</a></div><div class="ttdeci">void set_guard_pos(const tripoint_abs_ms &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02859">npcmove.cpp:2859</a></div></div>
<div class="ttc" id="aclassnpc_html_ad43e6fde3fbc21def53e20b418b616e7"><div class="ttname"><a href="classnpc.html#ad43e6fde3fbc21def53e20b418b616e7">npc::minimum_item_value</a></div><div class="ttdeci">int minimum_item_value() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02032">npc.cpp:2032</a></div></div>
<div class="ttc" id="aclassnpc_html_ad55732037ca207be54cc34ef3f74e893"><div class="ttname"><a href="classnpc.html#ad55732037ca207be54cc34ef3f74e893">npc::witness_thievery</a></div><div class="ttdeci">void witness_thievery(item *it) override</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01944">npcmove.cpp:1944</a></div></div>
<div class="ttc" id="aclassnpc_html_ad744dea4eca4c935a873c22e427a7277"><div class="ttname"><a href="classnpc.html#ad744dea4eca4c935a873c22e427a7277">npc::would_take_that</a></div><div class="ttdeci">bool would_take_that(const item &amp;it, const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03817">npcmove.cpp:3817</a></div></div>
<div class="ttc" id="aclassnpc_html_ad8d20228a9ce2ea0c6761c67f0478322"><div class="ttname"><a href="classnpc.html#ad8d20228a9ce2ea0c6761c67f0478322">npc::wants_take_that</a></div><div class="ttdeci">bool wants_take_that(const item &amp;it)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03802">npcmove.cpp:3802</a></div></div>
<div class="ttc" id="aclassnpc_html_ad9af10fbaadd2404019460873fefbda4"><div class="ttname"><a href="classnpc.html#ad9af10fbaadd2404019460873fefbda4">npc::rules</a></div><div class="ttdeci">npc_follower_rules rules</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01408">npc.h:1408</a></div></div>
<div class="ttc" id="aclassnpc_html_ad9d2ba89ae629f2d915436a06f377c24"><div class="ttname"><a href="classnpc.html#ad9d2ba89ae629f2d915436a06f377c24">npc::get_healing_item</a></div><div class="ttdeci">item &amp; get_healing_item(healing_options try_to_fix, bool first_best=false)</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02200">npc.cpp:2200</a></div></div>
<div class="ttc" id="aclassnpc_html_adbdc73d345c21b11ce06ad0be4b126e8"><div class="ttname"><a href="classnpc.html#adbdc73d345c21b11ce06ad0be4b126e8">npc::evaluate_monster</a></div><div class="ttdeci">float evaluate_monster(const monster &amp;target, int dist) const</div><div class="ttdoc">rates how dangerous a target is</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00467">npcmove.cpp:467</a></div></div>
<div class="ttc" id="aclassnpc_html_adc0b90f197e58b09eb6eb92132d432f0"><div class="ttname"><a href="classnpc.html#adc0b90f197e58b09eb6eb92132d432f0">npc::guaranteed_hostile</a></div><div class="ttdeci">bool guaranteed_hostile() const</div><div class="ttdoc">Is enemy or will turn into one (can't be convinced not to attack).</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02312">npc.cpp:2312</a></div></div>
<div class="ttc" id="aclassnpc_html_add86c8a6ccc62fd3efa2377ffa00fc15"><div class="ttname"><a href="classnpc.html#add86c8a6ccc62fd3efa2377ffa00fc15">npc::enough_time_to_reload</a></div><div class="ttdeci">bool enough_time_to_reload(const item &amp;gun) const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02762">npcmove.cpp:2762</a></div></div>
<div class="ttc" id="aclassnpc_html_ade7870077fa0ae24205d631e9abb60a7"><div class="ttname"><a href="classnpc.html#ade7870077fa0ae24205d631e9abb60a7">npc::discharge_cbm_weapon</a></div><div class="ttdeci">void discharge_cbm_weapon(bool fired=true, bool stow_real_weapon=false)</div><div class="ttdef"><b>Definition:</b> <a href="bionics_8cpp_source.html#l00575">bionics.cpp:575</a></div></div>
<div class="ttc" id="aclassnpc_html_ae17fa770d3d2ecbb89371e334c21ea6b"><div class="ttname"><a href="classnpc.html#ae17fa770d3d2ecbb89371e334c21ea6b">npc::op_of_u</a></div><div class="ttdeci">npc_opinion op_of_u</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01403">npc.h:1403</a></div></div>
<div class="ttc" id="aclassnpc_html_ae2697d29c28de70968b3aacccbfb824f"><div class="ttname"><a href="classnpc.html#ae2697d29c28de70968b3aacccbfb824f">npc::pick_up_item_map</a></div><div class="ttdeci">std::list&lt; item &gt; pick_up_item_map(const tripoint &amp;where)</div><div class="ttdoc">Picks up items and returns a list of them.</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03877">npcmove.cpp:3877</a></div></div>
<div class="ttc" id="aclassnpc_html_ae29d9e9d3d4be388beb789d8019d03ce"><div class="ttname"><a href="classnpc.html#ae29d9e9d3d4be388beb789d8019d03ce">npc::see_item_say_smth</a></div><div class="ttdeci">void see_item_say_smth(const itype_id &amp;object, const std::string &amp;smth)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03478">npcmove.cpp:3478</a></div></div>
<div class="ttc" id="aclassnpc_html_aec0e31c7784e3b54f820dddf440e04fc"><div class="ttname"><a href="classnpc.html#aec0e31c7784e3b54f820dddf440e04fc">npc::wander_pos</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; wander_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l01381">npc.h:1381</a></div></div>
<div class="ttc" id="aclassnpc_html_aed2e9afbb2e71854fdb5c2df9a59dd5c"><div class="ttname"><a href="classnpc.html#aed2e9afbb2e71854fdb5c2df9a59dd5c">npc::pick_up_item_vehicle</a></div><div class="ttdeci">std::list&lt; item &gt; pick_up_item_vehicle(vehicle &amp;veh, int part_index)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03883">npcmove.cpp:3883</a></div></div>
<div class="ttc" id="aclassnpc_html_aefc6f0c35c8924b11f291d9daf0f230e"><div class="ttname"><a href="classnpc.html#aefc6f0c35c8924b11f291d9daf0f230e">npc::good_escape_direction</a></div><div class="ttdeci">tripoint good_escape_direction(bool include_pos=true)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00260">npcmove.cpp:260</a></div></div>
<div class="ttc" id="aclassnpc_html_aefeae3d14dd64533e5bff412e280c2e8"><div class="ttname"><a href="classnpc.html#aefeae3d14dd64533e5bff412e280c2e8">npc::revert_after_activity</a></div><div class="ttdeci">void revert_after_activity()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l00927">npc.cpp:927</a></div></div>
<div class="ttc" id="aclassnpc_html_af5d3062f499ce1874b1ec47f3fa7bf4e"><div class="ttname"><a href="classnpc.html#af5d3062f499ce1874b1ec47f3fa7bf4e">npc::set_mission</a></div><div class="ttdeci">void set_mission(npc_mission new_mission)</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03530">npc.cpp:3530</a></div></div>
<div class="ttc" id="aclassnpc_html_af7d0521a7bfc228b3ae5949d9fbb3294"><div class="ttname"><a href="classnpc.html#af7d0521a7bfc228b3ae5949d9fbb3294">npc::use_bionic_by_id</a></div><div class="ttdeci">bool use_bionic_by_id(const bionic_id &amp;cbm_id, bool eff_only=false)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02248">npcmove.cpp:2248</a></div></div>
<div class="ttc" id="aclassnpc_html_af9ea7f0462d56a586115b26fefaee170"><div class="ttname"><a href="classnpc.html#af9ea7f0462d56a586115b26fefaee170">npc::pick_up_item</a></div><div class="ttdeci">void pick_up_item()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03655">npcmove.cpp:3655</a></div></div>
<div class="ttc" id="aclassnpc_html_afb23922118c6110a011990778c940ba9"><div class="ttname"><a href="classnpc.html#afb23922118c6110a011990778c940ba9">npc::is_following</a></div><div class="ttdeci">bool is_following() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02327">npc.cpp:2327</a></div></div>
<div class="ttc" id="aclassnpc_html_afb6788e7afa0689bb84fe0216c6b4663"><div class="ttname"><a href="classnpc.html#afb6788e7afa0689bb84fe0216c6b4663">npc::evaluate_best_attack</a></div><div class="ttdeci">void evaluate_best_attack(const Creature *target)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01985">npcmove.cpp:1985</a></div></div>
<div class="ttc" id="aclassnpc_html_afe871b5bf2a092bf7600c686cc5a0eca"><div class="ttname"><a href="classnpc.html#afe871b5bf2a092bf7600c686cc5a0eca">npc::die</a></div><div class="ttdeci">void die(Creature *killer) override</div><div class="ttdoc">Empty function.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02790">npc.cpp:2790</a></div></div>
<div class="ttc" id="aclassnpc_html_aff6a15f0eccd4e9dcc7bbb28034058c3"><div class="ttname"><a href="classnpc.html#aff6a15f0eccd4e9dcc7bbb28034058c3">npc::method_of_attack</a></div><div class="ttdeci">npc_action method_of_attack()</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l01962">npcmove.cpp:1962</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html"><div class="ttname"><a href="classoptional__vpart__position.html">optional_vpart_position</a></div><div class="ttdoc">Simple wrapper to forward functions that may return a std::optional to vpart_position.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00124">vpart_position.h:125</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_a4c78451e42e97753079ecd2a54c7143d"><div class="ttname"><a href="classoptional__vpart__position.html#a4c78451e42e97753079ecd2a54c7143d">optional_vpart_position::part_with_feature</a></div><div class="ttdeci">std::optional&lt; vpart_reference &gt; part_with_feature(const std::string &amp;f, bool unbroken) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02698">vehicle.cpp:2698</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_acf1ddbf380ff79f8fd707a0453b1608b"><div class="ttname"><a href="classoptional__vpart__position.html#acf1ddbf380ff79f8fd707a0453b1608b">optional_vpart_position::cargo</a></div><div class="ttdeci">std::optional&lt; vpart_reference &gt; cargo() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02710">vehicle.cpp:2710</a></div></div>
<div class="ttc" id="aclassoutfit_html_a59316384f010c280db9c30d8e14d005a"><div class="ttname"><a href="classoutfit.html#a59316384f010c280db9c30d8e14d005a">outfit::takeoff</a></div><div class="ttdeci">bool takeoff(item_location loc, std::list&lt; item &gt; *res, Character &amp;guy)</div><div class="ttdef"><b>Definition:</b> <a href="character__attire_8cpp_source.html#l01495">character_attire.cpp:1495</a></div></div>
<div class="ttc" id="aclassoutfit_html_a7512427da57f04dabd96aa8f94c8c597"><div class="ttname"><a href="classoutfit.html#a7512427da57f04dabd96aa8f94c8c597">outfit::activate_combat_items</a></div><div class="ttdeci">void activate_combat_items(npc &amp;guy)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02321">npcmove.cpp:2321</a></div></div>
<div class="ttc" id="aclassoutfit_html_aa1958f2ad820d0945ffb677c930e5259"><div class="ttname"><a href="classoutfit.html#aa1958f2ad820d0945ffb677c930e5259">outfit::deactivate_combat_items</a></div><div class="ttdeci">void deactivate_combat_items(npc &amp;guy)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02349">npcmove.cpp:2349</a></div></div>
<div class="ttc" id="aclassoutfit_html_ac07ab91b69bc4e7b435dd9e6af4d3407"><div class="ttname"><a href="classoutfit.html#ac07ab91b69bc4e7b435dd9e6af4d3407">outfit::adjust_worn</a></div><div class="ttdeci">bool adjust_worn(npc &amp;guy)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05410">npcmove.cpp:5410</a></div></div>
<div class="ttc" id="aclassoutfit_html_ace7613f56f5afd81a6d043691cd8b887"><div class="ttname"><a href="classoutfit.html#ace7613f56f5afd81a6d043691cd8b887">outfit::worn</a></div><div class="ttdeci">std::list&lt; item &gt; worn</div><div class="ttdef"><b>Definition:</b> <a href="character__attire_8h_source.html#l00087">character_attire.h:87</a></div></div>
<div class="ttc" id="aclassovermap_html_aa0999e49bed45fc1eb5e30498b8934f4"><div class="ttname"><a href="classovermap.html#aa0999e49bed45fc1eb5e30498b8934f4">overmap::invalid_tripoint</a></div><div class="ttdeci">static constexpr tripoint_abs_omt invalid_tripoint</div><div class="ttdoc">Dummy value, used to indicate that a point returned by a function is invalid.</div><div class="ttdef"><b>Definition:</b> <a href="overmap_8h_source.html#l00277">overmap.h:277</a></div></div>
<div class="ttc" id="aclassovermapbuffer_html_a5b59e43dc5c0e4f7bce3501dde28c20a"><div class="ttname"><a href="classovermapbuffer.html#a5b59e43dc5c0e4f7bce3501dde28c20a">overmapbuffer::get_travel_path</a></div><div class="ttdeci">std::vector&lt; tripoint_abs_omt &gt; get_travel_path(const tripoint_abs_omt &amp;src, const tripoint_abs_omt &amp;dest, const overmap_path_params &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8cpp_source.html#l00931">overmapbuffer.cpp:931</a></div></div>
<div class="ttc" id="aclassovermapbuffer_html_a60309f685adc56b0b7e5f69206e3cff4"><div class="ttname"><a href="classovermapbuffer.html#a60309f685adc56b0b7e5f69206e3cff4">overmapbuffer::find_closest</a></div><div class="ttdeci">tripoint_abs_omt find_closest(const tripoint_abs_omt &amp;origin, const omt_find_params &amp;params)</div><div class="ttdoc">Returns the closest point of terrain type.</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8cpp_source.html#l01137">overmapbuffer.cpp:1137</a></div></div>
<div class="ttc" id="aclassovermapbuffer_html_aa9fbf966291f6b82de9c540262324aba"><div class="ttname"><a href="classovermapbuffer.html#aa9fbf966291f6b82de9c540262324aba">overmapbuffer::ter</a></div><div class="ttdeci">const oter_id &amp; ter(const tripoint_abs_omt &amp;p)</div><div class="ttdoc">Returns the overmap terrain at the given OMT coordinates.</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8cpp_source.html#l00780">overmapbuffer.cpp:780</a></div></div>
<div class="ttc" id="aclassovermapbuffer_html_abe3397983bdf2419ede84ee43bdf587f"><div class="ttname"><a href="classovermapbuffer.html#abe3397983bdf2419ede84ee43bdf587f">overmapbuffer::find_npc</a></div><div class="ttdeci">shared_ptr_fast&lt; npc &gt; find_npc(character_id id)</div><div class="ttdoc">Find the npc with the given ID.</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8cpp_source.html#l01234">overmapbuffer.cpp:1234</a></div></div>
<div class="ttc" id="aclassovermapbuffer_html_afb50d2d30ce283fbd3ee8773fde98676"><div class="ttname"><a href="classovermapbuffer.html#afb50d2d30ce283fbd3ee8773fde98676">overmapbuffer::find_camp</a></div><div class="ttdeci">std::optional&lt; basecamp * &gt; find_camp(const point_abs_omt &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8cpp_source.html#l01259">overmapbuffer.cpp:1259</a></div></div>
<div class="ttc" id="aclassplayer__activity_html"><div class="ttname"><a href="classplayer__activity.html">player_activity</a></div><div class="ttdef"><b>Definition:</b> <a href="player__activity_8h_source.html#l00032">player_activity.h:33</a></div></div>
<div class="ttc" id="aclassplayer__activity_html_a8ec4a2e2ed99099a3ecb383063b95345"><div class="ttname"><a href="classplayer__activity.html#a8ec4a2e2ed99099a3ecb383063b95345">player_activity::do_turn</a></div><div class="ttdeci">void do_turn(Character &amp;you)</div><div class="ttdoc">Performs the activity for a single turn.</div><div class="ttdef"><b>Definition:</b> <a href="player__activity_8cpp_source.html#l00230">player_activity.cpp:230</a></div></div>
<div class="ttc" id="aclassplayer__activity_html_a955b947f2ca18118b44d3e44aa72b66e"><div class="ttname"><a href="classplayer__activity.html#a955b947f2ca18118b44d3e44aa72b66e">player_activity::id</a></div><div class="ttdeci">const activity_id &amp; id() const</div><div class="ttdef"><b>Definition:</b> <a href="player__activity_8h_source.html#l00114">player_activity.h:114</a></div></div>
<div class="ttc" id="aclassplayer__activity_html_ace15a2f5a970ee2cdb53e5ded21d08a2"><div class="ttname"><a href="classplayer__activity.html#ace15a2f5a970ee2cdb53e5ded21d08a2">player_activity::placement</a></div><div class="ttdeci">tripoint_abs_ms placement</div><div class="ttdef"><b>Definition:</b> <a href="player__activity_8h_source.html#l00068">player_activity.h:68</a></div></div>
<div class="ttc" id="aclassplayer__activity_html_ae44b657c59940e256aeb15e73bf2be1d"><div class="ttname"><a href="classplayer__activity.html#ae44b657c59940e256aeb15e73bf2be1d">player_activity::is_multi_type</a></div><div class="ttdeci">bool is_multi_type() const</div><div class="ttdef"><b>Definition:</b> <a href="player__activity_8cpp_source.html#l00129">player_activity.cpp:129</a></div></div>
<div class="ttc" id="aclassstomach__contents_html_a52e4721f4afcc99ddb28d261fc90cc32"><div class="ttname"><a href="classstomach__contents.html#a52e4721f4afcc99ddb28d261fc90cc32">stomach_contents::contains</a></div><div class="ttdeci">units::volume contains() const</div><div class="ttdef"><b>Definition:</b> <a href="stomach_8cpp_source.html#l00316">stomach.cpp:316</a></div></div>
<div class="ttc" id="aclassstomach__contents_html_a93a1500302155581c1846aa84314b81b"><div class="ttname"><a href="classstomach__contents.html#a93a1500302155581c1846aa84314b81b">stomach_contents::capacity</a></div><div class="ttdeci">units::volume capacity(const Character &amp;owner) const</div><div class="ttdoc">Calculates the capacity of this stomach.</div><div class="ttdef"><b>Definition:</b> <a href="stomach_8cpp_source.html#l00305">stomach.cpp:305</a></div></div>
<div class="ttc" id="aclassstomach__contents_html_a96eccd372c5b0f42ca47bfd7bfeabaec"><div class="ttname"><a href="classstomach__contents.html#a96eccd372c5b0f42ca47bfd7bfeabaec">stomach_contents::ingest</a></div><div class="ttdeci">void ingest(const food_summary &amp;ingested)</div><div class="ttdoc">Directly adds food to stomach contents.</div><div class="ttdef"><b>Definition:</b> <a href="stomach_8cpp_source.html#l00321">stomach.cpp:321</a></div></div>
<div class="ttc" id="aclassstomach__contents_html_aa5cf12fa92df9630e78c4cf5af74d616"><div class="ttname"><a href="classstomach__contents.html#aa5cf12fa92df9630e78c4cf5af74d616">stomach_contents::get_calories</a></div><div class="ttdeci">int get_calories() const</div><div class="ttdef"><b>Definition:</b> <a href="stomach_8cpp_source.html#l00442">stomach.cpp:442</a></div></div>
<div class="ttc" id="aclassstring__id_html"><div class="ttname"><a href="classstring__id.html">string_id&lt; activity_type &gt;</a></div></div>
<div class="ttc" id="aclassstring__id_html_a1b2100ed077789ba45aaf5081791b36c"><div class="ttname"><a href="classstring__id.html#a1b2100ed077789ba45aaf5081791b36c">string_id&lt; activity_type &gt;::NULL_ID</a></div><div class="ttdeci">static const string_id&lt; activity_type &gt; &amp; NULL_ID()</div><div class="ttdoc">Returns a null id whose string_id&lt;T&gt;::is_null() must always return true.</div></div>
<div class="ttc" id="aclassstring__id_html_ae75b0a209b55081a67c5fe6c17a4be00"><div class="ttname"><a href="classstring__id.html#ae75b0a209b55081a67c5fe6c17a4be00">string_id::str</a></div><div class="ttdeci">const std::string &amp; str() const</div><div class="ttdoc">Returns the identifier as plain std::string.</div><div class="ttdef"><b>Definition:</b> <a href="string__id_8h_source.html#l00260">string_id.h:260</a></div></div>
<div class="ttc" id="aclasstime__duration_html"><div class="ttname"><a href="classtime__duration.html">time_duration</a></div><div class="ttdoc">A duration defined as a number of specific time units.</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8h_source.html#l00196">calendar.h:197</a></div></div>
<div class="ttc" id="aclasstime__duration_html_a20688ca0a8848ec0d73636ede90d27ad"><div class="ttname"><a href="classtime__duration.html#a20688ca0a8848ec0d73636ede90d27ad">time_duration::from_minutes</a></div><div class="ttdeci">static constexpr time_duration from_minutes(const T m)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8h_source.html#l00233">calendar.h:233</a></div></div>
<div class="ttc" id="aclasstime__duration_html_af151c8d00f18411742bf9766f5be1b79"><div class="ttname"><a href="classtime__duration.html#af151c8d00f18411742bf9766f5be1b79">time_duration::from_hours</a></div><div class="ttdeci">static constexpr time_duration from_hours(const T h)</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8h_source.html#l00237">calendar.h:237</a></div></div>
<div class="ttc" id="aclasstranslation_html_a30b5b9d586c786942c2321701a53e572"><div class="ttname"><a href="classtranslation.html#a30b5b9d586c786942c2321701a53e572">translation::translated</a></div><div class="ttdeci">std::string translated(int num=1) const</div><div class="ttdoc">Returns raw string if no translation is needed, otherwise returns the translated string.</div><div class="ttdef"><b>Definition:</b> <a href="translation_8cpp_source.html#l00294">translation.cpp:294</a></div></div>
<div class="ttc" id="aclasstripoint__range_html"><div class="ttname"><a href="classtripoint__range.html">tripoint_range</a></div><div class="ttdef"><b>Definition:</b> <a href="map__iterator_8h_source.html#l00012">map_iterator.h:13</a></div></div>
<div class="ttc" id="aclasstripoint__range_html_a274b89cce25f62a34d8733e1dbb3047a"><div class="ttname"><a href="classtripoint__range.html#a274b89cce25f62a34d8733e1dbb3047a">tripoint_range::begin</a></div><div class="ttdeci">point_generator begin() const</div><div class="ttdef"><b>Definition:</b> <a href="map__iterator_8h_source.html#l00108">map_iterator.h:108</a></div></div>
<div class="ttc" id="aclasstripoint__range_html_a848309777e9c64307a96530bbc87541f"><div class="ttname"><a href="classtripoint__range.html#a848309777e9c64307a96530bbc87541f">tripoint_range::end</a></div><div class="ttdeci">point_generator end() const</div><div class="ttdef"><b>Definition:</b> <a href="map__iterator_8h_source.html#l00112">map_iterator.h:112</a></div></div>
<div class="ttc" id="aclassunits_1_1quantity_html"><div class="ttname"><a href="classunits_1_1quantity.html">units::quantity</a></div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00028">units.h:29</a></div></div>
<div class="ttc" id="aclassvehicle__cursor_html"><div class="ttname"><a href="classvehicle__cursor.html">vehicle_cursor</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle__selector_8h_source.html#l00018">vehicle_selector.h:19</a></div></div>
<div class="ttc" id="aclassvehicle__stack_html"><div class="ttname"><a href="classvehicle__stack.html">vehicle_stack</a></div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00173">vehicle.h:174</a></div></div>
<div class="ttc" id="aclassvehicle_html"><div class="ttname"><a href="classvehicle.html">vehicle</a></div><div class="ttdoc">A vehicle as a whole with all its components.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00801">vehicle.h:802</a></div></div>
<div class="ttc" id="aclassvehicle_html_a1b64eabc86039e338bf054c96f5a26ff"><div class="ttname"><a href="classvehicle.html#a1b64eabc86039e338bf054c96f5a26ff">vehicle::get_avail_parts</a></div><div class="ttdeci">vehicle_part_with_feature_range&lt; std::string &gt; get_avail_parts(std::string feature) const</div><div class="ttdoc">Yields a range of parts of this vehicle that each have the given feature and are available: not broke...</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03007">vehicle.cpp:3007</a></div></div>
<div class="ttc" id="aclassvehicle_html_aadd0f7f40c702af8d849d8e3dc8939ca"><div class="ttname"><a href="classvehicle.html#aadd0f7f40c702af8d849d8e3dc8939ca">vehicle::get_passenger</a></div><div class="ttdeci">Character * get_passenger(int you) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03403">vehicle.cpp:3403</a></div></div>
<div class="ttc" id="aclassvehicle_html_abbc4051229bf116dfd03c53dcc4a0765"><div class="ttname"><a href="classvehicle.html#abbc4051229bf116dfd03c53dcc4a0765">vehicle::get_items</a></div><div class="ttdeci">vehicle_stack get_items(const vehicle_part &amp;vp) const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l05922">vehicle.cpp:5922</a></div></div>
<div class="ttc" id="aclassvehicle_html_acdb2ebf673a32f657ac9e29b842ee7f5"><div class="ttname"><a href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">vehicle::part</a></div><div class="ttdeci">vehicle_part &amp; part(int part_num)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l08098">vehicle.cpp:8098</a></div></div>
<div class="ttc" id="aclassvehicle_html_ae8132c34a1ea24866889e6e599796adc"><div class="ttname"><a href="classvehicle.html#ae8132c34a1ea24866889e6e599796adc">vehicle::global_part_pos3</a></div><div class="ttdeci">tripoint global_part_pos3(const int &amp;index) const</div><div class="ttdoc">Get the coordinates of the studied part of the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l03442">vehicle.cpp:3442</a></div></div>
<div class="ttc" id="aclassviewer_html"><div class="ttname"><a href="classviewer.html">viewer</a></div><div class="ttdef"><b>Definition:</b> <a href="viewer_8h_source.html#l00010">viewer.h:11</a></div></div>
<div class="ttc" id="aclassviewer_html_a204fe140cdc73d2452fa9a390a32ba29"><div class="ttname"><a href="classviewer.html#a204fe140cdc73d2452fa9a390a32ba29">viewer::sees</a></div><div class="ttdeci">virtual bool sees(const tripoint &amp;target, bool is_avatar=false, int range_mod=0) const =0</div></div>
<div class="ttc" id="aclassvisitable_html_a31e8c573cb6e4870cc005915efc103b3"><div class="ttname"><a href="classvisitable.html#a31e8c573cb6e4870cc005915efc103b3">visitable::find_parent</a></div><div class="ttdeci">item * find_parent(const item &amp;it) const</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00049">visitable.cpp:49</a></div></div>
<div class="ttc" id="aclassvisitable_html_a3e80572268abd951cf016d275febe4e6"><div class="ttname"><a href="classvisitable.html#a3e80572268abd951cf016d275febe4e6">visitable::items_with</a></div><div class="ttdeci">std::vector&lt; const item * &gt; items_with(const std::function&lt; bool(const item &amp;)&gt; &amp;filter) const</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00330">visitable.cpp:330</a></div></div>
<div class="ttc" id="aclassvpart__reference_html"><div class="ttname"><a href="classvpart__reference.html">vpart_reference</a></div><div class="ttdoc">This is a wrapper over a vehicle pointer and a reference to a part of it.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00153">vpart_position.h:154</a></div></div>
<div class="ttc" id="aclasszone__manager_html"><div class="ttname"><a href="classzone__manager.html">zone_manager</a></div><div class="ttdef"><b>Definition:</b> <a href="clzones_8h_source.html#l00512">clzones.h:513</a></div></div>
<div class="ttc" id="aclasszone__manager_html_a54609d51d21bd8f370ee8b59525eb750"><div class="ttname"><a href="classzone__manager.html#a54609d51d21bd8f370ee8b59525eb750">zone_manager::get_manager</a></div><div class="ttdeci">static zone_manager &amp; get_manager()</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8h_source.html#l00550">clzones.h:550</a></div></div>
<div class="ttc" id="aclasszone__manager_html_aa2c34bee809fc023956ccdc3bc0febb9"><div class="ttname"><a href="classzone__manager.html#aa2c34bee809fc023956ccdc3bc0febb9">zone_manager::get_nearest</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; get_nearest(const zone_type_id &amp;type, const tripoint_abs_ms &amp;where, int range=MAX_DISTANCE, const faction_id &amp;fac=your_fac) const</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8cpp_source.html#l01164">clzones.cpp:1164</a></div></div>
<div class="ttc" id="aclzones_8h_html"><div class="ttname"><a href="clzones_8h.html">clzones.h</a></div></div>
<div class="ttc" id="aclzones_8h_html_a68d414e1c79f68a26edabb0ee1433e4b"><div class="ttname"><a href="clzones_8h.html#a68d414e1c79f68a26edabb0ee1433e4b">ACTIVITY_SEARCH_DISTANCE</a></div><div class="ttdeci">constexpr int ACTIVITY_SEARCH_DISTANCE</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8h_source.html#l00037">clzones.h:37</a></div></div>
<div class="ttc" id="acolony_8h_html"><div class="ttname"><a href="colony_8h.html">colony.h</a></div></div>
<div class="ttc" id="acoordinates_8h_html"><div class="ttname"><a href="coordinates_8h.html">coordinates.h</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a31847b31c6ef002e9d16afd7fd0005e3"><div class="ttname"><a href="coordinates_8h.html#a31847b31c6ef002e9d16afd7fd0005e3">line_to</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &amp;&amp;RhsInBounds &gt; &gt; line_to(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00798">coordinates.h:798</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a38e880e550bb0688dea9353138da8683"><div class="ttname"><a href="coordinates_8h.html#a38e880e550bb0688dea9353138da8683">tripoint_bub_ms</a></div><div class="ttdeci">coords::coord_point&lt; tripoint, coords::origin::reality_bubble, coords::ms &gt; tripoint_bub_ms</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00716">coordinates.h:716</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a560abf1cd341e88e2f13f454ec2ecc99"><div class="ttname"><a href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale &gt; &gt; closest_points_first(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc, int min_dist, int max_dist)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00848">coordinates.h:848</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a70d5706d5a84c7c1953498fa0c651b3e"><div class="ttname"><a href="coordinates_8h.html#a70d5706d5a84c7c1953498fa0c651b3e">direction_from</a></div><div class="ttdeci">direction direction_from(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00790">coordinates.h:790</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a8e2cbab6dac12095f06b4cff66857fbb"><div class="ttname"><a href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a></div><div class="ttdeci">int rl_dist(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00769">coordinates.h:769</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a9d7b6c83d7cf9846d5f1b56e02d88268"><div class="ttname"><a href="coordinates_8h.html#a9d7b6c83d7cf9846d5f1b56e02d88268">square_dist</a></div><div class="ttdeci">int square_dist(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00755">coordinates.h:755</a></div></div>
<div class="ttc" id="acraft__command_8h_html_a78e9fef1fc6aaee4239b8fa5cc3cd21fa912af0dff974604f1321254ca8ff38b6"><div class="ttname"><a href="craft__command_8h.html#a78e9fef1fc6aaee4239b8fa5cc3cd21fa912af0dff974604f1321254ca8ff38b6">usage_from::player</a></div><div class="ttdeci">@ player</div></div>
<div class="ttc" id="acreature_8h_html"><div class="ttname"><a href="creature_8h.html">creature.h</a></div></div>
<div class="ttc" id="acreature_8h_html_a299ec0c42ccc5a2d79d1739428ac3210"><div class="ttname"><a href="creature_8h.html#a299ec0c42ccc5a2d79d1739428ac3210">intensity</a></div><div class="ttdeci">int intensity</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00240">creature.h:240</a></div></div>
<div class="ttc" id="acreature_8h_html_a4b73e33b57ae387dc418906492d5f998"><div class="ttname"><a href="creature_8h.html#a4b73e33b57ae387dc418906492d5f998">force</a></div><div class="ttdeci">bool force</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00241">creature.h:241</a></div></div>
<div class="ttc" id="acreature_8h_html_ab97a871dbf59ff8692908611795f7642a21507b40c80068eda19865706fdc2403"><div class="ttname"><a href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a21507b40c80068eda19865706fdc2403">FacingDirection::RIGHT</a></div><div class="ttdeci">@ RIGHT</div></div>
<div class="ttc" id="acreature_8h_html_ab97a871dbf59ff8692908611795f7642a684d325a7303f52e64011467ff5c5758"><div class="ttname"><a href="creature_8h.html#ab97a871dbf59ff8692908611795f7642a684d325a7303f52e64011467ff5c5758">FacingDirection::LEFT</a></div><div class="ttdeci">@ LEFT</div></div>
<div class="ttc" id="acreature_8h_html_ac54f8023b2f6c4c85f60252cf47cc28d"><div class="ttname"><a href="creature_8h.html#ac54f8023b2f6c4c85f60252cf47cc28d">bp</a></div><div class="ttdeci">bodypart_id bp</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00238">creature.h:238</a></div></div>
<div class="ttc" id="acreature_8h_html_aeb8b361a289bc1747bf10888c18fbfaea5d7454274f566bb1a128ed016e6bc787"><div class="ttname"><a href="creature_8h.html#aeb8b361a289bc1747bf10888c18fbfaea5d7454274f566bb1a128ed016e6bc787">get_body_part_flags::only_main</a></div><div class="ttdeci">@ only_main</div></div>
<div class="ttc" id="acreature_8h_html_afb9a39a835be84327a86693636f5fc49"><div class="ttname"><a href="creature_8h.html#afb9a39a835be84327a86693636f5fc49">dur</a></div><div class="ttdeci">time_duration dur</div><div class="ttdef"><b>Definition:</b> <a href="creature_8h_source.html#l00237">creature.h:237</a></div></div>
<div class="ttc" id="acreature__tracker_8h_html"><div class="ttname"><a href="creature__tracker_8h.html">creature_tracker.h</a></div></div>
<div class="ttc" id="acreature__tracker_8h_html_a16f631f70e72b53e590770670fb301fb"><div class="ttname"><a href="creature__tracker_8h.html#a16f631f70e72b53e590770670fb301fb">get_creature_tracker</a></div><div class="ttdeci">creature_tracker &amp; get_creature_tracker()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13827">game.cpp:13827</a></div></div>
<div class="ttc" id="adamage_8h_html"><div class="ttname"><a href="damage_8h.html">damage.h</a></div></div>
<div class="ttc" id="adebug_8cpp_html_a240782b16593c6bd607c64787c62da0e"><div class="ttname"><a href="debug_8cpp.html#a240782b16593c6bd607c64787c62da0e">DebugLog</a></div><div class="ttdeci">std::ostream &amp; DebugLog(DebugLevel lev, DebugClass cl)</div><div class="ttdef"><b>Definition:</b> <a href="debug_8cpp_source.html#l01438">debug.cpp:1438</a></div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="debug_8h.html">debug.h</a></div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level D_ERROR and class D_MAIN, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00069">debug.h:69</a></div></div>
<div class="ttc" id="adebug_8h_html_ab658e6d84759440dbf3c890446075395ab51d2329abb542af139bd358206609ba"><div class="ttname"><a href="debug_8h.html#ab658e6d84759440dbf3c890446075395ab51d2329abb542af139bd358206609ba">D_INFO</a></div><div class="ttdeci">@ D_INFO</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00140">debug.h:140</a></div></div>
<div class="ttc" id="adebug_8h_html_afa45cf12d72d4226196a7d03c54ad7d3adfa3ea5b834aebc2a8e4e83b7d33db14"><div class="ttname"><a href="debug_8h.html#afa45cf12d72d4226196a7d03c54ad7d3adfa3ea5b834aebc2a8e4e83b7d33db14">DC_ALL</a></div><div class="ttdeci">@ DC_ALL</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00176">debug.h:175</a></div></div>
<div class="ttc" id="adialogue_8h_html_abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8"><div class="ttname"><a href="dialogue_8h.html#abfef6960b077f40e23bc00055370cc71a0639a24a99be1d60fe688dd938b7eca8">action</a></div><div class="ttdeci">@ action</div><div class="ttdef"><b>Definition:</b> <a href="dialogue_8h_source.html#l00044">dialogue.h:43</a></div></div>
<div class="ttc" id="adialogue__chatbin_8h_html"><div class="ttname"><a href="dialogue__chatbin_8h.html">dialogue_chatbin.h</a></div></div>
<div class="ttc" id="adispersion_8h_html"><div class="ttname"><a href="dispersion_8h.html">dispersion.h</a></div></div>
<div class="ttc" id="aeffect_8h_html"><div class="ttname"><a href="effect_8h.html">effect.h</a></div></div>
<div class="ttc" id="aenums_8h_html"><div class="ttname"><a href="enums_8h.html">enums.h</a></div></div>
<div class="ttc" id="aenums_8h_html_a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a"><div class="ttname"><a href="enums_8h.html#a02646717f97faa05c11dbda0aac2c716a599dcce2998a6b40b1e38e8c6006cb0a">ot_match_type::type</a></div><div class="ttdeci">@ type</div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea3ab788e6c7dfa584be4ca2e90c49ec8c">m_neutral</a></div><div class="ttdeci">@ m_neutral</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00354">enums.h:354</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea5d3734a51686ceb1848704dd277dfc7f">m_info</a></div><div class="ttdeci">@ m_info</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00352">enums.h:352</a></div></div>
<div class="ttc" id="aenums_8h_html_a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1"><div class="ttname"><a href="enums_8h.html#a3baf36d700701401b6baf94db93d096ea72e7b82d57a6df0d4263c2043139b1b1">m_bad</a></div><div class="ttdeci">@ m_bad</div><div class="ttdef"><b>Definition:</b> <a href="enums_8h_source.html#l00348">enums.h:348</a></div></div>
<div class="ttc" id="aenums_8h_html_aba0792ae6ae9fa99a07c9c9e6eae94e9ab50339a10e1de285ac99d4c3990b8693"><div class="ttname"><a href="enums_8h.html#aba0792ae6ae9fa99a07c9c9e6eae94e9ab50339a10e1de285ac99d4c3990b8693">trinary::NONE</a></div><div class="ttdeci">@ NONE</div></div>
<div class="ttc" id="aenums_8h_html_ade8f325e8cc8463cef8f944f3209d0e5a5918e24870f0ea98b9978dae8a69c533"><div class="ttname"><a href="enums_8h.html#ade8f325e8cc8463cef8f944f3209d0e5a5918e24870f0ea98b9978dae8a69c533">phase_id::LIQUID</a></div><div class="ttdeci">@ LIQUID</div></div>
<div class="ttc" id="aevent_8h_html_a333a7721472705fe444b24f107f9a731aa09554a2a78fb217500c6366b202ed82"><div class="ttname"><a href="event_8h.html#a333a7721472705fe444b24f107f9a731aa09554a2a78fb217500c6366b202ed82">event_type::opens_spellbook</a></div><div class="ttdeci">@ opens_spellbook</div></div>
<div class="ttc" id="aevent__bus_8h_html"><div class="ttname"><a href="event__bus_8h.html">event_bus.h</a></div></div>
<div class="ttc" id="aevent__bus_8h_html_a4f760194b9225ccf92a1419748def636"><div class="ttname"><a href="event__bus_8h.html#a4f760194b9225ccf92a1419748def636">get_event_bus</a></div><div class="ttdeci">event_bus &amp; get_event_bus()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13832">game.cpp:13832</a></div></div>
<div class="ttc" id="aexplosion_8h_html"><div class="ttname"><a href="explosion_8h.html">explosion.h</a></div></div>
<div class="ttc" id="afaction__camp_8h_html_ab6b01bd98db40fc2331dc0bc2ae73d61a430e39cf0eec69892a0fdb6b0dc4aa70"><div class="ttname"><a href="faction__camp_8h.html#ab6b01bd98db40fc2331dc0bc2ae73d61a430e39cf0eec69892a0fdb6b0dc4aa70">farm_ops::harvest</a></div><div class="ttdeci">@ harvest</div></div>
<div class="ttc" id="afield_8h_html"><div class="ttname"><a href="field_8h.html">field.h</a></div></div>
<div class="ttc" id="afield__type_8cpp_html_a0090428c1f6724209c133c6b04b037cd"><div class="ttname"><a href="field__type_8cpp.html#a0090428c1f6724209c133c6b04b037cd">fd_fire</a></div><div class="ttdeci">const field_type_str_id fd_fire(&quot;fd_fire&quot;)</div></div>
<div class="ttc" id="afield__type_8h_html"><div class="ttname"><a href="field__type_8h.html">field_type.h</a></div></div>
<div class="ttc" id="aflag_8cpp_html_a1089f9000b1350feb5b65a77b706dd7b"><div class="ttname"><a href="flag_8cpp.html#a1089f9000b1350feb5b65a77b706dd7b">flag_NPC_ALT_ATTACK</a></div><div class="ttdeci">const flag_id flag_NPC_ALT_ATTACK(&quot;NPC_ALT_ATTACK&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a3e2d3cbf6b78ce65033d1f9cbf1f59bf"><div class="ttname"><a href="flag_8cpp.html#a3e2d3cbf6b78ce65033d1f9cbf1f59bf">flag_USE_UPS</a></div><div class="ttdeci">const flag_id flag_USE_UPS(&quot;USE_UPS&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a4c5b923aa3a82dbac24b314b75536490"><div class="ttname"><a href="flag_8cpp.html#a4c5b923aa3a82dbac24b314b75536490">flag_NPC_THROW_NOW</a></div><div class="ttdeci">const flag_id flag_NPC_THROW_NOW(&quot;NPC_THROW_NOW&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a57bcb21f2d07b56b0c735991710908f7"><div class="ttname"><a href="flag_8cpp.html#a57bcb21f2d07b56b0c735991710908f7">flag_TWO_WAY_RADIO</a></div><div class="ttdeci">const flag_id flag_TWO_WAY_RADIO(&quot;TWO_WAY_RADIO&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a6be4f10366075d46b3240b6b098456a6"><div class="ttname"><a href="flag_8cpp.html#a6be4f10366075d46b3240b6b098456a6">flag_COMBAT_TOGGLEABLE</a></div><div class="ttdeci">const flag_id flag_COMBAT_TOGGLEABLE(&quot;COMBAT_TOGGLEABLE&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a936d1c7b90d01c5d07e69d0628c81235"><div class="ttname"><a href="flag_8cpp.html#a936d1c7b90d01c5d07e69d0628c81235">flag_NO_UNWIELD</a></div><div class="ttdeci">const flag_id flag_NO_UNWIELD(&quot;NO_UNWIELD&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_a992a6a80e8fc7944c1eda2676af9bb33"><div class="ttname"><a href="flag_8cpp.html#a992a6a80e8fc7944c1eda2676af9bb33">flag_NPC_ACTIVATE</a></div><div class="ttdeci">const flag_id flag_NPC_ACTIVATE(&quot;NPC_ACTIVATE&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_ad12eb85cdd376a51aa3859ca5894377b"><div class="ttname"><a href="flag_8cpp.html#ad12eb85cdd376a51aa3859ca5894377b">flag_SPLINT</a></div><div class="ttdeci">const flag_id flag_SPLINT(&quot;SPLINT&quot;)</div></div>
<div class="ttc" id="aflag_8cpp_html_ae8607045269d50f5b92c4e7a4c09e95c"><div class="ttname"><a href="flag_8cpp.html#ae8607045269d50f5b92c4e7a4c09e95c">flag_NO_PARASITES</a></div><div class="ttdeci">const flag_id flag_NO_PARASITES(&quot;NO_PARASITES&quot;)</div></div>
<div class="ttc" id="aflag_8h_html"><div class="ttname"><a href="flag_8h.html">flag.h</a></div></div>
<div class="ttc" id="aflat__set_8h_html"><div class="ttname"><a href="flat__set_8h.html">flat_set.h</a></div></div>
<div class="ttc" id="agame_8cpp_html_ab5c977b7e81348725fb7bf09fc64ed95"><div class="ttname"><a href="game_8cpp.html#ab5c977b7e81348725fb7bf09fc64ed95">get_player_view</a></div><div class="ttdeci">viewer &amp; get_player_view()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13812">game.cpp:13812</a></div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00382">game.cpp:382</a></div></div>
<div class="ttc" id="agame_8cpp_html_afa1063326b0c16b43c6f3dc8c3df403d"><div class="ttname"><a href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13822">game.cpp:13822</a></div></div>
<div class="ttc" id="agame_8h_html"><div class="ttname"><a href="game_8h.html">game.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html"><div class="ttname"><a href="game__constants_8h.html">game_constants.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a39fd8a829e3dc412646663066dbdb54c"><div class="ttname"><a href="game__constants_8h.html#a39fd8a829e3dc412646663066dbdb54c">SEEX</a></div><div class="ttdeci">constexpr int SEEX</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00042">game_constants.h:42</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a4cfa35de359af17f7bc6c2a424339eb5"><div class="ttname"><a href="game__constants_8h.html#a4cfa35de359af17f7bc6c2a424339eb5">SEEY</a></div><div class="ttdeci">constexpr int SEEY</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00043">game_constants.h:43</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a745392436b19cce3012d4d8dc0fe422c"><div class="ttname"><a href="game__constants_8h.html#a745392436b19cce3012d4d8dc0fe422c">MAX_VIEW_DISTANCE</a></div><div class="ttdeci">constexpr int MAX_VIEW_DISTANCE</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00051">game_constants.h:51</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a8226e8a134603e5bc06df05efd13d8d1"><div class="ttname"><a href="game__constants_8h.html#a8226e8a134603e5bc06df05efd13d8d1">MAX_RECOIL</a></div><div class="ttdeci">constexpr double MAX_RECOIL</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00137">game_constants.h:137</a></div></div>
<div class="ttc" id="agates_8h_html"><div class="ttname"><a href="gates_8h.html">gates.h</a></div></div>
<div class="ttc" id="agun__mode_8h_html"><div class="ttname"><a href="gun__mode_8h.html">gun_mode.h</a></div></div>
<div class="ttc" id="ainput__context_8cpp_html_a077f0863a15ffb1731f2cb207abcb958ab2c97ae425dd751b0e48a3acae79cf4a"><div class="ttname"><a href="input__context_8cpp.html#a077f0863a15ffb1731f2cb207abcb958ab2c97ae425dd751b0e48a3acae79cf4a">kb_menu_status::filter</a></div><div class="ttdeci">@ filter</div></div>
<div class="ttc" id="aitem_8cpp_html_a69e37326c7c5f142d13f8ac8e070b728"><div class="ttname"><a href="item_8cpp.html#a69e37326c7c5f142d13f8ac8e070b728">null_item_reference</a></div><div class="ttdeci">item &amp; null_item_reference()</div><div class="ttdoc">Returns a reference to a null item (see item::is_null).</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l00248">item.cpp:248</a></div></div>
<div class="ttc" id="aitem_8h_html"><div class="ttname"><a href="item_8h.html">item.h</a></div></div>
<div class="ttc" id="aitem_8h_html_a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8"><div class="ttname"><a href="item_8h.html#a4f974518dea58a566d831531303a34b9a755f85c2723bb39381c7379a604160d8">hint_rating::good</a></div><div class="ttdeci">@ good</div><div class="ttdoc">Item permits this action.</div></div>
<div class="ttc" id="aitem__factory_8cpp_html_a62fc9d4e4ca8f0e62b4556f5f65b666c"><div class="ttname"><a href="item__factory_8cpp.html#a62fc9d4e4ca8f0e62b4556f5f65b666c">item_controller</a></div><div class="ttdeci">std::unique_ptr&lt; Item_factory &gt; item_controller</div><div class="ttdef"><b>Definition:</b> <a href="item__factory_8cpp_source.html#l00126">item_factory.cpp:126</a></div></div>
<div class="ttc" id="aitem__factory_8h_html"><div class="ttname"><a href="item__factory_8h.html">item_factory.h</a></div></div>
<div class="ttc" id="aitype_8h_html"><div class="ttname"><a href="itype_8h.html">itype.h</a></div></div>
<div class="ttc" id="aitype_8h_html_a5aaa0efeab989fe1afbc025b4b84d3c2"><div class="ttname"><a href="itype_8h.html#a5aaa0efeab989fe1afbc025b4b84d3c2">base_metabolic_rate</a></div><div class="ttdeci">constexpr float base_metabolic_rate</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l00117">itype.h:117</a></div></div>
<div class="ttc" id="aitype_8h_html_a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180"><div class="ttname"><a href="itype_8h.html#a900fa847a573c744b0b3ea04319d6276a5161ebb0cce4b7987ba8b6935d60a180">itype_variant_kind::gun</a></div><div class="ttdeci">@ gun</div></div>
<div class="ttc" id="aiuse_8h_html"><div class="ttname"><a href="iuse_8h.html">iuse.h</a></div></div>
<div class="ttc" id="aiuse__actor_8h_html"><div class="ttname"><a href="iuse__actor_8h.html">iuse_actor.h</a></div></div>
<div class="ttc" id="aline_8cpp_html_a19634ed59e09da9312d6fa110a38539c"><div class="ttname"><a href="line_8cpp.html#a19634ed59e09da9312d6fa110a38539c">direction_name</a></div><div class="ttdeci">std::string direction_name(const direction dir)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00612">line.cpp:612</a></div></div>
<div class="ttc" id="aline_8cpp_html_a22f984836636053038f43340f9c50149"><div class="ttname"><a href="line_8cpp.html#a22f984836636053038f43340f9c50149">coord_to_angle</a></div><div class="ttdeci">units::angle coord_to_angle(const tripoint &amp;a, const tripoint &amp;b)</div><div class="ttdoc">Calculates the horizontal angle between the lines from (0,0,0) to a and the line from (0,...</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00940">line.cpp:940</a></div></div>
<div class="ttc" id="aline_8cpp_html_a399f25250fad82fbc37b72a78dfafb43"><div class="ttname"><a href="line_8cpp.html#a399f25250fad82fbc37b72a78dfafb43">displace_XY</a></div><div class="ttdeci">point displace_XY(const direction dir)</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00515">line.cpp:515</a></div></div>
<div class="ttc" id="aline_8cpp_html_a40b9d88f6d95e646490329d0071ec931"><div class="ttname"><a href="line_8cpp.html#a40b9d88f6d95e646490329d0071ec931">trigdist</a></div><div class="ttdeci">bool trigdist</div><div class="ttdef"><b>Definition:</b> <a href="line_8cpp_source.html#l00018">line.cpp:18</a></div></div>
<div class="ttc" id="aline_8h_html"><div class="ttname"><a href="line_8h.html">line.h</a></div></div>
<div class="ttc" id="aline_8h_html_a3621d2006812bd84f3ed6999b38f90a3"><div class="ttname"><a href="line_8h.html#a3621d2006812bd84f3ed6999b38f90a3">direction</a></div><div class="ttdeci">direction</div><div class="ttdef"><b>Definition:</b> <a href="line_8h_source.html#l00042">line.h:42</a></div></div>
<div class="ttc" id="amagic_8cpp_html_a6753ecfe87da659675b18c2f81d6ec12"><div class="ttname"><a href="magic_8cpp.html#a6753ecfe87da659675b18c2f81d6ec12">c</a></div><div class="ttdeci">static constexpr double c</div><div class="ttdef"><b>Definition:</b> <a href="magic_8cpp_source.html#l01568">magic.cpp:1568</a></div></div>
<div class="ttc" id="amagic_8h_html_a43ffd543787e68e5333debafdbb7ead7a2ad733df56aaafa5650bafc9c98c6ffb"><div class="ttname"><a href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a2ad733df56aaafa5650bafc9c98c6ffb">spell_target::ally</a></div><div class="ttdeci">@ ally</div></div>
<div class="ttc" id="amagic_8h_html_a43ffd543787e68e5333debafdbb7ead7a447b7147e84be512208dcc0995d67ebc"><div class="ttname"><a href="magic_8h.html#a43ffd543787e68e5333debafdbb7ead7a447b7147e84be512208dcc0995d67ebc">spell_target::item</a></div><div class="ttdeci">@ item</div></div>
<div class="ttc" id="amap_8h_html"><div class="ttname"><a href="map_8h.html">map.h</a></div></div>
<div class="ttc" id="amap__iterator_8h_html"><div class="ttname"><a href="map__iterator_8h.html">map_iterator.h</a></div></div>
<div class="ttc" id="amapdata_8h_html"><div class="ttname"><a href="mapdata_8h.html">mapdata.h</a></div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a014099fdb4e616450d942532bf1953ae"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a014099fdb4e616450d942532bf1953ae">ter_furn_flag::TFLAG_CAN_SIT</a></div><div class="ttdeci">@ TFLAG_CAN_SIT</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a03729ff11aa021aad1751ad38ed85c81"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a03729ff11aa021aad1751ad38ed85c81">ter_furn_flag::TFLAG_UNSTABLE</a></div><div class="ttdeci">@ TFLAG_UNSTABLE</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a069663dd0b045b0a7e5268c906c5790f"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a069663dd0b045b0a7e5268c906c5790f">ter_furn_flag::TFLAG_NO_SIGHT</a></div><div class="ttdeci">@ TFLAG_NO_SIGHT</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054ac0ec7541a0f28e104d9c691936512481"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac0ec7541a0f28e104d9c691936512481">ter_furn_flag::TFLAG_CLIMBABLE</a></div><div class="ttdeci">@ TFLAG_CLIMBABLE</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054ac6e19e1c41724be67b2bff2870539ca1"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac6e19e1c41724be67b2bff2870539ca1">ter_furn_flag::TFLAG_DEEP_WATER</a></div><div class="ttdeci">@ TFLAG_DEEP_WATER</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054ac862a199df92b3793a8ce4cf5b039d20"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac862a199df92b3793a8ce4cf5b039d20">ter_furn_flag::TFLAG_DOOR</a></div><div class="ttdeci">@ TFLAG_DOOR</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054af750a4c95295d69ca74da7e774111bfb"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af750a4c95295d69ca74da7e774111bfb">ter_furn_flag::TFLAG_FIRE_CONTAINER</a></div><div class="ttdeci">@ TFLAG_FIRE_CONTAINER</div></div>
<div class="ttc" id="amapgen_8h_html_afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37"><div class="ttname"><a href="mapgen_8h.html#afdd0a1598dc015b56a1b46d51da2b06ead825c53d89d9cacb3e034bcb138f3d37">mapgen_phase::transform</a></div><div class="ttdeci">@ transform</div></div>
<div class="ttc" id="amaterial_8h_html"><div class="ttname"><a href="material_8h.html">material.h</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a24f6ac6e06720c7cdf972a6083847132"><div class="ttname"><a href="math__parser__func_8h.html#a24f6ac6e06720c7cdf972a6083847132">abs</a></div><div class="ttdeci">double abs(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00030">math_parser_func.h:30</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a5834219bcffc7118c95b395b8cdeec20"><div class="ttname"><a href="math__parser__func_8h.html#a5834219bcffc7118c95b395b8cdeec20">round</a></div><div class="ttdeci">double round(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00110">math_parser_func.h:110</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a9009aa9e5eb1323238ebddffd8e1aedf"><div class="ttname"><a href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a></div><div class="ttdeci">double max(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00035">math_parser_func.h:35</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a993dede52d23a9a3d15b01a342391ef4"><div class="ttname"><a href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a></div><div class="ttdeci">double min(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00043">math_parser_func.h:43</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_ac9196b0cf8d9dd209db9fc00a69a55f6"><div class="ttname"><a href="math__parser__func_8h.html#ac9196b0cf8d9dd209db9fc00a69a55f6">ceil</a></div><div class="ttdeci">double ceil(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00100">math_parser_func.h:100</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ab8afe5baa726add2054cce385cad8855"><div class="ttname"><a href="memory__fast_8h.html#ab8afe5baa726add2054cce385cad8855">weak_ptr_fast</a></div><div class="ttdeci">std::weak_ptr&lt; T &gt; weak_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00017">memory_fast.h:17</a></div></div>
<div class="ttc" id="amemory__fast_8h_html_ada897699f31fc8b37c5af09d95d45840"><div class="ttname"><a href="memory__fast_8h.html#ada897699f31fc8b37c5af09d95d45840">shared_ptr_fast</a></div><div class="ttdeci">std::shared_ptr&lt; T &gt; shared_ptr_fast</div><div class="ttdef"><b>Definition:</b> <a href="memory__fast_8h_source.html#l00016">memory_fast.h:16</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a3ea1aed1d11cd410cce07fb5be7aa34f"><div class="ttname"><a href="messages_8cpp.html#a3ea1aed1d11cd410cce07fb5be7aa34f">add_msg_if_player_sees</a></div><div class="ttdeci">void add_msg_if_player_sees(const tripoint &amp;target, std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l01007">messages.cpp:1007</a></div></div>
<div class="ttc" id="amessages_8cpp_html_a54489326fc37823819c5105addfa27f2"><div class="ttname"><a href="messages_8cpp.html#a54489326fc37823819c5105addfa27f2">add_msg</a></div><div class="ttdeci">void add_msg(std::string msg)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8cpp_source.html#l00997">messages.cpp:997</a></div></div>
<div class="ttc" id="amessages_8h_html"><div class="ttname"><a href="messages_8h.html">messages.h</a></div></div>
<div class="ttc" id="amessages_8h_html_ab6590bda29b082a7282bcc1a9cc8f02a"><div class="ttname"><a href="messages_8h.html#ab6590bda29b082a7282bcc1a9cc8f02a">add_msg_debug</a></div><div class="ttdeci">#define add_msg_debug(type,...)</div><div class="ttdef"><b>Definition:</b> <a href="messages_8h_source.html#l00177">messages.h:177</a></div></div>
<div class="ttc" id="amission_8h_html"><div class="ttname"><a href="mission_8h.html">mission.h</a></div></div>
<div class="ttc" id="amission_8h_html_ad20a7d1ff55d31e8f1b7409ab56d7085"><div class="ttname"><a href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085">mission_goal</a></div><div class="ttdeci">mission_goal</div><div class="ttdef"><b>Definition:</b> <a href="mission_8h_source.html#l00060">mission.h:60</a></div></div>
<div class="ttc" id="amission_8h_html_ad20a7d1ff55d31e8f1b7409ab56d7085a2a71a02961479f56ca9a897ed726e759"><div class="ttname"><a href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085a2a71a02961479f56ca9a897ed726e759">MGOAL_FIND_ITEM_GROUP</a></div><div class="ttdeci">@ MGOAL_FIND_ITEM_GROUP</div><div class="ttdef"><b>Definition:</b> <a href="mission_8h_source.html#l00066">mission.h:66</a></div></div>
<div class="ttc" id="amission_8h_html_ad20a7d1ff55d31e8f1b7409ab56d7085a7ce044681892644558e23ee2ee225791"><div class="ttname"><a href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085a7ce044681892644558e23ee2ee225791">MGOAL_FIND_ITEM</a></div><div class="ttdeci">@ MGOAL_FIND_ITEM</div><div class="ttdef"><b>Definition:</b> <a href="mission_8h_source.html#l00064">mission.h:64</a></div></div>
<div class="ttc" id="amission_8h_html_ad20a7d1ff55d31e8f1b7409ab56d7085aa317d885583c2e6e132dd509fd1d8710"><div class="ttname"><a href="mission_8h.html#ad20a7d1ff55d31e8f1b7409ab56d7085aa317d885583c2e6e132dd509fd1d8710">MGOAL_FIND_ANY_ITEM</a></div><div class="ttdeci">@ MGOAL_FIND_ANY_ITEM</div><div class="ttdef"><b>Definition:</b> <a href="mission_8h_source.html#l00065">mission.h:65</a></div></div>
<div class="ttc" id="amonster_8h_html"><div class="ttname"><a href="monster_8h.html">monster.h</a></div></div>
<div class="ttc" id="amtype_8cpp_html_a1ce59be15eeebc2aa195dc5a5cf38358"><div class="ttname"><a href="mtype_8cpp.html#a1ce59be15eeebc2aa195dc5a5cf38358">mon_flag_RIDEABLE_MECH</a></div><div class="ttdeci">mon_flag_id mon_flag_RIDEABLE_MECH</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8cpp_source.html#l00142">mtype.cpp:142</a></div></div>
<div class="ttc" id="amtype_8h_html"><div class="ttname"><a href="mtype_8h.html">mtype.h</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npcmove_8cpp_03_html_a00172ed0a10f7343e460c341ad4fe416"><div class="ttname"><a href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a00172ed0a10f7343e460c341ad4fe416">anonymous_namespace{npcmove.cpp}::good_for_pickup</a></div><div class="ttdeci">bool good_for_pickup(const item &amp;it, npc &amp;who, const tripoint &amp;there)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00219">npcmove.cpp:219</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npcmove_8cpp_03_html_a14108754d46e7a886364e08c7817615b"><div class="ttname"><a href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a14108754d46e7a886364e08c7817615b">anonymous_namespace{npcmove.cpp}::avoidance_vehicles_radius</a></div><div class="ttdeci">const int avoidance_vehicles_radius</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00217">npcmove.cpp:217</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npcmove_8cpp_03_html_a21c4e6ec47c5c917485f57ab35c5f0b1"><div class="ttname"><a href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a21c4e6ec47c5c917485f57ab35c5f0b1">anonymous_namespace{npcmove.cpp}::defense_cbms</a></div><div class="ttdeci">const std::vector&lt; bionic_id &gt; defense_cbms</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00192">npcmove.cpp:192</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npcmove_8cpp_03_html_a4ebf7d016fe3acf5365eb4bb84abf223"><div class="ttname"><a href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a4ebf7d016fe3acf5365eb4bb84abf223">anonymous_namespace{npcmove.cpp}::health_cbms</a></div><div class="ttdeci">const std::vector&lt; bionic_id &gt; health_cbms</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00202">npcmove.cpp:202</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npcmove_8cpp_03_html_a8ac361f76a60d142bb729e731f1f99d7"><div class="ttname"><a href="namespaceanonymous__namespace_02npcmove_8cpp_03.html#a8ac361f76a60d142bb729e731f1f99d7">anonymous_namespace{npcmove.cpp}::weapon_cbms</a></div><div class="ttdeci">const std::vector&lt; bionic_id &gt; weapon_cbms</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00209">npcmove.cpp:209</a></div></div>
<div class="ttc" id="anamespacecalendar_html_a00a46407cfaf938c78b9e3ae7bbc763f"><div class="ttname"><a href="namespacecalendar.html#a00a46407cfaf938c78b9e3ae7bbc763f">calendar::INDEFINITELY_LONG</a></div><div class="ttdeci">const int INDEFINITELY_LONG</div><div class="ttdoc">A number that represents the longest possible action.</div></div>
<div class="ttc" id="anamespacecalendar_html_a356df28513f4d655ae35c312ab6e7d55"><div class="ttname"><a href="namespacecalendar.html#a356df28513f4d655ae35c312ab6e7d55">calendar::once_every</a></div><div class="ttdeci">bool once_every(const time_duration &amp;event_frequency)</div><div class="ttdoc">Predicate to handle rate-limiting.</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00753">calendar.cpp:753</a></div></div>
<div class="ttc" id="anamespacecalendar_html_ae15fcbf1c971589eb49c1a657fb6a580"><div class="ttname"><a href="namespacecalendar.html#ae15fcbf1c971589eb49c1a657fb6a580">calendar::turn</a></div><div class="ttdeci">time_point turn</div><div class="ttdef"><b>Definition:</b> <a href="calendar_8cpp_source.html#l00038">calendar.cpp:38</a></div></div>
<div class="ttc" id="anamespacecata_1_1hash64__detail_html_a5ca825db6fd06946302c60daa97333e4"><div class="ttname"><a href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">cata::hash64_detail::ret</a></div><div class="ttdeci">T ret</div><div class="ttdef"><b>Definition:</b> <a href="hash__utils_8h_source.html#l00097">hash_utils.h:97</a></div></div>
<div class="ttc" id="anamespacecata_html_a3d88c70a7080cf9c6f03411f0b13c8cf"><div class="ttname"><a href="namespacecata.html#a3d88c70a7080cf9c6f03411f0b13c8cf">cata::sort_by_rating</a></div><div class="ttdeci">void sort_by_rating(Iterator begin, Iterator end, RatingFunction rating_func)</div><div class="ttdoc">Sort elements of a sequence by their rating (the smaller the better).</div><div class="ttdef"><b>Definition:</b> <a href="cata__algo_8h_source.html#l00026">cata_algo.h:26</a></div></div>
<div class="ttc" id="anamespacedebugmode_html_ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e"><div class="ttname"><a href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2aa80ba6bdf706a3ad1f7450f71465cd7e">debugmode::DF_NPC_MOVEAI</a></div><div class="ttdeci">@ DF_NPC_MOVEAI</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00270">debug.h:270</a></div></div>
<div class="ttc" id="anamespacedebugmode_html_ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827"><div class="ttname"><a href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2ad53ac6289f06efc1b12b680e39b93827">debugmode::DF_NPC_COMBATAI</a></div><div class="ttdeci">@ DF_NPC_COMBATAI</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00268">debug.h:268</a></div></div>
<div class="ttc" id="anamespacedebugmode_html_ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2"><div class="ttname"><a href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2af23f8ccb0fd99b8a3db9e9223a5714a2">debugmode::DF_NPC</a></div><div class="ttdeci">@ DF_NPC</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00267">debug.h:267</a></div></div>
<div class="ttc" id="anamespacedebugmode_html_ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349"><div class="ttname"><a href="namespacedebugmode.html#ac654a55a1b56b11554103f87859968f2afa86872dc16620f75a46f9e96422e349">debugmode::DF_NPC_ITEMAI</a></div><div class="ttdeci">@ DF_NPC_ITEMAI</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00269">debug.h:269</a></div></div>
<div class="ttc" id="anamespacedoors_html_a7e98fe762c930a47288a073dc9792264"><div class="ttname"><a href="namespacedoors.html#a7e98fe762c930a47288a073dc9792264">doors::can_unlock_door</a></div><div class="ttdeci">bool can_unlock_door(const map &amp;m, const Creature &amp;who, const tripoint_bub_ms &amp;lockp)</div><div class="ttdoc">Whether a door at &quot;lockp&quot; can be unlocked by &quot;who.&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="gates_8cpp_source.html#l00449">gates.cpp:449</a></div></div>
<div class="ttc" id="anamespacedoors_html_ac942d0e590fade74ac316bd18fae5357"><div class="ttname"><a href="namespacedoors.html#ac942d0e590fade74ac316bd18fae5357">doors::unlock_door</a></div><div class="ttdeci">bool unlock_door(map &amp;m, Creature &amp;who, const tripoint_bub_ms &amp;lockp)</div><div class="ttdoc">Unlocks a door at &quot;lockp&quot; as &quot;who.&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="gates_8cpp_source.html#l00409">gates.cpp:409</a></div></div>
<div class="ttc" id="anamespacedoors_html_ad946fe0ed45565925e0a6c168ba12596"><div class="ttname"><a href="namespacedoors.html#ad946fe0ed45565925e0a6c168ba12596">doors::close_door</a></div><div class="ttdeci">void close_door(map &amp;m, Creature &amp;who, const tripoint_bub_ms &amp;closep)</div><div class="ttdoc">Handles deducting moves, printing messages (only non-NPCs cause messages), actually closing it,...</div><div class="ttdef"><b>Definition:</b> <a href="gates_8cpp_source.html#l00254">gates.cpp:254</a></div></div>
<div class="ttc" id="anamespacedoors_html_ae7c1bfb249698cfb947810fb98b62f1e"><div class="ttname"><a href="namespacedoors.html#ae7c1bfb249698cfb947810fb98b62f1e">doors::lock_door</a></div><div class="ttdeci">bool lock_door(map &amp;m, Creature &amp;who, const tripoint_bub_ms &amp;lockp)</div><div class="ttdoc">Locks a door at &quot;lockp&quot; as &quot;who.&quot;.</div><div class="ttdef"><b>Definition:</b> <a href="gates_8cpp_source.html#l00356">gates.cpp:356</a></div></div>
<div class="ttc" id="anamespacegame__menus_1_1inv_html_ac3a1cc6107728c90e65e9af775f7c279"><div class="ttname"><a href="namespacegame__menus_1_1inv.html#ac3a1cc6107728c90e65e9af775f7c279">game_menus::inv::compare</a></div><div class="ttdeci">void compare(avatar &amp;you, const std::optional&lt; tripoint &gt; &amp;offset)</div><div class="ttdef"><b>Definition:</b> <a href="game__inventory_8cpp_source.html#l02394">game_inventory.cpp:2394</a></div></div>
<div class="ttc" id="anamespacekeycode_html_a16ca776f0df120afb4f1b16a92e2d7f7aa6efe66b8fc51ca203d5f0015d983eac"><div class="ttname"><a href="namespacekeycode.html#a16ca776f0df120afb4f1b16a92e2d7f7aa6efe66b8fc51ca203d5f0015d983eac">keycode::end</a></div><div class="ttdeci">@ end</div><div class="ttdef"><b>Definition:</b> <a href="input_8h_source.html#l00095">input.h:95</a></div></div>
<div class="ttc" id="anamespacemath__opers_html_a2f0118617735cc810b9d76d62bd182f6"><div class="ttname"><a href="namespacemath__opers.html#a2f0118617735cc810b9d76d62bd182f6">math_opers::pos</a></div><div class="ttdeci">constexpr double pos(double, double r)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__impl_8h_source.html#l00203">math_parser_impl.h:203</a></div></div>
<div class="ttc" id="anamespacenpc__factions_html_af09ec48d0dc133795062d1424c486686a9d921e2d3b4862cddd420c437da1434e"><div class="ttname"><a href="namespacenpc__factions.html#af09ec48d0dc133795062d1424c486686a9d921e2d3b4862cddd420c437da1434e">npc_factions::watch_your_back</a></div><div class="ttdeci">@ watch_your_back</div><div class="ttdef"><b>Definition:</b> <a href="faction_8h_source.html#l00051">faction.h:51</a></div></div>
<div class="ttc" id="anamespacenpc__factions_html_af09ec48d0dc133795062d1424c486686ae2297e55866b5d8e47bfee136604c485"><div class="ttname"><a href="namespacenpc__factions.html#af09ec48d0dc133795062d1424c486686ae2297e55866b5d8e47bfee136604c485">npc_factions::kill_on_sight</a></div><div class="ttdeci">@ kill_on_sight</div><div class="ttdef"><b>Definition:</b> <a href="faction_8h_source.html#l00050">faction.h:50</a></div></div>
<div class="ttc" id="anamespaceom__direction_html_a8ba958ccfad28c0a5572a04dd1428f32"><div class="ttname"><a href="namespaceom__direction.html#a8ba958ccfad28c0a5572a04dd1428f32">om_direction::name</a></div><div class="ttdeci">std::string name(type dir)</div><div class="ttdoc">Get Human readable name of a direction.</div><div class="ttdef"><b>Definition:</b> <a href="overmap_8cpp_source.html#l06412">overmap.cpp:6412</a></div></div>
<div class="ttc" id="anamespacesfx_html_a1f138eaa92db132e81ce591751c512cc"><div class="ttname"><a href="namespacesfx.html#a1f138eaa92db132e81ce591751c512cc">sfx::get_heard_volume</a></div><div class="ttdeci">int get_heard_volume(const tripoint &amp;source)</div><div class="ttdoc">Functions from sfx that do not use the SDL_mixer API at all.</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l02045">sounds.cpp:2045</a></div></div>
<div class="ttc" id="anamespacesfx_html_a8fa2bb887ac81392fb686cc4079b5d5a"><div class="ttname"><a href="namespacesfx.html#a8fa2bb887ac81392fb686cc4079b5d5a">sfx::play_variant_sound</a></div><div class="ttdeci">void play_variant_sound(const std::string &amp;id, const std::string &amp;variant, int volume, units::angle angle, double pitch_min=-1.0, double pitch_max=-1.0)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l01999">sounds.cpp:1999</a></div></div>
<div class="ttc" id="anamespacesfx_html_aa186eb63210729f73d7c76dcda527ff5"><div class="ttname"><a href="namespacesfx.html#aa186eb63210729f73d7c76dcda527ff5">sfx::get_heard_angle</a></div><div class="ttdeci">units::angle get_heard_angle(const tripoint &amp;source)</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8cpp_source.html#l02058">sounds.cpp:2058</a></div></div>
<div class="ttc" id="anamespacesounds_html_af6b3d144906d9ccfda6824fb87e46aa3"><div class="ttname"><a href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3">sounds::sound_t</a></div><div class="ttdeci">sound_t</div><div class="ttdef"><b>Definition:</b> <a href="sounds_8h_source.html#l00023">sounds.h:23</a></div></div>
<div class="ttc" id="anamespacesounds_html_af6b3d144906d9ccfda6824fb87e46aa3a7ed21143076d0cca420653d4345baa2f"><div class="ttname"><a href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a7ed21143076d0cca420653d4345baa2f">sounds::sound_t::alert</a></div><div class="ttdeci">@ alert</div></div>
<div class="ttc" id="anamespacesounds_html_af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14"><div class="ttname"><a href="namespacesounds.html#af6b3d144906d9ccfda6824fb87e46aa3a9b4a8a31b4caf3cc5c6205f74950ac14">sounds::sound_t::speech</a></div><div class="ttdeci">@ speech</div></div>
<div class="ttc" id="anamespacetalk__function_html_accec93a5f1d44d1c33929afb1d0cbd8b"><div class="ttname"><a href="namespacetalk__function.html#accec93a5f1d44d1c33929afb1d0cbd8b">talk_function::assign_guard</a></div><div class="ttdeci">void assign_guard(npc &amp;)</div><div class="ttdef"><b>Definition:</b> <a href="npctalk__funcs_8cpp_source.html#l00404">npctalk_funcs.cpp:404</a></div></div>
<div class="ttc" id="anamespaceunits_html_a86330975eec4fe39c48b40e85afe151b"><div class="ttname"><a href="namespaceunits.html#a86330975eec4fe39c48b40e85afe151b">units::fabs</a></div><div class="ttdeci">quantity&lt; V, U &gt; fabs(quantity&lt; V, U &gt; q)</div><div class="ttdef"><b>Definition:</b> <a href="units_8h_source.html#l00147">units.h:147</a></div></div>
<div class="ttc" id="anpc_8h_html"><div class="ttname"><a href="npc_8h.html">npc.h</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a133e55cc6929aff6e04ecd1f8720d279"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a133e55cc6929aff6e04ecd1f8720d279">NPCATT_FLEE</a></div><div class="ttdeci">@ NPCATT_FLEE</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00118">npc.h:118</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a174d99e8adde79268310f021427992a6">NPCATT_FLEE_TEMP</a></div><div class="ttdeci">@ NPCATT_FLEE_TEMP</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00125">npc.h:125</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a436461a7ac1efa5ec5f2d53ab20d2b67"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a436461a7ac1efa5ec5f2d53ab20d2b67">NPCATT_TALK</a></div><div class="ttdeci">@ NPCATT_TALK</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00108">npc.h:108</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a4a0667c489303f36ce9c33ace51e05e1"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4a0667c489303f36ce9c33ace51e05e1">NPCATT_LEAD</a></div><div class="ttdeci">@ NPCATT_LEAD</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00112">npc.h:112</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a4a9fa01afc4dc893941ef6a0639dd159"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4a9fa01afc4dc893941ef6a0639dd159">NPCATT_WAIT_FOR_LEAVE</a></div><div class="ttdeci">@ NPCATT_WAIT_FOR_LEAVE</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00116">npc.h:116</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a4bbe4dbeb972f2da0fcbba0a74cde9df"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a4bbe4dbeb972f2da0fcbba0a74cde9df">NPCATT_MUG</a></div><div class="ttdeci">@ NPCATT_MUG</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00115">npc.h:115</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a54aaedf3b06b118cd4d2ca5f63c8695b"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a54aaedf3b06b118cd4d2ca5f63c8695b">NPCATT_NULL</a></div><div class="ttdeci">@ NPCATT_NULL</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00107">npc.h:107</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a59e2eeab0c7bf7336d7c5fea3a870d2a"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a59e2eeab0c7bf7336d7c5fea3a870d2a">NPCATT_KILL</a></div><div class="ttdeci">@ NPCATT_KILL</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00117">npc.h:117</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4a9ccd3ddb03edb6e10f0987b46ffbcc53"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4a9ccd3ddb03edb6e10f0987b46ffbcc53">NPCATT_RECOVER_GOODS</a></div><div class="ttdeci">@ NPCATT_RECOVER_GOODS</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00126">npc.h:126</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4ae5449845013a531dc5def34dce450be9"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4ae5449845013a531dc5def34dce450be9">NPCATT_ACTIVITY</a></div><div class="ttdeci">@ NPCATT_ACTIVITY</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00124">npc.h:124</a></div></div>
<div class="ttc" id="anpc_8h_html_a0b36e2ae8f588616c1fd7a3788452cd4aee568a181e2bf1f4ef5122e0674b162d"><div class="ttname"><a href="npc_8h.html#a0b36e2ae8f588616c1fd7a3788452cd4aee568a181e2bf1f4ef5122e0674b162d">NPCATT_FOLLOW</a></div><div class="ttdeci">@ NPCATT_FOLLOW</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00110">npc.h:110</a></div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a2b753549e5a11f2c1b492fb205bdc142"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a2b753549e5a11f2c1b492fb205bdc142">ally_rule::use_grenades</a></div><div class="ttdeci">@ use_grenades</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a2dd1371f733f6bdb649c8d8a9a901a4d"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a2dd1371f733f6bdb649c8d8a9a901a4d">ally_rule::close_doors</a></div><div class="ttdeci">@ close_doors</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a35fb73b6c1f70edc7dcf1c30432c40fc">ally_rule::use_silent</a></div><div class="ttdeci">@ use_silent</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a4d86aa5b7cf26fbf7d1be4e398b2ce67"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a4d86aa5b7cf26fbf7d1be4e398b2ce67">ally_rule::allow_pulp</a></div><div class="ttdeci">@ allow_pulp</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a5be11a9176c3d5056b833343103f70f4"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5be11a9176c3d5056b833343103f70f4">ally_rule::use_guns</a></div><div class="ttdeci">@ use_guns</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a5c981fdb3be5e8bd1ef605268999b8de"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5c981fdb3be5e8bd1ef605268999b8de">ally_rule::follow_close</a></div><div class="ttdeci">@ follow_close</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a5d295cf614c72aacdee1110f17041ce7"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5d295cf614c72aacdee1110f17041ce7">ally_rule::allow_complain</a></div><div class="ttdeci">@ allow_complain</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7a5fa494c9a95b3ed02a550c0942ba972a"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7a5fa494c9a95b3ed02a550c0942ba972a">ally_rule::allow_bash</a></div><div class="ttdeci">@ allow_bash</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7aa76dfd34a015e77b9101e83caf2babca"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7aa76dfd34a015e77b9101e83caf2babca">ally_rule::forbid_engage</a></div><div class="ttdeci">@ forbid_engage</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7ab68510088c71b865b342aa91d94ac960"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7ab68510088c71b865b342aa91d94ac960">ally_rule::avoid_doors</a></div><div class="ttdeci">@ avoid_doors</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7ac8ea8849c8659b30517754be9a99c2d9"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7ac8ea8849c8659b30517754be9a99c2d9">ally_rule::lock_doors</a></div><div class="ttdeci">@ lock_doors</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7acd5a026299ddf6f44abcae44c3c7838d"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7acd5a026299ddf6f44abcae44c3c7838d">ally_rule::allow_sleep</a></div><div class="ttdeci">@ allow_sleep</div></div>
<div class="ttc" id="anpc_8h_html_a17a98cf2bbf4b15edc64dc7cc4b40cd7af71fc2d2d65b8777b95ddca9f1656de5"><div class="ttname"><a href="npc_8h.html#a17a98cf2bbf4b15edc64dc7cc4b40cd7af71fc2d2d65b8777b95ddca9f1656de5">ally_rule::allow_pick_up</a></div><div class="ttdeci">@ allow_pick_up</div></div>
<div class="ttc" id="anpc_8h_html_a1cfe07d375f7cf0b8c656a5bcae8fc6da2b39325e56b1d6ac9e564b19554b1427"><div class="ttname"><a href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6da2b39325e56b1d6ac9e564b19554b1427">NPC_MISSION_SHELTER</a></div><div class="ttdeci">@ NPC_MISSION_SHELTER</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00174">npc.h:174</a></div></div>
<div class="ttc" id="anpc_8h_html_a1cfe07d375f7cf0b8c656a5bcae8fc6da6255603e60fdb2f2d52b8b2ce4000f87"><div class="ttname"><a href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6da6255603e60fdb2f2d52b8b2ce4000f87">NPC_MISSION_NULL</a></div><div class="ttdeci">@ NPC_MISSION_NULL</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00172">npc.h:172</a></div></div>
<div class="ttc" id="anpc_8h_html_a1cfe07d375f7cf0b8c656a5bcae8fc6da821bc9455735440f71106a3f1dcb6eb9"><div class="ttname"><a href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6da821bc9455735440f71106a3f1dcb6eb9">NPC_MISSION_GUARD</a></div><div class="ttdeci">@ NPC_MISSION_GUARD</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00181">npc.h:181</a></div></div>
<div class="ttc" id="anpc_8h_html_a1cfe07d375f7cf0b8c656a5bcae8fc6dac33d9490a5bc6bebca7f66a94524600c"><div class="ttname"><a href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6dac33d9490a5bc6bebca7f66a94524600c">NPC_MISSION_SHOPKEEP</a></div><div class="ttdeci">@ NPC_MISSION_SHOPKEEP</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00175">npc.h:175</a></div></div>
<div class="ttc" id="anpc_8h_html_a1cfe07d375f7cf0b8c656a5bcae8fc6daf5b83209bc53322e7a58eecfb974a4ce"><div class="ttname"><a href="npc_8h.html#a1cfe07d375f7cf0b8c656a5bcae8fc6daf5b83209bc53322e7a58eecfb974a4ce">NPC_MISSION_TRAVELLING</a></div><div class="ttdeci">@ NPC_MISSION_TRAVELLING</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00185">npc.h:184</a></div></div>
<div class="ttc" id="anpc_8h_html_a39cae492faa89ce3a47d7990d249f5bc"><div class="ttname"><a href="npc_8h.html#a39cae492faa89ce3a47d7990d249f5bc">npc_threat_dir</a></div><div class="ttdeci">constexpr std::array&lt; direction, 8 &gt; npc_threat_dir</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00544">npc.h:544</a></div></div>
<div class="ttc" id="anpc_8h_html_a4bf0df99f8f4c40b1aa6efeb3030ddbb"><div class="ttname"><a href="npc_8h.html#a4bf0df99f8f4c40b1aa6efeb3030ddbb">NPC_DANGER_VERY_LOW</a></div><div class="ttdeci">constexpr float NPC_DANGER_VERY_LOW</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00062">npc.h:62</a></div></div>
<div class="ttc" id="anpc_8h_html_a6d922675388ced5c1cbddc237cc9e909"><div class="ttname"><a href="npc_8h.html#a6d922675388ced5c1cbddc237cc9e909">NPC_COWARDICE_MODIFIER</a></div><div class="ttdeci">constexpr float NPC_COWARDICE_MODIFIER</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00065">npc.h:65</a></div></div>
<div class="ttc" id="anpc_8h_html_a7c691bfc5c3e5258642bbd0e792d9613"><div class="ttname"><a href="npc_8h.html#a7c691bfc5c3e5258642bbd0e792d9613">npc_need</a></div><div class="ttdeci">npc_need</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00199">npc.h:199</a></div></div>
<div class="ttc" id="anpc_8h_html_a7c691bfc5c3e5258642bbd0e792d9613a1278f671ef69dc7000375b16c7f9acd0"><div class="ttname"><a href="npc_8h.html#a7c691bfc5c3e5258642bbd0e792d9613a1278f671ef69dc7000375b16c7f9acd0">need_safety</a></div><div class="ttdeci">@ need_safety</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00202">npc.h:202</a></div></div>
<div class="ttc" id="anpc_8h_html_a7c691bfc5c3e5258642bbd0e792d9613abc7c0212ffcf3e4900d0484af6c24a4b"><div class="ttname"><a href="npc_8h.html#a7c691bfc5c3e5258642bbd0e792d9613abc7c0212ffcf3e4900d0484af6c24a4b">need_none</a></div><div class="ttdeci">@ need_none</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00200">npc.h:200</a></div></div>
<div class="ttc" id="anpc_8h_html_a864e0cd11c91a60d35e050bbf1bdf1caa0e7cb16e5f3f61cb0c04b64d5cf5d7c8"><div class="ttname"><a href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa0e7cb16e5f3f61cb0c04b64d5cf5d7c8">combat_engagement::NO_MOVE</a></div><div class="ttdeci">@ NO_MOVE</div></div>
<div class="ttc" id="anpc_8h_html_a864e0cd11c91a60d35e050bbf1bdf1caa32c7d8943bec86a6d7d5e03598670ca8"><div class="ttname"><a href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa32c7d8943bec86a6d7d5e03598670ca8">combat_engagement::WEAK</a></div><div class="ttdeci">@ WEAK</div></div>
<div class="ttc" id="anpc_8h_html_a864e0cd11c91a60d35e050bbf1bdf1caa4e5e3542d523b7fb9c61887d5bb7d642"><div class="ttname"><a href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa4e5e3542d523b7fb9c61887d5bb7d642">combat_engagement::HIT</a></div><div class="ttdeci">@ HIT</div></div>
<div class="ttc" id="anpc_8h_html_a864e0cd11c91a60d35e050bbf1bdf1caa5fb1f955b45e38e31789286a1790398d"><div class="ttname"><a href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa5fb1f955b45e38e31789286a1790398d">combat_engagement::ALL</a></div><div class="ttdeci">@ ALL</div></div>
<div class="ttc" id="anpc_8h_html_a864e0cd11c91a60d35e050bbf1bdf1caa7286293c9125ac7d7bace94c190bc16d"><div class="ttname"><a href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caa7286293c9125ac7d7bace94c190bc16d">combat_engagement::CLOSE</a></div><div class="ttdeci">@ CLOSE</div></div>
<div class="ttc" id="anpc_8h_html_a864e0cd11c91a60d35e050bbf1bdf1caab50339a10e1de285ac99d4c3990b8693"><div class="ttname"><a href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caab50339a10e1de285ac99d4c3990b8693">combat_engagement::NONE</a></div><div class="ttdeci">@ NONE</div></div>
<div class="ttc" id="anpc_8h_html_a864e0cd11c91a60d35e050bbf1bdf1caabb0dbce1d639f9d5573a041e92d732d0"><div class="ttname"><a href="npc_8h.html#a864e0cd11c91a60d35e050bbf1bdf1caabb0dbce1d639f9d5573a041e92d732d0">combat_engagement::FREE_FIRE</a></div><div class="ttdeci">@ FREE_FIRE</div></div>
<div class="ttc" id="anpc_8h_html_aac445267b2e6dcbf2b74b97748b0cda8a6713ee5d6a814f247d20060e75e92c3c"><div class="ttname"><a href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8a6713ee5d6a814f247d20060e75e92c3c">aim_rule::WHEN_CONVENIENT</a></div><div class="ttdeci">@ WHEN_CONVENIENT</div></div>
<div class="ttc" id="anpc_8h_html_aac445267b2e6dcbf2b74b97748b0cda8a8643d6bba01bb025d7510abe977fb486"><div class="ttname"><a href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8a8643d6bba01bb025d7510abe977fb486">aim_rule::STRICTLY_PRECISE</a></div><div class="ttdeci">@ STRICTLY_PRECISE</div></div>
<div class="ttc" id="anpc_8h_html_aac445267b2e6dcbf2b74b97748b0cda8ad911f54dde5284c4fd43c76c678b8b92"><div class="ttname"><a href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8ad911f54dde5284c4fd43c76c678b8b92">aim_rule::SPRAY</a></div><div class="ttdeci">@ SPRAY</div></div>
<div class="ttc" id="anpc_8h_html_aac445267b2e6dcbf2b74b97748b0cda8af6cdc115da7ee195766ffc5b7bddd823"><div class="ttname"><a href="npc_8h.html#aac445267b2e6dcbf2b74b97748b0cda8af6cdc115da7ee195766ffc5b7bddd823">aim_rule::PRECISE</a></div><div class="ttdeci">@ PRECISE</div></div>
<div class="ttc" id="anpc_8h_html_ac7e18ce0c0dbb21cd2896172414785f2"><div class="ttname"><a href="npc_8h.html#ac7e18ce0c0dbb21cd2896172414785f2">NPC_CHARACTER_DANGER_MAX</a></div><div class="ttdeci">constexpr float NPC_CHARACTER_DANGER_MAX</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00064">npc.h:64</a></div></div>
<div class="ttc" id="anpc_8h_html_ae99b5e394b70686a4ee829b7b8bfb492"><div class="ttname"><a href="npc_8h.html#ae99b5e394b70686a4ee829b7b8bfb492">NPC_MONSTER_DANGER_MAX</a></div><div class="ttdeci">constexpr float NPC_MONSTER_DANGER_MAX</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00063">npc.h:63</a></div></div>
<div class="ttc" id="anpc_8h_html_aee50a2d29c2194e6df726113b025e55b"><div class="ttname"><a href="npc_8h.html#aee50a2d29c2194e6df726113b025e55b">parse_tags</a></div><div class="ttdeci">void parse_tags(std::string &amp;phrase, const Character &amp;u, const Character &amp;me, const itype_id &amp;item_type=itype_id::NULL_ID())</div><div class="ttdef"><b>Definition:</b> <a href="npctalk_8cpp_source.html#l02056">npctalk.cpp:2056</a></div></div>
<div class="ttc" id="anpc__attack_8h_html"><div class="ttname"><a href="npc__attack_8h.html">npc_attack.h</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a0313dde9b91b312463fd84bf985b42a6"><div class="ttname"><a href="npcmove_8cpp.html#a0313dde9b91b312463fd84bf985b42a6">ACT_MOVE_LOOT</a></div><div class="ttdeci">static const activity_id ACT_MOVE_LOOT(&quot;ACT_MOVE_LOOT&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a04a78b20202d905c65011e5f8b51db43"><div class="ttname"><a href="npcmove_8cpp.html#a04a78b20202d905c65011e5f8b51db43">effect_npc_player_still_looking</a></div><div class="ttdeci">static const efftype_id effect_npc_player_still_looking(&quot;npc_player_still_looking&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a0dea205d5b8aa85ab213a0b84fa3a006"><div class="ttname"><a href="npcmove_8cpp.html#a0dea205d5b8aa85ab213a0b84fa3a006">NPC_THIRST_COMPLAIN</a></div><div class="ttdeci">static constexpr int NPC_THIRST_COMPLAIN</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00162">npcmove.cpp:162</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a151e6b162a8a2cdbdb11c407013076eb"><div class="ttname"><a href="npcmove_8cpp.html#a151e6b162a8a2cdbdb11c407013076eb">effect_bleed</a></div><div class="ttdeci">static const efftype_id effect_bleed(&quot;bleed&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a15450ecf5b34a615affe959125bf1626"><div class="ttname"><a href="npcmove_8cpp.html#a15450ecf5b34a615affe959125bf1626">bio_painkiller</a></div><div class="ttdeci">static const bionic_id bio_painkiller(&quot;bio_painkiller&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a157369b3ee1f3f5a889eb1d42ed97638"><div class="ttname"><a href="npcmove_8cpp.html#a157369b3ee1f3f5a889eb1d42ed97638">damage_bash</a></div><div class="ttdeci">static const damage_type_id damage_bash(&quot;bash&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a17d3c36ed4f9d4a8ffbd459b7c51e0c3"><div class="ttname"><a href="npcmove_8cpp.html#a17d3c36ed4f9d4a8ffbd459b7c51e0c3">nearest_passable</a></div><div class="ttdeci">static std::optional&lt; tripoint &gt; nearest_passable(const tripoint &amp;p, const tripoint &amp;closest_to)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03401">npcmove.cpp:3401</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a196db59a96c71a1c30a1abca71cf0431"><div class="ttname"><a href="npcmove_8cpp.html#a196db59a96c71a1c30a1abca71cf0431">npc_throw</a></div><div class="ttdeci">static void npc_throw(npc &amp;np, item &amp;it, const tripoint &amp;pos)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04156">npcmove.cpp:4156</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a1de43fa1f6d16ce87ab7a3a49e47c463"><div class="ttname"><a href="npcmove_8cpp.html#a1de43fa1f6d16ce87ab7a3a49e47c463">effect_infected</a></div><div class="ttdeci">static const efftype_id effect_infected(&quot;infected&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a2ab46842d379637d4d5711e46f5333b6"><div class="ttname"><a href="npcmove_8cpp.html#a2ab46842d379637d4d5711e46f5333b6">bio_blade</a></div><div class="ttdeci">static const bionic_id bio_blade(&quot;bio_blade&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a2dde49329eef942ec57d25db274942c0"><div class="ttname"><a href="npcmove_8cpp.html#a2dde49329eef942ec57d25db274942c0">effect_asthma</a></div><div class="ttdeci">static const efftype_id effect_asthma(&quot;asthma&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a31e2ef0b23e31f445746b9eaabbeb600"><div class="ttname"><a href="npcmove_8cpp.html#a31e2ef0b23e31f445746b9eaabbeb600">field_fd_last_known</a></div><div class="ttdeci">static const field_type_str_id field_fd_last_known(&quot;fd_last_known&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a32365a2b41e9af647ec05fbdea50ba90"><div class="ttname"><a href="npcmove_8cpp.html#a32365a2b41e9af647ec05fbdea50ba90">too_close</a></div><div class="ttdeci">static bool too_close(const tripoint &amp;critter_pos, const tripoint &amp;ally_pos, const int def_radius)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00682">npcmove.cpp:682</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a35045bcfd0e1c55fb7e9b88d8e36a614"><div class="ttname"><a href="npcmove_8cpp.html#a35045bcfd0e1c55fb7e9b88d8e36a614">damage_bullet</a></div><div class="ttdeci">static const damage_type_id damage_bullet(&quot;bullet&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a37e77cfc4ad1ad149440b37a4a9e1500"><div class="ttname"><a href="npcmove_8cpp.html#a37e77cfc4ad1ad149440b37a4a9e1500">NPC_HUNGER_CONSUME</a></div><div class="ttdeci">static constexpr int NPC_HUNGER_CONSUME</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00163">npcmove.cpp:163</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a39b21fc30fecd7d4fb15047600d03522"><div class="ttname"><a href="npcmove_8cpp.html#a39b21fc30fecd7d4fb15047600d03522">effect_bite</a></div><div class="ttdeci">static const efftype_id effect_bite(&quot;bite&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a3ba251501edde65d85515f5febd2fd8b"><div class="ttname"><a href="npcmove_8cpp.html#a3ba251501edde65d85515f5febd2fd8b">ACT_TIDY_UP</a></div><div class="ttdeci">static const activity_id ACT_TIDY_UP(&quot;ACT_TIDY_UP&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a3bad9376f4cd7fb97bfad7d8dfef4301"><div class="ttname"><a href="npcmove_8cpp.html#a3bad9376f4cd7fb97bfad7d8dfef4301">itype_lsd</a></div><div class="ttdeci">static const itype_id itype_lsd(&quot;lsd&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a3bfe78dbc0d8cfc6819f0f24c7729adc"><div class="ttname"><a href="npcmove_8cpp.html#a3bfe78dbc0d8cfc6819f0f24c7729adc">bio_nanobots</a></div><div class="ttdeci">static const bionic_id bio_nanobots(&quot;bio_nanobots&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a42653f931f94e236c64920609e0b0279"><div class="ttname"><a href="npcmove_8cpp.html#a42653f931f94e236c64920609e0b0279">rate_food</a></div><div class="ttdeci">static float rate_food(const item &amp;it, int want_nutr, int want_quench)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l04450">npcmove.cpp:4450</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a4424b509877ff458aa661c2b49a99dda"><div class="ttname"><a href="npcmove_8cpp.html#a4424b509877ff458aa661c2b49a99dda">bio_hydraulics</a></div><div class="ttdeci">static const bionic_id bio_hydraulics(&quot;bio_hydraulics&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a44adef81192d43188ce1a50f4b41bb3b"><div class="ttname"><a href="npcmove_8cpp.html#a44adef81192d43188ce1a50f4b41bb3b">itype_oxygen_tank</a></div><div class="ttdeci">static const itype_id itype_oxygen_tank(&quot;oxygen_tank&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a451b6bd6a61cf87421914613a235d819"><div class="ttname"><a href="npcmove_8cpp.html#a451b6bd6a61cf87421914613a235d819">form_loc_recursive</a></div><div class="ttdeci">static item_location form_loc_recursive(Character *npc, item *node, item *parent)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02099">npcmove.cpp:2099</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a45f8e2064814b10b3c8d0c5de0995db4"><div class="ttname"><a href="npcmove_8cpp.html#a45f8e2064814b10b3c8d0c5de0995db4">itype_thorazine</a></div><div class="ttdeci">static const itype_id itype_thorazine(&quot;thorazine&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a47a308d1260b0a61e3ac9f492d1159ca"><div class="ttname"><a href="npcmove_8cpp.html#a47a308d1260b0a61e3ac9f492d1159ca">zone_type_NO_NPC_PICKUP</a></div><div class="ttdeci">static const zone_type_id zone_type_NO_NPC_PICKUP(&quot;NO_NPC_PICKUP&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a47b7446e791f3b97d961376a99f71c5c"><div class="ttname"><a href="npcmove_8cpp.html#a47b7446e791f3b97d961376a99f71c5c">bio_chain_lightning</a></div><div class="ttdeci">static const bionic_id bio_chain_lightning(&quot;bio_chain_lightning&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a4de2ef4c2e145815427b09adfaa0def5"><div class="ttname"><a href="npcmove_8cpp.html#a4de2ef4c2e145815427b09adfaa0def5">effect_hit_by_player</a></div><div class="ttdeci">static const efftype_id effect_hit_by_player(&quot;hit_by_player&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a4df4d1902dc88952a51b05cf60c02753"><div class="ttname"><a href="npcmove_8cpp.html#a4df4d1902dc88952a51b05cf60c02753">itype_inhaler</a></div><div class="ttdeci">static const itype_id itype_inhaler(&quot;inhaler&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a529eaf0b3181b88487e110193c6d9986"><div class="ttname"><a href="npcmove_8cpp.html#a529eaf0b3181b88487e110193c6d9986">itype_smoxygen_tank</a></div><div class="ttdeci">static const itype_id itype_smoxygen_tank(&quot;smoxygen_tank&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a63e5739b23bda74126ceb8fbb66e502b"><div class="ttname"><a href="npcmove_8cpp.html#a63e5739b23bda74126ceb8fbb66e502b">ACT_OPERATION</a></div><div class="ttdeci">static const activity_id ACT_OPERATION(&quot;ACT_OPERATION&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a6bd7c8b57b582cbee241e6bbf8e51998"><div class="ttname"><a href="npcmove_8cpp.html#a6bd7c8b57b582cbee241e6bbf8e51998">NPC_THIRST_CONSUME</a></div><div class="ttdeci">static constexpr int NPC_THIRST_CONSUME</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00161">npcmove.cpp:161</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a765cb5e0b9669d9f0c218356ed53bfea"><div class="ttname"><a href="npcmove_8cpp.html#a765cb5e0b9669d9f0c218356ed53bfea">bio_ods</a></div><div class="ttdeci">static const bionic_id bio_ods(&quot;bio_ods&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7997463407ad7a54a4e46c55e1d11e23"><div class="ttname"><a href="npcmove_8cpp.html#a7997463407ad7a54a4e46c55e1d11e23">npc_pickup_from_stack</a></div><div class="ttdeci">std::list&lt; item &gt; npc_pickup_from_stack(npc &amp;who, T &amp;items)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l03771">npcmove.cpp:3771</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c2a13f94c0d13712af84b23f13e788f"><div class="ttname"><a href="npcmove_8cpp.html#a7c2a13f94c0d13712af84b23f13e788f">effect_bandaged</a></div><div class="ttdeci">static const efftype_id effect_bandaged(&quot;bandaged&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7">npc_action</a></div><div class="ttdeci">npc_action</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00166">npcmove.cpp:166</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a058b148b092d45266de475aa2281477b"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a058b148b092d45266de475aa2281477b">npc_worker_downtime</a></div><div class="ttdeci">@ npc_worker_downtime</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00186">npcmove.cpp:186</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a06ebb628884ecce6136bb9a6040bab9b"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a06ebb628884ecce6136bb9a6040bab9b">num_npc_actions</a></div><div class="ttdeci">@ num_npc_actions</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00188">npcmove.cpp:187</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a091d199710609af1bf3ff105b43453d5">npc_investigate_sound</a></div><div class="ttdeci">@ npc_investigate_sound</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00183">npcmove.cpp:183</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1acf1db108dede49616801b1e7cb295f">npc_goto_destination</a></div><div class="ttdeci">@ npc_goto_destination</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00176">npcmove.cpp:176</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a1b0dd2cfef9c4f9a367079199c7c80af"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1b0dd2cfef9c4f9a367079199c7c80af">npc_melee</a></div><div class="ttdeci">@ npc_melee</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00172">npcmove.cpp:172</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a1c5faa755f1cd29189d4e164dd3b1411"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a1c5faa755f1cd29189d4e164dd3b1411">npc_sleep</a></div><div class="ttdeci">@ npc_sleep</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00169">npcmove.cpp:169</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a30c4f16c4a66425e87f3e462c987d762"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a30c4f16c4a66425e87f3e462c987d762">npc_talk_to_player</a></div><div class="ttdeci">@ npc_talk_to_player</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00174">npcmove.cpp:174</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a320566dc8704d228e05b9fa1191726d8"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a320566dc8704d228e05b9fa1191726d8">npc_goto_to_this_pos</a></div><div class="ttdeci">@ npc_goto_to_this_pos</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00175">npcmove.cpp:175</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a34e61bbbaf8abebf63326320fec60c53"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a34e61bbbaf8abebf63326320fec60c53">npc_reload</a></div><div class="ttdeci">@ npc_reload</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00169">npcmove.cpp:169</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3689e79b49a193d9a17ac01a98fd4a55">npc_pause</a></div><div class="ttdeci">@ npc_pause</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00168">npcmove.cpp:168</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a3a4fe08fa3d733f7956e1c5692e1a3da"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a3a4fe08fa3d733f7956e1c5692e1a3da">npc_reach_attack</a></div><div class="ttdeci">@ npc_reach_attack</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00180">npcmove.cpp:180</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a43a9588bdb418b797338e9ea2200ef2e">npc_noop</a></div><div class="ttdeci">@ npc_noop</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00179">npcmove.cpp:179</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a48cceb4e0db33f4525fee6c3f7c7924d"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a48cceb4e0db33f4525fee6c3f7c7924d">npc_shoot</a></div><div class="ttdeci">@ npc_shoot</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00172">npcmove.cpp:172</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a4c50de30d1fe74ad9f2f7146ef81ede1"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a4c50de30d1fe74ad9f2f7146ef81ede1">npc_drop_items</a></div><div class="ttdeci">@ npc_drop_items</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00171">npcmove.cpp:171</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a520eb27da7595d67744500c34417615d">npc_flee</a></div><div class="ttdeci">@ npc_flee</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00172">npcmove.cpp:172</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a55a7ea511d5d1d406ea6edfb96a65c56"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a55a7ea511d5d1d406ea6edfb96a65c56">npc_look_for_player</a></div><div class="ttdeci">@ npc_look_for_player</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00173">npcmove.cpp:173</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6844b9197cb7aeed902bccab6e873e4e">npc_return_to_guard_pos</a></div><div class="ttdeci">@ npc_return_to_guard_pos</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00184">npcmove.cpp:184</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a6afb1482ed3f94beb6473c2f9b3b8189"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6afb1482ed3f94beb6473c2f9b3b8189">npc_avoid_friendly_fire</a></div><div class="ttdeci">@ npc_avoid_friendly_fire</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00177">npcmove.cpp:177</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a6fd72bcdd3524d15de954838ceb03e5a"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a6fd72bcdd3524d15de954838ceb03e5a">npc_escape_explosion</a></div><div class="ttdeci">@ npc_escape_explosion</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00178">npcmove.cpp:178</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a82965fc7cec7bafbe6a94100f689895d"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a82965fc7cec7bafbe6a94100f689895d">npc_pickup</a></div><div class="ttdeci">@ npc_pickup</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00170">npcmove.cpp:170</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a85155639ee95331052d51900b16fdbb1"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a85155639ee95331052d51900b16fdbb1">npc_mug_player</a></div><div class="ttdeci">@ npc_mug_player</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00174">npcmove.cpp:174</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a957620d09d9a4969916ad00c4ec50a07">npc_undecided</a></div><div class="ttdeci">@ npc_undecided</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00167">npcmove.cpp:167</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9709b18549143bed7e5cf29e02e65f82">npc_follow_player</a></div><div class="ttdeci">@ npc_follow_player</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00173">npcmove.cpp:173</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7a9c46449f66af0d972656ec500f4d39ba"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7a9c46449f66af0d972656ec500f4d39ba">npc_heal_player</a></div><div class="ttdeci">@ npc_heal_player</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00173">npcmove.cpp:173</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7aa5aba4596218f4103a32d1515d8bdab0">npc_player_activity</a></div><div class="ttdeci">@ npc_player_activity</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00185">npcmove.cpp:185</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7ab3ea6db7edf0f1efbf6082d8b7307d15"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ab3ea6db7edf0f1efbf6082d8b7307d15">npc_use_painkiller</a></div><div class="ttdeci">@ npc_use_painkiller</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00171">npcmove.cpp:171</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7ad178d28c383136b41476fe0df9c71306"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ad178d28c383136b41476fe0df9c71306">npc_aim</a></div><div class="ttdeci">@ npc_aim</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00182">npcmove.cpp:182</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7ae7395a29bb423bfddfba92378abe9a27"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7ae7395a29bb423bfddfba92378abe9a27">npc_do_attack</a></div><div class="ttdeci">@ npc_do_attack</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00181">npcmove.cpp:181</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af446f836ab49f08db0f16c95e6f26c85">npc_follow_embarked</a></div><div class="ttdeci">@ npc_follow_embarked</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00173">npcmove.cpp:173</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a7c7cb0a59b3544321a40899fa7b4ced7af8a5950d177e7da5bb22362a7e8949c1"><div class="ttname"><a href="npcmove_8cpp.html#a7c7cb0a59b3544321a40899fa7b4ced7af8a5950d177e7da5bb22362a7e8949c1">npc_heal</a></div><div class="ttdeci">@ npc_heal</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00171">npcmove.cpp:171</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a86688811514622ffd567dd7a15f31ebf"><div class="ttname"><a href="npcmove_8cpp.html#a86688811514622ffd567dd7a15f31ebf">MAX_FLOAT</a></div><div class="ttdeci">static constexpr float MAX_FLOAT</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00155">npcmove.cpp:155</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a86707315539643dbc391ad64dfbc2765"><div class="ttname"><a href="npcmove_8cpp.html#a86707315539643dbc391ad64dfbc2765">ACT_SPELLCASTING</a></div><div class="ttdeci">static const activity_id ACT_SPELLCASTING(&quot;ACT_SPELLCASTING&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a8d1c3c3d8e1c9281ac6f0a333487c414"><div class="ttname"><a href="npcmove_8cpp.html#a8d1c3c3d8e1c9281ac6f0a333487c414">npc_action_name</a></div><div class="ttdeci">static std::string npc_action_name(npc_action action)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05021">npcmove.cpp:5021</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_a91c01a2c4b936068b288514db0a639b5"><div class="ttname"><a href="npcmove_8cpp.html#a91c01a2c4b936068b288514db0a639b5">bio_laser</a></div><div class="ttdeci">static const bionic_id bio_laser(&quot;bio_laser&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a9719257cccee9b21df38a95f2ca195fa"><div class="ttname"><a href="npcmove_8cpp.html#a9719257cccee9b21df38a95f2ca195fa">bio_shock</a></div><div class="ttdeci">static const bionic_id bio_shock(&quot;bio_shock&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a97652b813a5499a1076967dbc4bd892f"><div class="ttname"><a href="npcmove_8cpp.html#a97652b813a5499a1076967dbc4bd892f">bio_heat_absorb</a></div><div class="ttdeci">static const bionic_id bio_heat_absorb(&quot;bio_heat_absorb&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a978adf30232e0bcf1b9d38a73b8dd30e"><div class="ttname"><a href="npcmove_8cpp.html#a978adf30232e0bcf1b9d38a73b8dd30e">bio_soporific</a></div><div class="ttdeci">static const bionic_id bio_soporific(&quot;bio_soporific&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a9875fb4a0c27055032f55b2fb787a183"><div class="ttname"><a href="npcmove_8cpp.html#a9875fb4a0c27055032f55b2fb787a183">bio_claws</a></div><div class="ttdeci">static const bionic_id bio_claws(&quot;bio_claws&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a998c1f0ad926f40dc54ed31ef34e105e"><div class="ttname"><a href="npcmove_8cpp.html#a998c1f0ad926f40dc54ed31ef34e105e">ACT_CRAFT</a></div><div class="ttdeci">static const activity_id ACT_CRAFT(&quot;ACT_CRAFT&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a99bde006d277d411e266b003163d9f05"><div class="ttname"><a href="npcmove_8cpp.html#a99bde006d277d411e266b003163d9f05">bio_ads</a></div><div class="ttdeci">static const bionic_id bio_ads(&quot;bio_ads&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_a9c88573bcf0c9acc70c79864f6b0e433"><div class="ttname"><a href="npcmove_8cpp.html#a9c88573bcf0c9acc70c79864f6b0e433">bio_leukocyte</a></div><div class="ttdeci">static const bionic_id bio_leukocyte(&quot;bio_leukocyte&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_aa3320a370fe1f7f1cf6e14918ca20358"><div class="ttname"><a href="npcmove_8cpp.html#aa3320a370fe1f7f1cf6e14918ca20358">effect_bouldering</a></div><div class="ttdeci">static const efftype_id effect_bouldering(&quot;bouldering&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_aa420c555e4d3d6c14ef7fcc8c1ab76a7"><div class="ttname"><a href="npcmove_8cpp.html#aa420c555e4d3d6c14ef7fcc8c1ab76a7">bio_faraday</a></div><div class="ttdeci">static const bionic_id bio_faraday(&quot;bio_faraday&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_aa597fc724fe51584e998a3e4fbfaa2bc"><div class="ttname"><a href="npcmove_8cpp.html#aa597fc724fe51584e998a3e4fbfaa2bc">wants_to_reload</a></div><div class="ttdeci">static bool wants_to_reload(const npc &amp;guy, const item &amp;candidate)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02061">npcmove.cpp:2061</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_aa93f72dcd6663590417f2f8fd001d032"><div class="ttname"><a href="npcmove_8cpp.html#aa93f72dcd6663590417f2f8fd001d032">ACT_PULP</a></div><div class="ttdeci">static const activity_id ACT_PULP(&quot;ACT_PULP&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_aad2dc5891bcab35900a7abbe32f8f257"><div class="ttname"><a href="npcmove_8cpp.html#aad2dc5891bcab35900a7abbe32f8f257">NC_EVAC_SHOPKEEP</a></div><div class="ttdeci">static const npc_class_id NC_EVAC_SHOPKEEP(&quot;NC_EVAC_SHOPKEEP&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_aaf598d0fedebd89ec20f768da3b5fd8a"><div class="ttname"><a href="npcmove_8cpp.html#aaf598d0fedebd89ec20f768da3b5fd8a">skill_firstaid</a></div><div class="ttdeci">static const skill_id skill_firstaid(&quot;firstaid&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ab79bc462345c02553b997c0ab7489bf2"><div class="ttname"><a href="npcmove_8cpp.html#ab79bc462345c02553b997c0ab7489bf2">bio_plutfilter</a></div><div class="ttdeci">static const bionic_id bio_plutfilter(&quot;bio_plutfilter&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ab7fca7b08d020989cad3cfad9e31c274"><div class="ttname"><a href="npcmove_8cpp.html#ab7fca7b08d020989cad3cfad9e31c274">bio_radscrubber</a></div><div class="ttdeci">static const bionic_id bio_radscrubber(&quot;bio_radscrubber&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ab987f0249d5dcb5a351fe48ffebffc55"><div class="ttname"><a href="npcmove_8cpp.html#ab987f0249d5dcb5a351fe48ffebffc55">effect_hypovolemia</a></div><div class="ttdeci">static const efftype_id effect_hypovolemia(&quot;hypovolemia&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_abac12fbba640bf269c53ef2030b9b0e3"><div class="ttname"><a href="npcmove_8cpp.html#abac12fbba640bf269c53ef2030b9b0e3">effect_npc_fire_bad</a></div><div class="ttdeci">static const efftype_id effect_npc_fire_bad(&quot;npc_fire_bad&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_abb15a2e894a280b84a6cb51ea9761fa6"><div class="ttname"><a href="npcmove_8cpp.html#abb15a2e894a280b84a6cb51ea9761fa6">wants_to_reload_with</a></div><div class="ttdeci">static bool wants_to_reload_with(const item &amp;weap, const item &amp;ammo)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l02093">npcmove.cpp:2093</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_abf2f82354556637a79e1feecad2969b9"><div class="ttname"><a href="npcmove_8cpp.html#abf2f82354556637a79e1feecad2969b9">zone_type_NPC_RETREAT</a></div><div class="ttdeci">static const zone_type_id zone_type_NPC_RETREAT(&quot;NPC_RETREAT&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ac9543c508e08b7d10d19ecb5f80e1b1c"><div class="ttname"><a href="npcmove_8cpp.html#ac9543c508e08b7d10d19ecb5f80e1b1c">effect_catch_up</a></div><div class="ttdeci">static const efftype_id effect_catch_up(&quot;catch_up&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ac95fd54d69ea350ea463a719fa7f3550"><div class="ttname"><a href="npcmove_8cpp.html#ac95fd54d69ea350ea463a719fa7f3550">effect_lying_down</a></div><div class="ttdeci">static const efftype_id effect_lying_down(&quot;lying_down&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_acdc2d231ebdbf7d9571d84ebe9993c5f"><div class="ttname"><a href="npcmove_8cpp.html#acdc2d231ebdbf7d9571d84ebe9993c5f">ACT_FIRSTAID</a></div><div class="ttdeci">static const activity_id ACT_FIRSTAID(&quot;ACT_FIRSTAID&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_acecb5c4379ee38c8382ddfa3c9a1a6d0"><div class="ttname"><a href="npcmove_8cpp.html#acecb5c4379ee38c8382ddfa3c9a1a6d0">clear_shot_reach</a></div><div class="ttdeci">static bool clear_shot_reach(const tripoint &amp;from, const tripoint &amp;to, bool check_ally=true)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00242">npcmove.cpp:242</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_ad1df0ca2944a94c3ad796e8baada33ae"><div class="ttname"><a href="npcmove_8cpp.html#ad1df0ca2944a94c3ad796e8baada33ae">effect_stunned</a></div><div class="ttdeci">static const efftype_id effect_stunned(&quot;stunned&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ad6fd62a9ed571c6bf17d577118be3c5a"><div class="ttname"><a href="npcmove_8cpp.html#ad6fd62a9ed571c6bf17d577118be3c5a">effect_stumbled_into_invisible</a></div><div class="ttdeci">static const efftype_id effect_stumbled_into_invisible(&quot;stumbled_into_invisible&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ad877460e5d6752cbcf4a1698032c702b"><div class="ttname"><a href="npcmove_8cpp.html#ad877460e5d6752cbcf4a1698032c702b">effect_npc_run_away</a></div><div class="ttdeci">static const efftype_id effect_npc_run_away(&quot;npc_run_away&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_adcaf70773541073a0d4cdfce4b857bf7"><div class="ttname"><a href="npcmove_8cpp.html#adcaf70773541073a0d4cdfce4b857bf7">effect_psi_stunned</a></div><div class="ttdeci">static const efftype_id effect_psi_stunned(&quot;psi_stunned&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_adcc47d614ba63ddb056307153d5ac06c"><div class="ttname"><a href="npcmove_8cpp.html#adcc47d614ba63ddb056307153d5ac06c">effect_disinfected</a></div><div class="ttdeci">static const efftype_id effect_disinfected(&quot;disinfected&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_adf56eab61890bbb283d4dbd7d26dde16"><div class="ttname"><a href="npcmove_8cpp.html#adf56eab61890bbb283d4dbd7d26dde16">trait_IGNORE_SOUND</a></div><div class="ttdeci">static const trait_id trait_IGNORE_SOUND(&quot;IGNORE_SOUND&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_ae04afbed56ed2363a8752a5dc0200b1b"><div class="ttname"><a href="npcmove_8cpp.html#ae04afbed56ed2363a8752a5dc0200b1b">bp_affected</a></div><div class="ttdeci">static bodypart_id bp_affected(npc &amp;who, const efftype_id &amp;effect_type)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05125">npcmove.cpp:5125</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_ae2002588c2e33a355ee6f1416df681e3"><div class="ttname"><a href="npcmove_8cpp.html#ae2002588c2e33a355ee6f1416df681e3">NPC_HUNGER_COMPLAIN</a></div><div class="ttdeci">static constexpr int NPC_HUNGER_COMPLAIN</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00164">npcmove.cpp:164</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_ae392542982be57abf21e9253ea942d4e"><div class="ttname"><a href="npcmove_8cpp.html#ae392542982be57abf21e9253ea942d4e">trait_RETURN_TO_START_POS</a></div><div class="ttdeci">static const trait_id trait_RETURN_TO_START_POS(&quot;RETURN_TO_START_POS&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_aecd517a9e74b5a5a21f0c75f88f50090"><div class="ttname"><a href="npcmove_8cpp.html#aecd517a9e74b5a5a21f0c75f88f50090">damage_cut</a></div><div class="ttdeci">static const damage_type_id damage_cut(&quot;cut&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_af079f6d5681dabcbc1c4ee804c0ba556"><div class="ttname"><a href="npcmove_8cpp.html#af079f6d5681dabcbc1c4ee804c0ba556">effect_no_sight</a></div><div class="ttdeci">static const efftype_id effect_no_sight(&quot;no_sight&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_af198a4e5b75aadbc020ee447fd31226b"><div class="ttname"><a href="npcmove_8cpp.html#af198a4e5b75aadbc020ee447fd31226b">bio_heatsink</a></div><div class="ttdeci">static const bionic_id bio_heatsink(&quot;bio_heatsink&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_af3afed1385da7b6a13a6acc3a7cc0609"><div class="ttname"><a href="npcmove_8cpp.html#af3afed1385da7b6a13a6acc3a7cc0609">print_action</a></div><div class="ttdeci">static void print_action(const char *prepend, npc_action action)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l05089">npcmove.cpp:5089</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_afbadedc2f23ae322e4a2e30157fd0585"><div class="ttname"><a href="npcmove_8cpp.html#afbadedc2f23ae322e4a2e30157fd0585">compare_sound_alert</a></div><div class="ttdeci">static bool compare_sound_alert(const dangerous_sound &amp;sound_a, const dangerous_sound &amp;sound_b)</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00234">npcmove.cpp:234</a></div></div>
<div class="ttc" id="anpcmove_8cpp_html_afcfa82c36c0dc2d76cd19d622c2b6ab4"><div class="ttname"><a href="npcmove_8cpp.html#afcfa82c36c0dc2d76cd19d622c2b6ab4">effect_onfire</a></div><div class="ttdeci">static const efftype_id effect_onfire(&quot;onfire&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_afdae56eafce50b1f873673574188aca8"><div class="ttname"><a href="npcmove_8cpp.html#afdae56eafce50b1f873673574188aca8">damage_stab</a></div><div class="ttdeci">static const damage_type_id damage_stab(&quot;stab&quot;)</div></div>
<div class="ttc" id="anpcmove_8cpp_html_afdcaa355e9fb31990b6222e12cc0416a"><div class="ttname"><a href="npcmove_8cpp.html#afdcaa355e9fb31990b6222e12cc0416a">effect_npc_flee_player</a></div><div class="ttdeci">static const efftype_id effect_npc_flee_player(&quot;npc_flee_player&quot;)</div></div>
<div class="ttc" id="anpctalk_8h_html"><div class="ttname"><a href="npctalk_8h.html">npctalk.h</a></div></div>
<div class="ttc" id="aomdata_8h_html"><div class="ttname"><a href="omdata_8h.html">omdata.h</a></div></div>
<div class="ttc" id="aomdata_8h_html_a34fa26d94d253aff79aacd4ffbc1505daf5e7a346d6681f66585d00619d9e1d65"><div class="ttname"><a href="omdata_8h.html#a34fa26d94d253aff79aacd4ffbc1505daf5e7a346d6681f66585d00619d9e1d65">oter_travel_cost_type::impassable</a></div><div class="ttdeci">@ impassable</div></div>
<div class="ttc" id="aoptions_8h_html"><div class="ttname"><a href="options_8h.html">options.h</a></div></div>
<div class="ttc" id="aovermap_8h_html"><div class="ttname"><a href="overmap_8h.html">overmap.h</a></div></div>
<div class="ttc" id="aovermap__location_8h_html"><div class="ttname"><a href="overmap__location_8h.html">overmap_location.h</a></div></div>
<div class="ttc" id="aovermapbuffer_8cpp_html_ab3cf8344ec3e473f9ce96a33dc3425af"><div class="ttname"><a href="overmapbuffer_8cpp.html#ab3cf8344ec3e473f9ce96a33dc3425af">overmap_buffer</a></div><div class="ttdeci">overmapbuffer overmap_buffer</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8cpp_source.html#l00051">overmapbuffer.cpp:51</a></div></div>
<div class="ttc" id="aovermapbuffer_8h_html"><div class="ttname"><a href="overmapbuffer_8h.html">overmapbuffer.h</a></div></div>
<div class="ttc" id="aplayer__activity_8h_html"><div class="ttname"><a href="player__activity_8h.html">player_activity.h</a></div></div>
<div class="ttc" id="apoint_8h_html_a4b1a6bcaa42d2c06ecc3afc63305bfdf"><div class="ttname"><a href="point_8h.html#a4b1a6bcaa42d2c06ecc3afc63305bfdf">tripoint_zero</a></div><div class="ttdeci">constexpr tripoint tripoint_zero</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00250">point.h:250</a></div></div>
<div class="ttc" id="aprojectile_8h_html"><div class="ttname"><a href="projectile_8h.html">projectile.h</a></div></div>
<div class="ttc" id="aranged_8cpp_html_a6b4c3a2a360b378de261413fbb7d84f0"><div class="ttname"><a href="ranged_8cpp.html#a6b4c3a2a360b378de261413fbb7d84f0">range_with_even_chance_of_good_hit</a></div><div class="ttdeci">int range_with_even_chance_of_good_hit(int dispersion)</div><div class="ttdef"><b>Definition:</b> <a href="ranged_8cpp_source.html#l00577">ranged.cpp:577</a></div></div>
<div class="ttc" id="aranged_8h_html"><div class="ttname"><a href="ranged_8h.html">ranged.h</a></div></div>
<div class="ttc" id="aret__val_8h_html"><div class="ttname"><a href="ret__val_8h.html">ret_val.h</a></div></div>
<div class="ttc" id="arng_8cpp_html_aad28bdad07401a34ecf9912708f8b750"><div class="ttname"><a href="rng_8cpp.html#aad28bdad07401a34ecf9912708f8b750">one_in</a></div><div class="ttdeci">bool one_in(int chance)</div><div class="ttdef"><b>Definition:</b> <a href="rng_8cpp_source.html#l00108">rng.cpp:108</a></div></div>
<div class="ttc" id="arng_8h_html"><div class="ttname"><a href="rng_8h.html">rng.h</a></div></div>
<div class="ttc" id="arng_8h_html_a12244355ee77108f1b08618e9962e4d1"><div class="ttname"><a href="rng_8h.html#a12244355ee77108f1b08618e9962e4d1">random_entry</a></div><div class="ttdeci">V random_entry(const C &amp;container, D default_value)</div><div class="ttdoc">Returns a random entry in the container.</div><div class="ttdef"><b>Definition:</b> <a href="rng_8h_source.html#l00104">rng.h:104</a></div></div>
<div class="ttc" id="asounds_8h_html"><div class="ttname"><a href="sounds_8h.html">sounds.h</a></div></div>
<div class="ttc" id="aspeech_8cpp_html_a67a91181969e507f1132304946b6360b"><div class="ttname"><a href="speech_8cpp.html#a67a91181969e507f1132304946b6360b">speech</a></div><div class="ttdeci">static std::map&lt; std::string, std::vector&lt; SpeechBubble &gt; &gt; speech</div><div class="ttdef"><b>Definition:</b> <a href="speech_8cpp_source.html#l00012">speech.cpp:12</a></div></div>
<div class="ttc" id="astomach_8h_html"><div class="ttname"><a href="stomach_8h.html">stomach.h</a></div></div>
<div class="ttc" id="astring__formatter_8h_html_a8964099387da2f95396c67566bafce3d"><div class="ttname"><a href="string__formatter_8h.html#a8964099387da2f95396c67566bafce3d">string_format</a></div><div class="ttdeci">std::string string_format(std::string_view format, Args &amp;&amp;...args)</div><div class="ttdoc">Simple wrapper over string_formatter::parse.</div><div class="ttdef"><b>Definition:</b> <a href="string__formatter_8h_source.html#l00417">string_formatter.h:417</a></div></div>
<div class="ttc" id="astructTarget__attributes_html"><div class="ttname"><a href="structTarget__attributes.html">Target_attributes</a></div><div class="ttdef"><b>Definition:</b> <a href="ranged_8h_source.html#l00085">ranged.h:85</a></div></div>
<div class="ttc" id="astructaim__mods__cache_html"><div class="ttname"><a href="structaim__mods__cache.html">aim_mods_cache</a></div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l00391">character.h:391</a></div></div>
<div class="ttc" id="astructbionic_html"><div class="ttname"><a href="structbionic.html">bionic</a></div><div class="ttdef"><b>Definition:</b> <a href="bionics_8h_source.html#l00198">bionics.h:198</a></div></div>
<div class="ttc" id="astructdangerous__sound_html"><div class="ttname"><a href="structdangerous__sound.html">dangerous_sound</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00538">npc.h:538</a></div></div>
<div class="ttc" id="astructdangerous__sound_html_a440dabb5a066d7ca8698a21d5f150565"><div class="ttname"><a href="structdangerous__sound.html#a440dabb5a066d7ca8698a21d5f150565">dangerous_sound::volume</a></div><div class="ttdeci">int volume</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00541">npc.h:541</a></div></div>
<div class="ttc" id="astructdangerous__sound_html_ab3d97dced497d2bda4238f5d388bfc6a"><div class="ttname"><a href="structdangerous__sound.html#ab3d97dced497d2bda4238f5d388bfc6a">dangerous_sound::type</a></div><div class="ttdeci">sounds::sound_t type</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00540">npc.h:540</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a02b7e4d4cc2f34ee9eb96cf21f9b67de"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a02b7e4d4cc2f34ee9eb96cf21f9b67de">dialogue_chatbin_snippets::snip_bleeding_badly</a></div><div class="ttdeci">translation snip_bleeding_badly</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00130">dialogue_chatbin.h:130</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a13113449812840bc5d6a027c4906956e"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a13113449812840bc5d6a027c4906956e">dialogue_chatbin_snippets::snip_far_distance</a></div><div class="ttdeci">translation snip_far_distance</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00091">dialogue_chatbin.h:91</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a1bf21bd13cb3a895a1463e1b8f902a5b"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a1bf21bd13cb3a895a1463e1b8f902a5b">dialogue_chatbin_snippets::snip_kill_npc_h</a></div><div class="ttdeci">translation snip_kill_npc_h</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00103">dialogue_chatbin.h:103</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a1dcff1acadd0438fec30bf7dc487ce6b"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a1dcff1acadd0438fec30bf7dc487ce6b">dialogue_chatbin_snippets::snip_danger_close_distance</a></div><div class="ttdeci">translation snip_danger_close_distance</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00089">dialogue_chatbin.h:89</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a232fe542d51159fc0e84bd938a3e05ad"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a232fe542d51159fc0e84bd938a3e05ad">dialogue_chatbin_snippets::snip_radiation_sickness</a></div><div class="ttdeci">translation snip_radiation_sickness</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00131">dialogue_chatbin.h:131</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a28f759152ce9567d37ba6c257fba0f69"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a28f759152ce9567d37ba6c257fba0f69">dialogue_chatbin_snippets::snip_run_away</a></div><div class="ttdeci">translation snip_run_away</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00116">dialogue_chatbin.h:116</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a31b1dcd35fda54be38e4e4f8d3b6ae5f"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a31b1dcd35fda54be38e4e4f8d3b6ae5f">dialogue_chatbin_snippets::snip_close_distance</a></div><div class="ttdeci">translation snip_close_distance</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00087">dialogue_chatbin.h:87</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a34e76c43138090b43396fd341b2d5502"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a34e76c43138090b43396fd341b2d5502">dialogue_chatbin_snippets::snip_wound_bite</a></div><div class="ttdeci">translation snip_wound_bite</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00128">dialogue_chatbin.h:128</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a3a549ccd3a016409e91ee7a132449037"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a3a549ccd3a016409e91ee7a132449037">dialogue_chatbin_snippets::snip_combat_noise_warning</a></div><div class="ttdeci">translation snip_combat_noise_warning</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00088">dialogue_chatbin.h:88</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a3add351c0c2103212c9c9a842c6b8c69"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a3add351c0c2103212c9c9a842c6b8c69">dialogue_chatbin_snippets::snip_speech_warning</a></div><div class="ttdeci">translation snip_speech_warning</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00117">dialogue_chatbin.h:117</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a3cbb903371269780136c70f20070299b"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a3cbb903371269780136c70f20070299b">dialogue_chatbin_snippets::snip_wound_infected</a></div><div class="ttdeci">translation snip_wound_infected</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00127">dialogue_chatbin.h:127</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a41430c6e3eb1f79b41f1d68b8ad32157"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a41430c6e3eb1f79b41f1d68b8ad32157">dialogue_chatbin_snippets::snip_cant_flee</a></div><div class="ttdeci">translation snip_cant_flee</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00086">dialogue_chatbin.h:86</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a4286c66c15a3c1a988b8386511cefc4d"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a4286c66c15a3c1a988b8386511cefc4d">dialogue_chatbin_snippets::snip_fire_in_the_hole_h</a></div><div class="ttdeci">translation snip_fire_in_the_hole_h</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00093">dialogue_chatbin.h:93</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a44adfad4a6edb194e3be2a22dc1194e5"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a44adfad4a6edb194e3be2a22dc1194e5">dialogue_chatbin_snippets::snip_general_danger</a></div><div class="ttdeci">translation snip_general_danger</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00096">dialogue_chatbin.h:96</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a4a941e688346378bcc8fd98a8b2ab138"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a4a941e688346378bcc8fd98a8b2ab138">dialogue_chatbin_snippets::snip_kill_player_h</a></div><div class="ttdeci">translation snip_kill_player_h</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00105">dialogue_chatbin.h:105</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a4df05b3a6577b40f2f9cb22cfc96de0e"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a4df05b3a6577b40f2f9cb22cfc96de0e">dialogue_chatbin_snippets::snip_its_safe</a></div><div class="ttdeci">translation snip_its_safe</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00101">dialogue_chatbin.h:101</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a530755cbfc0792b48d0762e1ae60fb16"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a530755cbfc0792b48d0762e1ae60fb16">dialogue_chatbin_snippets::snip_pulp_zombie</a></div><div class="ttdeci">translation snip_pulp_zombie</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00125">dialogue_chatbin.h:125</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a666942d986ad71eb87df1ccb3773083d"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a666942d986ad71eb87df1ccb3773083d">dialogue_chatbin_snippets::snip_kill_npc</a></div><div class="ttdeci">translation snip_kill_npc</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00104">dialogue_chatbin.h:104</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a6e26b47acf769074e73c17fd1a521b6a"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a6e26b47acf769074e73c17fd1a521b6a">dialogue_chatbin_snippets::snip_monster_warning_h</a></div><div class="ttdeci">translation snip_monster_warning_h</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00109">dialogue_chatbin.h:109</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a909144e9f40f6f6657ffdb43c98d06a1"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a909144e9f40f6f6657ffdb43c98d06a1">dialogue_chatbin_snippets::snip_heal_self</a></div><div class="ttdeci">translation snip_heal_self</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00097">dialogue_chatbin.h:97</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a94fa63d2a10b2d35d08b067777fc4df0"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a94fa63d2a10b2d35d08b067777fc4df0">dialogue_chatbin_snippets::snip_heal_player</a></div><div class="ttdeci">translation snip_heal_player</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00126">dialogue_chatbin.h:126</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_a9a7654d0f398764564f42baa519ccd75"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#a9a7654d0f398764564f42baa519ccd75">dialogue_chatbin_snippets::snip_bleeding</a></div><div class="ttdeci">translation snip_bleeding</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00129">dialogue_chatbin.h:129</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_ab0a8660e4755f4d15e8aa6c5b4b49b18"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#ab0a8660e4755f4d15e8aa6c5b4b49b18">dialogue_chatbin_snippets::snip_medium_distance</a></div><div class="ttdeci">translation snip_medium_distance</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00108">dialogue_chatbin.h:108</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_ab66e0207425e52dd5ea6c740c641cfdd"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#ab66e0207425e52dd5ea6c740c641cfdd">dialogue_chatbin_snippets::snip_fire_bad</a></div><div class="ttdeci">translation snip_fire_bad</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00092">dialogue_chatbin.h:92</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_ab6ed908d4643a42308ccad1cfe4aa678"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#ab6ed908d4643a42308ccad1cfe4aa678">dialogue_chatbin_snippets::snip_lost_blood</a></div><div class="ttdeci">translation snip_lost_blood</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00124">dialogue_chatbin.h:124</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_ac8937e6e53c5ebd6a4a7fff500303c42"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#ac8937e6e53c5ebd6a4a7fff500303c42">dialogue_chatbin_snippets::snip_movement_noise_warning</a></div><div class="ttdeci">translation snip_movement_noise_warning</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00111">dialogue_chatbin.h:111</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_add480233f4fa2917735fd7da12f784f0"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#add480233f4fa2917735fd7da12f784f0">dialogue_chatbin_snippets::snip_monster_warning</a></div><div class="ttdeci">translation snip_monster_warning</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00110">dialogue_chatbin.h:110</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_ae2de31459f0d43c877e7610239d05f0f"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#ae2de31459f0d43c877e7610239d05f0f">dialogue_chatbin_snippets::snip_fire_in_the_hole</a></div><div class="ttdeci">translation snip_fire_in_the_hole</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00094">dialogue_chatbin.h:94</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_ae9c9a367b94dbb61c38ffe094971fd89"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#ae9c9a367b94dbb61c38ffe094971fd89">dialogue_chatbin_snippets::snip_general_danger_h</a></div><div class="ttdeci">translation snip_general_danger_h</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00095">dialogue_chatbin.h:95</a></div></div>
<div class="ttc" id="astructdialogue__chatbin__snippets_html_aff1bb134f7aac67385a065d22f74a6db"><div class="ttname"><a href="structdialogue__chatbin__snippets.html#aff1bb134f7aac67385a065d22f74a6db">dialogue_chatbin_snippets::snip_its_safe_h</a></div><div class="ttdeci">translation snip_its_safe_h</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00100">dialogue_chatbin.h:100</a></div></div>
<div class="ttc" id="astructdialogue__chatbin_html_af0da224eb6a3c51fae658ca0cf031f4a"><div class="ttname"><a href="structdialogue__chatbin.html#af0da224eb6a3c51fae658ca0cf031f4a">dialogue_chatbin::missions_assigned</a></div><div class="ttdeci">std::vector&lt; mission * &gt; missions_assigned</div><div class="ttdoc">Mission that have been assigned by this dialogue to a player character.</div><div class="ttdef"><b>Definition:</b> <a href="dialogue__chatbin_8h_source.html#l00034">dialogue_chatbin.h:34</a></div></div>
<div class="ttc" id="astructexplosion__data_html_a467512e7e34c64ddb98ec737368b81cb"><div class="ttname"><a href="structexplosion__data.html#a467512e7e34c64ddb98ec737368b81cb">explosion_data::safe_range</a></div><div class="ttdeci">int safe_range() const</div><div class="ttdoc">Returns the distance at which the power drops below 1.</div><div class="ttdef"><b>Definition:</b> <a href="explosion_8cpp_source.html#l01001">explosion.cpp:1001</a></div></div>
<div class="ttc" id="astructfood__summary_html"><div class="ttname"><a href="structfood__summary.html">food_summary</a></div><div class="ttdef"><b>Definition:</b> <a href="stomach_8h_source.html#l00100">stomach.h:100</a></div></div>
<div class="ttc" id="astructhealing__options_html"><div class="ttname"><a href="structhealing__options.html">healing_options</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00549">npc.h:549</a></div></div>
<div class="ttc" id="astructhealing__options_html_a26f5297ad886d8fd7a3388d62ad2b600"><div class="ttname"><a href="structhealing__options.html#a26f5297ad886d8fd7a3388d62ad2b600">healing_options::bandage</a></div><div class="ttdeci">bool bandage</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00550">npc.h:550</a></div></div>
<div class="ttc" id="astructhealing__options_html_a46674f47eb19395e6d4e233e5f8f304c"><div class="ttname"><a href="structhealing__options.html#a46674f47eb19395e6d4e233e5f8f304c">healing_options::bleed</a></div><div class="ttdeci">bool bleed</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00552">npc.h:552</a></div></div>
<div class="ttc" id="astructhealing__options_html_a7c1818fa5ab0f75183dccc0ce48dd117"><div class="ttname"><a href="structhealing__options.html#a7c1818fa5ab0f75183dccc0ce48dd117">healing_options::infect</a></div><div class="ttdeci">bool infect</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00554">npc.h:554</a></div></div>
<div class="ttc" id="astructhealing__options_html_a8c7e48cc7294f8a08563eeb4874c070e"><div class="ttname"><a href="structhealing__options.html#a8c7e48cc7294f8a08563eeb4874c070e">healing_options::clear_all</a></div><div class="ttdeci">void clear_all()</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02118">npc.cpp:2118</a></div></div>
<div class="ttc" id="astructhealing__options_html_a94bfb3b1a00e7d4f63e2a685bf0b3da5"><div class="ttname"><a href="structhealing__options.html#a94bfb3b1a00e7d4f63e2a685bf0b3da5">healing_options::bite</a></div><div class="ttdeci">bool bite</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00553">npc.h:553</a></div></div>
<div class="ttc" id="astructhealing__options_html_aa6fb391cad922eb6b5f564f48e0506de"><div class="ttname"><a href="structhealing__options.html#aa6fb391cad922eb6b5f564f48e0506de">healing_options::disinfect</a></div><div class="ttdeci">bool disinfect</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00551">npc.h:551</a></div></div>
<div class="ttc" id="astructhealing__options_html_aee8b9e7a1512020403904793b2a5634f"><div class="ttname"><a href="structhealing__options.html#aee8b9e7a1512020403904793b2a5634f">healing_options::any_true</a></div><div class="ttdeci">bool any_true() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l02132">npc.cpp:2132</a></div></div>
<div class="ttc" id="astructitype_html_a291870408701f0174d8c46b7f770fbaf"><div class="ttname"><a href="structitype.html#a291870408701f0174d8c46b7f770fbaf">itype::get_id</a></div><div class="ttdeci">itype_id get_id() const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01497">itype.h:1497</a></div></div>
<div class="ttc" id="astructitype_html_a304367633fdfe6c63a53bdce0caced92"><div class="ttname"><a href="structitype.html#a304367633fdfe6c63a53bdce0caced92">itype::get_use</a></div><div class="ttdeci">const use_function * get_use(const std::string &amp;iuse_name) const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00179">itype.cpp:179</a></div></div>
<div class="ttc" id="astructitype_html_a76600c0d6a88c8d983838f0df2276212"><div class="ttname"><a href="structitype.html#a76600c0d6a88c8d983838f0df2276212">itype::invoke</a></div><div class="ttdeci">std::optional&lt; int &gt; invoke(Character *p, item &amp;it, const tripoint &amp;pos) const</div><div class="ttdef"><b>Definition:</b> <a href="itype_8cpp_source.html#l00195">itype.cpp:195</a></div></div>
<div class="ttc" id="astructitype_html_a7cb80d77696cefb42ac6e75756b47e60"><div class="ttname"><a href="structitype.html#a7cb80d77696cefb42ac6e75756b47e60">itype::ammo</a></div><div class="ttdeci">cata::value_ptr&lt; islot_ammo &gt; ammo</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01212">itype.h:1212</a></div></div>
<div class="ttc" id="astructitype_html_afa43bb71000c037c9918d907fdacf0b5"><div class="ttname"><a href="structitype.html#afa43bb71000c037c9918d907fdacf0b5">itype::use_methods</a></div><div class="ttdeci">std::map&lt; std::string, use_function &gt; use_methods</div><div class="ttdoc">Actions an instance can perform (if any) indexed by action type.</div><div class="ttdef"><b>Definition:</b> <a href="itype_8h_source.html#l01312">itype.h:1312</a></div></div>
<div class="ttc" id="astructmission__type_html_a8872c9cf3e3a3dd838448f3cd91ce4d8"><div class="ttname"><a href="structmission__type.html#a8872c9cf3e3a3dd838448f3cd91ce4d8">mission_type::goal</a></div><div class="ttdeci">mission_goal goal</div><div class="ttdef"><b>Definition:</b> <a href="mission_8h_source.html#l00190">mission.h:190</a></div></div>
<div class="ttc" id="astructmtype_html_a7f92cbd89d3870833c9d5300acb325a1"><div class="ttname"><a href="structmtype.html#a7f92cbd89d3870833c9d5300acb325a1">mtype::difficulty</a></div><div class="ttdeci">int difficulty</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8h_source.html#l00409">mtype.h:409</a></div></div>
<div class="ttc" id="astructmtype_html_a9a8f4ead67d1836e3f4db624533af5aa"><div class="ttname"><a href="structmtype.html#a9a8f4ead67d1836e3f4db624533af5aa">mtype::nname</a></div><div class="ttdeci">std::string nname(unsigned int quantity=1) const</div><div class="ttdef"><b>Definition:</b> <a href="mtype_8cpp_source.html#l00330">mtype.cpp:330</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_a3f84dc6a3577373da51869890cfbe4c7"><div class="ttname"><a href="structnpc__combat__memory__cache.html#a3f84dc6a3577373da51869890cfbe4c7">npc_combat_memory_cache::panic</a></div><div class="ttdeci">int panic</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00605">npc.h:605</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_a458f36d8f86be518856dfaf972acb8cf"><div class="ttname"><a href="structnpc__combat__memory__cache.html#a458f36d8f86be518856dfaf972acb8cf">npc_combat_memory_cache::engagement_distance</a></div><div class="ttdeci">int engagement_distance</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00613">npc.h:613</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_a72519b2a0b815abcace7368441200bbc"><div class="ttname"><a href="structnpc__combat__memory__cache.html#a72519b2a0b815abcace7368441200bbc">npc_combat_memory_cache::swarm_count</a></div><div class="ttdeci">int swarm_count</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00606">npc.h:606</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_a72b701249a501577ea69e5f9ede00642"><div class="ttname"><a href="structnpc__combat__memory__cache.html#a72b701249a501577ea69e5f9ede00642">npc_combat_memory_cache::assessment_before_repos</a></div><div class="ttdeci">int assessment_before_repos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00609">npc.h:609</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_a81a2b9ca2aaa184c61d0c005f079c758"><div class="ttname"><a href="structnpc__combat__memory__cache.html#a81a2b9ca2aaa184c61d0c005f079c758">npc_combat_memory_cache::formation_distance</a></div><div class="ttdeci">int formation_distance</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00612">npc.h:612</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_aaa0846c956f2a336a14623a422968e31"><div class="ttname"><a href="structnpc__combat__memory__cache.html#aaa0846c956f2a336a14623a422968e31">npc_combat_memory_cache::failing_to_reposition</a></div><div class="ttdeci">int failing_to_reposition</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00607">npc.h:607</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_ad3b621db1ec00acba130661e64c35b39"><div class="ttname"><a href="structnpc__combat__memory__cache.html#ad3b621db1ec00acba130661e64c35b39">npc_combat_memory_cache::repositioning</a></div><div class="ttdeci">bool repositioning</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00611">npc.h:611</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_ada16ae9c1fb1fcb76abdcd95af5e13a3"><div class="ttname"><a href="structnpc__combat__memory__cache.html#ada16ae9c1fb1fcb76abdcd95af5e13a3">npc_combat_memory_cache::my_health</a></div><div class="ttdeci">float my_health</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00610">npc.h:610</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_ae1e5a82ac8cb44fbad27d315a73f1acb"><div class="ttname"><a href="structnpc__combat__memory__cache.html#ae1e5a82ac8cb44fbad27d315a73f1acb">npc_combat_memory_cache::reposition_countdown</a></div><div class="ttdeci">int reposition_countdown</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00608">npc.h:608</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_ae6e54a74f64bd36ffdda8d31458d9fb1"><div class="ttname"><a href="structnpc__combat__memory__cache.html#ae6e54a74f64bd36ffdda8d31458d9fb1">npc_combat_memory_cache::assess_ally</a></div><div class="ttdeci">float assess_ally</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00603">npc.h:603</a></div></div>
<div class="ttc" id="astructnpc__combat__memory__cache_html_afad2220e98ff798d6e04d1b8cc2b1641"><div class="ttname"><a href="structnpc__combat__memory__cache.html#afad2220e98ff798d6e04d1b8cc2b1641">npc_combat_memory_cache::assess_enemy</a></div><div class="ttdeci">float assess_enemy</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00604">npc.h:604</a></div></div>
<div class="ttc" id="astructnpc__follower__rules_html_a092cd660168a4b1b14529db075e29ea0"><div class="ttname"><a href="structnpc__follower__rules.html#a092cd660168a4b1b14529db075e29ea0">npc_follower_rules::aim</a></div><div class="ttdeci">aim_rule aim</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00507">npc.h:507</a></div></div>
<div class="ttc" id="astructnpc__follower__rules_html_a88a0a6bc06d6962a9c35277e6c5e0b76"><div class="ttname"><a href="structnpc__follower__rules.html#a88a0a6bc06d6962a9c35277e6c5e0b76">npc_follower_rules::cbm_recharge</a></div><div class="ttdeci">cbm_recharge_rule cbm_recharge</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00508">npc.h:508</a></div></div>
<div class="ttc" id="astructnpc__follower__rules_html_a899f396466e396d549b1f7e54c1b1355"><div class="ttname"><a href="structnpc__follower__rules.html#a899f396466e396d549b1f7e54c1b1355">npc_follower_rules::has_flag</a></div><div class="ttdeci">bool has_flag(ally_rule test, bool check_override=true) const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03634">npc.cpp:3634</a></div></div>
<div class="ttc" id="astructnpc__follower__rules_html_a9eb4400a0210e0a41692a3c6635855f1"><div class="ttname"><a href="structnpc__follower__rules.html#a9eb4400a0210e0a41692a3c6635855f1">npc_follower_rules::engagement</a></div><div class="ttdeci">combat_engagement engagement</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00506">npc.h:506</a></div></div>
<div class="ttc" id="astructnpc__follower__rules_html_af7f57605c02d48aba09224adee9d260f"><div class="ttname"><a href="structnpc__follower__rules.html#af7f57605c02d48aba09224adee9d260f">npc_follower_rules::cbm_reserve</a></div><div class="ttdeci">cbm_reserve_rule cbm_reserve</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00509">npc.h:509</a></div></div>
<div class="ttc" id="astructnpc__need__goal__cache_html"><div class="ttname"><a href="structnpc__need__goal__cache.html">npc_need_goal_cache</a></div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00616">npc.h:616</a></div></div>
<div class="ttc" id="astructnpc__need__goal__cache_html_a685453685e2edc9b7fe672969e2198ea"><div class="ttname"><a href="structnpc__need__goal__cache.html#a685453685e2edc9b7fe672969e2198ea">npc_need_goal_cache::goal</a></div><div class="ttdeci">tripoint_abs_omt goal</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00617">npc.h:617</a></div></div>
<div class="ttc" id="astructnpc__need__goal__cache_html_aa794b7c08c2b9f020b3f25e0d8ec0102"><div class="ttname"><a href="structnpc__need__goal__cache.html#aa794b7c08c2b9f020b3f25e0d8ec0102">npc_need_goal_cache::omt_loc</a></div><div class="ttdeci">tripoint_abs_omt omt_loc</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00618">npc.h:618</a></div></div>
<div class="ttc" id="astructnpc__opinion_html_a33fc4533430debe24fb3a9a38acfabbe"><div class="ttname"><a href="structnpc__opinion.html#a33fc4533430debe24fb3a9a38acfabbe">npc_opinion::value</a></div><div class="ttdeci">int value</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00235">npc.h:235</a></div></div>
<div class="ttc" id="astructnpc__opinion_html_a3dd84c1d61aba9d6486853542c43dd42"><div class="ttname"><a href="structnpc__opinion.html#a3dd84c1d61aba9d6486853542c43dd42">npc_opinion::trust</a></div><div class="ttdeci">int trust</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00233">npc.h:233</a></div></div>
<div class="ttc" id="astructnpc__opinion_html_ac3e3687fbefeca03878ed52f641d4bf7"><div class="ttname"><a href="structnpc__opinion.html#ac3e3687fbefeca03878ed52f641d4bf7">npc_opinion::fear</a></div><div class="ttdeci">int fear</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00234">npc.h:234</a></div></div>
<div class="ttc" id="astructnpc__personality_html_a50b8489153689a4a10c714f321a6d887"><div class="ttname"><a href="structnpc__personality.html#a50b8489153689a4a10c714f321a6d887">npc_personality::bravery</a></div><div class="ttdeci">int8_t bravery</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00218">npc.h:218</a></div></div>
<div class="ttc" id="astructnpc__personality_html_ad2ed57eaba1c878112ed7575bc6ebfbb"><div class="ttname"><a href="structnpc__personality.html#ad2ed57eaba1c878112ed7575bc6ebfbb">npc_personality::collector</a></div><div class="ttdeci">int8_t collector</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00219">npc.h:219</a></div></div>
<div class="ttc" id="astructnpc__personality_html_aecf2fbbc5fcbda416d381dc0bde6e18c"><div class="ttname"><a href="structnpc__personality.html#aecf2fbbc5fcbda416d381dc0bde6e18c">npc_personality::aggression</a></div><div class="ttdeci">int8_t aggression</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00217">npc.h:217</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a0c8464dc785d8b0b9ebea26e1904ad04"><div class="ttname"><a href="structnpc__short__term__cache.html#a0c8464dc785d8b0b9ebea26e1904ad04">npc_short_term_cache::stuck</a></div><div class="ttdeci">int stuck</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00576">npc.h:576</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a0f00a09e500a57a83a2eb5a92b79626a"><div class="ttname"><a href="structnpc__short__term__cache.html#a0f00a09e500a57a83a2eb5a92b79626a">npc_short_term_cache::dangerous_explosives</a></div><div class="ttdeci">std::vector&lt; sphere &gt; dangerous_explosives</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00590">npc.h:590</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a2f847c6cd66e6f7738dec088ffae2264"><div class="ttname"><a href="structnpc__short__term__cache.html#a2f847c6cd66e6f7738dec088ffae2264">npc_short_term_cache::can_heal</a></div><div class="ttdeci">healing_options can_heal</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00570">npc.h:570</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a30e9e46d0c2222553b591a4f5ed1a3ad"><div class="ttname"><a href="structnpc__short__term__cache.html#a30e9e46d0c2222553b591a4f5ed1a3ad">npc_short_term_cache::total_danger</a></div><div class="ttdeci">float total_danger</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00564">npc.h:564</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a434ad68b13dfce2cdeb82c2a80a95f77"><div class="ttname"><a href="structnpc__short__term__cache.html#a434ad68b13dfce2cdeb82c2a80a95f77">npc_short_term_cache::hostile_guys</a></div><div class="ttdeci">std::vector&lt; weak_ptr_fast&lt; Creature &gt; &gt; hostile_guys</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00587">npc.h:587</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a7864f427ce6836bdcd50c19d4ae9da6d"><div class="ttname"><a href="structnpc__short__term__cache.html#a7864f427ce6836bdcd50c19d4ae9da6d">npc_short_term_cache::closest_enemy_to_friendly_distance</a></div><div class="ttdeci">std::optional&lt; int &gt; closest_enemy_to_friendly_distance() const</div><div class="ttdef"><b>Definition:</b> <a href="npcmove_8cpp_source.html#l00687">npcmove.cpp:687</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a7a7d0193975d0535d2fd311299ebebae"><div class="ttname"><a href="structnpc__short__term__cache.html#a7a7d0193975d0535d2fd311299ebebae">npc_short_term_cache::target</a></div><div class="ttdeci">weak_ptr_fast&lt; Creature &gt; target</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00567">npc.h:567</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a7cd98325c23b7af1df26919a92c30446"><div class="ttname"><a href="structnpc__short__term__cache.html#a7cd98325c23b7af1df26919a92c30446">npc_short_term_cache::current_attack</a></div><div class="ttdeci">std::shared_ptr&lt; npc_attack &gt; current_attack</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00582">npc.h:582</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a866155d086fdd4bcd7803377b34a37d2"><div class="ttname"><a href="structnpc__short__term__cache.html#a866155d086fdd4bcd7803377b34a37d2">npc_short_term_cache::current_attack_evaluation</a></div><div class="ttdeci">npc_attack_rating current_attack_evaluation</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00581">npc.h:581</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_a87ae0d72618e5cfa212bab6722d1df45"><div class="ttname"><a href="structnpc__short__term__cache.html#a87ae0d72618e5cfa212bab6722d1df45">npc_short_term_cache::threat_map</a></div><div class="ttdeci">std::map&lt; direction, float &gt; threat_map</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00591">npc.h:591</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_aa0a891ed2c8f48d72ddb341986bd3463"><div class="ttname"><a href="structnpc__short__term__cache.html#aa0a891ed2c8f48d72ddb341986bd3463">npc_short_term_cache::ally</a></div><div class="ttdeci">weak_ptr_fast&lt; Creature &gt; ally</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00569">npc.h:569</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_aa6b8e0edc5a63b7a63c28c7b1e15478c"><div class="ttname"><a href="structnpc__short__term__cache.html#aa6b8e0edc5a63b7a63c28c7b1e15478c">npc_short_term_cache::s_abs_pos</a></div><div class="ttdeci">tripoint s_abs_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00574">npc.h:574</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_aa9c845dc2b489b53e1b4bd5121fb99c7"><div class="ttname"><a href="structnpc__short__term__cache.html#aa9c845dc2b489b53e1b4bd5121fb99c7">npc_short_term_cache::neutral_guys</a></div><div class="ttdeci">std::vector&lt; weak_ptr_fast&lt; Creature &gt; &gt; neutral_guys</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00588">npc.h:588</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_aac51460e7bb6bc9c44bb79e9954d460c"><div class="ttname"><a href="structnpc__short__term__cache.html#aac51460e7bb6bc9c44bb79e9954d460c">npc_short_term_cache::searched_tiles</a></div><div class="ttdeci">lru_cache&lt; tripoint, int &gt; searched_tiles</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00593">npc.h:593</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_ab430f4b25dc26202dca20f13cde3c17c"><div class="ttname"><a href="structnpc__short__term__cache.html#ab430f4b25dc26202dca20f13cde3c17c">npc_short_term_cache::sound_alerts</a></div><div class="ttdeci">std::vector&lt; dangerous_sound &gt; sound_alerts</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00572">npc.h:572</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_ad1e1c3dc59bb43613859b4e0666e6aa0"><div class="ttname"><a href="structnpc__short__term__cache.html#ad1e1c3dc59bb43613859b4e0666e6aa0">npc_short_term_cache::friends</a></div><div class="ttdeci">std::vector&lt; weak_ptr_fast&lt; Creature &gt; &gt; friends</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00589">npc.h:589</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_aebd15f8fbb4dbb60ef004b3292eea716"><div class="ttname"><a href="structnpc__short__term__cache.html#aebd15f8fbb4dbb60ef004b3292eea716">npc_short_term_cache::guard_pos</a></div><div class="ttdeci">std::optional&lt; tripoint_abs_ms &gt; guard_pos</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00578">npc.h:578</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_af43fa626222f6d28f052da61973043b3"><div class="ttname"><a href="structnpc__short__term__cache.html#af43fa626222f6d28f052da61973043b3">npc_short_term_cache::danger_assessment</a></div><div class="ttdeci">float danger_assessment</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00565">npc.h:565</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_af591f5a61adc850f5967ff75b7d88a3b"><div class="ttname"><a href="structnpc__short__term__cache.html#af591f5a61adc850f5967ff75b7d88a3b">npc_short_term_cache::danger</a></div><div class="ttdeci">float danger</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00563">npc.h:563</a></div></div>
<div class="ttc" id="astructnpc__short__term__cache_html_afce0cfddc9963d26debdc4b77eca431c"><div class="ttname"><a href="structnpc__short__term__cache.html#afce0cfddc9963d26debdc4b77eca431c">npc_short_term_cache::my_weapon_value</a></div><div class="ttdeci">double my_weapon_value</div><div class="ttdef"><b>Definition:</b> <a href="npc_8h_source.html#l00579">npc.h:579</a></div></div>
<div class="ttc" id="astructnutrients_html"><div class="ttname"><a href="structnutrients.html">nutrients</a></div><div class="ttdef"><b>Definition:</b> <a href="stomach_8h_source.html#l00036">stomach.h:36</a></div></div>
<div class="ttc" id="astructnutrients_html_a27fef4783e99c7f2471a9fabcabe19b5"><div class="ttname"><a href="structnutrients.html#a27fef4783e99c7f2471a9fabcabe19b5">nutrients::kcal</a></div><div class="ttdeci">int kcal() const</div><div class="ttdef"><b>Definition:</b> <a href="stomach_8cpp_source.html#l00118">stomach.cpp:118</a></div></div>
<div class="ttc" id="astructomt__find__params_html"><div class="ttname"><a href="structomt__find__params.html">omt_find_params</a></div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8h_source.html#l00130">overmapbuffer.h:130</a></div></div>
<div class="ttc" id="astructomt__find__params_html_a06e2c0706d595a5bc540e372a3b254f7"><div class="ttname"><a href="structomt__find__params.html#a06e2c0706d595a5bc540e372a3b254f7">omt_find_params::search_range</a></div><div class="ttdeci">int search_range</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8h_source.html#l00132">overmapbuffer.h:132</a></div></div>
<div class="ttc" id="astructomt__find__params_html_a09fac42ef79884ebd50509d739867e1b"><div class="ttname"><a href="structomt__find__params.html#a09fac42ef79884ebd50509d739867e1b">omt_find_params::existing_only</a></div><div class="ttdeci">bool existing_only</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8h_source.html#l00136">overmapbuffer.h:136</a></div></div>
<div class="ttc" id="astructomt__find__params_html_a45a981bb3a1c05d30e897c156d908699"><div class="ttname"><a href="structomt__find__params.html#a45a981bb3a1c05d30e897c156d908699">omt_find_params::max_z</a></div><div class="ttdeci">int max_z</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8h_source.html#l00138">overmapbuffer.h:138</a></div></div>
<div class="ttc" id="astructomt__find__params_html_ac47a765ba6d46df98d615b15998db87c"><div class="ttname"><a href="structomt__find__params.html#ac47a765ba6d46df98d615b15998db87c">omt_find_params::types</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; std::string, ot_match_type &gt; &gt; types</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8h_source.html#l00131">overmapbuffer.h:131</a></div></div>
<div class="ttc" id="astructomt__find__params_html_af5229b00ad90cd2d88aadeb09ba11291"><div class="ttname"><a href="structomt__find__params.html#af5229b00ad90cd2d88aadeb09ba11291">omt_find_params::min_z</a></div><div class="ttdeci">int min_z</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8h_source.html#l00137">overmapbuffer.h:137</a></div></div>
<div class="ttc" id="astructoter__t_html_ab1638475c8650985ec100f0bc7fcafe7"><div class="ttname"><a href="structoter__t.html#ab1638475c8650985ec100f0bc7fcafe7">oter_t::get_type_id</a></div><div class="ttdeci">const string_id&lt; oter_type_t &gt; &amp; get_type_id() const</div><div class="ttdef"><b>Definition:</b> <a href="omdata_8h_source.html#l00323">omdata.h:323</a></div></div>
<div class="ttc" id="astructovermap__path__params_html_a64dc55bc7e0784c689c0c97459131ac7"><div class="ttname"><a href="structovermap__path__params.html#a64dc55bc7e0784c689c0c97459131ac7">overmap_path_params::for_npc</a></div><div class="ttdeci">static overmap_path_params for_npc()</div><div class="ttdef"><b>Definition:</b> <a href="overmapbuffer_8cpp_source.html#l00870">overmapbuffer.cpp:870</a></div></div>
<div class="ttc" id="astructpoint_html"><div class="ttname"><a href="structpoint.html">point</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00020">point.h:20</a></div></div>
<div class="ttc" id="astructsphere_html"><div class="ttname"><a href="structsphere.html">sphere</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00274">point.h:274</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00129">point.h:129</a></div></div>
<div class="ttc" id="astructtripoint_html_a89f6c0a16e2bfd7ce4f1f1d20404c4d7"><div class="ttname"><a href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">tripoint::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00133">point.h:133</a></div></div>
<div class="ttc" id="astructtripoint_html_ac944c0e329b5eba2602f7a52f66bbbb9"><div class="ttname"><a href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">tripoint::z</a></div><div class="ttdeci">int z</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00134">point.h:134</a></div></div>
<div class="ttc" id="astructtripoint_html_affdc0d5b75024cbfacd208a495def3dc"><div class="ttname"><a href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">tripoint::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00132">point.h:132</a></div></div>
<div class="ttc" id="astructuse__function_html"><div class="ttname"><a href="structuse__function.html">use_function</a></div><div class="ttdef"><b>Definition:</b> <a href="iuse_8h_source.html#l00302">iuse.h:302</a></div></div>
<div class="ttc" id="astructuse__function_html_a308134b3f05ca40164e867ac8d922da8"><div class="ttname"><a href="structuse__function.html#a308134b3f05ca40164e867ac8d922da8">use_function::call</a></div><div class="ttdeci">std::optional&lt; int &gt; call(Character *, item &amp;, const tripoint &amp;) const</div><div class="ttdef"><b>Definition:</b> <a href="iuse_8cpp_source.html#l08922">iuse.cpp:8922</a></div></div>
<div class="ttc" id="astructvehicle__part_html"><div class="ttname"><a href="structvehicle__part.html">vehicle_part</a></div><div class="ttdoc">Structure, describing vehicle part (i.e., wheel, seat)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00254">vehicle.h:254</a></div></div>
<div class="ttc" id="astructvehicle__part_html_acb5dce028b917a59941ed0f4cb0a4491"><div class="ttname"><a href="structvehicle__part.html#acb5dce028b917a59941ed0f4cb0a4491">vehicle_part::crew</a></div><div class="ttdeci">npc * crew() const</div><div class="ttdoc">Get NPC currently assigned to this part (seat, turret etc)?</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__part_8cpp_source.html#l00525">vehicle_part.cpp:525</a></div></div>
<div class="ttc" id="asubbodypart_8h_html_ae70ba95c272bf8b7296bc0df8bcd03e4"><div class="ttname"><a href="subbodypart_8h.html#ae70ba95c272bf8b7296bc0df8bcd03e4">side</a></div><div class="ttdeci">side</div><div class="ttdef"><b>Definition:</b> <a href="subbodypart_8h_source.html#l00029">subbodypart.h:29</a></div></div>
<div class="ttc" id="atalker_8h_html"><div class="ttname"><a href="talker_8h.html">talker.h</a></div></div>
<div class="ttc" id="atranslations_8h_html"><div class="ttname"><a href="translations_8h.html">translations.h</a></div></div>
<div class="ttc" id="atranslations_8h_html_a0b3ab525ec6b450b2487e7644255fa7c"><div class="ttname"><a href="translations_8h.html#a0b3ab525ec6b450b2487e7644255fa7c">translate_marker</a></div><div class="ttdeci">#define translate_marker(x)</div><div class="ttdoc">Marks a string literal to be extracted for translation.</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00017">translations.h:17</a></div></div>
<div class="ttc" id="atranslations_8h_html_ab92bb4161a6308b302d283816975c3a6"><div class="ttname"><a href="translations_8h.html#ab92bb4161a6308b302d283816975c3a6">_</a></div><div class="ttdeci">#define _(STRING)</div><div class="ttdef"><b>Definition:</b> <a href="translations_8h_source.html#l00089">translations.h:89</a></div></div>
<div class="ttc" id="aunits_8h_html"><div class="ttname"><a href="units_8h.html">units.h</a></div></div>
<div class="ttc" id="avalue__ptr_8h_html"><div class="ttname"><a href="value__ptr_8h.html">value_ptr.h</a></div></div>
<div class="ttc" id="aveh__type_8h_html"><div class="ttname"><a href="veh__type_8h.html">veh_type.h</a></div></div>
<div class="ttc" id="aveh__type_8h_html_aa3ff66a8c100c3deb40dfa70f1eb307ea563fb2626cff0acc6c8273fef3e3a8d0"><div class="ttname"><a href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea563fb2626cff0acc6c8273fef3e3a8d0">VPFLAG_CARGO</a></div><div class="ttdeci">@ VPFLAG_CARGO</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00094">veh_type.h:94</a></div></div>
<div class="ttc" id="aveh__type_8h_html_aa3ff66a8c100c3deb40dfa70f1eb307eaebc2a9d9402e04973e4ee469daddeda5"><div class="ttname"><a href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307eaebc2a9d9402e04973e4ee469daddeda5">VPFLAG_BOARDABLE</a></div><div class="ttdeci">@ VPFLAG_BOARDABLE</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00067">veh_type.h:67</a></div></div>
<div class="ttc" id="avehicle_8h_html"><div class="ttname"><a href="vehicle_8h.html">vehicle.h</a></div></div>
<div class="ttc" id="avehicle__selector_8h_html"><div class="ttname"><a href="vehicle__selector_8h.html">vehicle_selector.h</a></div></div>
<div class="ttc" id="aviewer_8h_html"><div class="ttname"><a href="viewer_8h.html">viewer.h</a></div></div>
<div class="ttc" id="avisitable_8h_html"><div class="ttname"><a href="visitable_8h.html">visitable.h</a></div></div>
<div class="ttc" id="avisitable_8h_html_ab73f6da193541e8dc1a3ebdb5f37fabea47559fb833ff58321570e5e877b467f6"><div class="ttname"><a href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea47559fb833ff58321570e5e877b467f6">VisitResponse::NEXT</a></div><div class="ttdeci">@ NEXT</div></div>
<div class="ttc" id="avisitable_8h_html_ab73f6da193541e8dc1a3ebdb5f37fabea8d12a2ca7e5a64036d7251a3eda51a38"><div class="ttname"><a href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabea8d12a2ca7e5a64036d7251a3eda51a38">VisitResponse::ABORT</a></div><div class="ttdeci">@ ABORT</div></div>
<div class="ttc" id="avisitable_8h_html_ab73f6da193541e8dc1a3ebdb5f37fabeab85df04e922fe1dd3c1f0692faeaacef"><div class="ttname"><a href="visitable_8h.html#ab73f6da193541e8dc1a3ebdb5f37fabeab85df04e922fe1dd3c1f0692faeaacef">VisitResponse::SKIP</a></div><div class="ttdeci">@ SKIP</div></div>
<div class="ttc" id="avpart__position_8h_html"><div class="ttname"><a href="vpart__position_8h.html">vpart_position.h</a></div></div>
<div class="ttc" id="avpart__position_8h_html_a8da46e924794d004c9899494ecd600c5"><div class="ttname"><a href="vpart__position_8h.html#a8da46e924794d004c9899494ecd600c5">veh_pointer_or_null</a></div><div class="ttdeci">vehicle * veh_pointer_or_null(const optional_vpart_position &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00185">vpart_position.h:185</a></div></div>
<div class="ttc" id="avpart__range_8h_html"><div class="ttname"><a href="vpart__range_8h.html">vpart_range.h</a></div></div>
<div class="ttc" id="awidget_8h_html_ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61"><div class="ttname"><a href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983fa71cb762591159613cc1eb3e2df9edd61">widget_var::move_cost</a></div><div class="ttdeci">@ move_cost</div></div>
<div class="ttc" id="awidget_8h_html_ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153"><div class="ttname"><a href="widget_8h.html#ac9c40e0d5ffae2a9e10019da79b7983face4ef3ec98443ed10da505114b58f153">widget_var::speed</a></div><div class="ttdeci">@ speed</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 7 2024 08:48:30 for Cataclysm DDA by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
