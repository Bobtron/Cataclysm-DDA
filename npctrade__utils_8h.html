<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm DDA: src/npctrade_utils.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm DDA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">npctrade_utils.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;list&gt;</code><br />
</div>
<p><a href="npctrade__utils_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a089b8203a700cf09673a77476ed22c6f"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="npctrade__utils_8h.html#a089b8203a700cf09673a77476ed22c6f">CATA_SRC_NPCTRADE_UTILS_H</a></td></tr>
<tr class="separator:a089b8203a700cf09673a77476ed22c6f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a92f07fed6d6b44ac2ea8307fc0b0da8f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="npctrade__utils_8h.html#a92f07fed6d6b44ac2ea8307fc0b0da8f">add_fallback_zone</a> (<a class="el" href="classnpc.html">npc</a> &amp;guy)</td></tr>
<tr class="separator:a92f07fed6d6b44ac2ea8307fc0b0da8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af6d53c14326c1cb0370fa2b249a46a2d"><td class="memItemLeft" align="right" valign="top">std::list&lt; <a class="el" href="classitem.html">item</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="npctrade__utils_8h.html#af6d53c14326c1cb0370fa2b249a46a2d">distribute_items_to_npc_zones</a> (std::list&lt; <a class="el" href="classitem.html">item</a> &gt; &amp;items, <a class="el" href="classnpc.html">npc</a> &amp;guy)</td></tr>
<tr class="separator:af6d53c14326c1cb0370fa2b249a46a2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77be6909ee52f9056f3328d064de528f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="npctrade__utils_8h.html#a77be6909ee52f9056f3328d064de528f">consume_items_in_zones</a> (<a class="el" href="classnpc.html">npc</a> &amp;guy, <a class="el" href="classtime__duration.html">time_duration</a> const &amp;elapsed)</td></tr>
<tr class="separator:a77be6909ee52f9056f3328d064de528f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a13b5614909a98d0b41801d8b074d8c91"><td class="memItemLeft" align="right" valign="top">constexpr char const  *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="npctrade__utils_8h.html#a13b5614909a98d0b41801d8b074d8c91">fallback_name</a> = &quot;NPC Shopkeeper unsorted fallback zone&quot;</td></tr>
<tr class="separator:a13b5614909a98d0b41801d8b074d8c91"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a089b8203a700cf09673a77476ed22c6f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a089b8203a700cf09673a77476ed22c6f">&#9670;&nbsp;</a></span>CATA_SRC_NPCTRADE_UTILS_H</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define CATA_SRC_NPCTRADE_UTILS_H</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade__utils_8h_source.html#l00003">3</a> of file <a class="el" href="npctrade__utils_8h_source.html">npctrade_utils.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a92f07fed6d6b44ac2ea8307fc0b0da8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92f07fed6d6b44ac2ea8307fc0b0da8f">&#9670;&nbsp;</a></span>add_fallback_zone()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void add_fallback_zone </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnpc.html">npc</a> &amp;&#160;</td>
          <td class="paramname"><em>guy</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade__utils_8cpp_source.html#l00079">79</a> of file <a class="el" href="npctrade__utils_8cpp_source.html">npctrade_utils.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;{</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <a class="code" href="classzone__manager.html">zone_manager</a> &amp;zmgr = <a class="code" href="classzone__manager.html#a54609d51d21bd8f370ee8b59525eb750">zone_manager::get_manager</a>();</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> <span class="keyword">const</span> loc = guy.<a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    <a class="code" href="classstring__id.html">faction_id</a> <span class="keyword">const</span> &amp;fac_id = guy.<a class="code" href="classnpc.html#aef82c9fb32b160e16ace84676297d2b5">get_fac_id</a>();</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;    <span class="keywordflow">if</span>( zmgr.<a class="code" href="classzone__manager.html#aff01780bd615c3b526e071efdce01b70">has_near</a>( <a class="code" href="npctrade__utils_8cpp.html#a5a86c44ff9433e6f488251b0bc38c0c7">zone_type_LOOT_UNSORTED</a>, loc, <a class="code" href="game__constants_8h.html#afec5544a31d4183805cff025dd84b5f4">PICKUP_RANGE</a>, fac_id ) ) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    }</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    std::vector&lt;tripoint_abs_ms&gt; points;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> <span class="keyword">const</span> &amp;t : <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( loc, <a class="code" href="game__constants_8h.html#afec5544a31d4183805cff025dd84b5f4">PICKUP_RANGE</a> ) ) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> <span class="keyword">const</span> t_here = here.<a class="code" href="classmap.html#a1cc29653b8305e7192311c05a0bd4c99">bub_from_abs</a>( t );</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        <span class="keywordflow">if</span>( here.<a class="code" href="classmap.html#a00008f407a53edc2445622618d7ed071">has_furn</a>( t_here ) &amp;&amp;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            ( here.<a class="code" href="classmap.html#af55e014aab791bbe4c8630361c1311dd">furn</a>( t_here )-&gt;<a class="code" href="structmap__data__common__t.html#a690ea143a57dfd3d0521626a8d900255">max_volume</a> &gt; <a class="code" href="npctrade__utils_8cpp.html#af2540b2bf274cc61340154c538845226">ter_t_floor</a>-&gt;<a class="code" href="structmap__data__common__t.html#a690ea143a57dfd3d0521626a8d900255">max_volume</a> ||</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;              here.<a class="code" href="classmap.html#af55e014aab791bbe4c8630361c1311dd">furn</a>( t_here )-&gt;<a class="code" href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af647e87b783dfbafbb681f3ba4705bcf">ter_furn_flag::TFLAG_CONTAINER</a> ) ) &amp;&amp;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            here.<a class="code" href="classmap.html#a3014d235b1298cadddb4c412d133ae6b">can_put_items_ter_furn</a>( t_here ) &amp;&amp;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            !here.<a class="code" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">route</a>( guy.<a class="code" href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">pos_bub</a>(), t_here, guy.<a class="code" href="classnpc.html#ab117ea356d49855e02448774397d23b9">get_pathfinding_settings</a>(),</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                         guy.<a class="code" href="classnpc.html#acb437607e20194f9d5b94c95b860b744">get_path_avoid</a>() )</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            .empty() ) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            points.emplace_back( t );</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    }</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160; </div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span>( points.empty() ) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        zmgr.<a class="code" href="classzone__manager.html#a8552f70b6ae762286c2ccc4e270e1ea3">add</a>( <a class="code" href="npctrade__utils_8h.html#a13b5614909a98d0b41801d8b074d8c91">fallback_name</a>, <a class="code" href="npctrade__utils_8cpp.html#a5a86c44ff9433e6f488251b0bc38c0c7">zone_type_LOOT_UNSORTED</a>, fac_id, <span class="keyword">false</span>, <span class="keyword">true</span>,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                  loc.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() + <a class="code" href="point_8h.html#a161d3b46a2531cb4eecd7d82391ecd0a">tripoint_north_west</a>, loc.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>() + <a class="code" href="point_8h.html#a5767887bb9dcb0ae61b2ab06979a1d1b">tripoint_south_east</a> );</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> <span class="keyword">const</span> &amp;t : points ) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            zmgr.<a class="code" href="classzone__manager.html#a8552f70b6ae762286c2ccc4e270e1ea3">add</a>( <a class="code" href="npctrade__utils_8h.html#a13b5614909a98d0b41801d8b074d8c91">fallback_name</a>, <a class="code" href="npctrade__utils_8cpp.html#a5a86c44ff9433e6f488251b0bc38c0c7">zone_type_LOOT_UNSORTED</a>, fac_id, <span class="keyword">false</span>, <span class="keyword">true</span>, t.raw(),</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                      t.raw() );</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="debug_8cpp.html#a240782b16593c6bd607c64787c62da0e">DebugLog</a>( <a class="code" href="debug_8h.html#ab658e6d84759440dbf3c890446075395acdde8abdfca282d5529a48366dcfe8fd">DebugLevel::D_WARNING</a>, <a class="code" href="debug_8h.html#afa45cf12d72d4226196a7d03c54ad7d3a1d75ac3d58695ea88f599caa6a352098">DebugClass::D_GAME</a> )</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            &lt;&lt; <span class="stringliteral">&quot;Added fallack loot zones for NPC trader &quot;</span> &lt;&lt; guy.<a class="code" href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">name</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;}</div>
<div class="ttc" id="aclassCharacter_html_a6592c35167738421f3e04ca8808d37db"><div class="ttname"><a href="classCharacter.html#a6592c35167738421f3e04ca8808d37db">Character::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="character_8h_source.html#l02684">character.h:2684</a></div></div>
<div class="ttc" id="aclassCreature_html_a3261de1530798f5b934a71b9a4e17f5b"><div class="ttname"><a href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">Creature::get_location</a></div><div class="ttdeci">tripoint_abs_ms get_location() const</div><div class="ttdoc">Returns the location of the creature in map square coordinates (the most detailed coordinate system),...</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l03232">creature.cpp:3232</a></div></div>
<div class="ttc" id="aclassCreature_html_af7172e571c5c69240d9f71a01fddf035"><div class="ttname"><a href="classCreature.html#af7172e571c5c69240d9f71a01fddf035">Creature::pos_bub</a></div><div class="ttdeci">tripoint_bub_ms pos_bub() const</div><div class="ttdef"><b>Definition:</b> <a href="creature_8cpp_source.html#l00183">creature.cpp:183</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__mut_html_a5a5454f4ce144b5b3a84c2698a54ab8c"><div class="ttname"><a href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">coords::coord_point_mut::raw</a></div><div class="ttdeci">constexpr const Point &amp; raw() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00157">coordinates.h:157</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point_html"><div class="ttname"><a href="classcoords_1_1coord__point.html">coords::coord_point&lt; tripoint, coords::origin::abs, coords::ms &gt;</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00345">map.h:346</a></div></div>
<div class="ttc" id="aclassmap_html_a00008f407a53edc2445622618d7ed071"><div class="ttname"><a href="classmap.html#a00008f407a53edc2445622618d7ed071">map::has_furn</a></div><div class="ttdeci">bool has_furn(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01712">map.cpp:1712</a></div></div>
<div class="ttc" id="aclassmap_html_a1cc29653b8305e7192311c05a0bd4c99"><div class="ttname"><a href="classmap.html#a1cc29653b8305e7192311c05a0bd4c99">map::bub_from_abs</a></div><div class="ttdeci">tripoint_bub_ms bub_from_abs(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09647">map.cpp:9647</a></div></div>
<div class="ttc" id="aclassmap_html_a3014d235b1298cadddb4c412d133ae6b"><div class="ttname"><a href="classmap.html#a3014d235b1298cadddb4c412d133ae6b">map::can_put_items_ter_furn</a></div><div class="ttdeci">bool can_put_items_ter_furn(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03097">map.cpp:3097</a></div></div>
<div class="ttc" id="aclassmap_html_acd464679b3bb514e2568ffdb3260ef0c"><div class="ttname"><a href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">map::route</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; route(const tripoint &amp;f, const tripoint &amp;t, const pathfinding_settings &amp;settings, const std::unordered_set&lt; tripoint &gt; &amp;pre_closed={{ }}) const</div><div class="ttdoc">Calculate the best path using A*.</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00192">pathfinding.cpp:192</a></div></div>
<div class="ttc" id="aclassmap_html_af55e014aab791bbe4c8630361c1311dd"><div class="ttname"><a href="classmap.html#af55e014aab791bbe4c8630361c1311dd">map::furn</a></div><div class="ttdeci">furn_id furn(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01722">map.cpp:1722</a></div></div>
<div class="ttc" id="aclassnpc_html_ab117ea356d49855e02448774397d23b9"><div class="ttname"><a href="classnpc.html#ab117ea356d49855e02448774397d23b9">npc::get_pathfinding_settings</a></div><div class="ttdeci">const pathfinding_settings &amp; get_pathfinding_settings() const override</div><div class="ttdoc">Returns settings for pathfinding.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03287">npc.cpp:3287</a></div></div>
<div class="ttc" id="aclassnpc_html_acb437607e20194f9d5b94c95b860b744"><div class="ttname"><a href="classnpc.html#acb437607e20194f9d5b94c95b860b744">npc::get_path_avoid</a></div><div class="ttdeci">std::unordered_set&lt; tripoint &gt; get_path_avoid() const override</div><div class="ttdoc">Returns a set of points we do not want to path through.</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l03312">npc.cpp:3312</a></div></div>
<div class="ttc" id="aclassnpc_html_aef82c9fb32b160e16ace84676297d2b5"><div class="ttname"><a href="classnpc.html#aef82c9fb32b160e16ace84676297d2b5">npc::get_fac_id</a></div><div class="ttdeci">faction_id get_fac_id() const</div><div class="ttdef"><b>Definition:</b> <a href="npc_8cpp_source.html#l00771">npc.cpp:771</a></div></div>
<div class="ttc" id="aclassstring__id_html"><div class="ttname"><a href="classstring__id.html">string_id&lt; faction &gt;</a></div></div>
<div class="ttc" id="aclasszone__manager_html"><div class="ttname"><a href="classzone__manager.html">zone_manager</a></div><div class="ttdef"><b>Definition:</b> <a href="clzones_8h_source.html#l00512">clzones.h:513</a></div></div>
<div class="ttc" id="aclasszone__manager_html_a54609d51d21bd8f370ee8b59525eb750"><div class="ttname"><a href="classzone__manager.html#a54609d51d21bd8f370ee8b59525eb750">zone_manager::get_manager</a></div><div class="ttdeci">static zone_manager &amp; get_manager()</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8h_source.html#l00550">clzones.h:550</a></div></div>
<div class="ttc" id="aclasszone__manager_html_a8552f70b6ae762286c2ccc4e270e1ea3"><div class="ttname"><a href="classzone__manager.html#a8552f70b6ae762286c2ccc4e270e1ea3">zone_manager::add</a></div><div class="ttdeci">void add(const std::string &amp;name, const zone_type_id &amp;type, const faction_id &amp;faction, bool invert, bool enabled, const tripoint &amp;start, const tripoint &amp;end, const shared_ptr_fast&lt; zone_options &gt; &amp;options=nullptr, bool personal=false, bool silent=false, map *pmap=nullptr)</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8cpp_source.html#l01385">clzones.cpp:1385</a></div></div>
<div class="ttc" id="aclasszone__manager_html_aff01780bd615c3b526e071efdce01b70"><div class="ttname"><a href="classzone__manager.html#aff01780bd615c3b526e071efdce01b70">zone_manager::has_near</a></div><div class="ttdeci">bool has_near(const zone_type_id &amp;type, const tripoint_abs_ms &amp;where, int range=MAX_DISTANCE, const faction_id &amp;fac=your_fac) const</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8cpp_source.html#l01011">clzones.cpp:1011</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a560abf1cd341e88e2f13f454ec2ecc99"><div class="ttname"><a href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale &gt; &gt; closest_points_first(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc, int min_dist, int max_dist)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00848">coordinates.h:848</a></div></div>
<div class="ttc" id="adebug_8cpp_html_a240782b16593c6bd607c64787c62da0e"><div class="ttname"><a href="debug_8cpp.html#a240782b16593c6bd607c64787c62da0e">DebugLog</a></div><div class="ttdeci">std::ostream &amp; DebugLog(DebugLevel lev, DebugClass cl)</div><div class="ttdef"><b>Definition:</b> <a href="debug_8cpp_source.html#l01438">debug.cpp:1438</a></div></div>
<div class="ttc" id="adebug_8h_html_ab658e6d84759440dbf3c890446075395acdde8abdfca282d5529a48366dcfe8fd"><div class="ttname"><a href="debug_8h.html#ab658e6d84759440dbf3c890446075395acdde8abdfca282d5529a48366dcfe8fd">D_WARNING</a></div><div class="ttdeci">@ D_WARNING</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00141">debug.h:141</a></div></div>
<div class="ttc" id="adebug_8h_html_afa45cf12d72d4226196a7d03c54ad7d3a1d75ac3d58695ea88f599caa6a352098"><div class="ttname"><a href="debug_8h.html#afa45cf12d72d4226196a7d03c54ad7d3a1d75ac3d58695ea88f599caa6a352098">D_GAME</a></div><div class="ttdeci">@ D_GAME</div><div class="ttdoc">Main game class.</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00167">debug.h:167</a></div></div>
<div class="ttc" id="agame_8cpp_html_afa1063326b0c16b43c6f3dc8c3df403d"><div class="ttname"><a href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13822">game.cpp:13822</a></div></div>
<div class="ttc" id="agame__constants_8h_html_afec5544a31d4183805cff025dd84b5f4"><div class="ttname"><a href="game__constants_8h.html#afec5544a31d4183805cff025dd84b5f4">PICKUP_RANGE</a></div><div class="ttdeci">constexpr int PICKUP_RANGE</div><div class="ttdoc">Items on the map with at most this distance to the player are considered available for crafting,...</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00070">game_constants.h:70</a></div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054af647e87b783dfbafbb681f3ba4705bcf"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af647e87b783dfbafbb681f3ba4705bcf">ter_furn_flag::TFLAG_CONTAINER</a></div><div class="ttdeci">@ TFLAG_CONTAINER</div></div>
<div class="ttc" id="anpctrade__utils_8cpp_html_a5a86c44ff9433e6f488251b0bc38c0c7"><div class="ttname"><a href="npctrade__utils_8cpp.html#a5a86c44ff9433e6f488251b0bc38c0c7">zone_type_LOOT_UNSORTED</a></div><div class="ttdeci">static const zone_type_id zone_type_LOOT_UNSORTED(&quot;LOOT_UNSORTED&quot;)</div></div>
<div class="ttc" id="anpctrade__utils_8cpp_html_af2540b2bf274cc61340154c538845226"><div class="ttname"><a href="npctrade__utils_8cpp.html#af2540b2bf274cc61340154c538845226">ter_t_floor</a></div><div class="ttdeci">static const ter_str_id ter_t_floor(&quot;t_floor&quot;)</div></div>
<div class="ttc" id="anpctrade__utils_8h_html_a13b5614909a98d0b41801d8b074d8c91"><div class="ttname"><a href="npctrade__utils_8h.html#a13b5614909a98d0b41801d8b074d8c91">fallback_name</a></div><div class="ttdeci">constexpr char const  * fallback_name</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8h_source.html#l00010">npctrade_utils.h:10</a></div></div>
<div class="ttc" id="apoint_8h_html_a161d3b46a2531cb4eecd7d82391ecd0a"><div class="ttname"><a href="point_8h.html#a161d3b46a2531cb4eecd7d82391ecd0a">tripoint_north_west</a></div><div class="ttdeci">constexpr tripoint tripoint_north_west</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00269">point.h:269</a></div></div>
<div class="ttc" id="apoint_8h_html_a5767887bb9dcb0ae61b2ab06979a1d1b"><div class="ttname"><a href="point_8h.html#a5767887bb9dcb0ae61b2ab06979a1d1b">tripoint_south_east</a></div><div class="ttdeci">constexpr tripoint tripoint_south_east</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00265">point.h:265</a></div></div>
<div class="ttc" id="astructmap__data__common__t_html_a630778707744fb147436b9aa0c370a7e"><div class="ttname"><a href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">map_data_common_t::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00534">mapdata.h:534</a></div></div>
<div class="ttc" id="astructmap__data__common__t_html_a690ea143a57dfd3d0521626a8d900255"><div class="ttname"><a href="structmap__data__common__t.html#a690ea143a57dfd3d0521626a8d900255">map_data_common_t::max_volume</a></div><div class="ttdeci">units::volume max_volume</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00509">mapdata.h:509</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="clzones_8cpp_source.html#l01385">zone_manager::add()</a>, <a class="el" href="map_8cpp_source.html#l09647">map::bub_from_abs()</a>, <a class="el" href="map_8cpp_source.html#l03097">map::can_put_items_ter_furn()</a>, <a class="el" href="coordinates_8h_source.html#l00848">closest_points_first()</a>, <a class="el" href="debug_8h_source.html#l00167">D_GAME</a>, <a class="el" href="debug_8h_source.html#l00141">D_WARNING</a>, <a class="el" href="debug_8cpp_source.html#l01438">DebugLog()</a>, <a class="el" href="npctrade__utils_8h_source.html#l00010">fallback_name</a>, <a class="el" href="map_8cpp_source.html#l01722">map::furn()</a>, <a class="el" href="npc_8cpp_source.html#l00771">npc::get_fac_id()</a>, <a class="el" href="creature_8cpp_source.html#l03232">Creature::get_location()</a>, <a class="el" href="clzones_8h_source.html#l00550">zone_manager::get_manager()</a>, <a class="el" href="game_8cpp_source.html#l13822">get_map()</a>, <a class="el" href="npc_8cpp_source.html#l03312">npc::get_path_avoid()</a>, <a class="el" href="npc_8cpp_source.html#l03287">npc::get_pathfinding_settings()</a>, <a class="el" href="mapdata_8h_source.html#l00534">map_data_common_t::has_flag()</a>, <a class="el" href="map_8cpp_source.html#l01712">map::has_furn()</a>, <a class="el" href="clzones_8cpp_source.html#l01011">zone_manager::has_near()</a>, <a class="el" href="mapdata_8h_source.html#l00509">map_data_common_t::max_volume</a>, <a class="el" href="character_8h_source.html#l02684">Character::name</a>, <a class="el" href="game__constants_8h_source.html#l00070">PICKUP_RANGE</a>, <a class="el" href="creature_8cpp_source.html#l00183">Creature::pos_bub()</a>, <a class="el" href="coordinates_8h_source.html#l00157">coords::coord_point_mut&lt; Point, Subpoint, InBounds &gt;::raw()</a>, <a class="el" href="pathfinding_8cpp_source.html#l00192">map::route()</a>, <a class="el" href="npctrade__utils_8cpp.html#af2540b2bf274cc61340154c538845226">ter_t_floor</a>, <a class="el" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af647e87b783dfbafbb681f3ba4705bcf">TFLAG_CONTAINER</a>, <a class="el" href="point_8h_source.html#l00269">tripoint_north_west</a>, <a class="el" href="point_8h_source.html#l00265">tripoint_south_east</a>, and <a class="el" href="npctrade__utils_8cpp.html#a5a86c44ff9433e6f488251b0bc38c0c7">zone_type_LOOT_UNSORTED</a>.</p>

<p class="reference">Referenced by <a class="el" href="npc_8cpp_source.html#l01933">npc::shop_restock()</a>, and <a class="el" href="trade__ui_8cpp_source.html#l00105">trade_ui::trade_ui()</a>.</p>

</div>
</div>
<a id="a77be6909ee52f9056f3328d064de528f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77be6909ee52f9056f3328d064de528f">&#9670;&nbsp;</a></span>consume_items_in_zones()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void consume_items_in_zones </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classnpc.html">npc</a> &amp;&#160;</td>
          <td class="paramname"><em>guy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classtime__duration.html">time_duration</a> const &amp;&#160;</td>
          <td class="paramname"><em>elapsed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade__utils_8cpp_source.html#l00157">157</a> of file <a class="el" href="npctrade__utils_8cpp_source.html">npctrade_utils.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;{</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    std::unordered_set&lt;tripoint&gt; <span class="keyword">const</span> src = <a class="code" href="classzone__manager.html#a54609d51d21bd8f370ee8b59525eb750">zone_manager::get_manager</a>().<a class="code" href="classzone__manager.html#a57b76406598198475140852e43feb6e4">get_point_set_loot</a>(</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                guy.<a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>(), <a class="code" href="game__constants_8h.html#afec5544a31d4183805cff025dd84b5f4">PICKUP_RANGE</a>, guy.<a class="code" href="classnpc.html#aef82c9fb32b160e16ace84676297d2b5">get_fac_id</a>() );</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160; </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a9201381ead46e0d6cc696ae69cab9e0b">consume_cache</a> cache;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="structtripoint.html">tripoint</a> <span class="keyword">const</span> &amp;pt : src ) {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a98c2f9c8a00237d07e1deec548161f26">consume_queue</a> consumed;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        std::list&lt;item_location&gt; stack =</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        here.<a class="code" href="classmap.html#a465b100a7f16fef97298001da28fc899">items_with</a>( pt, [&amp;guy]( <a class="code" href="classitem.html">item</a> <span class="keyword">const</span> &amp; it ) {</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            <span class="keywordflow">return</span> it.<a class="code" href="classitem.html#a0b35b9066ad71987b77727af45d96059">is_owned_by</a>( guy );</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        } );</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classitem__location.html">item_location</a> &amp;elem : stack ) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a61dec221ff08c6cff5c896600698b1c7">_consume_item</a>( elem, consumed, cache, guy, elapsed );</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classitem__location.html">item_location</a> &amp;it : consumed ) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            it.<a class="code" href="classvisitable.html#adeb03e3af46e1b106a5f88f112add296">remove_item</a>();</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;}</div>
<div class="ttc" id="aclassitem__location_html"><div class="ttname"><a href="classitem__location.html">item_location</a></div><div class="ttdoc">A lightweight handle to an item independent of it's location Unlike a raw pointer can be (de-)seriali...</div><div class="ttdef"><b>Definition:</b> <a href="item__location_8h_source.html#l00028">item_location.h:29</a></div></div>
<div class="ttc" id="aclassitem_html"><div class="ttname"><a href="classitem.html">item</a></div><div class="ttdef"><b>Definition:</b> <a href="item_8h_source.html#l00195">item.h:196</a></div></div>
<div class="ttc" id="aclassitem_html_a0b35b9066ad71987b77727af45d96059"><div class="ttname"><a href="classitem.html#a0b35b9066ad71987b77727af45d96059">item::is_owned_by</a></div><div class="ttdeci">bool is_owned_by(const Character &amp;c, bool available_to_take=false) const</div><div class="ttdef"><b>Definition:</b> <a href="item_8cpp_source.html#l02116">item.cpp:2116</a></div></div>
<div class="ttc" id="aclassmap_html_a465b100a7f16fef97298001da28fc899"><div class="ttname"><a href="classmap.html#a465b100a7f16fef97298001da28fc899">map::items_with</a></div><div class="ttdeci">std::list&lt; item_location &gt; items_with(const tripoint &amp;p, const std::function&lt; bool(const item &amp;)&gt; &amp;filter)</div><div class="ttdoc">Find items located at point p (on map or in vehicles) that pass the filter.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l05960">map.cpp:5960</a></div></div>
<div class="ttc" id="aclassvisitable_html_adeb03e3af46e1b106a5f88f112add296"><div class="ttname"><a href="classvisitable.html#adeb03e3af46e1b106a5f88f112add296">visitable::remove_item</a></div><div class="ttdeci">item remove_item(item &amp;it)</div><div class="ttdoc">Removes and returns the item which must be contained by this instance.</div><div class="ttdef"><b>Definition:</b> <a href="visitable_8cpp_source.html#l00543">visitable.cpp:543</a></div></div>
<div class="ttc" id="aclasszone__manager_html_a57b76406598198475140852e43feb6e4"><div class="ttname"><a href="classzone__manager.html#a57b76406598198475140852e43feb6e4">zone_manager::get_point_set_loot</a></div><div class="ttdeci">std::unordered_set&lt; tripoint &gt; get_point_set_loot(const tripoint_abs_ms &amp;where, int radius, const faction_id &amp;fac=your_fac) const</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8cpp_source.html#l00943">clzones.cpp:943</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npctrade__utils_8cpp_03_html_a61dec221ff08c6cff5c896600698b1c7"><div class="ttname"><a href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a61dec221ff08c6cff5c896600698b1c7">anonymous_namespace{npctrade_utils.cpp}::_consume_item</a></div><div class="ttdeci">void _consume_item(item_location elem, consume_queue &amp;consumed, consume_cache &amp;cache, npc &amp;guy, time_duration const &amp;elapsed)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8cpp_source.html#l00024">npctrade_utils.cpp:24</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npctrade__utils_8cpp_03_html_a9201381ead46e0d6cc696ae69cab9e0b"><div class="ttname"><a href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a9201381ead46e0d6cc696ae69cab9e0b">anonymous_namespace{npctrade_utils.cpp}::consume_cache</a></div><div class="ttdeci">std::map&lt; itype_id, int &gt; consume_cache</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8cpp_source.html#l00020">npctrade_utils.cpp:20</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npctrade__utils_8cpp_03_html_a98c2f9c8a00237d07e1deec548161f26"><div class="ttname"><a href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a98c2f9c8a00237d07e1deec548161f26">anonymous_namespace{npctrade_utils.cpp}::consume_queue</a></div><div class="ttdeci">std::vector&lt; item_location &gt; consume_queue</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8cpp_source.html#l00021">npctrade_utils.cpp:21</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00129">point.h:129</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="npctrade__utils_8cpp_source.html#l00024">anonymous_namespace{npctrade_utils.cpp}::_consume_item()</a>, <a class="el" href="npc_8cpp_source.html#l00771">npc::get_fac_id()</a>, <a class="el" href="creature_8cpp_source.html#l03232">Creature::get_location()</a>, <a class="el" href="clzones_8h_source.html#l00550">zone_manager::get_manager()</a>, <a class="el" href="game_8cpp_source.html#l13822">get_map()</a>, <a class="el" href="clzones_8cpp_source.html#l00943">zone_manager::get_point_set_loot()</a>, <a class="el" href="item_8cpp_source.html#l02116">item::is_owned_by()</a>, <a class="el" href="map_8cpp_source.html#l05960">map::items_with()</a>, <a class="el" href="game__constants_8h_source.html#l00070">PICKUP_RANGE</a>, and <a class="el" href="visitable_8cpp_source.html#l00543">visitable::remove_item()</a>.</p>

<p class="reference">Referenced by <a class="el" href="npc_8cpp_source.html#l01933">npc::shop_restock()</a>.</p>

</div>
</div>
<a id="af6d53c14326c1cb0370fa2b249a46a2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af6d53c14326c1cb0370fa2b249a46a2d">&#9670;&nbsp;</a></span>distribute_items_to_npc_zones()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::list&lt;<a class="el" href="classitem.html">item</a>&gt; distribute_items_to_npc_zones </td>
          <td>(</td>
          <td class="paramtype">std::list&lt; <a class="el" href="classitem.html">item</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>items</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classnpc.html">npc</a> &amp;&#160;</td>
          <td class="paramname"><em>guy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade__utils_8cpp_source.html#l00117">117</a> of file <a class="el" href="npctrade__utils_8cpp_source.html">npctrade_utils.cpp</a>.</p>
<div class="fragment"><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;{</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    <a class="code" href="classzone__manager.html">zone_manager</a> &amp;zmgr = <a class="code" href="classzone__manager.html#a54609d51d21bd8f370ee8b59525eb750">zone_manager::get_manager</a>();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <a class="code" href="classmap.html">map</a> &amp;here = <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>();</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> <span class="keyword">const</span> loc_abs = guy.<a class="code" href="classCreature.html#a3261de1530798f5b934a71b9a4e17f5b">get_location</a>();</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <a class="code" href="classstring__id.html">faction_id</a> <span class="keyword">const</span> &amp;fac_id = guy.<a class="code" href="classnpc.html#aef82c9fb32b160e16ace84676297d2b5">get_fac_id</a>();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160; </div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    std::list&lt;item&gt; leftovers;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a7f7f46bc28aabb5b14d6e3be58a317fc">dest_t</a> <span class="keyword">const</span> fallback = <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a66083098aea7fd107678c14e45b952f3">_get_shuffled_point_set</a>(</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                                zmgr.<a class="code" href="classzone__manager.html#a48a7258f14361522cf75baa31967a6c8">get_near</a>( <a class="code" href="npctrade__utils_8cpp.html#a5a86c44ff9433e6f488251b0bc38c0c7">zone_type_LOOT_UNSORTED</a>, loc_abs, <a class="code" href="game__constants_8h.html#afec5544a31d4183805cff025dd84b5f4">PICKUP_RANGE</a>, <span class="keyword">nullptr</span>, fac_id ) );</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <span class="keywordflow">for</span>( <a class="code" href="classitem.html">item</a> <span class="keyword">const</span> &amp;it : items ) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        <a class="code" href="classstring__id.html">zone_type_id</a> <span class="keyword">const</span> zid =</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            zmgr.<a class="code" href="classzone__manager.html#a84d04a4cd3ab24eaaaa9fcffa391d968">get_near_zone_type_for_item</a>( it, loc_abs, <a class="code" href="game__constants_8h.html#afec5544a31d4183805cff025dd84b5f4">PICKUP_RANGE</a>, fac_id );</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a7f7f46bc28aabb5b14d6e3be58a317fc">dest_t</a> dest = zid.<a class="code" href="classstring__id.html#a8ca0e76fa665125f1e50bd1ed8dbd213">is_valid</a>() ? <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a66083098aea7fd107678c14e45b952f3">_get_shuffled_point_set</a>( zmgr.<a class="code" href="classzone__manager.html#a48a7258f14361522cf75baa31967a6c8">get_near</a>(</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                          zid, loc_abs, <a class="code" href="game__constants_8h.html#afec5544a31d4183805cff025dd84b5f4">PICKUP_RANGE</a>, &amp;it, fac_id ) )</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                      : <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a7f7f46bc28aabb5b14d6e3be58a317fc">dest_t</a>();</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        std::copy( fallback.begin(), fallback.end(), std::back_inserter( dest ) );</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="keywordtype">bool</span> leftover = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        <span class="keywordflow">for</span>( <a class="code" href="classcoords_1_1coord__point.html">tripoint_abs_ms</a> <span class="keyword">const</span> &amp;dpoint : dest ) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <a class="code" href="structtripoint.html">tripoint</a> <span class="keyword">const</span> dpoint_here = here.<a class="code" href="classmap.html#a426c21f7244ff80a61685a89e9146fec">getlocal</a>( dpoint );</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            std::optional&lt;vpart_reference&gt; <span class="keyword">const</span> vp = here.<a class="code" href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">veh_at</a>( dpoint_here ).<a class="code" href="classoptional__vpart__position.html#acf1ddbf380ff79f8fd707a0453b1608b">cargo</a>();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="keywordflow">if</span>( vp &amp;&amp; vp-&gt;vehicle().get_owner() == fac_id ) {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                leftover = <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a61e0fab3d264818c2363021fa9f137db">_to_veh</a>( it, vp );</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                leftover = <a class="code" href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#adb772451ba84ab3392bb236ac370a2a5">_to_map</a>( it, here, dpoint_here );</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">if</span>( !leftover ) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;        <span class="keywordflow">if</span>( leftover ) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            leftovers.emplace_back( it );</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    }</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160; </div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">return</span> leftovers;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div>
<div class="ttc" id="aclassmap_html_a426c21f7244ff80a61685a89e9146fec"><div class="ttname"><a href="classmap.html#a426c21f7244ff80a61685a89e9146fec">map::getlocal</a></div><div class="ttdeci">tripoint getlocal(const tripoint &amp;p) const</div><div class="ttdoc">Inverse of getabs.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09635">map.cpp:9635</a></div></div>
<div class="ttc" id="aclassmap_html_aa487d96256c3d35db7a1bf273156b64a"><div class="ttname"><a href="classmap.html#aa487d96256c3d35db7a1bf273156b64a">map::veh_at</a></div><div class="ttdeci">optional_vpart_position veh_at(const tripoint &amp;p) const</div><div class="ttdoc">Checks if tile is occupied by vehicle and by which part.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01316">map.cpp:1316</a></div></div>
<div class="ttc" id="aclassoptional__vpart__position_html_acf1ddbf380ff79f8fd707a0453b1608b"><div class="ttname"><a href="classoptional__vpart__position.html#acf1ddbf380ff79f8fd707a0453b1608b">optional_vpart_position::cargo</a></div><div class="ttdeci">std::optional&lt; vpart_reference &gt; cargo() const</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02710">vehicle.cpp:2710</a></div></div>
<div class="ttc" id="aclassstring__id_html_a8ca0e76fa665125f1e50bd1ed8dbd213"><div class="ttname"><a href="classstring__id.html#a8ca0e76fa665125f1e50bd1ed8dbd213">string_id::is_valid</a></div><div class="ttdeci">bool is_valid() const</div><div class="ttdoc">Returns whether this id is valid, that means whether it refers to an existing object.</div><div class="ttdef"><b>Definition:</b> <a href="achievement_8cpp_source.html#l00078">achievement.cpp:78</a></div></div>
<div class="ttc" id="aclasszone__manager_html_a48a7258f14361522cf75baa31967a6c8"><div class="ttname"><a href="classzone__manager.html#a48a7258f14361522cf75baa31967a6c8">zone_manager::get_near</a></div><div class="ttdeci">std::unordered_set&lt; tripoint_abs_ms &gt; get_near(const zone_type_id &amp;type, const tripoint_abs_ms &amp;where, int range=MAX_DISTANCE, const item *it=nullptr, const faction_id &amp;fac=your_fac) const</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8cpp_source.html#l01134">clzones.cpp:1134</a></div></div>
<div class="ttc" id="aclasszone__manager_html_a84d04a4cd3ab24eaaaa9fcffa391d968"><div class="ttname"><a href="classzone__manager.html#a84d04a4cd3ab24eaaaa9fcffa391d968">zone_manager::get_near_zone_type_for_item</a></div><div class="ttdeci">zone_type_id get_near_zone_type_for_item(const item &amp;it, const tripoint_abs_ms &amp;where, int range=MAX_DISTANCE, const faction_id &amp;fac=your_fac) const</div><div class="ttdef"><b>Definition:</b> <a href="clzones_8cpp_source.html#l01202">clzones.cpp:1202</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npctrade__utils_8cpp_03_html_a61e0fab3d264818c2363021fa9f137db"><div class="ttname"><a href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a61e0fab3d264818c2363021fa9f137db">anonymous_namespace{npctrade_utils.cpp}::_to_veh</a></div><div class="ttdeci">bool _to_veh(item const &amp;it, std::optional&lt; vpart_reference &gt; const &amp;vp)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8cpp_source.html#l00068">npctrade_utils.cpp:68</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npctrade__utils_8cpp_03_html_a66083098aea7fd107678c14e45b952f3"><div class="ttname"><a href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a66083098aea7fd107678c14e45b952f3">anonymous_namespace{npctrade_utils.cpp}::_get_shuffled_point_set</a></div><div class="ttdeci">dest_t _get_shuffled_point_set(std::unordered_set&lt; tripoint_abs_ms &gt; const &amp;set)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8cpp_source.html#l00049">npctrade_utils.cpp:49</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npctrade__utils_8cpp_03_html_a7f7f46bc28aabb5b14d6e3be58a317fc"><div class="ttname"><a href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#a7f7f46bc28aabb5b14d6e3be58a317fc">anonymous_namespace{npctrade_utils.cpp}::dest_t</a></div><div class="ttdeci">std::vector&lt; tripoint_abs_ms &gt; dest_t</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8cpp_source.html#l00022">npctrade_utils.cpp:22</a></div></div>
<div class="ttc" id="anamespaceanonymous__namespace_02npctrade__utils_8cpp_03_html_adb772451ba84ab3392bb236ac370a2a5"><div class="ttname"><a href="namespaceanonymous__namespace_02npctrade__utils_8cpp_03.html#adb772451ba84ab3392bb236ac370a2a5">anonymous_namespace{npctrade_utils.cpp}::_to_map</a></div><div class="ttdeci">bool _to_map(item const &amp;it, map &amp;here, tripoint const &amp;dpoint_here)</div><div class="ttdef"><b>Definition:</b> <a href="npctrade__utils_8cpp_source.html#l00058">npctrade_utils.cpp:58</a></div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="npctrade__utils_8cpp_source.html#l00049">anonymous_namespace{npctrade_utils.cpp}::_get_shuffled_point_set()</a>, <a class="el" href="npctrade__utils_8cpp_source.html#l00058">anonymous_namespace{npctrade_utils.cpp}::_to_map()</a>, <a class="el" href="npctrade__utils_8cpp_source.html#l00068">anonymous_namespace{npctrade_utils.cpp}::_to_veh()</a>, <a class="el" href="vehicle_8cpp_source.html#l02710">optional_vpart_position::cargo()</a>, <a class="el" href="npc_8cpp_source.html#l00771">npc::get_fac_id()</a>, <a class="el" href="creature_8cpp_source.html#l03232">Creature::get_location()</a>, <a class="el" href="clzones_8h_source.html#l00550">zone_manager::get_manager()</a>, <a class="el" href="game_8cpp_source.html#l13822">get_map()</a>, <a class="el" href="clzones_8cpp_source.html#l01134">zone_manager::get_near()</a>, <a class="el" href="clzones_8cpp_source.html#l01202">zone_manager::get_near_zone_type_for_item()</a>, <a class="el" href="map_8cpp_source.html#l09635">map::getlocal()</a>, <a class="el" href="achievement_8cpp_source.html#l00078">string_id&lt; T &gt;::is_valid()</a>, <a class="el" href="game__constants_8h_source.html#l00070">PICKUP_RANGE</a>, <a class="el" href="map_8cpp_source.html#l01316">map::veh_at()</a>, and <a class="el" href="npctrade__utils_8cpp.html#a5a86c44ff9433e6f488251b0bc38c0c7">zone_type_LOOT_UNSORTED</a>.</p>

<p class="reference">Referenced by <a class="el" href="mission__companion_8cpp_source.html#l01952">talk_function::hospital_raid_return()</a>, <a class="el" href="mission__companion_8cpp_source.html#l01847">talk_function::scavenging_raid_return()</a>, <a class="el" href="npc_8cpp_source.html#l01933">npc::shop_restock()</a>, and <a class="el" href="npctrade_8cpp_source.html#l00278">npc_trading::trade()</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a13b5614909a98d0b41801d8b074d8c91"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13b5614909a98d0b41801d8b074d8c91">&#9670;&nbsp;</a></span>fallback_name</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr char const* fallback_name = &quot;NPC Shopkeeper unsorted fallback zone&quot;</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="npctrade__utils_8h_source.html#l00010">10</a> of file <a class="el" href="npctrade__utils_8h_source.html">npctrade_utils.h</a>.</p>

<p class="reference">Referenced by <a class="el" href="npctrade__utils_8cpp_source.html#l00079">add_fallback_zone()</a>, and <a class="el" href="trade__ui_8cpp_source.html#l00105">trade_ui::trade_ui()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 7 2024 08:48:34 for Cataclysm DDA by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
