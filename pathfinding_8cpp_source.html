<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Cataclysm DDA: src/pathfinding.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Cataclysm DDA
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">pathfinding.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="pathfinding_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="pathfinding_8h.html">pathfinding.h</a>&quot;</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160; </div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;array&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;cstdlib&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;iterator&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;optional&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;queue&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;utility&gt;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="cata__utility_8h.html">cata_utility.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="coordinates_8h.html">coordinates.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="debug_8h.html">debug.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="game_8h.html">game.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gates_8h.html">gates.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="line_8h.html">line.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="map_8h.html">map.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="mapdata_8h.html">mapdata.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="point_8h.html">point.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="submap_8h.html">submap.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="trap_8h.html">trap.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="type__id_8h.html">type_id.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="veh__type_8h.html">veh_type.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vehicle_8h.html">vehicle.h</a>&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="vpart__position_8h.html">vpart_position.h</a>&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">// Turns two indexed to a 2D array into an index to equivalent 1D array</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">   31</a></span>&#160;<span class="keyword">static</span> constexpr <span class="keywordtype">int</span> <a class="code" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a>( <span class="keyword">const</span> <a class="code" href="structpoint.html">point</a> &amp;p )</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;{</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">return</span> ( p.<a class="code" href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">x</a> * <a class="code" href="game__constants_8h.html#a2b6d307dfab13601267fc3c627192f4e">MAPSIZE_Y</a> ) + p.<a class="code" href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">y</a>;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;}</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">// Flattened 2D array representing a single z-level worth of pathfinding data</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="structpath__data__layer.html">   37</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structpath__data__layer.html">path_data_layer</a> {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">// Closed/open is accessed way more often than all other values here</span></div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">   39</a></span>&#160;    std::bitset&lt; MAPSIZE_X *MAPSIZE_Y &gt; <a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>;</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="structpath__data__layer.html#a28aae58e8aa5eb15f019b60d80046a37">   40</a></span>&#160;    std::bitset&lt; MAPSIZE_X *MAPSIZE_Y &gt; <a class="code" href="structpath__data__layer.html#a28aae58e8aa5eb15f019b60d80046a37">open</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">   41</a></span>&#160;    std::array&lt; int, MAPSIZE_X *MAPSIZE_Y &gt; <a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">   42</a></span>&#160;    std::array&lt; int, MAPSIZE_X *MAPSIZE_Y &gt; <a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="structpath__data__layer.html#a5bdd7b1a04edd26fb2c69fc96d867c66">   43</a></span>&#160;    std::array&lt; tripoint, MAPSIZE_X *MAPSIZE_Y &gt; <a class="code" href="structpath__data__layer.html#a5bdd7b1a04edd26fb2c69fc96d867c66">parent</a>;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="structpath__data__layer.html#ac02eadaeb679ced09f671618a8e20487">   45</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structpath__data__layer.html#ac02eadaeb679ced09f671618a8e20487">reset</a>() {</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>.reset();</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <a class="code" href="structpath__data__layer.html#a28aae58e8aa5eb15f019b60d80046a37">open</a>.reset();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;};</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="structpathfinder.html">   51</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structpathfinder.html">pathfinder</a> {</div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="structpathfinder.html#a19c47931c0e5c4fecfc7eaa828c12636">   52</a></span>&#160;    <span class="keyword">using</span> <a class="code" href="structpathfinder.html#a19c47931c0e5c4fecfc7eaa828c12636">queue_type</a> =</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        std::priority_queue&lt; std::pair&lt;int, tripoint&gt;, std::vector&lt; std::pair&lt;int, tripoint&gt; &gt;, <a class="code" href="structpair__greater__cmp__first.html">pair_greater_cmp_first</a> &gt;;</div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">   54</a></span>&#160;    <a class="code" href="structpathfinder.html#a19c47931c0e5c4fecfc7eaa828c12636">queue_type</a> <a class="code" href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">open</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="structpathfinder.html#a330d627fcb4c3e55b4ed7ba26aaaf7df">   55</a></span>&#160;    std::array&lt; std::unique_ptr&lt; path_data_layer &gt;, <a class="code" href="game__constants_8h.html#a3b81841aab42975add2ee3525f48058a">OVERMAP_LAYERS</a> &gt; <a class="code" href="structpathfinder.html#a330d627fcb4c3e55b4ed7ba26aaaf7df">path_data</a>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="structpathfinder.html#a3c00ab47aac12bbdf5ace224fb47591d">   57</a></span>&#160;    <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;<a class="code" href="structpathfinder.html#a3c00ab47aac12bbdf5ace224fb47591d">get_layer</a>( <span class="keyword">const</span> <span class="keywordtype">int</span> z ) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        std::unique_ptr&lt; path_data_layer &gt; &amp;ptr = <a class="code" href="structpathfinder.html#a330d627fcb4c3e55b4ed7ba26aaaf7df">path_data</a>[z + <a class="code" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>];</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">if</span>( ptr != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            <span class="keywordflow">return</span> *ptr;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        }</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        ptr = std::make_unique&lt;path_data_layer&gt;();</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <span class="keywordflow">return</span> *ptr;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structpathfinder.html#a78609d9a28d759c0c568cbc0e354f553">   66</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structpathfinder.html#a78609d9a28d759c0c568cbc0e354f553">reset</a>( <span class="keywordtype">int</span> minz, <span class="keywordtype">int</span> maxz ) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i = minz; i &lt;= maxz; ++i ) {</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            std::unique_ptr&lt; path_data_layer &gt; &amp;ptr = <a class="code" href="structpathfinder.html#a330d627fcb4c3e55b4ed7ba26aaaf7df">path_data</a>[i + <a class="code" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>];</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">if</span>( ptr != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <a class="code" href="structpathfinder.html#a330d627fcb4c3e55b4ed7ba26aaaf7df">path_data</a>[i + <a class="code" href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a>]-&gt;reset();</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        }</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <a class="code" href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">open</a> = <a class="code" href="structpathfinder.html#a19c47931c0e5c4fecfc7eaa828c12636">queue_type</a>();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    }</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160; </div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="structpathfinder.html#a083a5fbadeb8cbaf3c408c093e90479b">   76</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structpathfinder.html#a083a5fbadeb8cbaf3c408c093e90479b">empty</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">open</a>.empty();</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno"><a class="line" href="structpathfinder.html#ae4022c0a90aef5de1430e41dae3c8391">   80</a></span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="structpathfinder.html#ae4022c0a90aef5de1430e41dae3c8391">get_next</a>() {</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="keyword">const</span> <span class="keyword">auto</span> pt = <a class="code" href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">open</a>.top();</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        <a class="code" href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">open</a>.pop();</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="keywordflow">return</span> pt.second;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    }</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="structpathfinder.html#ab7b80d453998f12d82f075db97234f05">   86</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structpathfinder.html#ab7b80d453998f12d82f075db97234f05">add_point</a>( <span class="keyword">const</span> <span class="keywordtype">int</span> gscore, <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classscore.html">score</a>, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;from, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;to ) {</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="structpathfinder.html#a3c00ab47aac12bbdf5ace224fb47591d">get_layer</a>( to.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> index = <a class="code" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a>( to.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keywordflow">if</span>( layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] ) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keywordflow">if</span>( layer.<a class="code" href="structpath__data__layer.html#a28aae58e8aa5eb15f019b60d80046a37">open</a>[index] &amp;&amp; gscore &gt;= layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[index] ) {</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        }</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        layer.<a class="code" href="structpath__data__layer.html#a28aae58e8aa5eb15f019b60d80046a37">open</a>[index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[index] = gscore;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        layer.<a class="code" href="structpath__data__layer.html#a5bdd7b1a04edd26fb2c69fc96d867c66">parent</a>[index] = from;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        layer.<a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a> [index] = <a class="code" href="classscore.html">score</a>;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <a class="code" href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">open</a>.emplace( <a class="code" href="classscore.html">score</a>, to );</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    }</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno"><a class="line" href="structpathfinder.html#aab715954a28f2efa66c81e0b65284f10">  103</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structpathfinder.html#aab715954a28f2efa66c81e0b65284f10">close_point</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p ) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="structpathfinder.html#a3c00ab47aac12bbdf5ace224fb47591d">get_layer</a>( p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> index = <a class="code" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a>( p.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="structpathfinder.html#a0e8ca462eec97c81030745935f80935f">  109</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="structpathfinder.html#a0e8ca462eec97c81030745935f80935f">unclose_point</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p ) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="structpathfinder.html#a3c00ab47aac12bbdf5ace224fb47591d">get_layer</a>( p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> index = <a class="code" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a>( p.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    }</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;};</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno"><a class="line" href="pathfinding_8cpp.html#af9280c7df7cc38110497fea42349bfa7">  116</a></span>&#160;<span class="keyword">static</span> <a class="code" href="structpathfinder.html">pathfinder</a> <a class="code" href="pathfinding_8cpp.html#af9280c7df7cc38110497fea42349bfa7">pf</a>;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160; </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">// Modifies `t` to point to a tile with `flag` in a 1-submap radius of `t`&#39;s original value,</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">// searching nearest points first (starting with `t` itself).</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">// return false if it could not find a suitable point</span></div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="pathfinding_8cpp.html#afec8831dd25a3475c346d71c4765efdb">  121</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="pathfinding_8cpp.html#afec8831dd25a3475c346d71c4765efdb">vertical_move_destination</a>( <span class="keyword">const</span> <a class="code" href="classmap.html">map</a> &amp;m, <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054">ter_furn_flag</a> flag, <a class="code" href="structtripoint.html">tripoint</a> &amp;t )</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;{</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keyword">const</span> <a class="code" href="structpathfinding__cache.html">pathfinding_cache</a> &amp;pf_cache = m.<a class="code" href="classmap.html#ad357c4299f89a66ece9df0c3edc4401d">get_pathfinding_cache_ref</a>( t.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structpoint.html">point</a> &amp;p : <a class="code" href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a>( t.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), <a class="code" href="game__constants_8h.html#a39fd8a829e3dc412646663066dbdb54c">SEEX</a> ) ) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="keywordflow">if</span>( pf_cache.<a class="code" href="structpathfinding__cache.html#a7a9d431915c689367774248820b3b5a5">special</a>[p.x][p.y] &amp; <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a55f8aaf1025c549edc7e26cd6f4595ac">PF_UPDOWN</a> ) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> t2( p, t.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            <span class="keywordflow">if</span>( m.<a class="code" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( flag, t2 ) ) {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                t = t2;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    }</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;}</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="keyword">template</span>&lt;<span class="keyword">class</span> Set1, <span class="keyword">class</span> Set2&gt;</div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="pathfinding_8cpp.html#ae55025945fb76acd7d5234497a47c78c">  137</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="pathfinding_8cpp.html#ae55025945fb76acd7d5234497a47c78c">is_disjoint</a>( <span class="keyword">const</span> Set1 &amp;set1, <span class="keyword">const</span> Set2 &amp;set2 )</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;{</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <span class="keywordflow">if</span>( set1.empty() || set2.empty() ) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;    }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;    <span class="keyword">typename</span> Set1::const_iterator it1 = set1.begin();</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keyword">typename</span> Set1::const_iterator it1_end = set1.end();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160; </div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keyword">typename</span> Set2::const_iterator it2 = set2.begin();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <span class="keyword">typename</span> Set2::const_iterator it2_end = set2.end();</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span>( *set2.rbegin() &lt; *it1 || *set1.rbegin() &lt; *it2 ) {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160; </div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="keywordflow">while</span>( it1 != it1_end &amp;&amp; it2 != it2_end ) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">if</span>( *it1 == *it2 ) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        <span class="keywordflow">if</span>( *it1 &lt; *it2 ) {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            it1++;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            it2++;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;        }</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    }</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160; </div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160; </div>
<div class="line"><a name="l00167"></a><span class="lineno"><a class="line" href="classmap.html#a9fe6f81443a4ae45012d6e664efb74c2">  167</a></span>&#160;std::vector&lt;tripoint&gt; <a class="code" href="classmap.html#a9fe6f81443a4ae45012d6e664efb74c2">map::straight_route</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;f, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;t )<span class="keyword"> const</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    std::vector&lt;tripoint&gt; <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <span class="keywordflow">if</span>( f == t || !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( f ) ) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( t ) ) {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> clipped = t;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <a class="code" href="classmap.html#a6de7bd08f979537c8dcda8ebdc7e6d1e">clip_to_bounds</a>( clipped );</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classmap.html#a9fe6f81443a4ae45012d6e664efb74c2">straight_route</a>( f, clipped );</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    }</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span>( f.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == t.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a> = <a class="code" href="coordinates_8h.html#a31847b31c6ef002e9d16afd7fd0005e3">line_to</a>( f, t );</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keyword">const</span> <a class="code" href="structpathfinding__cache.html">pathfinding_cache</a> &amp;pf_cache = <a class="code" href="classmap.html#ad357c4299f89a66ece9df0c3edc4401d">get_pathfinding_cache_ref</a>( f.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="comment">// Check all points for any special case (including just hard terrain)</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="keywordflow">if</span>( std::any_of( <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.begin(), <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.end(), [&amp;pf_cache]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        constexpr pf_special non_normal = PF_SLOW | PF_WALL | PF_VEHICLE | PF_TRAP | PF_SHARP;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        return pf_cache.special[p.x][p.y] &amp; non_normal;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        } ) ) {</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;            <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.clear();</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;}</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno"><a class="line" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">  192</a></span>&#160;std::vector&lt;tripoint&gt; <a class="code" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">map::route</a>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;f, <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;t,</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                  <span class="keyword">const</span> <a class="code" href="structpathfinding__settings.html">pathfinding_settings</a> &amp;settings,</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                  <span class="keyword">const</span> std::unordered_set&lt;tripoint&gt; &amp;pre_closed )<span class="keyword"> const</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">/* TODO: If the origin or destination is out of bound, figure out the closest</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">     * in-bounds point and go to that, then to the real origin/destination.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    std::vector&lt;tripoint&gt; <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keywordflow">if</span>( f == t || !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( f ) ) {</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    }</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160; </div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( t ) ) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> clipped = t;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <a class="code" href="classmap.html#a6de7bd08f979537c8dcda8ebdc7e6d1e">clip_to_bounds</a>( clipped );</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">route</a>( f, clipped, settings, pre_closed );</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    }</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;    <span class="comment">// First, check for a simple straight line on flat ground</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;    <span class="comment">// Except when the line contains a pre-closed tile - we need to do regular pathing then</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    <span class="keywordflow">if</span>( f.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> == t.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keyword">auto</span> line_path = <a class="code" href="classmap.html#a9fe6f81443a4ae45012d6e664efb74c2">straight_route</a>( f, t );</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordflow">if</span>( !line_path.empty() ) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordflow">if</span>( std::none_of( line_path.begin(), line_path.end(), [&amp;pre_closed]( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            return pre_closed.count( p );</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            } ) ) {</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="keywordflow">return</span> line_path;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160; </div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;    <span class="comment">// If expected path length is greater than max distance, allow only line path, like above</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( f, t ) &gt; settings.<a class="code" href="structpathfinding__settings.html#ad0b14e2ee3fc5bb59d985e98e2fa9504">max_dist</a> ) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;    }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> max_length = settings.<a class="code" href="structpathfinding__settings.html#a3b87b50c231e1614cf7b3d1ba8ac3feb">max_length</a>;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a> = settings.<a class="code" href="structpathfinding__settings.html#ab8d46d403f59fc4e86ee1392c0a7b05a">bash_strength</a>;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> climb_cost = settings.<a class="code" href="structpathfinding__settings.html#ad6c8b466453d6bd53db004ce7ab625c4">climb_cost</a>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> <a class="code" href="namespacedoors.html">doors</a> = settings.<a class="code" href="structpathfinding__settings.html#a559966d37cd11c7dc42cc856e550f66a">allow_open_doors</a>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> locks = settings.<a class="code" href="structpathfinding__settings.html#a43905661151e40ed74bd75e8030d6622">allow_unlock_doors</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> trapavoid = settings.<a class="code" href="structpathfinding__settings.html#acba070ceb6ae16b9c3991a1d2814d4c8">avoid_traps</a>;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> roughavoid = settings.<a class="code" href="structpathfinding__settings.html#a0382d7086559f7f5c7c9c44eba612311">avoid_rough_terrain</a>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">bool</span> sharpavoid = settings.<a class="code" href="structpathfinding__settings.html#ab888f81c3ce0d4f691e9f8619cf31328">avoid_sharp</a>;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">int</span> pad = 16;  <span class="comment">// Should be much bigger - low value makes pathfinders dumb!</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>( <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( f.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, t.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> ) - pad, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( f.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, t.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> ) - pad, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">std::min</a>( f.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, t.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) );</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>( <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( f.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, t.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> ) + pad, <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( f.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, t.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> ) + pad, <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">std::max</a>( f.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, t.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) );</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    <a class="code" href="classmap.html#a6de7bd08f979537c8dcda8ebdc7e6d1e">clip_to_bounds</a>( <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.x, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.y, <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.z );</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <a class="code" href="classmap.html#a6de7bd08f979537c8dcda8ebdc7e6d1e">clip_to_bounds</a>( <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.x, <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.y, <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.z );</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160; </div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <a class="code" href="namespacepf.html">pf</a>.reset( <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.z, <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.z );</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    <span class="comment">// Make NPCs not want to path through player</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="comment">// But don&#39;t make player pathing stop working</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    <span class="keywordflow">for</span>( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;p : pre_closed ) {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">if</span>( p.x &gt;= <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.x &amp;&amp; p.x &lt; <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.x &amp;&amp; p.y &gt;= <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.y &amp;&amp; p.y &lt; <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.y ) {</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <a class="code" href="namespacepf.html">pf</a>.close_point( p );</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        }</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;    }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160; </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <span class="comment">// Start and end must not be closed</span></div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;    <a class="code" href="namespacepf.html">pf</a>.unclose_point( f );</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <a class="code" href="namespacepf.html">pf</a>.unclose_point( t );</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="namespacepf.html">pf</a>.add_point( 0, 0, f, f );</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160; </div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordtype">bool</span> done = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160; </div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    constexpr <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55">pf_special</a> non_normal = <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55aecc59352ad14424c7d789446dc655e0f">PF_SLOW</a> | <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a19b842b59c62891e6a86c1b22752b2d9">PF_WALL</a> | <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a05850be5e3f2c1bfcbaad5d43fa8b366">PF_VEHICLE</a> | <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55accbf1609e79c6baaf7bf745d0ecd0f54">PF_TRAP</a> | <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55ae0b53a72c5504a50f28bb80be75e6b4c">PF_SHARP</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">do</span> {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> cur = <a class="code" href="namespacepf.html">pf</a>.get_next();</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160; </div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">int</span> parent_index = <a class="code" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a>( cur.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;        <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span>( layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[parent_index] ) {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;        }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160; </div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        <span class="keywordflow">if</span>( layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] &gt; max_length ) {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            <span class="comment">// Shortest path would be too long, return empty vector</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">return</span> std::vector&lt;tripoint&gt;();</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        <span class="keywordflow">if</span>( cur == t ) {</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        }</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160; </div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[parent_index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160; </div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        <span class="keyword">const</span> <a class="code" href="structpathfinding__cache.html">pathfinding_cache</a> &amp;pf_cache = <a class="code" href="classmap.html#ad357c4299f89a66ece9df0c3edc4401d">get_pathfinding_cache_ref</a>( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        <span class="keyword">const</span> <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55">pf_special</a> cur_special = pf_cache.<a class="code" href="structpathfinding__cache.html#a7a9d431915c689367774248820b3b5a5">special</a>[cur.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>][cur.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>];</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160; </div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        <span class="comment">// 7 3 5</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="comment">// 1 . 2</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <span class="comment">// 6 4 8</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        constexpr std::array&lt;int, 8&gt; x_offset{{ -1,  1,  0,  0,  1, -1, -1, 1 }};</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        constexpr std::array&lt;int, 8&gt; y_offset{{  0,  0, -1,  1, -1,  1, -1, 1 }};</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> i = 0; i &lt; 8; i++ ) {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> p( cur.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> + x_offset[i], cur.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> + y_offset[i], cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> index = <a class="code" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a>( p.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="comment">// TODO: Remove this and instead have sentinels at the edges</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="keywordflow">if</span>( p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> &lt; <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.x || p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> &gt;= <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.x || p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> &lt; <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.y || p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> &gt;= <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.y ) {</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">if</span>( layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] ) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            <span class="comment">// Penalize for diagonals or the path will look &quot;unnatural&quot;</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="keywordtype">int</span> newg = layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] + ( ( cur.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> != p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> &amp;&amp; cur.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> != p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> ) ? 1 : 0 );</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160; </div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keyword">const</span> <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55">pf_special</a> p_special = pf_cache.<a class="code" href="structpathfinding__cache.html#a7a9d431915c689367774248820b3b5a5">special</a>[p.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>][p.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>];</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="comment">// TODO: De-uglify, de-huge-n</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;            <span class="keywordflow">if</span>( !( p_special &amp; non_normal ) ) {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                <span class="comment">// Boring flat dirt - the most common case above the ground</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                newg += 2;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                <span class="keywordflow">if</span>( roughavoid ) {</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                    layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>; <span class="comment">// Close all rough terrain tiles</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                <span class="keywordtype">int</span> part = -1;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                <span class="keyword">const</span> <a class="code" href="classmaptile__impl.html">const_maptile</a> &amp;tile = <a class="code" href="classmap.html#ad657dde349de750c36163b30b3e9bdc6">maptile_at_internal</a>( p );</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;                <span class="keyword">const</span> <a class="code" href="structter__t.html">ter_t</a> &amp;<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a> = tile.<a class="code" href="classmaptile__impl.html#a0629376a52a7a2f0ac1f55dcb93290a1">get_ter_t</a>();</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                <span class="keyword">const</span> <a class="code" href="structfurn__t.html">furn_t</a> &amp;<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">furniture</a> = tile.<a class="code" href="classmaptile__impl.html#a5d1ab7324df577e978041f6e9881144c">get_furn_t</a>();</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                <span class="keyword">const</span> <a class="code" href="classfield.html">field</a> &amp;<a class="code" href="classfield.html">field</a> = tile.<a class="code" href="classmaptile__impl.html#a0855cf23c4e9e44b1d35fcb01deb0137">get_field</a>();</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                <span class="keyword">const</span> <a class="code" href="classvehicle.html">vehicle</a> *veh = <a class="code" href="classmap.html#ab822562ab4d1069ff53486f67098d0da">veh_at_internal</a>( p, part );</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160; </div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> cost = <a class="code" href="classmap.html#a55e7db287690ab6aa7dbe5bf422e3a29">move_cost_internal</a>( <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">furniture</a>, <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>, <a class="code" href="classfield.html">field</a>, veh, part );</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                <span class="comment">// Don&#39;t calculate bash rating unless we intend to actually use it</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                <span class="keyword">const</span> <span class="keywordtype">int</span> rating = ( <a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a> == 0 || cost != 0 ) ? -1 :</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                                   <a class="code" href="classmap.html#a73ef839e31b07dcdccedb77368cd92ea">bash_rating_internal</a>( <a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a>, <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">furniture</a>, <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>, <span class="keyword">false</span>, veh, part );</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                <span class="keywordflow">if</span>( cost == 0 &amp;&amp; rating &lt;= 0 &amp;&amp; ( !<a class="code" href="namespacedoors.html">doors</a> || !<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>.open || !<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">furniture</a>.open ) &amp;&amp; veh == <span class="keyword">nullptr</span> &amp;&amp;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                    climb_cost &lt;= 0 ) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                    layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>; <span class="comment">// Close it so that next time we won&#39;t try to calculate costs</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160; </div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                newg += cost;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="keywordflow">if</span>( cost == 0 ) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                    <span class="keywordflow">if</span>( climb_cost &gt; 0 &amp;&amp; p_special &amp; <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a24c5298c256b8ee4de60ce1872396d7b">PF_CLIMBABLE</a> ) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                        <span class="comment">// Climbing fences</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                        newg += climb_cost;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="namespacedoors.html">doors</a> &amp;&amp; ( <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>.open || <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">furniture</a>.open ) &amp;&amp;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                               ( ( !<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>.has_flag( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac4a81a25e90b04b9a92e0ec8945aad48">ter_furn_flag::TFLAG_OPENCLOSE_INSIDE</a> ) &amp;&amp;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                                   !<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">furniture</a>.has_flag( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac4a81a25e90b04b9a92e0ec8945aad48">ter_furn_flag::TFLAG_OPENCLOSE_INSIDE</a> ) ) ||</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                 !<a class="code" href="classmap.html#a3bc75c8b706a54c1575b4460b2f363b1">is_outside</a>( cur ) ) ) {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                        <span class="comment">// Only try to open INSIDE doors from the inside</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                        <span class="comment">// To open and then move onto the tile</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                        newg += 4;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( veh != <span class="keyword">nullptr</span> ) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                        <span class="keyword">const</span> <span class="keyword">auto</span> vpobst = <a class="code" href="classvpart__position.html">vpart_position</a>( <span class="keyword">const_cast&lt;</span><a class="code" href="classvehicle.html">vehicle</a> &amp;<span class="keyword">&gt;</span>( *veh ), part ).<a class="code" href="classvpart__position.html#a3888b23941b14d5931801b7afe3e3eb8">obstacle_at_part</a>();</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                        part = vpobst ? vpobst-&gt;part_index() : -1;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                        <span class="keywordtype">int</span> dummy = -1;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">bool</span> is_outside_veh = <a class="code" href="classmap.html#ab822562ab4d1069ff53486f67098d0da">veh_at_internal</a>( cur, dummy ) != veh;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                        <span class="keywordflow">if</span>( <a class="code" href="namespacedoors.html">doors</a> &amp;&amp; part != -1 &amp;&amp; veh-&gt;<a class="code" href="classvehicle.html#aa3c434ad827415575b465480af310487">next_part_to_open</a>( part, is_outside_veh ) != -1 ) {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                            <span class="comment">// Handle car doors, but don&#39;t try to path through curtains</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                            newg += 10; <span class="comment">// One turn to open, 4 to move there</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( locks &amp;&amp; veh-&gt;<a class="code" href="classvehicle.html#a316ae13526323d2e762ee54d4161a064">next_part_to_unlock</a>( part, is_outside_veh ) != -1 ) {</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                            newg += 12; <span class="comment">// 2 turns to open, 4 to move there</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( part &gt;= 0 &amp;&amp; <a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a> &gt; 0 ) {</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                            <span class="comment">// Car obstacle that isn&#39;t a door</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                            <span class="comment">// TODO: Account for armor</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                            <span class="keywordtype">int</span> <a class="code" href="display_8h.html#ad55df0d7f625a78f1afc728ee1a6d6a4ad2ccda10db94c2b5d51beed10484c025">hp</a> = veh-&gt;<a class="code" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a>( part ).<a class="code" href="structvehicle__part.html#a957611df4a4b4faa87f67ff64bea72ce">hp</a>();</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                            <span class="keywordflow">if</span>( <a class="code" href="display_8h.html#ad55df0d7f625a78f1afc728ee1a6d6a4ad2ccda10db94c2b5d51beed10484c025">hp</a> / 20 &gt; <a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a> ) {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                                <span class="comment">// Threshold damage thing means we just can&#39;t bash this down</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                                layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="display_8h.html#ad55df0d7f625a78f1afc728ee1a6d6a4ad2ccda10db94c2b5d51beed10484c025">hp</a> / 10 &gt; <a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a> ) {</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                <span class="comment">// Threshold damage thing means we will fail to deal damage pretty often</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                                <a class="code" href="display_8h.html#ad55df0d7f625a78f1afc728ee1a6d6a4ad2ccda10db94c2b5d51beed10484c025">hp</a> *= 2;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                            }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160; </div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                            newg += 2 * <a class="code" href="display_8h.html#ad55df0d7f625a78f1afc728ee1a6d6a4ad2ccda10db94c2b5d51beed10484c025">hp</a> / <a class="code" href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">bash</a> + 8 + 4;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( part &gt;= 0 ) {</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structvehicle__part.html">vehicle_part</a> &amp;vp = veh-&gt;<a class="code" href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">part</a>( part );</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                            <span class="keywordflow">if</span>( !<a class="code" href="namespacedoors.html">doors</a> || !vp.<a class="code" href="structvehicle__part.html#a002a1023cd1a96d43556a1b912ebd27b">info</a>().<a class="code" href="classvpart__info.html#aea0fdb1ef9041e28d7856afae97dcc87">has_flag</a>( <a class="code" href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea812fb775f113f8e70717ffcf2dacf15f">VPFLAG_OPENABLE</a> ) ) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                                <span class="comment">// Won&#39;t be openable, don&#39;t try from other sides</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                            }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                        }</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rating &gt; 1 ) {</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                        <span class="comment">// Expected number of turns to bash it down, 1 turn to move there</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        <span class="comment">// and 5 turns of penalty not to trash everything just because we can</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                        newg += ( 20 / rating ) + 2 + 10;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( rating == 1 ) {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                        <span class="comment">// Desperate measures, avoid whenever possible</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        newg += 500;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                        <span class="comment">// Unbashable and unopenable from here</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                        <span class="keywordflow">if</span>( !<a class="code" href="namespacedoors.html">doors</a> || !<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>.open || !<a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">furniture</a>.open ) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                            <span class="comment">// Or anywhere else for that matter</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                            layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                        }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160; </div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                    }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;                <span class="keywordflow">if</span>( trapavoid &amp;&amp; ( p_special &amp; <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55accbf1609e79c6baaf7bf745d0ecd0f54">PF_TRAP</a> ) ) {</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                    <span class="keyword">const</span> <a class="code" href="structtrap.html">trap</a> &amp;ter_trp = <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>.trap.obj();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                    <span class="keyword">const</span> <a class="code" href="structtrap.html">trap</a> &amp;trp = ter_trp.<a class="code" href="structtrap.html#adc8f59b97597d373f7cb0bbcf061e794">is_benign</a>() ? tile.<a class="code" href="classmaptile__impl.html#a9711662eea34df49d38f835dc227cefb">get_trap_t</a>() : ter_trp;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                    <span class="keywordflow">if</span>( !trp.<a class="code" href="structtrap.html#adc8f59b97597d373f7cb0bbcf061e794">is_benign</a>() ) {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                        <span class="comment">// For now make them detect all traps</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                        <span class="keywordflow">if</span>( <a class="code" href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">terrain</a>.has_flag( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af607730a38ff7975c6724b22881e0e58">ter_furn_flag::TFLAG_NO_FLOOR</a> ) ) {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                            <span class="comment">// Special case - ledge in z-levels</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;                            <span class="comment">// Warning: really expensive, needs a cache</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                            <span class="keywordflow">if</span>( <a class="code" href="classmap.html#a3188771064ca49d4798c6a80bfad0fcd">valid_move</a>( p, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">tripoint</a>( p.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - 1 ), <span class="keyword">false</span>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                                <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a>( p.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - 1 );</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;                                <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a27e22f0999ea03eff18babc48643c568">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af607730a38ff7975c6724b22881e0e58">ter_furn_flag::TFLAG_NO_FLOOR</a>, <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a> ) ) {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                                    <span class="comment">// Otherwise this would have been a huge fall</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                                    <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( p.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - 1 );</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                                    <span class="comment">// From cur, not p, because we won&#39;t be walking on air</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                                    <a class="code" href="namespacepf.html">pf</a>.add_point( layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] + 10,</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                                                  layer.<a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a>[parent_index] + 10 + 2 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a>, t ),</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                                  cur, <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a> );</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                                }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                                <span class="comment">// Close p, because we won&#39;t be walking on it</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                                layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                            }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;                            <span class="comment">// Otherwise it&#39;s walkable</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                            newg += 500;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                        }</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                    }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                <span class="keywordflow">if</span>( sharpavoid &amp;&amp; p_special &amp; <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55ae0b53a72c5504a50f28bb80be75e6b4c">PF_SHARP</a> ) {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    layer.<a class="code" href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">closed</a>[index] = <span class="keyword">true</span>; <span class="comment">// Avoid sharp things</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                }</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160; </div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            }</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            <a class="code" href="namespacepf.html">pf</a>.add_point( newg, newg + 2 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( p, t ), cur, p );</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;        }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;        <span class="keywordflow">if</span>( !( cur_special &amp; <a class="code" href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a55f8aaf1025c549edc7e26cd6f4595ac">PF_UPDOWN</a> ) || !settings.<a class="code" href="structpathfinding__settings.html#a63add695745ea192d4464597716ebc7d">allow_climb_stairs</a> ) {</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <span class="comment">// The part below is only for z-level pathing</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;        }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;        <span class="keywordtype">bool</span> rope_ladder = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;        <span class="keyword">const</span> <a class="code" href="classmaptile__impl.html">const_maptile</a> &amp;parent_tile = <a class="code" href="classmap.html#ad657dde349de750c36163b30b3e9bdc6">maptile_at_internal</a>( cur );</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;        <span class="keyword">const</span> <a class="code" href="structter__t.html">ter_t</a> &amp;parent_terrain = parent_tile.<a class="code" href="classmaptile__impl.html#a0629376a52a7a2f0ac1f55dcb93290a1">get_ter_t</a>();</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        <span class="keywordflow">if</span>( settings.<a class="code" href="structpathfinding__settings.html#a63add695745ea192d4464597716ebc7d">allow_climb_stairs</a> &amp;&amp; cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> &gt; <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.z &amp;&amp;</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;            parent_terrain.<a class="code" href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ab09f2463f4ce060d051439b5535a47e6">ter_furn_flag::TFLAG_GOES_DOWN</a> ) ) {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            std::optional&lt;tripoint&gt; opt_dest = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;find_or_make_stairs( <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>(),</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                                               cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - 1, rope_ladder, <span class="keyword">false</span>, cur );</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;            <span class="keywordflow">if</span>( !opt_dest ) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;            }</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;            <a class="code" href="structtripoint.html">tripoint</a> dest = opt_dest.value();</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="pathfinding_8cpp.html#afec8831dd25a3475c346d71c4765efdb">vertical_move_destination</a>( *<span class="keyword">this</span>, <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a589ce1673849a76ea3bf17df3fe84ab3">ter_furn_flag::TFLAG_GOES_UP</a>, dest ) ) {</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( dest ) ) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( dest.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                <a class="code" href="namespacepf.html">pf</a>.add_point( layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] + 2,</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                              layer.<a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a>[parent_index] + 2 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( dest, t ),</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                              cur, dest );</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;            }</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;        <span class="keywordflow">if</span>( settings.<a class="code" href="structpathfinding__settings.html#a63add695745ea192d4464597716ebc7d">allow_climb_stairs</a> &amp;&amp; cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> &lt; <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.z &amp;&amp;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            parent_terrain.<a class="code" href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a589ce1673849a76ea3bf17df3fe84ab3">ter_furn_flag::TFLAG_GOES_UP</a> ) ) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            std::optional&lt;tripoint&gt; opt_dest = <a class="code" href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a>-&gt;find_or_make_stairs( <a class="code" href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a>(),</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                                               cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + 1, rope_ladder, <span class="keyword">false</span>, cur );</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">if</span>( !opt_dest ) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            <a class="code" href="structtripoint.html">tripoint</a> dest = opt_dest.value();</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="pathfinding_8cpp.html#afec8831dd25a3475c346d71c4765efdb">vertical_move_destination</a>( *<span class="keyword">this</span>, <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ab09f2463f4ce060d051439b5535a47e6">ter_furn_flag::TFLAG_GOES_DOWN</a>, dest ) ) {</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( dest ) ) {</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                }</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( dest.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                <a class="code" href="namespacepf.html">pf</a>.add_point( layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] + 2,</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                              layer.<a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a>[parent_index] + 2 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( dest, t ),</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                              cur, dest );</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            }</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        <span class="keywordflow">if</span>( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> &lt; <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.z &amp;&amp; parent_terrain.<a class="code" href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a60132a40385f8951559a28563c2905f9">ter_furn_flag::TFLAG_RAMP</a> ) &amp;&amp;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <a class="code" href="classmap.html#a3188771064ca49d4798c6a80bfad0fcd">valid_move</a>( cur, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">tripoint</a>( cur.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + 1 ), <span class="keyword">false</span>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + 1 );</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> it = 0; it &lt; 8; it++ ) {</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a>( cur.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> + x_offset[it], cur.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> + y_offset[it], cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + 1 );</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a> ) ) {</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                }</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                <a class="code" href="namespacepf.html">pf</a>.add_point( layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] + 4,</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                              layer.<a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a>[parent_index] + 4 + 2 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a>, t ),</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                              cur, <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a> );</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            }</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        <span class="keywordflow">if</span>( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> &lt; <a class="code" href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a>.z &amp;&amp; parent_terrain.<a class="code" href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a4099f16f8e2c4ea80e996db0ea6f4c02">ter_furn_flag::TFLAG_RAMP_UP</a> ) &amp;&amp;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;            <a class="code" href="classmap.html#a3188771064ca49d4798c6a80bfad0fcd">valid_move</a>( cur, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">tripoint</a>( cur.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + 1 ), <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;            <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + 1 );</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> it = 0; it &lt; 8; it++ ) {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a>( cur.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> + x_offset[it], cur.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> + y_offset[it], cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> + 1 );</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a> ) ) {</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                }</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <a class="code" href="namespacepf.html">pf</a>.add_point( layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] + 4,</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                              layer.<a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a>[parent_index] + 4 + 2 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a>, t ),</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                              cur, <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">above</a> );</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;        }</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">if</span>( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> &gt; <a class="code" href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a>.z &amp;&amp; parent_terrain.<a class="code" href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">has_flag</a>( <a class="code" href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a26a026d844907da147f1350754b5210b">ter_furn_flag::TFLAG_RAMP_DOWN</a> ) &amp;&amp;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <a class="code" href="classmap.html#a3188771064ca49d4798c6a80bfad0fcd">valid_move</a>( cur, <a class="code" href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">tripoint</a>( cur.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>(), cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - 1 ), <span class="keyword">false</span>, <span class="keyword">true</span>, <span class="keyword">true</span> ) ) {</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;            <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - 1 );</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            <span class="keywordflow">for</span>( <span class="keywordtype">size_t</span> it = 0; it &lt; 8; it++ ) {</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a>( cur.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a> + x_offset[it], cur.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a> + y_offset[it], cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - 1 );</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                <span class="keywordflow">if</span>( !<a class="code" href="classmap.html#a46608709f68358365d0734b1063fed73">inbounds</a>( <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a> ) ) {</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                    <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                <a class="code" href="namespacepf.html">pf</a>.add_point( layer.<a class="code" href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">gscore</a>[parent_index] + 4,</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                              layer.<a class="code" href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">score</a>[parent_index] + 4 + 2 * <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a>, t ),</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                              cur, <a class="code" href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">below</a> );</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;            }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160; </div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    } <span class="keywordflow">while</span>( !done &amp;&amp; !<a class="code" href="namespacepf.html">pf</a>.empty() );</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <span class="keywordflow">if</span>( done ) {</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.reserve( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( f, t ) * 2 );</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;        <a class="code" href="structtripoint.html">tripoint</a> cur = t;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="comment">// Just to limit max distance, in case something weird happens</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        <span class="keywordflow">for</span>( <span class="keywordtype">int</span> fdist = max_length; fdist != 0; fdist-- ) {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">int</span> cur_index = <a class="code" href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a>( cur.<a class="code" href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">xy</a>() );</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keyword">const</span> <a class="code" href="structpath__data__layer.html">path_data_layer</a> &amp;layer = <a class="code" href="namespacepf.html">pf</a>.get_layer( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp;par = layer.<a class="code" href="structpath__data__layer.html#a5bdd7b1a04edd26fb2c69fc96d867c66">parent</a>[cur_index];</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;            <span class="keywordflow">if</span>( cur == f ) {</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;            }</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.push_back( cur );</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            <span class="comment">// Jumps are acceptable on 1 z-level changes</span></div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            <span class="comment">// This is because stairs teleport the player too</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">if</span>( <a class="code" href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a>( cur, par ) &gt; 1 &amp;&amp; <a class="code" href="math__parser__func_8h.html#a24f6ac6e06720c7cdf972a6083847132">std::abs</a>( cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> - par.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> ) != 1 ) {</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <a class="code" href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a>( <span class="stringliteral">&quot;Jump in our route!  %d:%d:%d-&gt;%d:%d:%d&quot;</span>,</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                          cur.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, cur.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, cur.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a>, par.<a class="code" href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">x</a>, par.<a class="code" href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">y</a>, par.<a class="code" href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">z</a> );</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;            }</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160; </div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            cur = par;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;        }</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160; </div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;        std::reverse( <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.begin(), <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>.end() );</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    }</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160; </div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">ret</a>;</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;}</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160; </div>
<div class="line"><a name="l00553"></a><span class="lineno"><a class="line" href="classmap.html#aaab8867d1f8257bc1c713ed74bb04b3b">  553</a></span>&#160;std::vector&lt;tripoint_bub_ms&gt; <a class="code" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">map::route</a>( <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> &amp;f, <span class="keyword">const</span> <a class="code" href="classcoords_1_1coord__point.html">tripoint_bub_ms</a> &amp;t,</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        <span class="keyword">const</span> <a class="code" href="structpathfinding__settings.html">pathfinding_settings</a> &amp;settings,</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keyword">const</span> std::unordered_set&lt;tripoint&gt; &amp;pre_closed )<span class="keyword"> const</span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keyword"></span>{</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    std::vector&lt;tripoint&gt; raw_result = <a class="code" href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">route</a>( f.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>(), t.<a class="code" href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">raw</a>(), settings, pre_closed );</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    std::vector&lt;tripoint_bub_ms&gt; result;</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    std::transform( raw_result.begin(), raw_result.end(), std::back_inserter( result ),</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    []( <span class="keyword">const</span> <a class="code" href="structtripoint.html">tripoint</a> &amp; p ) {</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        return tripoint_bub_ms( p );</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    } );</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;}</div>
<div class="ttc" id="acata__utility_8h_html"><div class="ttname"><a href="cata__utility_8h.html">cata_utility.h</a></div></div>
<div class="ttc" id="acata__variant_8h_html_adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e"><div class="ttname"><a href="cata__variant_8h.html#adfe42687fffdd05d233096b4e7dac2f4a45a310b5cb289ed0e3a8870a1991736e">cata_variant_type::tripoint</a></div><div class="ttdeci">@ tripoint</div></div>
<div class="ttc" id="aclasscoords_1_1coord__point__mut_html_a5a5454f4ce144b5b3a84c2698a54ab8c"><div class="ttname"><a href="classcoords_1_1coord__point__mut.html#a5a5454f4ce144b5b3a84c2698a54ab8c">coords::coord_point_mut::raw</a></div><div class="ttdeci">constexpr const Point &amp; raw() const</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00157">coordinates.h:157</a></div></div>
<div class="ttc" id="aclasscoords_1_1coord__point_html"><div class="ttname"><a href="classcoords_1_1coord__point.html">coords::coord_point&lt; tripoint, coords::origin::reality_bubble, coords::ms &gt;</a></div></div>
<div class="ttc" id="aclassfield_html"><div class="ttname"><a href="classfield.html">field</a></div><div class="ttdoc">A variable sized collection of field entries on a given map square.</div><div class="ttdef"><b>Definition:</b> <a href="field_8h_source.html#l00106">field.h:107</a></div></div>
<div class="ttc" id="aclassmap_html"><div class="ttname"><a href="classmap.html">map</a></div><div class="ttdoc">Manage and cache data about a part of the map.</div><div class="ttdef"><b>Definition:</b> <a href="map_8h_source.html#l00345">map.h:346</a></div></div>
<div class="ttc" id="aclassmap_html_a27e22f0999ea03eff18babc48643c568"><div class="ttname"><a href="classmap.html#a27e22f0999ea03eff18babc48643c568">map::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag, const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03077">map.cpp:3077</a></div></div>
<div class="ttc" id="aclassmap_html_a3188771064ca49d4798c6a80bfad0fcd"><div class="ttname"><a href="classmap.html#a3188771064ca49d4798c6a80bfad0fcd">map::valid_move</a></div><div class="ttdeci">bool valid_move(const tripoint &amp;from, const tripoint &amp;to, bool bash=false, bool flying=false, bool via_ramp=false) const</div><div class="ttdoc">Returns true if a creature could walk from from to to in one step.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02542">map.cpp:2542</a></div></div>
<div class="ttc" id="aclassmap_html_a3bc75c8b706a54c1575b4460b2f363b1"><div class="ttname"><a href="classmap.html#a3bc75c8b706a54c1575b4460b2f363b1">map::is_outside</a></div><div class="ttdeci">bool is_outside(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03395">map.cpp:3395</a></div></div>
<div class="ttc" id="aclassmap_html_a46608709f68358365d0734b1063fed73"><div class="ttname"><a href="classmap.html#a46608709f68358365d0734b1063fed73">map::inbounds</a></div><div class="ttdeci">bool inbounds(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l09057">map.cpp:9057</a></div></div>
<div class="ttc" id="aclassmap_html_a55e7db287690ab6aa7dbe5bf422e3a29"><div class="ttname"><a href="classmap.html#a55e7db287690ab6aa7dbe5bf422e3a29">map::move_cost_internal</a></div><div class="ttdeci">int move_cost_internal(const furn_t &amp;furniture, const ter_t &amp;terrain, const field &amp;field, const vehicle *veh, int vpart) const</div><div class="ttdoc">Internal versions of public functions to avoid checking same variables multiple times.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l02377">map.cpp:2377</a></div></div>
<div class="ttc" id="aclassmap_html_a6de7bd08f979537c8dcda8ebdc7e6d1e"><div class="ttname"><a href="classmap.html#a6de7bd08f979537c8dcda8ebdc7e6d1e">map::clip_to_bounds</a></div><div class="ttdeci">void clip_to_bounds(tripoint &amp;p) const</div><div class="ttdoc">Clips the coordinates of p to fit the map bounds.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l10404">map.cpp:10404</a></div></div>
<div class="ttc" id="aclassmap_html_a73ef839e31b07dcdccedb77368cd92ea"><div class="ttname"><a href="classmap.html#a73ef839e31b07dcdccedb77368cd92ea">map::bash_rating_internal</a></div><div class="ttdeci">int bash_rating_internal(int str, const furn_t &amp;furniture, const ter_t &amp;terrain, bool allow_floor, const vehicle *veh, int part) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l03195">map.cpp:3195</a></div></div>
<div class="ttc" id="aclassmap_html_a9fe6f81443a4ae45012d6e664efb74c2"><div class="ttname"><a href="classmap.html#a9fe6f81443a4ae45012d6e664efb74c2">map::straight_route</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; straight_route(const tripoint &amp;f, const tripoint &amp;t) const</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00167">pathfinding.cpp:167</a></div></div>
<div class="ttc" id="aclassmap_html_aaa8d85d40512cf240c55a050d8952c2f"><div class="ttname"><a href="classmap.html#aaa8d85d40512cf240c55a050d8952c2f">map::bash</a></div><div class="ttdeci">bash_params bash(const tripoint &amp;p, int str, bool silent=false, bool destroy=false, bool bash_floor=false, const vehicle *bashing_vehicle=nullptr)</div><div class="ttdoc">Returns a pair where first is whether anything was smashed and second is if it was destroyed.</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l04292">map.cpp:4292</a></div></div>
<div class="ttc" id="aclassmap_html_ab822562ab4d1069ff53486f67098d0da"><div class="ttname"><a href="classmap.html#ab822562ab4d1069ff53486f67098d0da">map::veh_at_internal</a></div><div class="ttdeci">vehicle * veh_at_internal(const tripoint &amp;p, int &amp;part_num)</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l01356">map.cpp:1356</a></div></div>
<div class="ttc" id="aclassmap_html_acd464679b3bb514e2568ffdb3260ef0c"><div class="ttname"><a href="classmap.html#acd464679b3bb514e2568ffdb3260ef0c">map::route</a></div><div class="ttdeci">std::vector&lt; tripoint &gt; route(const tripoint &amp;f, const tripoint &amp;t, const pathfinding_settings &amp;settings, const std::unordered_set&lt; tripoint &gt; &amp;pre_closed={{ }}) const</div><div class="ttdoc">Calculate the best path using A*.</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00192">pathfinding.cpp:192</a></div></div>
<div class="ttc" id="aclassmap_html_ad357c4299f89a66ece9df0c3edc4401d"><div class="ttname"><a href="classmap.html#ad357c4299f89a66ece9df0c3edc4401d">map::get_pathfinding_cache_ref</a></div><div class="ttdeci">const pathfinding_cache &amp; get_pathfinding_cache_ref(int zlev) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l10312">map.cpp:10312</a></div></div>
<div class="ttc" id="aclassmap_html_ad657dde349de750c36163b30b3e9bdc6"><div class="ttname"><a href="classmap.html#ad657dde349de750c36163b30b3e9bdc6">map::maptile_at_internal</a></div><div class="ttdeci">const_maptile maptile_at_internal(const tripoint &amp;p) const</div><div class="ttdef"><b>Definition:</b> <a href="map_8cpp_source.html#l00414">map.cpp:414</a></div></div>
<div class="ttc" id="aclassmaptile__impl_html"><div class="ttname"><a href="classmaptile__impl.html">maptile_impl</a></div><div class="ttdoc">A wrapper for a submap point.</div><div class="ttdef"><b>Definition:</b> <a href="submap_8h_source.html#l00332">submap.h:333</a></div></div>
<div class="ttc" id="aclassmaptile__impl_html_a0629376a52a7a2f0ac1f55dcb93290a1"><div class="ttname"><a href="classmaptile__impl.html#a0629376a52a7a2f0ac1f55dcb93290a1">maptile_impl::get_ter_t</a></div><div class="ttdeci">const ter_t &amp; get_ter_t() const</div><div class="ttdef"><b>Definition:</b> <a href="submap_8h_source.html#l00375">submap.h:375</a></div></div>
<div class="ttc" id="aclassmaptile__impl_html_a0855cf23c4e9e44b1d35fcb01deb0137"><div class="ttname"><a href="classmaptile__impl.html#a0855cf23c4e9e44b1d35fcb01deb0137">maptile_impl::get_field</a></div><div class="ttdeci">const field &amp; get_field() const</div><div class="ttdef"><b>Definition:</b> <a href="submap_8h_source.html#l00379">submap.h:379</a></div></div>
<div class="ttc" id="aclassmaptile__impl_html_a5d1ab7324df577e978041f6e9881144c"><div class="ttname"><a href="classmaptile__impl.html#a5d1ab7324df577e978041f6e9881144c">maptile_impl::get_furn_t</a></div><div class="ttdeci">const furn_t &amp; get_furn_t() const</div><div class="ttdef"><b>Definition:</b> <a href="submap_8h_source.html#l00372">submap.h:372</a></div></div>
<div class="ttc" id="aclassmaptile__impl_html_a9711662eea34df49d38f835dc227cefb"><div class="ttname"><a href="classmaptile__impl.html#a9711662eea34df49d38f835dc227cefb">maptile_impl::get_trap_t</a></div><div class="ttdeci">const trap &amp; get_trap_t() const</div><div class="ttdef"><b>Definition:</b> <a href="submap_8h_source.html#l00368">submap.h:368</a></div></div>
<div class="ttc" id="aclassscore_html"><div class="ttname"><a href="classscore.html">score</a></div><div class="ttdef"><b>Definition:</b> <a href="event__statistics_8h_source.html#l00101">event_statistics.h:102</a></div></div>
<div class="ttc" id="aclassvehicle_html"><div class="ttname"><a href="classvehicle.html">vehicle</a></div><div class="ttdoc">A vehicle as a whole with all its components.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00801">vehicle.h:802</a></div></div>
<div class="ttc" id="aclassvehicle_html_a316ae13526323d2e762ee54d4161a064"><div class="ttname"><a href="classvehicle.html#a316ae13526323d2e762ee54d4161a064">vehicle::next_part_to_unlock</a></div><div class="ttdeci">int next_part_to_unlock(int p, bool outside=false) const</div><div class="ttdoc">Return the index of the next part to unlock at part p's location.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02993">vehicle.cpp:2993</a></div></div>
<div class="ttc" id="aclassvehicle_html_aa3c434ad827415575b465480af310487"><div class="ttname"><a href="classvehicle.html#aa3c434ad827415575b465480af310487">vehicle::next_part_to_open</a></div><div class="ttdeci">int next_part_to_open(int p, bool outside=false) const</div><div class="ttdoc">Return the index of the next part to open at p's location.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02946">vehicle.cpp:2946</a></div></div>
<div class="ttc" id="aclassvehicle_html_acdb2ebf673a32f657ac9e29b842ee7f5"><div class="ttname"><a href="classvehicle.html#acdb2ebf673a32f657ac9e29b842ee7f5">vehicle::part</a></div><div class="ttdeci">vehicle_part &amp; part(int part_num)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l08098">vehicle.cpp:8098</a></div></div>
<div class="ttc" id="aclassvpart__info_html_aea0fdb1ef9041e28d7856afae97dcc87"><div class="ttname"><a href="classvpart__info.html#aea0fdb1ef9041e28d7856afae97dcc87">vpart_info::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00256">veh_type.h:256</a></div></div>
<div class="ttc" id="aclassvpart__position_html"><div class="ttname"><a href="classvpart__position.html">vpart_position</a></div><div class="ttdoc">Reference to a position (a point) of the vehicle.</div><div class="ttdef"><b>Definition:</b> <a href="vpart__position_8h_source.html#l00043">vpart_position.h:44</a></div></div>
<div class="ttc" id="aclassvpart__position_html_a3888b23941b14d5931801b7afe3e3eb8"><div class="ttname"><a href="classvpart__position.html#a3888b23941b14d5931801b7afe3e3eb8">vpart_position::obstacle_at_part</a></div><div class="ttdeci">std::optional&lt; vpart_reference &gt; obstacle_at_part() const</div><div class="ttdoc">Returns the obstacle that exists at this point of the vehicle (if any).</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8cpp_source.html#l02604">vehicle.cpp:2604</a></div></div>
<div class="ttc" id="acoordinates_8h_html"><div class="ttname"><a href="coordinates_8h.html">coordinates.h</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a31847b31c6ef002e9d16afd7fd0005e3"><div class="ttname"><a href="coordinates_8h.html#a31847b31c6ef002e9d16afd7fd0005e3">line_to</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &amp;&amp;RhsInBounds &gt; &gt; line_to(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00798">coordinates.h:798</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a560abf1cd341e88e2f13f454ec2ecc99"><div class="ttname"><a href="coordinates_8h.html#a560abf1cd341e88e2f13f454ec2ecc99">closest_points_first</a></div><div class="ttdeci">std::vector&lt; coords::coord_point&lt; Point, Origin, Scale &gt; &gt; closest_points_first(const coords::coord_point&lt; Point, Origin, Scale &gt; &amp;loc, int min_dist, int max_dist)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00848">coordinates.h:848</a></div></div>
<div class="ttc" id="acoordinates_8h_html_a8e2cbab6dac12095f06b4cff66857fbb"><div class="ttname"><a href="coordinates_8h.html#a8e2cbab6dac12095f06b4cff66857fbb">rl_dist</a></div><div class="ttdeci">int rl_dist(const coords::coord_point&lt; Point, Origin, Scale, LhsInBounds &gt; &amp;loc1, const coords::coord_point&lt; Point, Origin, Scale, RhsInBounds &gt; &amp;loc2)</div><div class="ttdef"><b>Definition:</b> <a href="coordinates_8h_source.html#l00769">coordinates.h:769</a></div></div>
<div class="ttc" id="acube__direction_8h_html_aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004"><div class="ttname"><a href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca55a9d6aa251e3c334db4ab4055a4a004">cube_direction::above</a></div><div class="ttdeci">@ above</div></div>
<div class="ttc" id="acube__direction_8h_html_aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977"><div class="ttname"><a href="cube__direction_8h.html#aea62013051f3c8842efa174037dfb5bca6cede1cfde12fc6d88ad1d8b6636a977">cube_direction::below</a></div><div class="ttdeci">@ below</div></div>
<div class="ttc" id="adebug_8h_html"><div class="ttname"><a href="debug_8h.html">debug.h</a></div></div>
<div class="ttc" id="adebug_8h_html_a87e509562277a7ada3a75330d00cb445"><div class="ttname"><a href="debug_8h.html#a87e509562277a7ada3a75330d00cb445">debugmsg</a></div><div class="ttdeci">#define debugmsg(...)</div><div class="ttdoc">Debug message of level D_ERROR and class D_MAIN, also includes the source file name and line,...</div><div class="ttdef"><b>Definition:</b> <a href="debug_8h_source.html#l00069">debug.h:69</a></div></div>
<div class="ttc" id="adescriptions_8cpp_html_aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04"><div class="ttname"><a href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8a47afa88cfb198f52733fa3d1f43d7f04">description_target::terrain</a></div><div class="ttdeci">@ terrain</div></div>
<div class="ttc" id="adescriptions_8cpp_html_aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d"><div class="ttname"><a href="descriptions_8cpp.html#aeed2fa049c80ba4e2960866b4e00d5d8afd87f5969ecaa22eaca667dd742f916d">description_target::furniture</a></div><div class="ttdeci">@ furniture</div></div>
<div class="ttc" id="adisplay_8h_html_ad55df0d7f625a78f1afc728ee1a6d6a4ad2ccda10db94c2b5d51beed10484c025"><div class="ttname"><a href="display_8h.html#ad55df0d7f625a78f1afc728ee1a6d6a4ad2ccda10db94c2b5d51beed10484c025">bodygraph_var::hp</a></div><div class="ttdeci">@ hp</div></div>
<div class="ttc" id="agame_8cpp_html_abeb98e93502d73818b4a73fabe191bc1"><div class="ttname"><a href="game_8cpp.html#abeb98e93502d73818b4a73fabe191bc1">g</a></div><div class="ttdeci">std::unique_ptr&lt; game &gt; g</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l00382">game.cpp:382</a></div></div>
<div class="ttc" id="agame_8cpp_html_afa1063326b0c16b43c6f3dc8c3df403d"><div class="ttname"><a href="game_8cpp.html#afa1063326b0c16b43c6f3dc8c3df403d">get_map</a></div><div class="ttdeci">map &amp; get_map()</div><div class="ttdef"><b>Definition:</b> <a href="game_8cpp_source.html#l13822">game.cpp:13822</a></div></div>
<div class="ttc" id="agame_8h_html"><div class="ttname"><a href="game_8h.html">game.h</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a2b6d307dfab13601267fc3c627192f4e"><div class="ttname"><a href="game__constants_8h.html#a2b6d307dfab13601267fc3c627192f4e">MAPSIZE_Y</a></div><div class="ttdeci">constexpr int MAPSIZE_Y</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00046">game_constants.h:46</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a39fd8a829e3dc412646663066dbdb54c"><div class="ttname"><a href="game__constants_8h.html#a39fd8a829e3dc412646663066dbdb54c">SEEX</a></div><div class="ttdeci">constexpr int SEEX</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00042">game_constants.h:42</a></div></div>
<div class="ttc" id="agame__constants_8h_html_a3b81841aab42975add2ee3525f48058a"><div class="ttname"><a href="game__constants_8h.html#a3b81841aab42975add2ee3525f48058a">OVERMAP_LAYERS</a></div><div class="ttdeci">constexpr int OVERMAP_LAYERS</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00077">game_constants.h:77</a></div></div>
<div class="ttc" id="agame__constants_8h_html_aad0eacfa516a8f7e005674027d7640fe"><div class="ttname"><a href="game__constants_8h.html#aad0eacfa516a8f7e005674027d7640fe">OVERMAP_DEPTH</a></div><div class="ttdeci">constexpr int OVERMAP_DEPTH</div><div class="ttdef"><b>Definition:</b> <a href="game__constants_8h_source.html#l00073">game_constants.h:73</a></div></div>
<div class="ttc" id="agates_8h_html"><div class="ttname"><a href="gates_8h.html">gates.h</a></div></div>
<div class="ttc" id="aline_8h_html"><div class="ttname"><a href="line_8h.html">line.h</a></div></div>
<div class="ttc" id="amap_8h_html"><div class="ttname"><a href="map_8h.html">map.h</a></div></div>
<div class="ttc" id="amapdata_8h_html"><div class="ttname"><a href="mapdata_8h.html">mapdata.h</a></div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054">ter_furn_flag</a></div><div class="ttdeci">ter_furn_flag</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00202">mapdata.h:202</a></div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a26a026d844907da147f1350754b5210b"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a26a026d844907da147f1350754b5210b">ter_furn_flag::TFLAG_RAMP_DOWN</a></div><div class="ttdeci">@ TFLAG_RAMP_DOWN</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a4099f16f8e2c4ea80e996db0ea6f4c02"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a4099f16f8e2c4ea80e996db0ea6f4c02">ter_furn_flag::TFLAG_RAMP_UP</a></div><div class="ttdeci">@ TFLAG_RAMP_UP</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a589ce1673849a76ea3bf17df3fe84ab3"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a589ce1673849a76ea3bf17df3fe84ab3">ter_furn_flag::TFLAG_GOES_UP</a></div><div class="ttdeci">@ TFLAG_GOES_UP</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054a60132a40385f8951559a28563c2905f9"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054a60132a40385f8951559a28563c2905f9">ter_furn_flag::TFLAG_RAMP</a></div><div class="ttdeci">@ TFLAG_RAMP</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054ab09f2463f4ce060d051439b5535a47e6"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ab09f2463f4ce060d051439b5535a47e6">ter_furn_flag::TFLAG_GOES_DOWN</a></div><div class="ttdeci">@ TFLAG_GOES_DOWN</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054ac4a81a25e90b04b9a92e0ec8945aad48"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054ac4a81a25e90b04b9a92e0ec8945aad48">ter_furn_flag::TFLAG_OPENCLOSE_INSIDE</a></div><div class="ttdeci">@ TFLAG_OPENCLOSE_INSIDE</div></div>
<div class="ttc" id="amapdata_8h_html_a2edbbfd25069897b3062331e48224054af607730a38ff7975c6724b22881e0e58"><div class="ttname"><a href="mapdata_8h.html#a2edbbfd25069897b3062331e48224054af607730a38ff7975c6724b22881e0e58">ter_furn_flag::TFLAG_NO_FLOOR</a></div><div class="ttdeci">@ TFLAG_NO_FLOOR</div></div>
<div class="ttc" id="amath__parser__func_8h_html_a24f6ac6e06720c7cdf972a6083847132"><div class="ttname"><a href="math__parser__func_8h.html#a24f6ac6e06720c7cdf972a6083847132">abs</a></div><div class="ttdeci">double abs(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00030">math_parser_func.h:30</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a9009aa9e5eb1323238ebddffd8e1aedf"><div class="ttname"><a href="math__parser__func_8h.html#a9009aa9e5eb1323238ebddffd8e1aedf">max</a></div><div class="ttdeci">double max(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00035">math_parser_func.h:35</a></div></div>
<div class="ttc" id="amath__parser__func_8h_html_a993dede52d23a9a3d15b01a342391ef4"><div class="ttname"><a href="math__parser__func_8h.html#a993dede52d23a9a3d15b01a342391ef4">min</a></div><div class="ttdeci">double min(std::vector&lt; double &gt; const &amp;params)</div><div class="ttdef"><b>Definition:</b> <a href="math__parser__func_8h_source.html#l00043">math_parser_func.h:43</a></div></div>
<div class="ttc" id="anamespacecata_1_1hash64__detail_html_a5ca825db6fd06946302c60daa97333e4"><div class="ttname"><a href="namespacecata_1_1hash64__detail.html#a5ca825db6fd06946302c60daa97333e4">cata::hash64_detail::ret</a></div><div class="ttdeci">T ret</div><div class="ttdef"><b>Definition:</b> <a href="hash__utils_8h_source.html#l00097">hash_utils.h:97</a></div></div>
<div class="ttc" id="anamespacedoors_html"><div class="ttname"><a href="namespacedoors.html">doors</a></div><div class="ttdef"><b>Definition:</b> <a href="gates_8h_source.html#l00028">gates.h:29</a></div></div>
<div class="ttc" id="anamespacepf_html"><div class="ttname"><a href="namespacepf.html">pf</a></div><div class="ttdef"><b>Definition:</b> <a href="overmap_8h_source.html#l00044">overmap.h:45</a></div></div>
<div class="ttc" id="apathfinding_8cpp_html_ad6cd1f35ed998d84b516ae7ca8bf7bc9"><div class="ttname"><a href="pathfinding_8cpp.html#ad6cd1f35ed998d84b516ae7ca8bf7bc9">flat_index</a></div><div class="ttdeci">static constexpr int flat_index(const point &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00031">pathfinding.cpp:31</a></div></div>
<div class="ttc" id="apathfinding_8cpp_html_ae55025945fb76acd7d5234497a47c78c"><div class="ttname"><a href="pathfinding_8cpp.html#ae55025945fb76acd7d5234497a47c78c">is_disjoint</a></div><div class="ttdeci">static bool is_disjoint(const Set1 &amp;set1, const Set2 &amp;set2)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00137">pathfinding.cpp:137</a></div></div>
<div class="ttc" id="apathfinding_8cpp_html_af9280c7df7cc38110497fea42349bfa7"><div class="ttname"><a href="pathfinding_8cpp.html#af9280c7df7cc38110497fea42349bfa7">pf</a></div><div class="ttdeci">static pathfinder pf</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00116">pathfinding.cpp:116</a></div></div>
<div class="ttc" id="apathfinding_8cpp_html_afec8831dd25a3475c346d71c4765efdb"><div class="ttname"><a href="pathfinding_8cpp.html#afec8831dd25a3475c346d71c4765efdb">vertical_move_destination</a></div><div class="ttdeci">static bool vertical_move_destination(const map &amp;m, ter_furn_flag flag, tripoint &amp;t)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00121">pathfinding.cpp:121</a></div></div>
<div class="ttc" id="apathfinding_8h_html"><div class="ttname"><a href="pathfinding_8h.html">pathfinding.h</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55">pf_special</a></div><div class="ttdeci">pf_special</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00009">pathfinding.h:9</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55a05850be5e3f2c1bfcbaad5d43fa8b366"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a05850be5e3f2c1bfcbaad5d43fa8b366">PF_VEHICLE</a></div><div class="ttdeci">@ PF_VEHICLE</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00013">pathfinding.h:13</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55a19b842b59c62891e6a86c1b22752b2d9"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a19b842b59c62891e6a86c1b22752b2d9">PF_WALL</a></div><div class="ttdeci">@ PF_WALL</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00012">pathfinding.h:12</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55a24c5298c256b8ee4de60ce1872396d7b"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a24c5298c256b8ee4de60ce1872396d7b">PF_CLIMBABLE</a></div><div class="ttdeci">@ PF_CLIMBABLE</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00017">pathfinding.h:17</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55a55f8aaf1025c549edc7e26cd6f4595ac"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55a55f8aaf1025c549edc7e26cd6f4595ac">PF_UPDOWN</a></div><div class="ttdeci">@ PF_UPDOWN</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00016">pathfinding.h:16</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55accbf1609e79c6baaf7bf745d0ecd0f54"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55accbf1609e79c6baaf7bf745d0ecd0f54">PF_TRAP</a></div><div class="ttdeci">@ PF_TRAP</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00015">pathfinding.h:15</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55ae0b53a72c5504a50f28bb80be75e6b4c"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55ae0b53a72c5504a50f28bb80be75e6b4c">PF_SHARP</a></div><div class="ttdeci">@ PF_SHARP</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00018">pathfinding.h:18</a></div></div>
<div class="ttc" id="apathfinding_8h_html_ad4fb18e6e70f8406c209ab1bb25dbb55aecc59352ad14424c7d789446dc655e0f"><div class="ttname"><a href="pathfinding_8h.html#ad4fb18e6e70f8406c209ab1bb25dbb55aecc59352ad14424c7d789446dc655e0f">PF_SLOW</a></div><div class="ttdeci">@ PF_SLOW</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00011">pathfinding.h:11</a></div></div>
<div class="ttc" id="apoint_8h_html"><div class="ttname"><a href="point_8h.html">point.h</a></div></div>
<div class="ttc" id="astructfurn__t_html"><div class="ttname"><a href="structfurn__t.html">furn_t</a></div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00641">mapdata.h:641</a></div></div>
<div class="ttc" id="astructmap__data__common__t_html_a630778707744fb147436b9aa0c370a7e"><div class="ttname"><a href="structmap__data__common__t.html#a630778707744fb147436b9aa0c370a7e">map_data_common_t::has_flag</a></div><div class="ttdeci">bool has_flag(const std::string &amp;flag) const</div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00534">mapdata.h:534</a></div></div>
<div class="ttc" id="astructpair__greater__cmp__first_html"><div class="ttname"><a href="structpair__greater__cmp__first.html">pair_greater_cmp_first</a></div><div class="ttdoc">Greater-than comparison operator; required by the sort interface.</div><div class="ttdef"><b>Definition:</b> <a href="cata__utility_8h_source.html#l00033">cata_utility.h:33</a></div></div>
<div class="ttc" id="astructpath__data__layer_html"><div class="ttname"><a href="structpath__data__layer.html">path_data_layer</a></div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00037">pathfinding.cpp:37</a></div></div>
<div class="ttc" id="astructpath__data__layer_html_a28aae58e8aa5eb15f019b60d80046a37"><div class="ttname"><a href="structpath__data__layer.html#a28aae58e8aa5eb15f019b60d80046a37">path_data_layer::open</a></div><div class="ttdeci">std::bitset&lt; MAPSIZE_X *MAPSIZE_Y &gt; open</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00040">pathfinding.cpp:40</a></div></div>
<div class="ttc" id="astructpath__data__layer_html_a494569e576ea86d1f56701552f03ed1b"><div class="ttname"><a href="structpath__data__layer.html#a494569e576ea86d1f56701552f03ed1b">path_data_layer::score</a></div><div class="ttdeci">std::array&lt; int, MAPSIZE_X *MAPSIZE_Y &gt; score</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00041">pathfinding.cpp:41</a></div></div>
<div class="ttc" id="astructpath__data__layer_html_a5bdd7b1a04edd26fb2c69fc96d867c66"><div class="ttname"><a href="structpath__data__layer.html#a5bdd7b1a04edd26fb2c69fc96d867c66">path_data_layer::parent</a></div><div class="ttdeci">std::array&lt; tripoint, MAPSIZE_X *MAPSIZE_Y &gt; parent</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00043">pathfinding.cpp:43</a></div></div>
<div class="ttc" id="astructpath__data__layer_html_ac02eadaeb679ced09f671618a8e20487"><div class="ttname"><a href="structpath__data__layer.html#ac02eadaeb679ced09f671618a8e20487">path_data_layer::reset</a></div><div class="ttdeci">void reset()</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00045">pathfinding.cpp:45</a></div></div>
<div class="ttc" id="astructpath__data__layer_html_aeeeaaf04c42436bad1adce51823d41f0"><div class="ttname"><a href="structpath__data__layer.html#aeeeaaf04c42436bad1adce51823d41f0">path_data_layer::closed</a></div><div class="ttdeci">std::bitset&lt; MAPSIZE_X *MAPSIZE_Y &gt; closed</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00039">pathfinding.cpp:39</a></div></div>
<div class="ttc" id="astructpath__data__layer_html_af8f2943b6431ffd9590a3ca77b1410a6"><div class="ttname"><a href="structpath__data__layer.html#af8f2943b6431ffd9590a3ca77b1410a6">path_data_layer::gscore</a></div><div class="ttdeci">std::array&lt; int, MAPSIZE_X *MAPSIZE_Y &gt; gscore</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00042">pathfinding.cpp:42</a></div></div>
<div class="ttc" id="astructpathfinder_html"><div class="ttname"><a href="structpathfinder.html">pathfinder</a></div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00051">pathfinding.cpp:51</a></div></div>
<div class="ttc" id="astructpathfinder_html_a083a5fbadeb8cbaf3c408c093e90479b"><div class="ttname"><a href="structpathfinder.html#a083a5fbadeb8cbaf3c408c093e90479b">pathfinder::empty</a></div><div class="ttdeci">bool empty() const</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00076">pathfinding.cpp:76</a></div></div>
<div class="ttc" id="astructpathfinder_html_a0e8ca462eec97c81030745935f80935f"><div class="ttname"><a href="structpathfinder.html#a0e8ca462eec97c81030745935f80935f">pathfinder::unclose_point</a></div><div class="ttdeci">void unclose_point(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00109">pathfinding.cpp:109</a></div></div>
<div class="ttc" id="astructpathfinder_html_a19c47931c0e5c4fecfc7eaa828c12636"><div class="ttname"><a href="structpathfinder.html#a19c47931c0e5c4fecfc7eaa828c12636">pathfinder::queue_type</a></div><div class="ttdeci">std::priority_queue&lt; std::pair&lt; int, tripoint &gt;, std::vector&lt; std::pair&lt; int, tripoint &gt; &gt;, pair_greater_cmp_first &gt; queue_type</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00052">pathfinding.cpp:53</a></div></div>
<div class="ttc" id="astructpathfinder_html_a330d627fcb4c3e55b4ed7ba26aaaf7df"><div class="ttname"><a href="structpathfinder.html#a330d627fcb4c3e55b4ed7ba26aaaf7df">pathfinder::path_data</a></div><div class="ttdeci">std::array&lt; std::unique_ptr&lt; path_data_layer &gt;, OVERMAP_LAYERS &gt; path_data</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00055">pathfinding.cpp:55</a></div></div>
<div class="ttc" id="astructpathfinder_html_a3c00ab47aac12bbdf5ace224fb47591d"><div class="ttname"><a href="structpathfinder.html#a3c00ab47aac12bbdf5ace224fb47591d">pathfinder::get_layer</a></div><div class="ttdeci">path_data_layer &amp; get_layer(const int z)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00057">pathfinding.cpp:57</a></div></div>
<div class="ttc" id="astructpathfinder_html_a745c428924f3987117d9072b12f838ea"><div class="ttname"><a href="structpathfinder.html#a745c428924f3987117d9072b12f838ea">pathfinder::open</a></div><div class="ttdeci">queue_type open</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00054">pathfinding.cpp:54</a></div></div>
<div class="ttc" id="astructpathfinder_html_a78609d9a28d759c0c568cbc0e354f553"><div class="ttname"><a href="structpathfinder.html#a78609d9a28d759c0c568cbc0e354f553">pathfinder::reset</a></div><div class="ttdeci">void reset(int minz, int maxz)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00066">pathfinding.cpp:66</a></div></div>
<div class="ttc" id="astructpathfinder_html_aab715954a28f2efa66c81e0b65284f10"><div class="ttname"><a href="structpathfinder.html#aab715954a28f2efa66c81e0b65284f10">pathfinder::close_point</a></div><div class="ttdeci">void close_point(const tripoint &amp;p)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00103">pathfinding.cpp:103</a></div></div>
<div class="ttc" id="astructpathfinder_html_ab7b80d453998f12d82f075db97234f05"><div class="ttname"><a href="structpathfinder.html#ab7b80d453998f12d82f075db97234f05">pathfinder::add_point</a></div><div class="ttdeci">void add_point(const int gscore, const int score, const tripoint &amp;from, const tripoint &amp;to)</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00086">pathfinding.cpp:86</a></div></div>
<div class="ttc" id="astructpathfinder_html_ae4022c0a90aef5de1430e41dae3c8391"><div class="ttname"><a href="structpathfinder.html#ae4022c0a90aef5de1430e41dae3c8391">pathfinder::get_next</a></div><div class="ttdeci">tripoint get_next()</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8cpp_source.html#l00080">pathfinding.cpp:80</a></div></div>
<div class="ttc" id="astructpathfinding__cache_html"><div class="ttname"><a href="structpathfinding__cache.html">pathfinding_cache</a></div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00043">pathfinding.h:43</a></div></div>
<div class="ttc" id="astructpathfinding__cache_html_a7a9d431915c689367774248820b3b5a5"><div class="ttname"><a href="structpathfinding__cache.html#a7a9d431915c689367774248820b3b5a5">pathfinding_cache::special</a></div><div class="ttdeci">cata::mdarray&lt; pf_special, point_bub_ms &gt; special</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00049">pathfinding.h:49</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html"><div class="ttname"><a href="structpathfinding__settings.html">pathfinding_settings</a></div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00052">pathfinding.h:52</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_a0382d7086559f7f5c7c9c44eba612311"><div class="ttname"><a href="structpathfinding__settings.html#a0382d7086559f7f5c7c9c44eba612311">pathfinding_settings::avoid_rough_terrain</a></div><div class="ttdeci">bool avoid_rough_terrain</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00066">pathfinding.h:66</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_a3b87b50c231e1614cf7b3d1ba8ac3feb"><div class="ttname"><a href="structpathfinding__settings.html#a3b87b50c231e1614cf7b3d1ba8ac3feb">pathfinding_settings::max_length</a></div><div class="ttdeci">int max_length</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00056">pathfinding.h:56</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_a43905661151e40ed74bd75e8030d6622"><div class="ttname"><a href="structpathfinding__settings.html#a43905661151e40ed74bd75e8030d6622">pathfinding_settings::allow_unlock_doors</a></div><div class="ttdeci">bool allow_unlock_doors</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00063">pathfinding.h:63</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_a559966d37cd11c7dc42cc856e550f66a"><div class="ttname"><a href="structpathfinding__settings.html#a559966d37cd11c7dc42cc856e550f66a">pathfinding_settings::allow_open_doors</a></div><div class="ttdeci">bool allow_open_doors</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00062">pathfinding.h:62</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_a63add695745ea192d4464597716ebc7d"><div class="ttname"><a href="structpathfinding__settings.html#a63add695745ea192d4464597716ebc7d">pathfinding_settings::allow_climb_stairs</a></div><div class="ttdeci">bool allow_climb_stairs</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00065">pathfinding.h:65</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_ab888f81c3ce0d4f691e9f8619cf31328"><div class="ttname"><a href="structpathfinding__settings.html#ab888f81c3ce0d4f691e9f8619cf31328">pathfinding_settings::avoid_sharp</a></div><div class="ttdeci">bool avoid_sharp</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00067">pathfinding.h:67</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_ab8d46d403f59fc4e86ee1392c0a7b05a"><div class="ttname"><a href="structpathfinding__settings.html#ab8d46d403f59fc4e86ee1392c0a7b05a">pathfinding_settings::bash_strength</a></div><div class="ttdeci">int bash_strength</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00053">pathfinding.h:53</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_acba070ceb6ae16b9c3991a1d2814d4c8"><div class="ttname"><a href="structpathfinding__settings.html#acba070ceb6ae16b9c3991a1d2814d4c8">pathfinding_settings::avoid_traps</a></div><div class="ttdeci">bool avoid_traps</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00064">pathfinding.h:64</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_ad0b14e2ee3fc5bb59d985e98e2fa9504"><div class="ttname"><a href="structpathfinding__settings.html#ad0b14e2ee3fc5bb59d985e98e2fa9504">pathfinding_settings::max_dist</a></div><div class="ttdeci">int max_dist</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00054">pathfinding.h:54</a></div></div>
<div class="ttc" id="astructpathfinding__settings_html_ad6c8b466453d6bd53db004ce7ab625c4"><div class="ttname"><a href="structpathfinding__settings.html#ad6c8b466453d6bd53db004ce7ab625c4">pathfinding_settings::climb_cost</a></div><div class="ttdeci">int climb_cost</div><div class="ttdef"><b>Definition:</b> <a href="pathfinding_8h_source.html#l00060">pathfinding.h:60</a></div></div>
<div class="ttc" id="astructpoint_html"><div class="ttname"><a href="structpoint.html">point</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00020">point.h:20</a></div></div>
<div class="ttc" id="astructpoint_html_a9a82ca9504acabb1e30569f89c805471"><div class="ttname"><a href="structpoint.html#a9a82ca9504acabb1e30569f89c805471">point::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00024">point.h:24</a></div></div>
<div class="ttc" id="astructpoint_html_ad679b07fb69d55f5ad454d0f1f2891d5"><div class="ttname"><a href="structpoint.html#ad679b07fb69d55f5ad454d0f1f2891d5">point::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00023">point.h:23</a></div></div>
<div class="ttc" id="astructter__t_html"><div class="ttname"><a href="structter__t.html">ter_t</a></div><div class="ttdef"><b>Definition:</b> <a href="mapdata_8h_source.html#l00598">mapdata.h:598</a></div></div>
<div class="ttc" id="astructtrap_html"><div class="ttname"><a href="structtrap.html">trap</a></div><div class="ttdoc">Some traps aren't actually traps in the usual sense of the word.</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00109">trap.h:109</a></div></div>
<div class="ttc" id="astructtrap_html_adc8f59b97597d373f7cb0bbcf061e794"><div class="ttname"><a href="structtrap.html#adc8f59b97597d373f7cb0bbcf061e794">trap::is_benign</a></div><div class="ttdeci">bool is_benign() const</div><div class="ttdoc">If true, this is not really a trap and there won't be any safety queries before stepping onto it (e....</div><div class="ttdef"><b>Definition:</b> <a href="trap_8h_source.html#l00221">trap.h:221</a></div></div>
<div class="ttc" id="astructtripoint_html"><div class="ttname"><a href="structtripoint.html">tripoint</a></div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00129">point.h:129</a></div></div>
<div class="ttc" id="astructtripoint_html_a89f6c0a16e2bfd7ce4f1f1d20404c4d7"><div class="ttname"><a href="structtripoint.html#a89f6c0a16e2bfd7ce4f1f1d20404c4d7">tripoint::y</a></div><div class="ttdeci">int y</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00133">point.h:133</a></div></div>
<div class="ttc" id="astructtripoint_html_ac944c0e329b5eba2602f7a52f66bbbb9"><div class="ttname"><a href="structtripoint.html#ac944c0e329b5eba2602f7a52f66bbbb9">tripoint::z</a></div><div class="ttdeci">int z</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00134">point.h:134</a></div></div>
<div class="ttc" id="astructtripoint_html_accc0725c936dbebb2486f969f39e2e5f"><div class="ttname"><a href="structtripoint.html#accc0725c936dbebb2486f969f39e2e5f">tripoint::xy</a></div><div class="ttdeci">constexpr point xy() const</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00202">point.h:202</a></div></div>
<div class="ttc" id="astructtripoint_html_affdc0d5b75024cbfacd208a495def3dc"><div class="ttname"><a href="structtripoint.html#affdc0d5b75024cbfacd208a495def3dc">tripoint::x</a></div><div class="ttdeci">int x</div><div class="ttdef"><b>Definition:</b> <a href="point_8h_source.html#l00132">point.h:132</a></div></div>
<div class="ttc" id="astructvehicle__part_html"><div class="ttname"><a href="structvehicle__part.html">vehicle_part</a></div><div class="ttdoc">Structure, describing vehicle part (i.e., wheel, seat)</div><div class="ttdef"><b>Definition:</b> <a href="vehicle_8h_source.html#l00254">vehicle.h:254</a></div></div>
<div class="ttc" id="astructvehicle__part_html_a002a1023cd1a96d43556a1b912ebd27b"><div class="ttname"><a href="structvehicle__part.html#a002a1023cd1a96d43556a1b912ebd27b">vehicle_part::info</a></div><div class="ttdeci">const vpart_info &amp; info() const</div><div class="ttdoc">Get part definition common to all parts of this type.</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__part_8cpp_source.html#l00623">vehicle_part.cpp:623</a></div></div>
<div class="ttc" id="astructvehicle__part_html_a957611df4a4b4faa87f67ff64bea72ce"><div class="ttname"><a href="structvehicle__part.html#a957611df4a4b4faa87f67ff64bea72ce">vehicle_part::hp</a></div><div class="ttdeci">int hp() const</div><div class="ttdoc">current part health with range [0,durability]</div><div class="ttdef"><b>Definition:</b> <a href="vehicle__part_8cpp_source.html#l00149">vehicle_part.cpp:149</a></div></div>
<div class="ttc" id="asubmap_8h_html"><div class="ttname"><a href="submap_8h.html">submap.h</a></div></div>
<div class="ttc" id="atrap_8h_html"><div class="ttname"><a href="trap_8h.html">trap.h</a></div></div>
<div class="ttc" id="atype__id_8h_html"><div class="ttname"><a href="type__id_8h.html">type_id.h</a></div></div>
<div class="ttc" id="aveh__type_8h_html"><div class="ttname"><a href="veh__type_8h.html">veh_type.h</a></div></div>
<div class="ttc" id="aveh__type_8h_html_aa3ff66a8c100c3deb40dfa70f1eb307ea812fb775f113f8e70717ffcf2dacf15f"><div class="ttname"><a href="veh__type_8h.html#aa3ff66a8c100c3deb40dfa70f1eb307ea812fb775f113f8e70717ffcf2dacf15f">VPFLAG_OPENABLE</a></div><div class="ttdeci">@ VPFLAG_OPENABLE</div><div class="ttdef"><b>Definition:</b> <a href="veh__type_8h_source.html#l00072">veh_type.h:72</a></div></div>
<div class="ttc" id="avehicle_8h_html"><div class="ttname"><a href="vehicle_8h.html">vehicle.h</a></div></div>
<div class="ttc" id="avpart__position_8h_html"><div class="ttname"><a href="vpart__position_8h.html">vpart_position.h</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue May 7 2024 08:48:31 for Cataclysm DDA by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
